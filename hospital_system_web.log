2025-03-30 02:12:02,469 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:12:02,469 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:12:02,469 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 7aec99ae-59b2-4311-989d-5925cc19c6e9)
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 0facea4a-ef82-41e1-bd7f-63d48fe38283)
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 800967ad-34cf-42dd-aa3c-b7f94bbc11c0)
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 54cb6ec7-12cb-4ecf-ade5-b7f04734e426)
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:12:02,482 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:12:02,492 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:12:02,492 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:12:02,492 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:12:02,492 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:12:02,515 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 02:12:02,515 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 02:12:02,515 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:12:02,686 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:12:02,686 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:12:02,686 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 68a762d4-ce73-482c-830b-94c3765fe27d)
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 2ee069f2-a5f0-4166-a24f-23324d51c420)
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 48b22245-56d6-4cb9-bc60-0ac47e935676)
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 1e45200a-be88-4a6e-b772-a5cbd8994e11)
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:12:02,699 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:12:02,708 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:12:02,709 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:12:02,709 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:12:02,709 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:12:02,722 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:12:02,727 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:12:09,116 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:12:09] "GET / HTTP/1.1" 200 -
2025-03-30 02:12:09,124 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:12:09] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 02:12:09,124 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:12:09] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 02:12:09,153 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:12:09] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-03-30 02:12:26,084 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 02:12:26,084 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 6d9e008b-5957-4e2b-a378-a44ec3e22bd2
2025-03-30 02:12:26,084 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:12:26,084 - Hospital-MultiAgent-System - INFO - 创建新患者记录: P0001
2025-03-30 02:12:26,085 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:12:26,085 - Hospital-MultiAgent-System-Web - ERROR - 处理咨询请求时出错: 'list' object has no attribute 'items'
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 156, in start_consultation
    result = hospital_system["orchestrator"].process_consultation(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 232, in process_consultation
    for key, value in short_term_consultations.items():
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'items'
2025-03-30 02:12:26,086 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:12:26] "[35m[1mPOST /api/consult HTTP/1.1[0m" 500 -
2025-03-30 02:13:33,533 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 02:13:33,586 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:13:33,780 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:13:33,780 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:13:33,780 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 06a1c321-68e5-4b6b-99c7-7c0ba0d951b7)
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 1e82bce1-9654-4c6c-a2ad-179a0a08bd4e)
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 330a0d21-d257-459c-a063-54d3660415e7)
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 650f82cd-c648-46a4-9054-8cfa7ec70486)
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:13:33,793 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:13:33,803 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:13:33,803 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:13:33,803 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:13:33,804 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:13:33,817 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:13:33,821 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:14:29,333 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 02:14:29,401 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:14:29,586 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:14:29,586 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:14:29,586 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 9946493e-e393-44d6-a1bf-e0615aaaaecc)
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: da108247-81b2-48a5-8f51-d28cf7cb5576)
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: c8c4cb4e-6ade-405a-972f-246ef2159d9f)
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 770c265e-3a73-4e6c-996d-f60507c92eeb)
2025-03-30 02:14:29,599 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:14:29,600 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:14:29,600 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:14:29,600 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:14:29,609 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:14:29,609 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:14:29,609 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:14:29,610 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:14:29,623 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:14:29,627 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:14:44,898 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:14:44,899 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:14:44,899 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:14:44,911 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:14:44,911 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:14:44,911 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:14:44,911 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:14:44,911 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:14:44,911 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 28028a49-adae-4e3a-b66c-e905402666fc)
2025-03-30 02:14:44,911 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:14:44,911 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 67078a3b-6f13-40b2-8248-91fbab7828f2)
2025-03-30 02:14:44,911 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:14:44,912 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: e8536a6c-5497-4124-a74f-5ff3c2144a07)
2025-03-30 02:14:44,912 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:14:44,912 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 502dc3ed-7c32-4b85-8a72-2e7dbc778c74)
2025-03-30 02:14:44,912 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:14:44,912 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:14:44,912 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:14:44,912 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:14:44,921 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:14:44,921 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:14:44,921 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:14:44,922 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:14:44,942 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 02:14:44,943 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 02:14:44,943 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:14:45,116 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:14:45,116 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:14:45,116 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:14:45,128 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:14:45,128 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:14:45,128 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:14:45,128 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:14:45,128 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:14:45,128 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 89443adb-afdc-442b-8f6a-3a74b8f0ac86)
2025-03-30 02:14:45,128 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:14:45,129 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 53bc06ac-b3c5-494a-ad24-3d9bcad7214b)
2025-03-30 02:14:45,129 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:14:45,129 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: c532fe34-5aad-496e-8c72-89c81e4722fc)
2025-03-30 02:14:45,129 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:14:45,129 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: fc82b57c-e88b-44be-b0e4-86aea8314d00)
2025-03-30 02:14:45,129 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:14:45,129 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:14:45,129 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:14:45,129 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:14:45,138 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:14:45,138 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:14:45,138 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:14:45,139 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:14:45,151 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:14:45,156 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:14:51,158 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:14:51] "GET / HTTP/1.1" 200 -
2025-03-30 02:14:51,174 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:14:51] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 02:14:51,174 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:14:51] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 02:15:05,428 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 02:15:05,428 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: a2a31686-3f46-4fe6-8cfa-25919163d69c
2025-03-30 02:15:05,429 - Hospital-MultiAgent-System - INFO - 找到已有患者记录: P0001
2025-03-30 02:15:05,429 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:15:05,429 - Hospital-MultiAgent-System - INFO - 患者 赵四 (ID: P0001) 是复诊患者
2025-03-30 02:15:05,430 - Hospital-MultiAgent-System - ERROR - 问诊流程发生错误: 'NoneType' object has no attribute 'get'
2025-03-30 02:15:05,430 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:15:05,430 - Hospital-MultiAgent-System-Web - ERROR - 处理咨询请求时出错: 'Orchestrator' object has no attribute 'get_conversation_history'
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 171, in start_consultation
    "history": hospital_system["orchestrator"].get_conversation_history()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Orchestrator' object has no attribute 'get_conversation_history'. Did you mean: 'conversation_history'?
2025-03-30 02:15:05,432 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:15:05] "[35m[1mPOST /api/consult HTTP/1.1[0m" 500 -
2025-03-30 02:16:04,818 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 02:16:04,869 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:16:05,055 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:16:05,055 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:16:05,055 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:16:05,067 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:16:05,067 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:16:05,067 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: a09400dd-f641-48b4-b697-b7b04b913b96)
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 1fe91e4f-b810-473f-8191-b2aa032c7592)
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: c06164bc-01cd-4a8a-944d-c93d7bc62baf)
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 2f6821af-8820-4a47-bbae-c9492ac487d8)
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:16:05,068 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:16:05,078 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:16:05,078 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:16:05,078 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:16:05,078 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:16:05,092 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:16:05,096 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:16:38,384 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 02:16:38,442 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:16:38,637 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:16:38,637 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:16:38,637 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:16:38,649 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:16:38,649 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:16:38,649 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 6e38b292-ad2c-4bfa-bd0b-385f3b198162)
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: f0909385-dd93-4b85-9663-b281b91f419a)
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 6b6662f2-5f46-41aa-a223-5f0a317a4219)
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 4e921fde-7e7b-4594-b528-4ab79da53e7c)
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:16:38,650 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:16:38,660 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:16:38,660 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:16:38,660 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:16:38,660 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:16:38,674 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:16:38,679 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:16:55,805 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 02:16:55,894 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:16:56,073 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:16:56,073 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:16:56,073 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 9b1353f0-08c2-4ad2-8bfc-b923469db376)
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 111c2eab-13b6-49f1-88bc-ac09046a31e3)
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: a76063d3-722b-47f9-bbe8-6456b9bbd842)
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 101d23ed-053a-4d01-bf70-9a798c625570)
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:16:56,086 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:16:56,096 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:16:56,096 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:16:56,096 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:16:56,096 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:16:56,109 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:16:56,114 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:17:04,073 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:17:04,073 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:17:04,073 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:17:04,086 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:17:04,086 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:17:04,086 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:17:04,086 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:17:04,086 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:17:04,086 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: bf391c3d-b271-479b-a0e5-7d1b236ade24)
2025-03-30 02:17:04,086 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:17:04,086 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 8cbf58d7-167b-4788-afab-d150f887e01d)
2025-03-30 02:17:04,086 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:17:04,086 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 88d0ba49-0408-41a9-8a9a-b61ef04c9e0a)
2025-03-30 02:17:04,086 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:17:04,086 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 1b406aac-9c55-4742-b2d8-a1e497eb31e5)
2025-03-30 02:17:04,087 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:17:04,087 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:17:04,087 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:17:04,087 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:17:04,096 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:17:04,096 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:17:04,096 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:17:04,097 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:17:04,116 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 02:17:04,116 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 02:17:04,117 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:17:04,291 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:17:04,291 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:17:04,291 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 38500539-7845-4811-9ff6-1363f514d465)
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: a53dcbbf-156b-40ad-b89c-69ce1bbf3cfc)
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 7bf924b8-c27d-4cb6-bb59-e4155506ccdb)
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 22180543-b182-43cb-9c85-6007bfe5808d)
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:17:04,304 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:17:04,314 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:17:04,314 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:17:04,314 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:17:04,314 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:17:04,328 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:17:04,332 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:17:13,060 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:17:13] "GET / HTTP/1.1" 200 -
2025-03-30 02:17:13,074 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:17:13] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 02:17:13,075 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:17:13] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 02:17:21,149 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 02:17:21,150 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 7aa22ee8-b9cb-4879-b329-9bfa5bd8fde0
2025-03-30 02:17:21,150 - Hospital-MultiAgent-System - INFO - 找到已有患者记录: P0001
2025-03-30 02:17:21,151 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:17:21,151 - Hospital-MultiAgent-System - INFO - 患者 赵四 (ID: P0001) 是复诊患者
2025-03-30 02:17:21,151 - Hospital-MultiAgent-System - ERROR - 问诊流程发生错误: 'NoneType' object has no attribute 'get'
2025-03-30 02:17:21,151 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:17:21,152 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:17:21] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 02:17:21,154 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:17:21] "GET /api/consultation/348ae7cb-4713-448c-832c-5f6384d80a13/history HTTP/1.1" 200 -
2025-03-30 02:19:37,664 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 02:19:37,719 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:19:37,915 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:19:37,915 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:19:37,915 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: eef6bb6f-2ed2-4676-aec6-19b10fd5ffc3)
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: e4b95de3-5381-46fd-9f4c-c6a59f78d7f0)
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 26266411-06ac-4bd8-a510-11eea17bc644)
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: eb12bd2a-146d-49e7-a15b-55e44064b3ce)
2025-03-30 02:19:37,928 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:19:37,929 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:19:37,929 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:19:37,929 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:19:37,938 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:19:37,938 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:19:37,938 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:19:37,939 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:19:37,953 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:19:37,958 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:20:02,145 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 02:20:02,212 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:20:02,393 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:20:02,393 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:20:02,393 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: f5812e35-cec7-41b9-bde0-a64dd89586b4)
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 8b185b40-40ec-452d-9b0a-68baa1af452f)
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: bc7fde45-ec09-4b69-a489-21affe30e4df)
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: e1c234fa-df73-4e27-acab-4c2274364adc)
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:20:02,406 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:20:02,416 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:20:02,416 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:20:02,416 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:20:02,417 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:20:02,431 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:20:02,435 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:20:11,719 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:20:11,719 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:20:11,720 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:20:11,732 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:20:11,732 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:20:11,732 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 010a844b-5b01-4329-92a1-708e853b5be1)
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 33117c0f-9120-478d-8a62-f98eb4cf9927)
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 209a773f-2958-4bf3-bab5-caf1547c3233)
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: e7fc38d9-761e-40c0-8014-ca1a9673d311)
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:20:11,733 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:20:11,742 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:20:11,742 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:20:11,742 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:20:11,743 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:20:11,762 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 02:20:11,763 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 02:20:11,763 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:20:11,939 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:20:11,939 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:20:11,939 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 3861f55c-5978-434c-ac86-4ac71db2a27e)
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 9cb7fff6-f7cd-434b-a2fa-734fe75d60d9)
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 6dbbe0a9-464e-46fa-9f29-82dbe24472c6)
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: fe2d8fb1-0729-4b4f-ba5e-f59533e10fd9)
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:20:11,952 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:20:11,962 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:20:11,962 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:20:11,962 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:20:11,963 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:20:11,975 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:20:11,980 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:20:24,382 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:20:24] "GET / HTTP/1.1" 200 -
2025-03-30 02:20:24,394 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:20:24] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 02:20:24,394 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:20:24] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 02:20:39,419 - Hospital-MultiAgent-System-Web - INFO - 开始处理 张三 的问诊请求...
2025-03-30 02:20:39,419 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 张三, 问诊ID: b4da02ef-3320-41c1-a8f5-bc22efadcec8
2025-03-30 02:20:39,419 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:20:39,420 - Hospital-MultiAgent-System - INFO - 创建新患者记录: P0002
2025-03-30 02:20:39,420 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:20:39,420 - Hospital-MultiAgent-System - INFO - 患者 张三 (ID: P0002) 是复诊患者
2025-03-30 02:20:39,420 - Hospital-MultiAgent-System - ERROR - 问诊流程发生错误: 'ReceptionistAgent' object has no attribute 'process_message'
2025-03-30 02:20:39,420 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:20:39,420 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:20:39] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 02:20:39,423 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:20:39] "GET /api/consultation/4dd4dd76-8883-4643-b035-a748cbc1a0d7/history HTTP/1.1" 200 -
2025-03-30 02:21:59,905 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 02:21:59,957 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:22:00,158 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:22:00,158 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:22:00,158 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:22:00,171 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:22:00,171 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:22:00,171 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:22:00,171 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:22:00,171 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:22:00,171 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: f7a3ebd0-24a7-49c5-a02b-9661faf4f6bd)
2025-03-30 02:22:00,171 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:22:00,171 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 0d9c0577-78a6-4045-9420-0a78d2517d78)
2025-03-30 02:22:00,171 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:22:00,171 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 50a279b0-f74b-405c-8032-af9eed7ea7a2)
2025-03-30 02:22:00,171 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:22:00,171 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: f689698a-74c3-4e44-a0de-b8f800db37be)
2025-03-30 02:22:00,172 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:22:00,172 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:22:00,172 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:22:00,172 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:22:00,182 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:22:00,182 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:22:00,182 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:22:00,182 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:22:00,195 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:22:00,199 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:22:30,387 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 02:22:30,444 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:22:30,643 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:22:30,643 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:22:30,643 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:22:30,656 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 1ea6187f-9090-4aa9-bcbe-9ff9703631cc)
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: dd3fca62-7e49-46b9-bb27-71796c217d17)
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 7ecf58b2-8173-4905-8f1a-25556ee1b4ed)
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 762169fe-f0a9-4276-8b9e-38a573ccfc1a)
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:22:30,657 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:22:30,667 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:22:30,667 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:22:30,667 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:22:30,668 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:22:30,683 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:22:30,687 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:23:09,963 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 02:23:10,019 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:23:10,221 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:23:10,221 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:23:10,221 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:23:10,234 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:23:10,234 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 1b5abced-cf0d-4c72-a2d4-4659ef65ebe5)
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 2fe41510-0354-4c32-ac0c-6572bc8cf7e4)
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 6e07f64f-ec8a-412c-95ab-792e06ff3325)
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: b803fc5c-fd6f-47c0-ae46-10cfe7e4e4c6)
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:23:10,235 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:23:10,245 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:23:10,245 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:23:10,245 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:23:10,246 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:23:10,258 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:23:10,263 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:23:30,418 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 02:23:30,485 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:23:30,675 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:23:30,675 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:23:30,675 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 015c7741-e1ef-479e-9f94-46a1a1afe3fb)
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: f1019881-c847-47fc-95ad-dac804a1db4a)
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: b0868fb3-f348-4c32-b441-f42b8c4f2c57)
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 3cf9be40-93b8-440d-9e12-5d8a8a0ad5fe)
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:23:30,689 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:23:30,699 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:23:30,699 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:23:30,699 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:23:30,699 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:23:30,713 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:23:30,717 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:23:38,085 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:23:38,086 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:23:38,086 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:23:38,098 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:23:38,098 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:23:38,098 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:23:38,098 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:23:38,099 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:23:38,099 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: f0300522-3406-4e4c-9d69-ce53e81ee8ab)
2025-03-30 02:23:38,099 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:23:38,099 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 295c9f0e-be35-45b3-96ff-954c2a054427)
2025-03-30 02:23:38,099 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:23:38,099 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: c6590f0f-b9ec-4ee8-86b2-82efb8c8325e)
2025-03-30 02:23:38,099 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:23:38,099 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: fc265dbe-5d9b-4bc8-9883-2440bafc0bb6)
2025-03-30 02:23:38,099 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:23:38,099 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:23:38,099 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:23:38,099 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:23:38,108 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:23:38,108 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:23:38,108 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:23:38,109 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:23:38,128 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 02:23:38,128 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 02:23:38,129 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:23:38,308 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:23:38,308 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:23:38,308 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 0adb2a54-0869-40ec-afed-264a087ea7b5)
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 24e0d886-ca84-406f-b1f0-771f45dd7771)
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 5c9eedd7-8723-40f3-b215-cd1dccde1b8d)
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 47042e0f-1523-4788-a2b7-962657a05cd8)
2025-03-30 02:23:38,321 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:23:38,322 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:23:38,322 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:23:38,322 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:23:38,331 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:23:38,331 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:23:38,331 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:23:38,332 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:23:38,345 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:23:38,349 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:23:45,119 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:23:45] "GET / HTTP/1.1" 200 -
2025-03-30 02:23:45,133 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:23:45] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 02:23:45,134 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:23:45] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 02:23:57,985 - Hospital-MultiAgent-System-Web - INFO - 开始处理 张三 的问诊请求...
2025-03-30 02:23:57,986 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 张三, 问诊ID: 1551bf3b-0b94-4885-bf98-962099d08664
2025-03-30 02:23:57,986 - Hospital-MultiAgent-System - INFO - 找到已有患者记录: P0002
2025-03-30 02:23:57,987 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:23:57,987 - Hospital-MultiAgent-System - INFO - 患者 张三 (ID: P0002) 是复诊患者
2025-03-30 02:23:57,988 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:23:57,992 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:23:57,993 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:23:57] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 02:23:57,997 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:23:57] "GET /api/consultation/a665464d-2bb4-480f-b726-6346df810152/history HTTP/1.1" 200 -
2025-03-30 02:27:09,133 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/receptionist.py', reloading
2025-03-30 02:27:09,201 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:27:09,381 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:27:09,381 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:27:09,381 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 17e09d0d-f72b-40da-8ed2-85136527ca58)
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: c1783aab-f1bd-4cec-b0d7-7f8cec0b44ef)
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: aa3d57d5-c002-4107-ac95-c709ae314bb8)
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: b0de9fde-3fee-4677-8348-f0300e602682)
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:27:09,394 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:27:09,404 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:27:09,404 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:27:09,404 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:27:09,404 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:27:09,417 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:27:09,421 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:28:30,161 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/doctor.py', reloading
2025-03-30 02:28:30,235 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:28:30,412 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:28:30,413 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:28:30,413 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:28:30,425 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:28:30,425 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:28:30,425 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:28:30,425 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:28:30,425 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:28:30,425 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 5d26a8e9-a4ee-4203-9438-2e0b091efcd6)
2025-03-30 02:28:30,426 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:28:30,426 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: eb0327bc-9922-486a-b188-94ff4b64d905)
2025-03-30 02:28:30,426 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:28:30,426 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 0d29b224-b63f-4799-bf33-09ce66ee00e9)
2025-03-30 02:28:30,426 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:28:30,426 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: f5e07ad9-8169-4862-8f61-b21fd6e3b6ef)
2025-03-30 02:28:30,426 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:28:30,426 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:28:30,426 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:28:30,426 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:28:30,435 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:28:30,435 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:28:30,435 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:28:30,436 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:28:30,449 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:28:30,453 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:29:36,041 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/pharmacist.py', reloading
2025-03-30 02:29:36,107 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:29:36,292 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:29:36,292 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:29:36,292 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:29:36,305 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:29:36,305 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: a89fe99d-8ce7-4861-bc13-bdb69848a2d6)
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 4ac4bf51-9fb7-45c3-8f67-8d8ba1d30b3e)
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 1b6998d7-fe87-4bbd-bcfb-2c4be9d702df)
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 53afbb42-46df-4572-9cf4-b0b1f9ff0e39)
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:29:36,306 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:29:36,315 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:29:36,315 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:29:36,315 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:29:36,316 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:29:36,329 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:29:36,333 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:30:08,613 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/receptionist.py', reloading
2025-03-30 02:30:08,684 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:30:08,863 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:30:08,863 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:30:08,863 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 3c46ad45-5e68-4a72-b753-29a51e60d556)
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 402685a2-00c9-4393-89a5-bef8ed4b6629)
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: e8e893f5-6401-4f2e-92a6-5c0c2c627bfd)
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 25da459e-0ded-4ce4-bbc3-b2813b125d58)
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:30:08,876 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:30:08,885 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:30:08,885 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:30:08,885 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:30:08,886 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:30:08,900 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:30:08,904 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:30:25,783 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:30:25,783 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:30:25,783 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:30:25,796 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:30:25,796 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 09b9cfcc-2e13-46fb-8221-fdfe4371b574)
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 165fc88e-6383-4f4f-83c7-847dd8183411)
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 841475e6-5833-43b9-bee3-47a74656d778)
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 37f9938e-116b-4b14-a2bf-67e209f64f92)
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:30:25,797 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:30:25,806 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:30:25,806 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:30:25,806 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:30:25,807 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:30:25,826 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 02:30:25,826 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 02:30:25,826 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:30:25,999 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:30:26,000 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:30:26,000 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: c9cecf88-9414-4cf2-aef7-d85362621a99)
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: ad47eca2-173e-48b9-a9d2-5dbe53d819c4)
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 2586d39c-f250-4c26-8171-658d675d2d81)
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 5484d36f-7fd7-4c67-9862-ae17b3ab501d)
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:30:26,012 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:30:26,021 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:30:26,021 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:30:26,022 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:30:26,022 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:30:26,036 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:30:26,040 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:30:37,159 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:30:37] "GET / HTTP/1.1" 200 -
2025-03-30 02:30:37,173 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:30:37] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 02:30:37,173 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:30:37] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 02:31:08,048 - Hospital-MultiAgent-System-Web - INFO - 开始处理 李大 的问诊请求...
2025-03-30 02:31:08,049 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 李大, 问诊ID: d253ebc2-f153-4ba7-9369-d0330671e052
2025-03-30 02:31:08,050 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:08,050 - Hospital-MultiAgent-System - INFO - 创建新患者记录: P0003
2025-03-30 02:31:08,051 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:08,051 - Hospital-MultiAgent-System - INFO - 患者 李大 (ID: P0003) 是复诊患者
2025-03-30 02:31:08,051 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 李大 (ID: P0003) 的接诊请求
2025-03-30 02:31:08,051 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 02:31:08,051 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 02:31:08,051 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 李大
患者年龄: 40
主诉症...
2025-03-30 02:31:08,179 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:31:08,182 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:31:11,321 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:31:11,327 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.14秒
2025-03-30 02:31:11,327 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "psychiatry",
  "gr...
2025-03-30 02:31:11,327 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "psychiatry",
  "greeting": "您好，李先生! 我是前台接待员，很高兴为您服务。根据您的失眠症状，我建议您前往精神科就诊。请在候诊区稍等，我们会尽快安排医生为您诊疗。"
}
```
2025-03-30 02:31:11,329 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:11,330 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:11,330 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:11,330 - Hospital-MultiAgent-System - INFO - 医生正在处理患者 P0003 的诊断请求，症状: ['失眠']
2025-03-30 02:31:11,331 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.4
2025-03-30 02:31:11,331 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富的专科医生，正在进行初步诊断。提供专业、准确但谨慎的诊断结果。
2025-03-30 02:31:11,331 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位internal专科医生，请根据以下患者情况进行初步诊断:

症状: 失眠
病史: 无

请...
2025-03-30 02:31:11,333 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:31:11,335 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:31:14,596 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:31:14,602 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.27秒
2025-03-30 02:31:14,602 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "初步诊断为原发性失眠（Primary Insom...
2025-03-30 02:31:14,604 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:14,608 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:14,608 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:14,608 - Hospital-MultiAgent-System - INFO - 医生正在为患者 P0003 开具处方，诊断: 初步诊断为原发性失眠（Primary Insomnia）
2025-03-30 02:31:14,608 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.4
2025-03-30 02:31:14,608 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富的医生，正在根据患者诊断开具处方。提供专业、安全的用药建议。
2025-03-30 02:31:14,608 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，请根据以下诊断结果开具处方:

诊断结果: 初步诊断为原发性失眠（Primary ...
2025-03-30 02:31:14,610 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:31:14,612 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:31:19,345 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:31:19,347 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：4.73秒
2025-03-30 02:31:19,347 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "medications": [
    {
      "name": "...
2025-03-30 02:31:19,348 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:19,349 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:19,349 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:19,349 - Hospital-MultiAgent-System - INFO - 药剂师正在审核患者 P0003 的处方
2025-03-30 02:31:19,349 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.3
2025-03-30 02:31:19,349 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业药剂师，擅长审核处方的合理性、安全性和药物相互作用。请严格按照医学标准评估处方。
2025-03-30 02:31:19,349 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业药剂师，请审核以下处方的合理性和安全性:

药品清单:
- 药品名称: 佐匹克隆片
  ...
2025-03-30 02:31:19,352 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:31:19,355 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:31:22,110 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:31:22,113 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.76秒
2025-03-30 02:31:22,113 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "valid": true,
  "issues": [],
  "warn...
2025-03-30 02:31:22,114 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "valid": true,
  "issues": [],
  "warnings": [
    "佐匹克隆片可能导致依赖性，建议严格遵循短期使用原则。",
    "服药后可能出现次日晨起嗜睡或注意力下降，需避免驾驶或操作机械。",
    "服药前避免饮酒或使用其他中枢神经抑制剂，以防止加重嗜睡或呼吸抑制风险。"
  ],
  "recommendations": [
    "明确疗程时长，建议不超过2周，并在处方中注明。",
    "建议患者在服药期间定期随访，评估疗效及潜在副作用。",
    "如失眠症状持续或加重，建议进一步检查排除其他潜在病因，并调整治疗方案。"
  ]
}
```
2025-03-30 02:31:22,114 - Hospital-MultiAgent-System - INFO - 患者 P0003 的处方已通过审核
2025-03-30 02:31:22,115 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:22,116 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:22,118 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:22,118 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:31:22] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 02:31:22,122 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:31:22] "GET /api/consultation/6c552f31-882a-4cbe-8706-d175880d302d/history HTTP/1.1" 200 -
2025-03-30 02:31:59,442 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 02:31:59,442 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 1059bd42-2059-4e8c-9946-5e7d457ea711
2025-03-30 02:31:59,443 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:59,443 - Hospital-MultiAgent-System - INFO - 创建新患者记录: P0004
2025-03-30 02:31:59,445 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:31:59,445 - Hospital-MultiAgent-System - INFO - 患者 赵四 (ID: P0004) 是复诊患者
2025-03-30 02:31:59,445 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0004) 的接诊请求
2025-03-30 02:31:59,445 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 02:31:59,445 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 02:31:59,445 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 02:31:59,932 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:31:59,936 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:32:10,136 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:32:10,140 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：10.20秒
2025-03-30 02:32:10,140 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "surgery",
  "greet...
2025-03-30 02:32:10,141 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "surgery",
  "greeting": "您好，赵先生！我是医院的前台接待员，很高兴为您服务。根据您提到的屁股疼以及您的病史，我建议您到外科进行检查。请前往二楼外科诊室，我们的医生会为您进一步诊疗。祝您早日康复！"
}
```
2025-03-30 02:32:10,142 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:32:10,143 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:32:10,144 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:32:10,144 - Hospital-MultiAgent-System - INFO - 医生正在处理患者 P0004 的诊断请求，症状: ['屁股疼']
2025-03-30 02:32:10,144 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.4
2025-03-30 02:32:10,144 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富的专科医生，正在进行初步诊断。提供专业、准确但谨慎的诊断结果。
2025-03-30 02:32:10,144 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位internal专科医生，请根据以下患者情况进行初步诊断:

症状: 屁股疼
病史: 肚子疼...
2025-03-30 02:32:10,146 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:32:10,148 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:32:12,512 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:32:12,516 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.37秒
2025-03-30 02:32:12,516 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "可能为肛周脓肿或肛裂",
  "explanat...
2025-03-30 02:32:12,519 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:32:12,520 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:32:12,521 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:32:12,521 - Hospital-MultiAgent-System - INFO - 医生正在为患者 P0004 开具处方，诊断: 可能为肛周脓肿或肛裂
2025-03-30 02:32:12,521 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.4
2025-03-30 02:32:12,521 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富的医生，正在根据患者诊断开具处方。提供专业、安全的用药建议。
2025-03-30 02:32:12,521 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，请根据以下诊断结果开具处方:

诊断结果: 可能为肛周脓肿或肛裂
诊断解释: 屁股...
2025-03-30 02:32:12,526 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:32:12,529 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:32:19,555 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:32:19,558 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：7.03秒
2025-03-30 02:32:19,558 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "medications": [
    {
      "name": "...
2025-03-30 02:32:19,559 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:32:19,560 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:32:19,560 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:32:19,560 - Hospital-MultiAgent-System - INFO - 药剂师正在审核患者 P0004 的处方
2025-03-30 02:32:19,560 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.3
2025-03-30 02:32:19,560 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业药剂师，擅长审核处方的合理性、安全性和药物相互作用。请严格按照医学标准评估处方。
2025-03-30 02:32:19,560 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业药剂师，请审核以下处方的合理性和安全性:

药品清单:
- 药品名称: 头孢克肟片
  ...
2025-03-30 02:32:19,959 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:32:19,963 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:32:23,757 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:32:23,764 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.80秒
2025-03-30 02:32:23,765 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "valid": true,
  "issues": [],
  "warn...
2025-03-30 02:32:23,765 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "valid": true,
  "issues": [],
  "warnings": [
    "甲硝唑片可能引起胃肠道不适或金属味，建议饭后服用并观察不良反应。",
    "头孢克肟片与甲硝唑片联合使用可能增加胃肠道负担，需注意患者是否有消化系统疾病史。",
    "利多卡因凝胶为局部麻醉剂，长期使用可能引起局部皮肤刺激或过敏反应，需注意观察。",
    "复方角菜酸酯栓可能引起局部刺激或排便不适，使用前需确保肛门区域清洁。",
    "抗生素使用需严格遵循疗程，避免过早停药导致耐药性问题。"
  ],
  "recommendations": [
    "明确疗程时长，建议头孢克肟片和甲硝唑片疗程为5-7天，具体根据感染情况调整。",
    "建议患者在服用甲硝唑期间避免饮酒，以防止双硫仑样反应。",
    "建议患者在使用利多卡因凝胶时避免过量涂抹，以减少局部皮肤刺激风险。",
    "随访建议中提到的复查时间合理，但可进一步明确复查时需携带的相关信息（如用药记录）。"
  ]
}
```
2025-03-30 02:32:23,765 - Hospital-MultiAgent-System - INFO - 患者 P0004 的处方已通过审核
2025-03-30 02:32:23,766 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:32:23,768 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:32:23,768 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:32:23,768 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:32:23] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 02:32:23,777 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:32:23] "GET /api/consultation/693c451b-4075-482e-af31-12d572e4afde/history HTTP/1.1" 200 -
2025-03-30 02:33:02,456 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 02:33:02,456 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: c44f5ab1-3170-4364-8f87-90f27ff91d62
2025-03-30 02:33:02,458 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:02,459 - Hospital-MultiAgent-System - INFO - 创建新患者记录: P0005
2025-03-30 02:33:02,462 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:02,462 - Hospital-MultiAgent-System - INFO - 患者 赵四 (ID: P0005) 是复诊患者
2025-03-30 02:33:02,462 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0005) 的接诊请求
2025-03-30 02:33:02,462 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 02:33:02,463 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 02:33:02,463 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 02:33:02,954 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:33:02,958 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:33:06,158 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:33:06,163 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.20秒
2025-03-30 02:33:06,163 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "ophthalmology",
  ...
2025-03-30 02:33:06,163 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "ophthalmology",
  "greeting": "您好，赵先生！我是医院的前台接待员，很高兴为您服务。根据您描述的眼睛疼症状，我建议您先到眼科就诊。眼科在二楼，您可以在那边登记并等候医生为您检查。如果有其他不适，也可以随时告诉我们。祝您早日康复！"
}
```
2025-03-30 02:33:06,166 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:06,170 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:06,172 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:06,172 - Hospital-MultiAgent-System - INFO - 医生正在处理患者 P0005 的诊断请求，症状: ['眼睛疼']
2025-03-30 02:33:06,172 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.4
2025-03-30 02:33:06,173 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富的专科医生，正在进行初步诊断。提供专业、准确但谨慎的诊断结果。
2025-03-30 02:33:06,173 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位internal专科医生，请根据以下患者情况进行初步诊断:

症状: 眼睛疼
病史: 肚子疼...
2025-03-30 02:33:06,177 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:33:06,180 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:33:08,710 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:33:08,715 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.53秒
2025-03-30 02:33:08,715 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "可能的全身性炎症或感染",
  "explana...
2025-03-30 02:33:08,719 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:08,723 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:08,725 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:08,725 - Hospital-MultiAgent-System - INFO - 医生正在为患者 P0005 开具处方，诊断: 可能的全身性炎症或感染
2025-03-30 02:33:08,726 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.4
2025-03-30 02:33:08,726 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富的医生，正在根据患者诊断开具处方。提供专业、安全的用药建议。
2025-03-30 02:33:08,726 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，请根据以下诊断结果开具处方:

诊断结果: 可能的全身性炎症或感染
诊断解释: 患...
2025-03-30 02:33:08,730 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:33:08,733 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:33:13,019 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:33:13,023 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：4.29秒
2025-03-30 02:33:13,023 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "medications": [
    {
      "name": "...
2025-03-30 02:33:13,028 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:13,031 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:13,034 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:13,035 - Hospital-MultiAgent-System - INFO - 药剂师正在审核患者 P0005 的处方
2025-03-30 02:33:13,035 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.3
2025-03-30 02:33:13,035 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业药剂师，擅长审核处方的合理性、安全性和药物相互作用。请严格按照医学标准评估处方。
2025-03-30 02:33:13,035 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业药剂师，请审核以下处方的合理性和安全性:

药品清单:
- 药品名称: 阿莫西林
  剂...
2025-03-30 02:33:13,040 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:33:13,044 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:33:18,132 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:33:18,137 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：5.09秒
2025-03-30 02:33:18,138 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "valid": true,
  "issues": [],
  "warn...
2025-03-30 02:33:18,138 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "valid": true,
  "issues": [],
  "warnings": [
    "布洛芬可能会对胃肠道产生刺激，建议患者饭后服用以减少胃肠道不适。",
    "布洛芬与阿莫西林同时服用时，需注意可能增加胃肠道不良反应的风险。",
    "布洛芬的每日最大剂量为1200mg，患者需严格遵守以避免过量使用。",
    "人工泪液的使用频率较高时，需注意是否含有防腐剂，长期使用可能对眼表造成刺激。"
  ],
  "recommendations": [
    "建议在处方中明确人工泪液的具体疗程，或注明‘根据需要使用’。",
    "提醒患者在服用布洛芬期间，若出现胃痛、黑便或其他胃肠道不适症状，应立即停药并就医。",
    "建议患者在服用阿莫西林期间，若出现过敏反应（如皮疹、瘙痒、呼吸困难），应立即停药并就医。",
    "随访建议中可补充说明：若患者症状明显改善，可根据医生建议调整或停止抗生素疗程。"
  ]
}
```
2025-03-30 02:33:18,139 - Hospital-MultiAgent-System - INFO - 患者 P0005 的处方已通过审核
2025-03-30 02:33:18,140 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:18,141 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:18,142 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:33:18,143 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:33:18] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 02:33:18,147 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:33:18] "GET /api/consultation/ecc9e32b-b91c-4c9a-b143-3b34f1fab369/history HTTP/1.1" 200 -
2025-03-30 02:38:24,145 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:38:24,145 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:38:24,145 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 6af1d2c8-c350-4dbc-859e-8be109fd5bcf)
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 2f35fb94-74ad-486a-9b47-fd8fc9deda0e)
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: fe41458e-f95c-48b2-813e-e1a8c62e07ea)
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 7e41aad1-eda1-4aea-b34d-86ab44996c20)
2025-03-30 02:38:24,158 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:38:24,159 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:38:24,159 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:38:24,159 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:38:24,168 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:38:24,168 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:38:24,168 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:38:24,168 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:38:24,187 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 02:38:24,187 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 02:38:24,187 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:38:24,358 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:38:24,358 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:38:24,358 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: b76d7d22-e7ca-4e7c-8a5a-224e05145b9f)
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 02c4c817-bac8-4b3b-b7d0-f75e2a2358c9)
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: c9b8836d-6738-4eda-afdf-1489e20677a1)
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: d2271b2b-6faa-4ee5-ad2e-650151f20aa5)
2025-03-30 02:38:24,371 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:38:24,372 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:38:24,372 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:38:24,372 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:38:24,381 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:38:24,381 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:38:24,381 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:38:24,382 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:38:24,395 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:38:24,399 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:38:26,965 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:38:26] "GET / HTTP/1.1" 200 -
2025-03-30 02:38:26,978 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:38:26] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 02:38:26,978 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:38:26] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 02:38:43,179 - Hospital-MultiAgent-System-Web - INFO - 开始处理 李大 的问诊请求...
2025-03-30 02:38:43,179 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 李大, 问诊ID: 8d0b0672-511d-4339-9b6a-a26d1c5d4924
2025-03-30 02:38:43,183 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:43,183 - Hospital-MultiAgent-System - INFO - 创建新患者记录: P0006
2025-03-30 02:38:43,185 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:43,185 - Hospital-MultiAgent-System - INFO - 患者 李大 (ID: P0006) 是复诊患者
2025-03-30 02:38:43,185 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 李大 (ID: P0006) 的接诊请求
2025-03-30 02:38:43,185 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 02:38:43,185 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 02:38:43,185 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 李大
患者年龄: 20
主诉症...
2025-03-30 02:38:43,741 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:38:43,746 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:38:47,388 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:38:47,390 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.64秒
2025-03-30 02:38:47,390 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "orthopedics",
  "g...
2025-03-30 02:38:47,391 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "orthopedics",
  "greeting": "您好，李先生！我是医院的前台接待员。根据您提到的脚疼情况，我建议您前往骨科就诊。请先到骨科候诊区稍等，我们会尽快为您安排医生诊疗。祝您早日康复！"
}
```
2025-03-30 02:38:47,392 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:47,393 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:47,395 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:47,395 - Hospital-MultiAgent-System - INFO - 医生正在处理患者 P0006 的诊断请求，症状: ['脚疼']
2025-03-30 02:38:47,395 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.4
2025-03-30 02:38:47,395 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富的专科医生，正在进行初步诊断。提供专业、准确但谨慎的诊断结果。
2025-03-30 02:38:47,395 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位internal专科医生，请根据以下患者情况进行初步诊断:

症状: 脚疼
病史: 无

请...
2025-03-30 02:38:47,398 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:38:47,399 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:38:50,120 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:38:50,122 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.72秒
2025-03-30 02:38:50,122 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "非特异性足部疼痛",
  "explanatio...
2025-03-30 02:38:50,125 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:50,126 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:50,128 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:50,128 - Hospital-MultiAgent-System - INFO - 医生正在为患者 P0006 开具处方，诊断: 非特异性足部疼痛
2025-03-30 02:38:50,128 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.4
2025-03-30 02:38:50,128 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富的医生，正在根据患者诊断开具处方。提供专业、安全的用药建议。
2025-03-30 02:38:50,128 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，请根据以下诊断结果开具处方:

诊断结果: 非特异性足部疼痛
诊断解释: 患者报告...
2025-03-30 02:38:50,129 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:38:50,131 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:38:53,836 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:38:53,840 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.71秒
2025-03-30 02:38:53,840 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "medications": [
    {
      "name": "...
2025-03-30 02:38:53,844 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:53,846 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:53,847 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:53,847 - Hospital-MultiAgent-System - INFO - 药剂师正在审核患者 P0006 的处方
2025-03-30 02:38:53,847 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.3
2025-03-30 02:38:53,847 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业药剂师，擅长审核处方的合理性、安全性和药物相互作用。请严格按照医学标准评估处方。
2025-03-30 02:38:53,847 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业药剂师，请审核以下处方的合理性和安全性:

药品清单:
- 药品名称: 布洛芬片
  剂...
2025-03-30 02:38:53,850 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:38:53,852 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:38:57,398 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:38:57,402 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.55秒
2025-03-30 02:38:57,402 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "valid": true,
  "issues": [],
  "warn...
2025-03-30 02:38:57,402 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "valid": true,
  "issues": [],
  "warnings": [
    "布洛芬可能会导致胃肠道不适或溃疡风险，尤其是长期使用或高剂量时，应严格按照建议饭后服用。",
    "氯唑沙宗可能引起嗜睡或头晕，服药期间应避免驾驶或操作机械。",
    "服药期间避免饮酒，因为布洛芬和氯唑沙宗均可能增加胃肠道或中枢神经系统副作用的风险。"
  ],
  "recommendations": [
    "布洛芬的剂量和频率合理，但建议明确疗程，通常不建议超过7天连续使用，除非有明确的医嘱。",
    "氯唑沙宗的剂量和频率合理，但建议明确疗程，通常不建议长期使用，除非有明确的医嘱。",
    "随访建议清晰且适当，但可补充说明布洛芬和氯唑沙宗的联合使用可能导致嗜睡或头晕，患者需注意症状变化。",
    "建议患者定期复诊以评估治疗效果，并根据需要调整用药方案。"
  ]
}
```
2025-03-30 02:38:57,402 - Hospital-MultiAgent-System - INFO - 患者 P0006 的处方已通过审核
2025-03-30 02:38:57,406 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:57,407 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:57,408 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:38:57,409 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:38:57] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 02:38:57,414 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:38:57] "GET /api/consultation/736a03da-44ec-4f00-b44f-4f7c71b450f4/history HTTP/1.1" 200 -
2025-03-30 02:41:07,827 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 02:41:07,885 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:41:08,076 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:41:08,076 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:41:08,076 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 6ceb1d78-6b22-4e3f-b658-982a44eb7225)
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: f2fec52b-cddb-40ff-8542-def7fcba7086)
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 8883ed42-d054-42b7-a80d-5a29d685b429)
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: c63334b3-dfd1-4067-b802-56fbd167ebdb)
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:41:08,090 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:41:08,100 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:41:08,100 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:41:08,100 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:41:08,101 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:41:08,115 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:41:08,119 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:41:40,384 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 02:41:40,450 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:41:40,633 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:41:40,633 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:41:40,633 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:41:40,646 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:41:40,646 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:41:40,646 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:41:40,646 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:41:40,646 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:41:40,646 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: ef7a2908-5920-4f1b-b829-e3f67044a7c3)
2025-03-30 02:41:40,646 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:41:40,646 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 932081f5-1560-49b0-94c4-e2d8e0ce943b)
2025-03-30 02:41:40,646 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:41:40,646 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 430ded2e-a619-4f3f-b6eb-29c83331ec9e)
2025-03-30 02:41:40,646 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:41:40,646 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 29d2b329-1fbc-408a-8f37-f79f1f0edb30)
2025-03-30 02:41:40,647 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:41:40,647 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:41:40,647 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:41:40,647 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:41:40,656 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:41:40,656 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:41:40,656 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:41:40,656 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:41:40,669 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:41:40,674 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:42:19,026 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 02:42:19,107 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:42:19,283 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:42:19,283 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:42:19,284 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:42:19,296 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:42:19,296 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:42:19,296 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:42:19,296 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:42:19,296 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:42:19,296 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: b33f0ca0-c87a-400c-bf8d-4d0007505c79)
2025-03-30 02:42:19,297 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:42:19,297 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: a2764e18-3d0a-40b2-b2b4-121e6266026a)
2025-03-30 02:42:19,297 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:42:19,297 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: d6001514-3a1a-45c5-b96f-9a107d587239)
2025-03-30 02:42:19,297 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:42:19,297 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 2e9af5d3-e39b-4294-bf7b-f2479b0380e6)
2025-03-30 02:42:19,297 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:42:19,297 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:42:19,297 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:42:19,297 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:42:19,306 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:42:19,306 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:42:19,306 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:42:19,307 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:42:19,320 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:42:19,324 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:42:30,772 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:42:30,772 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:42:30,772 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:42:30,785 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:42:30,785 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:42:30,785 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:42:30,785 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:42:30,785 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:42:30,785 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 68509d45-9e31-4792-b7c8-9d9e3103ae6e)
2025-03-30 02:42:30,785 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:42:30,785 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 3a6719a5-174d-41cd-a14f-5881ff587699)
2025-03-30 02:42:30,785 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:42:30,785 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: bf5e7fe6-dcc1-4911-8d93-d7906b643f07)
2025-03-30 02:42:30,785 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:42:30,785 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 4b4447f8-f683-4ea1-8286-78557b2947eb)
2025-03-30 02:42:30,786 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:42:30,786 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:42:30,786 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:42:30,786 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:42:30,795 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:42:30,795 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:42:30,795 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:42:30,796 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:42:30,816 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 02:42:30,816 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 02:42:30,817 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:42:30,990 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:42:30,990 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:42:30,990 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 017e4b6e-1b43-4604-8a40-451eb2447207)
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 01d901c3-9d1b-4e8b-94b3-e65667c8c9c9)
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: b8cde89b-ad14-4d98-a55e-89d468f5c9e7)
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 8d91e524-167a-41cc-967e-4e7b37bec9f8)
2025-03-30 02:42:31,003 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:42:31,004 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:42:31,004 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:42:31,004 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:42:31,013 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:42:31,013 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:42:31,013 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:42:31,013 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:42:31,026 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:42:31,030 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:42:34,396 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:42:34] "GET / HTTP/1.1" 200 -
2025-03-30 02:42:34,413 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:42:34] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 02:42:34,414 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:42:34] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 02:42:48,376 - Hospital-MultiAgent-System-Web - INFO - 开始处理 李大 的问诊请求...
2025-03-30 02:42:48,376 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: 2896983b-a60c-4793-9809-e434c804e5f6
2025-03-30 02:42:48,376 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 李大, 问诊ID: 564ce909-ec1d-48b7-81f9-676303716b84
2025-03-30 02:42:48,380 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:42:48,380 - Hospital-MultiAgent-System - INFO - 创建新患者记录: P0007
2025-03-30 02:42:48,382 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:42:48,383 - Hospital-MultiAgent-System - INFO - 患者 李大 (ID: P0007) 是复诊患者
2025-03-30 02:42:48,383 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 李大 (ID: P0007) 的接诊请求
2025-03-30 02:42:48,383 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 02:42:48,383 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 02:42:48,383 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 李大
患者年龄: 20
主诉症...
2025-03-30 02:42:48,546 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:42:48,548 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:42:51,210 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:42:51,216 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.67秒
2025-03-30 02:42:51,217 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "department_code": "orthopedics",
  "greeting"...
2025-03-30 02:42:51,218 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:42:51,220 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:42:51,221 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:42:51,221 - Hospital-MultiAgent-System - INFO - 医生正在处理患者 P0007 的诊断请求，症状: ['腰疼']
2025-03-30 02:42:51,221 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.4
2025-03-30 02:42:51,221 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富的专科医生，正在进行初步诊断。提供专业、准确但谨慎的诊断结果。
2025-03-30 02:42:51,221 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位orthopedics专科医生，请根据以下患者情况进行初步诊断:

症状: 腰疼
病史: 屁...
2025-03-30 02:42:51,224 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:42:51,225 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:42:53,356 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:42:53,357 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.13秒
2025-03-30 02:42:53,357 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "坐骨神经痛",
  "explanation":...
2025-03-30 02:42:53,360 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:42:53,362 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:42:53,364 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:42:53,364 - Hospital-MultiAgent-System - INFO - 医生正在为患者 P0007 开具处方，诊断: 坐骨神经痛
2025-03-30 02:42:53,364 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.4
2025-03-30 02:42:53,364 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富的医生，正在根据患者诊断开具处方。提供专业、安全的用药建议。
2025-03-30 02:42:53,364 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，请根据以下诊断结果开具处方:

诊断结果: 坐骨神经痛
诊断解释: 患者的腰疼和屁...
2025-03-30 02:42:53,365 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:42:53,366 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:42:57,593 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:42:57,594 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：4.23秒
2025-03-30 02:42:57,595 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "medications": [
    {
      "name": "...
2025-03-30 02:42:57,596 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:42:57,597 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:42:57,598 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:42:57,598 - Hospital-MultiAgent-System - INFO - 药剂师正在审核患者 P0007 的处方
2025-03-30 02:42:57,598 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.3
2025-03-30 02:42:57,599 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业药剂师，擅长审核处方的合理性、安全性和药物相互作用。请严格按照医学标准评估处方。
2025-03-30 02:42:57,599 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业药剂师，请审核以下处方的合理性和安全性:

药品清单:
- 药品名称: 布洛芬片
  剂...
2025-03-30 02:42:57,600 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:42:57,601 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:43:04,920 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:43:04,924 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：7.32秒
2025-03-30 02:43:04,924 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "valid": true,
  "issues": [],
  "warn...
2025-03-30 02:43:04,924 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "valid": true,
  "issues": [],
  "warnings": [
    "布洛芬可能引起胃肠道不适或溃疡风险，尤其是长期使用或高剂量时。",
    "布洛芬与双氯芬酸钠凝胶均为非甾体抗炎药（NSAIDs），可能增加全身性不良反应的风险，尽管双氯芬酸为局部用药。",
    "加巴喷丁可能引起嗜睡、头晕等中枢神经系统副作用，需注意患者是否从事需要集中注意力的活动（如驾驶）。",
    "甲钴胺可能引起轻微的胃肠道不适或过敏反应，需监测患者是否出现异常反应。",
    "患者需避免饮酒，因为饮酒可能加重布洛芬的胃肠道副作用和加巴喷丁的中枢抑制作用。"
  ],
  "recommendations": [
    "建议布洛芬的使用疗程明确，一般不建议超过10天，除非有明确的医生指导。",
    "建议患者在使用布洛芬时同时服用胃黏膜保护剂（如质子泵抑制剂）以降低胃肠道不良反应风险，特别是有胃病史的患者。",
    "建议双氯芬酸钠凝胶避免大面积使用或长时间使用，以减少全身吸收的可能性。",
    "建议患者在服用加巴喷丁的初期注意观察是否出现嗜睡、头晕等副作用，必要时调整剂量或频率。",
    "建议在随访时评估患者对药物的耐受性和疗效，必要时调整治疗方案。"
  ]
}
```
2025-03-30 02:43:04,926 - Hospital-MultiAgent-System - INFO - 患者 P0007 的处方已通过审核
2025-03-30 02:43:04,931 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:43:04,935 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:43:04,939 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:43:04,939 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: 564ce909-ec1d-48b7-81f9-676303716b84
2025-03-30 02:43:04,940 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 8
2025-03-30 02:43:04,941 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:43:04] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 02:43:04,949 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:43:04] "GET /api/consultation/564ce909-ec1d-48b7-81f9-676303716b84/history HTTP/1.1" 200 -
2025-03-30 02:50:15,004 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:50:15,004 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:50:15,004 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:50:15,017 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:50:15,017 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:50:15,017 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: e568bdba-45cf-4314-88c0-e07412781d00)
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 61b408cc-2ce4-4e97-922a-9f79ba0664f3)
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 4cea11af-bffd-4dc5-ad9a-5a7469979f7c)
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 2d30fb35-8d87-4847-a552-cfe3108e79f9)
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:50:15,018 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:50:15,027 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:50:15,027 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:50:15,027 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:50:15,028 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:50:15,047 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 02:50:15,047 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 02:50:15,048 - werkzeug - INFO -  * Restarting with stat
2025-03-30 02:50:15,219 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:50:15,220 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:50:15,220 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:50:15,232 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:50:15,232 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 7226031e-e291-4864-8d20-04b7c2b17506)
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 73bab177-7d26-4ee0-ba67-3c4e26fbdb4e)
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化LLM服务成功
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: c4de36ef-d3ab-4b6b-adf6-ce503bf1939b)
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 0e3d890b-f3f1-41d4-93bd-362533b2f0d3)
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 02:50:15,233 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 02:50:15,242 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 02:50:15,242 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 02:50:15,242 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 02:50:15,243 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 02:50:15,256 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 02:50:15,260 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 02:51:07,866 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:51:07] "GET / HTTP/1.1" 200 -
2025-03-30 02:51:07,880 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:51:07] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 02:51:07,880 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:51:07] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 02:51:23,110 - Hospital-MultiAgent-System-Web - INFO - 开始处理 李大 的问诊请求...
2025-03-30 02:51:23,110 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: 038897b3-5b4b-4fec-95be-399d01342ea4
2025-03-30 02:51:23,110 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 李大, 问诊ID: a8854333-1953-44d4-b92e-b2c189ada80d
2025-03-30 02:51:23,113 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:23,113 - Hospital-MultiAgent-System - INFO - 创建新患者记录: P0008
2025-03-30 02:51:23,116 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:23,116 - Hospital-MultiAgent-System - INFO - 患者 李大 (ID: P0008) 是复诊患者
2025-03-30 02:51:23,116 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 李大 (ID: P0008) 的接诊请求
2025-03-30 02:51:23,116 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 02:51:23,116 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 02:51:23,116 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 李大
患者年龄: 20
主诉症...
2025-03-30 02:51:23,527 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:51:23,534 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:51:26,290 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:51:26,294 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.76秒
2025-03-30 02:51:26,294 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "dental",
  "greeti...
2025-03-30 02:51:26,295 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "dental",
  "greeting": "您好，李先生! 我是医院的前台接待员，很高兴为您服务。根据您的症状描述，我建议您前往牙科就诊。请在牙科诊室门口等候，我们的医生会尽快为您检查。祝您早日康复!"
}
```
2025-03-30 02:51:26,297 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:26,299 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:26,300 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:26,300 - Hospital-MultiAgent-System - INFO - 医生正在处理患者 P0008 的诊断请求，症状: ['牙疼']
2025-03-30 02:51:26,300 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.4
2025-03-30 02:51:26,300 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富的专科医生，正在进行初步诊断。提供专业、准确但谨慎的诊断结果。
2025-03-30 02:51:26,300 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位internal专科医生，请根据以下患者情况进行初步诊断:

症状: 牙疼
病史: 无

请...
2025-03-30 02:51:26,303 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:51:26,305 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:51:29,999 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:51:30,003 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.70秒
2025-03-30 02:51:30,004 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "牙髓炎或牙周炎",
  "explanation...
2025-03-30 02:51:30,008 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:30,010 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:30,011 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:30,011 - Hospital-MultiAgent-System - INFO - 医生正在为患者 P0008 开具处方，诊断: 牙髓炎或牙周炎
2025-03-30 02:51:30,011 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.4
2025-03-30 02:51:30,011 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富的医生，正在根据患者诊断开具处方。提供专业、安全的用药建议。
2025-03-30 02:51:30,011 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，请根据以下诊断结果开具处方:

诊断结果: 牙髓炎或牙周炎
诊断解释: 牙疼通常与...
2025-03-30 02:51:30,014 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:51:30,015 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:51:35,197 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:51:35,201 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：5.19秒
2025-03-30 02:51:35,202 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "medications": [
    {
      "name": "...
2025-03-30 02:51:35,206 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:35,207 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:35,209 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:35,209 - Hospital-MultiAgent-System - INFO - 药剂师正在审核患者 P0008 的处方
2025-03-30 02:51:35,209 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.3
2025-03-30 02:51:35,209 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业药剂师，擅长审核处方的合理性、安全性和药物相互作用。请严格按照医学标准评估处方。
2025-03-30 02:51:35,209 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业药剂师，请审核以下处方的合理性和安全性:

药品清单:
- 药品名称: 阿莫西林胶囊
 ...
2025-03-30 02:51:35,211 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 02:51:35,212 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 02:51:39,500 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 02:51:39,503 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：4.29秒
2025-03-30 02:51:39,503 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "valid": true,
  "issues": [],
  "warn...
2025-03-30 02:51:39,503 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "valid": true,
  "issues": [],
  "warnings": [
    "布洛芬可能引起胃肠道不适，建议与食物同服以减少胃刺激。",
    "甲硝唑可能引起恶心、金属味等副作用，服药期间避免饮酒，以防止双硫仑样反应。",
    "阿莫西林和甲硝唑均为抗菌药物，需注意监测患者是否出现过敏反应或胃肠道不适。",
    "布洛芬仅在必要时使用，不宜长期服用，以避免肾功能损害或胃肠道溃疡风险。",
    "氯己定漱口水长期使用可能导致牙齿着色，建议仅在医生指导下使用。"
  ],
  "recommendations": [
    "建议患者在服用布洛芬时注意监测疼痛缓解情况，避免过量使用。",
    "建议患者在服用甲硝唑期间严格禁酒，避免潜在的严重不良反应。",
    "建议患者在使用氯己定漱口水后定期检查牙齿状况，必要时咨询牙科医生。",
    "建议患者在服用阿莫西林和甲硝唑期间注意观察是否出现过敏反应，如皮疹、瘙痒等，若出现需立即停药并就医。",
    "建议患者完成抗生素疗程后，及时复诊以评估感染控制情况。"
  ]
}
```
2025-03-30 02:51:39,503 - Hospital-MultiAgent-System - INFO - 患者 P0008 的处方已通过审核
2025-03-30 02:51:39,508 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:39,510 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:39,511 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 02:51:39,511 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: a8854333-1953-44d4-b92e-b2c189ada80d
2025-03-30 02:51:39,511 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 8
2025-03-30 02:51:39,512 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:51:39] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 02:51:39,517 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 02:51:39] "GET /api/consultation/a8854333-1953-44d4-b92e-b2c189ada80d/history HTTP/1.1" 200 -
2025-03-30 03:01:18,162 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:01:18,162 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:01:18,162 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:01:18,175 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:01:18,175 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:01:18,175 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:01:18,175 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:01:18,175 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:01:18,175 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: eb292ddb-c6d7-4319-b8af-ba5312e7f31c)
2025-03-30 03:01:18,176 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:01:18,176 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 2ea42f2e-f396-4162-bf41-769452176efb)
2025-03-30 03:01:18,176 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化成功
2025-03-30 03:01:18,176 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: dbea21df-1eab-4229-9030-e18fc4f8862e)
2025-03-30 03:01:18,176 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:01:18,176 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 8f8744d6-b594-4a1e-8a93-02ade7e0c91f)
2025-03-30 03:01:18,176 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:01:18,176 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:01:18,176 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:01:18,176 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:01:18,185 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:01:18,185 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:01:18,185 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:01:18,186 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:01:18,205 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 03:01:18,205 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 03:01:18,206 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:01:18,379 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:01:18,379 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:01:18,379 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 3b497b81-3d9f-4974-bec0-ad7cc0b17d6b)
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 2156ef18-dfb4-4d86-ae47-aefd02c52f20)
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化成功
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: b035c11c-64bb-4c53-8e08-e535f1a5678d)
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 84f56842-d778-46b7-a28b-ba9d742d60ad)
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:01:18,392 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:01:18,393 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:01:18,402 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:01:18,402 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:01:18,402 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:01:18,403 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:01:18,414 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:01:18,419 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:01:24,666 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:01:24] "GET / HTTP/1.1" 200 -
2025-03-30 03:01:24,680 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:01:24] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 03:01:24,683 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:01:24] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 03:01:52,425 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:01:52,426 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: 0c253511-3808-4459-8957-3d519b2649ca
2025-03-30 03:01:52,426 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 8ce88ac3-5210-4519-baee-de5cb70efd5d
2025-03-30 03:01:52,429 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:01:52,429 - Hospital-MultiAgent-System - INFO - 创建新患者记录: P0009
2025-03-30 03:01:52,432 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:01:52,433 - Hospital-MultiAgent-System - INFO - 患者 赵四 (ID: P0009) 是复诊患者
2025-03-30 03:01:52,433 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0009) 的接诊请求
2025-03-30 03:01:52,433 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:01:52,433 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 03:01:52,433 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 03:01:52,591 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:01:52,594 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:01:55,257 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:01:55,262 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.67秒
2025-03-30 03:01:55,263 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "orthopedics",
  "g...
2025-03-30 03:01:55,263 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "orthopedics",
  "greeting": "您好，赵先生！我是医院前台接待员，很高兴为您服务。根据您描述的腰部、屁股和腿部疼痛症状，我建议您到骨科就诊。请前往骨科挂号窗口，我们会尽快安排医生为您诊治。祝您早日康复！"
}
```
2025-03-30 03:01:55,265 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:01:55,267 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:01:55,268 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:01:55,268 - Hospital-MultiAgent-System - INFO - 医生开始与患者 P0009 进行交互式问诊
2025-03-30 03:01:55,268 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:01:55,268 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行问诊。请提出专业、有针对性的问题。
2025-03-30 03:01:55,268 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下信息生成下一个问诊问题:

已知症状: 腰疼, 屁股疼, 腿疼
病史: 干...
2025-03-30 03:01:55,271 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:01:55,272 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:01:56,634 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:01:56,638 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.37秒
2025-03-30 03:01:56,638 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否会放射到其他部位，例如脚或脚趾？疼痛的性质是钝痛、刺痛还是烧灼感？
2025-03-30 03:01:56,641 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:01:56,643 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:01:56,643 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: 8ce88ac3-5210-4519-baee-de5cb70efd5d
2025-03-30 03:01:56,644 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 4
2025-03-30 03:01:56,644 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:01:56] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 03:01:56,650 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:01:56] "GET /api/consultation/8ce88ac3-5210-4519-baee-de5cb70efd5d/history HTTP/1.1" 200 -
2025-03-30 03:05:43,739 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 03:05:43,811 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:05:43,987 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:05:43,988 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:05:43,988 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:05:44,000 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:05:44,000 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: ed6451c4-cc93-4f42-a654-799eae3bbf2f)
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 550ef464-4f6c-4701-8c5e-c3cd07457f8f)
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化成功
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: cecdf81d-2d92-44f5-bc1c-bf420e6d42c8)
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 57a1476a-02dd-4025-8b95-001f00874c94)
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:05:44,001 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:05:44,010 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:05:44,011 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:05:44,011 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:05:44,011 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:05:44,024 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:05:44,028 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:07:09,780 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 03:07:09,849 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:07:10,027 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:07:10,027 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:07:10,027 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:07:10,039 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:07:10,039 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 07fb24e8-a681-4b12-b7e0-4b29c5f69682)
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 5a3648c0-39e6-4088-a98f-79a5470788e2)
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化成功
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: e1cd4951-7b6e-4663-a89a-497a6f643ca9)
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: f564ccc5-c928-4844-8345-7377377577d2)
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:07:10,040 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:07:10,049 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:07:10,049 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:07:10,049 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:07:10,050 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:07:10,062 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:07:10,067 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:07:17,970 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:07:17,971 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:07:17,971 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:07:17,983 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:07:17,983 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: b6852f53-07cc-410a-a46a-b1e4d93b5b22)
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 7c4d6498-c238-43da-9302-3d80de73fec0)
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化成功
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: d1eb3bb1-aece-42fd-86b7-17a572017dbf)
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 22e77ef6-f853-41cd-b9fa-91cd37f1f9ed)
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:07:17,984 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:07:17,994 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:07:17,994 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:07:17,994 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:07:17,994 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:07:18,013 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 03:07:18,013 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 03:07:18,014 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:07:18,187 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:07:18,187 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:07:18,187 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: c22b381c-476e-40c9-893d-409812f8841c)
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 23810120-3ef2-4e59-8748-bbc02da6e3c2)
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化成功
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 83f2a488-5f29-4e48-8fd9-f78e7419813c)
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 5f1f60f7-f383-4125-86d4-66cef3f02fdd)
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:07:18,200 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:07:18,209 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:07:18,210 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:07:18,210 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:07:18,210 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:07:18,223 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:07:18,228 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:07:24,029 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:07:24] "GET / HTTP/1.1" 200 -
2025-03-30 03:07:24,044 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:07:24] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 03:07:24,044 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:07:24] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 03:07:43,451 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:07:43,451 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: a4dd3aa5-8ed1-4834-9005-f249cf7ff89a
2025-03-30 03:07:43,452 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: b0aac59d-cdb2-4226-98cd-ab874e61e084
2025-03-30 03:07:43,455 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:07:43,455 - Hospital-MultiAgent-System - INFO - 创建新患者记录: P0010
2025-03-30 03:07:43,457 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:07:43,458 - Hospital-MultiAgent-System - INFO - 患者 赵四 (ID: P0010) 是复诊患者
2025-03-30 03:07:43,458 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0010) 的接诊请求
2025-03-30 03:07:43,458 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:07:43,458 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 03:07:43,458 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 03:07:43,616 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:07:43,619 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:07:46,086 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:07:46,094 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.47秒
2025-03-30 03:07:46,094 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "dental",
  "greeti...
2025-03-30 03:07:46,094 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "dental",
  "greeting": "您好，赵先生！我是医院前台接待员，很高兴为您服务。根据您的主诉症状牙疼，我建议您到牙科就诊。请您前往牙科诊室，我们的医生会为您检查和治疗。祝您早日康复！"
}
```
2025-03-30 03:07:46,102 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:07:46,106 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:07:46,111 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:07:46,111 - Hospital-MultiAgent-System - INFO - 医生开始与患者 P0010 进行交互式问诊
2025-03-30 03:07:46,111 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:07:46,111 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行问诊。请提出专业、有针对性的问题。
2025-03-30 03:07:46,111 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下信息生成下一个问诊问题:

已知症状: 牙疼
病史: 无
已问过的问题: ...
2025-03-30 03:07:46,113 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:07:46,115 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:07:47,497 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:07:47,501 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.39秒
2025-03-30 03:07:47,501 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：牙疼是持续性的还是间歇性的，疼痛是否会在咀嚼、冷热刺激或夜间加重？
2025-03-30 03:07:47,505 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:07:47,507 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:07:47,507 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: b0aac59d-cdb2-4226-98cd-ab874e61e084
2025-03-30 03:07:47,507 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 4
2025-03-30 03:07:47,507 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:07:47] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 03:07:47,511 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:07:47] "GET /api/consultation/b0aac59d-cdb2-4226-98cd-ab874e61e084/history HTTP/1.1" 200 -
2025-03-30 03:08:11,322 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:08:11,323 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: 89574368-b45e-4980-826e-7a80b12ee3e6
2025-03-30 03:08:11,323 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 0c4407c9-e856-47d7-a2ec-3a5827d95f29
2025-03-30 03:08:11,326 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:08:11,327 - Hospital-MultiAgent-System - INFO - 创建新患者记录: P0011
2025-03-30 03:08:11,330 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:08:11,330 - Hospital-MultiAgent-System - INFO - 患者 赵四 (ID: P0011) 是复诊患者
2025-03-30 03:08:11,330 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0011) 的接诊请求
2025-03-30 03:08:11,330 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:08:11,330 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 03:08:11,331 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 03:08:11,442 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:08:11,444 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:08:13,890 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:08:13,895 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.45秒
2025-03-30 03:08:13,900 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "internal",
  "gree...
2025-03-30 03:08:13,901 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "internal",
  "greeting": "您好，赵先生! 我是前台接待员，非常高兴为您服务。基于您的症状描述，我建议您先去内科就诊。请在等待区稍作休息，我们会尽快安排医生为您检查。"
}
```
2025-03-30 03:08:13,910 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:08:13,918 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:08:13,921 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:08:13,921 - Hospital-MultiAgent-System - INFO - 医生开始与患者 P0011 进行交互式问诊
2025-03-30 03:08:13,921 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:08:13,921 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行问诊。请提出专业、有针对性的问题。
2025-03-30 03:08:13,921 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下信息生成下一个问诊问题:

已知症状: 间歇性的
病史: 无
已问过的问题...
2025-03-30 03:08:13,923 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:08:13,925 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:08:15,749 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:08:15,750 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.82秒
2025-03-30 03:08:15,750 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：间歇性症状通常在什么时间段或特定情况下（如进食、运动、休息或压力增加时）更容易出现？
2025-03-30 03:08:15,751 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:08:15,752 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:08:15,752 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: 0c4407c9-e856-47d7-a2ec-3a5827d95f29
2025-03-30 03:08:15,752 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 4
2025-03-30 03:08:15,753 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:08:15] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 03:08:15,756 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:08:15] "GET /api/consultation/0c4407c9-e856-47d7-a2ec-3a5827d95f29/history HTTP/1.1" 200 -
2025-03-30 03:08:58,249 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:08:58,249 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: b0b3787e-8e21-4da9-af2b-d23318b9854c
2025-03-30 03:08:58,249 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 8fd90bcf-1387-44e9-bb39-403b2d4298fd
2025-03-30 03:08:58,253 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:08:58,253 - Hospital-MultiAgent-System - INFO - 创建新患者记录: P0012
2025-03-30 03:08:58,256 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:08:58,256 - Hospital-MultiAgent-System - INFO - 患者 赵四 (ID: P0012) 是复诊患者
2025-03-30 03:08:58,256 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0012) 的接诊请求
2025-03-30 03:08:58,256 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:08:58,256 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 03:08:58,256 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 03:08:58,849 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:08:58,852 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:09:01,739 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:09:01,743 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.89秒
2025-03-30 03:09:01,743 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "psychiatry",
  "gr...
2025-03-30 03:09:01,743 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "psychiatry",
  "greeting": "您好，赵先生！我是前台接待员，很高兴为您服务。根据您提到的情况，压力大的时候可能会出现一些相关的心理或情绪问题，我建议您到精神科就诊。请在前方候诊区稍等，我们会尽快为您安排医生。"
}
```
2025-03-30 03:09:01,747 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:09:01,749 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:09:01,751 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:09:01,751 - Hospital-MultiAgent-System - INFO - 医生开始与患者 P0012 进行交互式问诊
2025-03-30 03:09:01,751 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:09:01,751 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行问诊。请提出专业、有针对性的问题。
2025-03-30 03:09:01,751 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下信息生成下一个问诊问题:

已知症状: 压力大的时候
病史: 无
已问过的...
2025-03-30 03:09:01,753 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:09:01,754 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:09:03,102 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:09:03,107 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.35秒
2025-03-30 03:09:03,107 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：压力大的时候是否会出现特定的身体症状，例如头痛、胸闷、心率加快、胃部不适或其他不适？
2025-03-30 03:09:03,111 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:09:03,113 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:09:03,113 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: 8fd90bcf-1387-44e9-bb39-403b2d4298fd
2025-03-30 03:09:03,113 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 4
2025-03-30 03:09:03,114 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:09:03] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 03:09:03,118 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:09:03] "GET /api/consultation/8fd90bcf-1387-44e9-bb39-403b2d4298fd/history HTTP/1.1" 200 -
2025-03-30 03:10:57,068 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 03:10:57,125 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:10:57,321 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:10:57,321 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:10:57,321 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: fcfa5cbf-343d-4fba-870b-de8087a29579)
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 王医生 (ID: 56634c34-2542-446f-91da-83525e7fd71b)
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - 医生智能体 王医生 初始化成功
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 62f02355-38f9-430a-aaa3-438902bb789b)
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 25e21916-e180-49c4-900d-a71e96b79bb2)
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:10:57,334 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:10:57,344 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:10:57,344 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:10:57,344 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:10:57,345 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:10:57,359 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:10:57,363 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:12:08,917 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 03:12:08,975 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:18:38,007 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:18:38,007 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:18:38,007 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:18:38,020 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:18:38,020 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:18:38,020 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:18:38,020 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:18:38,021 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:18:38,021 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 94545ec1-5777-401c-a35c-ac7b43b1bd9d)
2025-03-30 03:18:38,021 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:18:38,021 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1075dfb30>智能体: 王医生 (ID: 6f918e7d-ffce-475c-b3ff-f3e51d10505e)
2025-03-30 03:18:38,021 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 95b7a5c1-c037-4bab-82c8-4fcc2055d98d)
2025-03-30 03:18:38,021 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:18:38,021 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: d0998779-92a8-4cf5-9401-8a89b0b78967)
2025-03-30 03:18:38,021 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:18:38,021 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:18:38,021 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:18:38,021 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:18:38,030 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:18:38,030 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:18:38,030 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:18:38,031 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:18:38,050 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 03:18:38,050 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 03:18:38,050 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:18:38,225 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:18:38,226 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:18:38,226 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:18:38,238 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:18:38,238 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:18:38,238 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:18:38,238 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:18:38,238 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:18:38,238 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 48858dea-87d2-4114-b2f1-c3e6e032b2ab)
2025-03-30 03:18:38,238 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:18:38,238 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x103387d10>智能体: 王医生 (ID: ce88e7be-5e0d-4faa-8f96-fbf104007a9d)
2025-03-30 03:18:38,238 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 92a65612-816c-4628-944d-1ea58447967f)
2025-03-30 03:18:38,238 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:18:38,238 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 28561a12-2b76-4314-a5e4-cb36665c4b38)
2025-03-30 03:18:38,239 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:18:38,239 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:18:38,239 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:18:38,239 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:18:38,248 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:18:38,248 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:18:38,248 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:18:38,249 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:18:38,261 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:18:38,265 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:18:47,450 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:18:47] "GET / HTTP/1.1" 200 -
2025-03-30 03:18:47,465 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:18:47] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 03:18:47,465 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:18:47] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 03:19:04,983 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:19:04,984 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: 423905ab-f71c-47e9-b606-4d0020eb2780
2025-03-30 03:19:04,984 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 7d9ddf22-4a25-490c-9db2-fbeedbd1964d
2025-03-30 03:19:04,984 - Hospital-MultiAgent-System - ERROR - 问诊流程发生错误: 'Orchestrator' object has no attribute '_get_or_create_patient_id'
2025-03-30 03:19:04,984 - Hospital-MultiAgent-System-Web - ERROR - 处理咨询请求时出错: '7d9ddf22-4a25-490c-9db2-fbeedbd1964d'
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 65, in process_consultation
    patient_id = self._get_or_create_patient_id(patient_name, patient_age)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Orchestrator' object has no attribute '_get_or_create_patient_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 157, in start_consultation
    result = hospital_system["orchestrator"].process_consultation(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 263, in process_consultation
    self.consultations[consultation_id]["status"] = "error"
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
KeyError: '7d9ddf22-4a25-490c-9db2-fbeedbd1964d'
2025-03-30 03:19:04,988 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:19:04] "[35m[1mPOST /api/consult HTTP/1.1[0m" 500 -
2025-03-30 03:20:17,081 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 03:20:17,132 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:20:17,330 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:20:17,330 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:20:17,330 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:20:17,343 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:20:17,343 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:20:17,343 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:20:17,343 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:20:17,343 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:20:17,343 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 424a30be-4e13-4ae6-9525-c7b7ec06bef6)
2025-03-30 03:20:17,343 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:20:17,343 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x10800d2b0>智能体: 王医生 (ID: b94598c7-7530-473f-9f4f-9625cb16592b)
2025-03-30 03:20:17,343 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 4123f262-e8f3-4f7d-9845-7ee377d3df1b)
2025-03-30 03:20:17,343 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:20:17,343 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 6b380a9f-aed2-4fcf-843d-4cfd382d8d69)
2025-03-30 03:20:17,343 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:20:17,344 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:20:17,344 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:20:17,344 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:20:17,353 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:20:17,353 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:20:17,353 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:20:17,354 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:20:17,367 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:20:17,372 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:20:39,542 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 03:20:39,608 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:20:39,792 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:20:39,792 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:20:39,792 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:20:39,805 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:20:39,805 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:20:39,805 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:20:39,805 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:20:39,805 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:20:39,805 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 00c1e147-3e69-4878-9188-84c0f7016889)
2025-03-30 03:20:39,805 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:20:39,805 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1056330e0>智能体: 王医生 (ID: 80aec904-2be0-479b-9d07-8a633bcccf16)
2025-03-30 03:20:39,805 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: db6295f4-9277-4f63-b9e1-cd32c4a8ab6a)
2025-03-30 03:20:39,805 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:20:39,805 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 33c1d19a-6b93-46b6-be5a-d6d1b519bc1d)
2025-03-30 03:20:39,805 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:20:39,806 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:20:39,806 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:20:39,806 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:20:39,815 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:20:39,815 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:20:39,815 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:20:39,815 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:20:39,829 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:20:39,833 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:20:51,329 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:20:51,329 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:20:51,329 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:20:51,342 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:20:51,342 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:20:51,342 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:20:51,342 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:20:51,342 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:20:51,342 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 32d41db5-c002-4d18-8c30-e771d886242e)
2025-03-30 03:20:51,342 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:20:51,342 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x10552edb0>智能体: 王医生 (ID: a4326aff-04d8-4cbe-949d-4b382132fa07)
2025-03-30 03:20:51,343 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: fb365029-881d-4cc7-b454-e6743210f59e)
2025-03-30 03:20:51,343 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:20:51,343 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: fcb824c3-dcd5-4cb0-8916-a61b6abc1e7d)
2025-03-30 03:20:51,343 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:20:51,343 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:20:51,343 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:20:51,343 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:20:51,352 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:20:51,352 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:20:51,352 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:20:51,353 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:20:51,372 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 03:20:51,372 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 03:20:51,372 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:20:51,547 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:20:51,547 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:20:51,547 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:20:51,559 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:20:51,559 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:20:51,559 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:20:51,559 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:20:51,560 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:20:51,560 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 4d2d073f-d597-49c6-9e4a-2254f5e9dfec)
2025-03-30 03:20:51,560 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:20:51,560 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x102995370>智能体: 王医生 (ID: 66741353-a013-4928-b7f5-822753dd558c)
2025-03-30 03:20:51,560 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 122b4db3-8b96-43c9-aae2-bb644b75147d)
2025-03-30 03:20:51,560 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:20:51,560 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 75799bfd-7084-47fe-9f42-d8fbc663e162)
2025-03-30 03:20:51,560 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:20:51,560 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:20:51,560 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:20:51,560 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:20:51,569 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:20:51,569 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:20:51,569 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:20:51,570 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:20:51,584 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:20:51,588 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:20:55,546 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:20:55] "GET / HTTP/1.1" 200 -
2025-03-30 03:20:55,558 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:20:55] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 03:20:55,559 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:20:55] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 03:21:05,468 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:21:05,468 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: 58d3af23-9662-402f-91fb-a39e3c6bd161
2025-03-30 03:21:05,469 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 6a0443f9-a90c-44f4-82ce-bcbcc0af0777
2025-03-30 03:21:05,469 - Hospital-MultiAgent-System - ERROR - 问诊流程发生错误: 'MemorySystem' object has no attribute 'get_all_patients'
2025-03-30 03:21:05,469 - Hospital-MultiAgent-System-Web - ERROR - 处理咨询请求时出错: '6a0443f9-a90c-44f4-82ce-bcbcc0af0777'
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 65, in process_consultation
    patient_id = self._get_or_create_patient_id(patient_name, patient_age)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 648, in _get_or_create_patient_id
    patients = self.memory_system.get_all_patients()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'MemorySystem' object has no attribute 'get_all_patients'. Did you mean: 'get_all_patient_ids'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 157, in start_consultation
    result = hospital_system["orchestrator"].process_consultation(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 263, in process_consultation
    self.consultations[consultation_id]["status"] = "error"
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
KeyError: '6a0443f9-a90c-44f4-82ce-bcbcc0af0777'
2025-03-30 03:21:05,473 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:21:05] "[35m[1mPOST /api/consult HTTP/1.1[0m" 500 -
2025-03-30 03:22:11,207 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/memory_system.py', reloading
2025-03-30 03:22:11,261 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:22:11,459 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:22:11,459 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:22:11,459 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:22:11,472 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:22:11,472 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:22:11,472 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:22:11,472 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:22:11,472 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:22:11,472 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: c07d253b-6871-48fc-bca4-ec819d450145)
2025-03-30 03:22:11,472 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:22:11,472 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x103a26a20>智能体: 王医生 (ID: 98a8560b-5a37-4f72-826a-902b9c36d4c1)
2025-03-30 03:22:11,472 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 76b0645f-9d2d-4f42-a561-a10cd41cea7f)
2025-03-30 03:22:11,472 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:22:11,472 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: eee478ce-b6c1-43ad-9a76-b7748c48f2d9)
2025-03-30 03:22:11,472 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:22:11,473 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:22:11,473 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:22:11,473 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:22:11,483 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:22:11,483 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:22:11,483 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:22:11,483 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:22:11,498 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:22:11,503 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:22:43,750 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/memory_system.py', reloading
2025-03-30 03:22:43,821 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:22:44,003 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:22:44,003 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:22:44,003 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:22:44,016 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:22:44,016 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:22:44,016 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:22:44,016 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:22:44,017 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:22:44,017 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 66cf1dfc-ed00-49de-b418-781bae06cfe2)
2025-03-30 03:22:44,017 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:22:44,017 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1052cb680>智能体: 王医生 (ID: f5ee5e41-9792-49ee-876f-d094f2a61fc9)
2025-03-30 03:22:44,017 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 08a33fd3-3090-4540-8b2e-dd41b15c94a0)
2025-03-30 03:22:44,017 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:22:44,017 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 5f36ea99-27b4-4722-81a3-eb4bfb10df0b)
2025-03-30 03:22:44,017 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:22:44,017 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:22:44,017 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:22:44,017 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:22:44,026 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:22:44,026 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:22:44,026 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:22:44,027 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:22:44,040 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:22:44,044 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:23:00,574 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:23:00,574 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:23:00,574 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: e30ebdf6-d765-4611-9b86-02fdf9e3a69e)
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1051e6db0>智能体: 王医生 (ID: e614268d-6436-48aa-8774-b16b42a96812)
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: b890fa21-ec6f-40b4-b2c8-b987d0a3f19f)
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: aa15fed8-f301-4138-bd3d-612024484d65)
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:23:00,587 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:23:00,597 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:23:00,597 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:23:00,597 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:23:00,597 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:23:00,616 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 03:23:00,617 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 03:23:00,617 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:23:00,792 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:23:00,792 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:23:00,792 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:23:00,804 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:23:00,804 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: c7755a9c-5dd3-4ca4-b5e9-097dff42720f)
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x10500e1e0>智能体: 王医生 (ID: af75e0c1-e0ce-4450-8c24-739ae0f71ae8)
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 5ecba0ee-1a0a-4d76-b701-6453e057f6ee)
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 193b2f9c-5ad2-4284-9ff5-c0cd4120db2b)
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:23:00,805 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:23:00,815 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:23:00,815 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:23:00,815 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:23:00,815 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:23:00,829 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:23:00,833 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:23:06,099 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:23:06] "GET / HTTP/1.1" 200 -
2025-03-30 03:23:06,114 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:23:06] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 03:23:06,114 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:23:06] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 03:23:19,508 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:23:19,508 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: b32dba1e-eabd-405d-8da6-c49f892cd508
2025-03-30 03:23:19,508 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: d5e1ac7c-9f0e-4244-a43d-1c58092b2586
2025-03-30 03:23:19,512 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:23:19,512 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0004) 的接诊请求
2025-03-30 03:23:19,512 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:23:19,513 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 03:23:19,513 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 03:23:19,683 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:23:19,685 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:23:22,180 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:23:22,190 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.50秒
2025-03-30 03:23:22,190 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "surgery",
  "greet...
2025-03-30 03:23:22,190 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "surgery",
  "greeting": "您好，赵先生！我是医院的前台接待员，很高兴为您服务。根据您的症状描述，我建议您到外科就诊。请前往一楼外科诊区，我们会尽快安排医生为您检查。"
}
```
2025-03-30 03:23:22,190 - Hospital-MultiAgent-System - INFO - 医生开始与患者 P0004 进行交互式问诊
2025-03-30 03:23:22,190 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:23:22,191 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行问诊。请提出专业、有针对性的问题。
2025-03-30 03:23:22,191 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下信息生成下一个问诊问题:

已知症状: 屁股疼
病史: 无
已问过的问题:...
2025-03-30 03:23:22,198 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:23:22,204 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:23:24,123 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:23:24,127 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.92秒
2025-03-30 03:23:24,127 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是持续性的还是间歇性的？如果是间歇性的，通常会在什么情况下加重或缓解？
2025-03-30 03:23:24,127 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: d5e1ac7c-9f0e-4244-a43d-1c58092b2586
2025-03-30 03:23:24,127 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 4
2025-03-30 03:23:24,128 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:23:24] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 03:23:24,135 - Hospital-MultiAgent-System-Web - ERROR - 获取咨询历史时出错: Object of type MemorySystem is not JSON serializable
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 252, in get_consultation_history
    return jsonify({
           ^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type MemorySystem is not JSON serializable
2025-03-30 03:23:24,139 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:23:24] "[35m[1mGET /api/consultation/d5e1ac7c-9f0e-4244-a43d-1c58092b2586/history HTTP/1.1[0m" 500 -
2025-03-30 03:24:44,675 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 03:24:44,757 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:24:44,934 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:24:44,934 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:24:44,934 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 95b560e6-5f8f-4bc2-ad3f-a0a48903636e)
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1030f1070>智能体: 王医生 (ID: 18fef439-b373-43ef-b9a3-f0fa1aca7faf)
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: a4cd9941-6ac5-4d2c-bdd1-4656232899d2)
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: f1323529-f416-4268-9a89-81bbaec23c74)
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:24:44,947 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:24:44,956 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:24:44,956 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:24:44,956 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:24:44,957 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:24:44,970 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:24:44,974 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:25:09,215 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 03:25:09,282 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:25:09,470 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:25:09,470 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:25:09,470 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:25:09,482 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:25:09,482 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:25:09,482 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:25:09,483 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:25:09,483 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:25:09,483 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 18c22575-bf5d-414c-9c5f-e0bb0ec0fcc2)
2025-03-30 03:25:09,483 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:25:09,483 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x10733d370>智能体: 王医生 (ID: 78d99b2e-2765-4b85-9b12-fc0c1fe0f297)
2025-03-30 03:25:09,483 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: b7d1b209-3198-451e-8220-68b45725acc1)
2025-03-30 03:25:09,483 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:25:09,483 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: ebdd3462-2fc7-43a0-b78b-93d2211044ee)
2025-03-30 03:25:09,483 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:25:09,483 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:25:09,483 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:25:09,483 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:25:09,492 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:25:09,492 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:25:09,492 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:25:09,493 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:25:09,504 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:25:09,508 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:25:19,706 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:25:19,707 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:25:19,707 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:25:19,719 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:25:19,719 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: a07d5616-ec14-48fa-938d-d02bf416f541)
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x10676d2b0>智能体: 王医生 (ID: a2e925d0-3bfa-4a42-a8d2-6fdde333ffba)
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 6c462b48-ce7e-4238-a7e2-998bbf548dce)
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: ed9ea278-c072-4d25-8333-a2e55116c0b5)
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:25:19,720 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:25:19,730 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:25:19,730 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:25:19,730 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:25:19,730 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:25:19,751 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 03:25:19,751 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 03:25:19,752 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:25:19,928 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:25:19,928 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:25:19,928 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:25:19,941 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:25:19,941 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:25:19,941 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:25:19,941 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:25:19,941 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:25:19,942 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 9c273274-0ddb-4841-b50f-e9f80b99c94a)
2025-03-30 03:25:19,942 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:25:19,942 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x104e33320>智能体: 王医生 (ID: 1bd4a085-22bc-42c1-981d-fb28c8e3081c)
2025-03-30 03:25:19,942 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 4ffcebcc-1ad0-4952-bdf0-bacb5b3eef36)
2025-03-30 03:25:19,942 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:25:19,942 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 184bbc10-78ad-4d25-a40b-42f100b44da2)
2025-03-30 03:25:19,942 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:25:19,942 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:25:19,942 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:25:19,942 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:25:19,951 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:25:19,951 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:25:19,951 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:25:19,952 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:25:19,964 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:25:19,968 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:25:30,201 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:25:30] "GET / HTTP/1.1" 200 -
2025-03-30 03:25:30,217 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:25:30] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 03:25:30,217 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:25:30] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 03:25:42,162 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:25:42,162 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: b4e868e0-2510-47aa-954a-4342f2e3cea5
2025-03-30 03:25:42,162 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: f4077ed1-058f-4fa4-b97f-aa8c1378e5bc
2025-03-30 03:25:42,162 - Hospital-MultiAgent-System - ERROR - 问诊流程发生错误: 'MemorySystem' object has no attribute 'get_all_patients'
2025-03-30 03:25:42,163 - Hospital-MultiAgent-System-Web - ERROR - 处理咨询请求时出错: 'f4077ed1-058f-4fa4-b97f-aa8c1378e5bc'
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 65, in process_consultation
    patient_id = self._get_or_create_patient_id(patient_name, patient_age)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 648, in _get_or_create_patient_id
    patients = self.memory_system.get_all_patients()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'MemorySystem' object has no attribute 'get_all_patients'. Did you mean: 'get_all_patient_ids'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 157, in start_consultation
    result = hospital_system["orchestrator"].process_consultation(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 263, in process_consultation
    self.consultations[consultation_id]["status"] = "error"
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
KeyError: 'f4077ed1-058f-4fa4-b97f-aa8c1378e5bc'
2025-03-30 03:25:42,166 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:25:42] "[35m[1mPOST /api/consult HTTP/1.1[0m" 500 -
2025-03-30 03:26:59,770 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 03:26:59,823 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:27:00,029 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:27:00,029 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:27:00,029 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 157965da-15bf-4b3d-a3e1-938022f81cf3)
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x103652120>智能体: 王医生 (ID: 47dda12a-a323-4c0d-8a63-ea3511fa17a5)
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 8ce1481a-6d10-42b6-a00f-82f32bc725e6)
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 89a34fd6-d5c6-414d-8828-c8a85517b862)
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:27:00,043 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:27:00,053 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:27:00,053 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:27:00,053 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:27:00,054 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:27:00,068 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:27:00,072 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:27:27,250 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 03:27:27,322 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:27:27,503 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:27:27,503 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:27:27,503 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:27:27,515 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:27:27,515 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:27:27,515 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:27:27,516 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:27:27,516 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:27:27,516 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 328ea273-214d-4b3a-8c24-f831fd2166b6)
2025-03-30 03:27:27,516 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:27:27,516 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1078797f0>智能体: 王医生 (ID: f11ddcb1-5373-479d-ac61-644f863f0c89)
2025-03-30 03:27:27,516 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 4e486d44-661a-4da9-bf88-8902a764d934)
2025-03-30 03:27:27,516 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:27:27,516 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: b6e58a71-befc-45e4-a28e-035d364e56d8)
2025-03-30 03:27:27,516 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:27:27,516 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:27:27,516 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:27:27,516 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:27:27,525 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:27:27,525 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:27:27,525 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:27:27,526 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:27:27,540 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:27:27,544 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:27:39,037 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:27:39,037 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:27:39,037 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:27:39,050 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:27:39,050 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:27:39,050 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:27:39,050 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:27:39,050 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:27:39,050 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 05d21c39-1a34-4c6e-a256-117dd390d0d8)
2025-03-30 03:27:39,050 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:27:39,050 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1063f12b0>智能体: 王医生 (ID: 916f8668-959e-4d46-b9a7-a79ae7d5fdf9)
2025-03-30 03:27:39,050 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 71d8daab-85f0-4f69-82f3-5777e52ef958)
2025-03-30 03:27:39,050 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:27:39,050 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 3592ef36-62fe-4617-ae6f-517244f97652)
2025-03-30 03:27:39,051 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:27:39,051 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:27:39,051 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:27:39,051 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:27:39,060 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:27:39,060 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:27:39,060 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:27:39,061 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:27:39,078 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 03:27:39,078 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 03:27:39,078 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:27:39,252 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:27:39,252 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:27:39,252 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 3884d9df-f5dd-4727-8164-665923d13c91)
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x101733ec0>智能体: 王医生 (ID: 7adaecf6-5224-4d81-a89a-48eccfe04887)
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 7853ddd2-47da-4d88-b2bd-76353ce99ef0)
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 62c75074-afb6-4918-ab41-4d4fbc02a593)
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:27:39,265 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:27:39,275 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:27:39,275 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:27:39,275 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:27:39,275 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:27:39,289 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:27:39,293 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:27:50,361 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:27:50] "GET / HTTP/1.1" 200 -
2025-03-30 03:27:50,373 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:27:50] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 03:27:50,376 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:27:50] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 03:28:01,207 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:28:01,207 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: c6f72797-d933-4434-8600-b5d19003058e
2025-03-30 03:28:01,207 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 89359457-d698-4e63-9bd0-28aa91f486a4
2025-03-30 03:28:01,207 - Hospital-MultiAgent-System - ERROR - 问诊流程发生错误: 'MemorySystem' object has no attribute 'get_all_patients'
2025-03-30 03:28:01,208 - Hospital-MultiAgent-System-Web - ERROR - 处理咨询请求时出错: '89359457-d698-4e63-9bd0-28aa91f486a4'
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 65, in process_consultation
    patient_id = self._get_or_create_patient_id(patient_name, patient_age)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 649, in _get_or_create_patient_id
    existing_patients = self.memory_system.get_all_patients()
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'MemorySystem' object has no attribute 'get_all_patients'. Did you mean: 'get_all_patient_ids'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 157, in start_consultation
    result = hospital_system["orchestrator"].process_consultation(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 263, in process_consultation
    self.consultations[consultation_id]["status"] = "error"
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
KeyError: '89359457-d698-4e63-9bd0-28aa91f486a4'
2025-03-30 03:28:01,212 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:28:01] "[35m[1mPOST /api/consult HTTP/1.1[0m" 500 -
2025-03-30 03:29:30,147 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/memory_system.py', reloading
2025-03-30 03:29:30,204 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:29:30,398 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:29:30,398 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:29:30,398 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:29:30,411 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:29:30,411 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:29:30,411 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:29:30,411 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:29:30,411 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:29:30,411 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 4b088b1d-c2a5-4bf5-afd6-8782e0651d8b)
2025-03-30 03:29:30,411 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:29:30,411 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x106af2db0>智能体: 王医生 (ID: 58d77e9d-4643-4792-b427-ec9d83540b5f)
2025-03-30 03:29:30,411 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 4f0a721c-e831-4f2a-b673-b5877866cc0b)
2025-03-30 03:29:30,411 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:29:30,411 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: eedf9ae1-3727-4dd1-bfa6-31779a00e345)
2025-03-30 03:29:30,411 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:29:30,412 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:29:30,412 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:29:30,412 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:29:30,421 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:29:30,421 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:29:30,421 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:29:30,422 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:29:30,436 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:29:30,441 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:29:33,456 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/memory_system.py', reloading
2025-03-30 03:29:33,509 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:29:33,706 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:29:33,706 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:29:33,706 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:29:33,719 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:29:33,719 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:29:33,719 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:29:33,720 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:29:33,720 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:29:33,720 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 54ad7b01-978c-4b2c-97bf-cd93ba4a03df)
2025-03-30 03:29:33,720 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:29:33,720 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x105aa7bf0>智能体: 王医生 (ID: a33cb06e-9e67-4faa-b61f-9ab464433004)
2025-03-30 03:29:33,720 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: f9de9582-5b4d-402d-8875-95a727a6a96e)
2025-03-30 03:29:33,720 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:29:33,720 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: d8fa18bd-82c4-40e1-bc8b-e0af9d121feb)
2025-03-30 03:29:33,720 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:29:33,720 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:29:33,720 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:29:33,720 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:29:33,730 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:29:33,730 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:29:33,730 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:29:33,730 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:29:33,745 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:29:33,749 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:30:10,964 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/memory_system.py', reloading
2025-03-30 03:30:11,019 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:30:11,225 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:30:11,225 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:30:11,225 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:30:11,238 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:30:11,238 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:30:11,238 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:30:11,238 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:30:11,238 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:30:11,238 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 5c32b81a-8983-447a-88d0-f37bfdd2f84a)
2025-03-30 03:30:11,238 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:30:11,239 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1082752b0>智能体: 王医生 (ID: 58fcadb3-8da7-4c6a-bf7a-6055b7d7edb9)
2025-03-30 03:30:11,239 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 12120cb1-73a8-40a5-8cef-d6136c6cef3b)
2025-03-30 03:30:11,239 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:30:11,239 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 7f72797a-c895-4b7a-a14e-feaa3e8acc3d)
2025-03-30 03:30:11,239 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:30:11,239 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:30:11,239 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:30:11,239 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:30:11,249 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:30:11,249 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:30:11,249 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:30:11,250 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:30:11,264 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:30:11,269 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:30:15,294 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/memory_system.py', reloading
2025-03-30 03:30:15,347 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:30:15,546 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:30:15,546 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:30:15,546 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:30:15,559 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:30:15,559 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: a82e55d6-fd82-404e-819d-cfa2fbcec69b)
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1058a79b0>智能体: 王医生 (ID: caa7251c-7b24-485a-8605-815d4fd86ec3)
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 9ce82491-1a1a-4582-b9ca-162585122687)
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 88cc6103-8805-4a8d-bf8a-9d128c998ec5)
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:30:15,560 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:30:15,570 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:30:15,570 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:30:15,570 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:30:15,571 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:30:15,583 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:30:15,588 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:30:40,631 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:30:40,631 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:30:40,631 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:30:40,645 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:30:40,645 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:30:40,645 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:30:40,645 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:30:40,645 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:30:40,645 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 4cd6d3cf-5997-4719-90e8-d240b01555ad)
2025-03-30 03:30:40,645 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:30:40,645 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x103d7f320>智能体: 王医生 (ID: ac673e4a-ccdf-48a8-9714-e98a2bea1457)
2025-03-30 03:30:40,645 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: d0a24c33-31fa-4e32-916f-e95c76f16651)
2025-03-30 03:30:40,645 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:30:40,645 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 30bcfda5-6aa1-4383-9806-9ee3dfc3de8a)
2025-03-30 03:30:40,645 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:30:40,646 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:30:40,646 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:30:40,646 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:30:40,655 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:30:40,655 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:30:40,655 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:30:40,656 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:30:40,676 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 03:30:40,676 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 03:30:40,677 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:30:40,868 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:30:40,868 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:30:40,868 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:30:40,882 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:30:40,882 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:30:40,882 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:30:40,882 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:30:40,882 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:30:40,882 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: a07bd05b-7a5d-4d35-a266-8aa9a490d6a5)
2025-03-30 03:30:40,882 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:30:40,882 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1046a5430>智能体: 王医生 (ID: f5d1476f-479b-4e79-86d4-6e1711f998f1)
2025-03-30 03:30:40,882 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 2022cf17-aa34-4a4e-a27d-9074beff852e)
2025-03-30 03:30:40,882 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:30:40,882 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 885cea63-c602-47ec-8514-57d6ad3b5312)
2025-03-30 03:30:40,882 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:30:40,883 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:30:40,883 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:30:40,883 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:30:40,892 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:30:40,893 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:30:40,893 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:30:40,893 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:30:40,907 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:30:40,911 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:30:46,787 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:30:46] "GET / HTTP/1.1" 200 -
2025-03-30 03:30:46,800 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:30:46] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 03:30:46,800 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:30:46] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 03:30:59,513 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:30:59,514 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: cc30c75c-5190-4329-8084-4fb77cbbbd44
2025-03-30 03:30:59,514 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 9cfb1aac-a205-4274-aea2-2047d4b7ff9b
2025-03-30 03:30:59,518 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:30:59,518 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0004) 的接诊请求
2025-03-30 03:30:59,518 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:30:59,518 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 03:30:59,518 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 03:30:59,758 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:30:59,760 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:31:02,359 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:31:02,365 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.61秒
2025-03-30 03:31:02,365 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "surgery",
  "greet...
2025-03-30 03:31:02,365 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "surgery",
  "greeting": "您好，赵先生！我是前台接待员，很高兴为您服务。根据您描述的症状，我建议您前往外科就诊。请到右侧的等候区稍作休息，我们会尽快安排医生为您诊疗。"
}
```
2025-03-30 03:31:02,366 - Hospital-MultiAgent-System - INFO - 医生开始与患者 P0004 进行交互式问诊
2025-03-30 03:31:02,366 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:31:02,366 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行问诊。请提出专业、有针对性的问题。
2025-03-30 03:31:02,366 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下信息生成下一个问诊问题:

已知症状: 屁股疼
病史: 无
已问过的问题:...
2025-03-30 03:31:02,368 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:31:02,370 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:31:03,516 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:31:03,518 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.15秒
2025-03-30 03:31:03,518 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是持续性的还是间歇性的？疼痛是否与坐姿、活动或排便有关？
2025-03-30 03:31:03,518 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: 9cfb1aac-a205-4274-aea2-2047d4b7ff9b
2025-03-30 03:31:03,518 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 4
2025-03-30 03:31:03,519 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:31:03] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 03:31:03,523 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:31:03] "GET /api/consultation/9cfb1aac-a205-4274-aea2-2047d4b7ff9b/history HTTP/1.1" 200 -
2025-03-30 03:35:42,505 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:35:42] "GET / HTTP/1.1" 200 -
2025-03-30 03:35:42,512 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:35:42] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 03:35:42,513 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:35:42] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 03:36:02,015 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:36:02,015 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: d5a5564f-deef-443b-9117-862b933a5e11
2025-03-30 03:36:02,015 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 89b53f41-1fca-454b-b7fc-353cef906148
2025-03-30 03:36:02,019 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:36:02,019 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0004) 的接诊请求
2025-03-30 03:36:02,019 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:36:02,020 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 03:36:02,020 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 03:36:32,022 - Hospital-MultiAgent-System - WARNING - 网络检查失败: [Errno 8] nodename nor servname provided, or not known
2025-03-30 03:36:49,982 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:36:49,985 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：17.96秒
2025-03-30 03:36:49,985 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "surgery",
  "greet...
2025-03-30 03:36:49,986 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "surgery",
  "greeting": "您好，赵先生！我是医院的前台接待员。根据您的症状描述，建议您先到外科就诊，看看是否涉及软组织或其他相关问题。请在大厅左侧等候区稍作休息，我们会尽快为您安排医生诊疗。"
}
```
2025-03-30 03:36:49,986 - Hospital-MultiAgent-System - INFO - 医生开始与患者 P0004 进行交互式问诊
2025-03-30 03:36:49,986 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:36:49,986 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行问诊。请提出专业、有针对性的问题。
2025-03-30 03:36:49,986 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下信息生成下一个问诊问题:

已知症状: 屁股疼
病史: 无
已问过的问题:...
2025-03-30 03:36:49,990 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:36:50,208 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:36:51,480 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:36:51,484 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.27秒
2025-03-30 03:36:51,484 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是持续性还是间歇性的？疼痛的性质是刺痛、钝痛还是灼痛？
2025-03-30 03:36:51,484 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: 9cfb1aac-a205-4274-aea2-2047d4b7ff9b
2025-03-30 03:36:51,485 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 4
2025-03-30 03:36:51,485 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:36:51] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 03:36:51,492 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:36:51] "GET /api/consultation/9cfb1aac-a205-4274-aea2-2047d4b7ff9b/history HTTP/1.1" 200 -
2025-03-30 03:37:55,483 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 03:37:55,483 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 03:37:55,483 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 03:37:55,495 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:37:55,495 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: 
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 736906bb-05a2-4886-90d7-f09ef75c7222)
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x106ddc320>智能体: 王医生 (ID: 2bd02d69-892f-448f-be14-19cef4a0129d)
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 70513f88-e46d-4eac-80c8-df040f30d3c6)
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 076ebcd8-5380-4574-b1fe-4a430f2ac79b)
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 03:37:55,496 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 03:37:55,506 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:37:55,506 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:37:55,506 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:37:55,506 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:37:55,525 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 03:37:55,525 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 03:37:55,525 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:37:55,697 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:37:55,697 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:37:55,697 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:37:55,709 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 3f66a77f-49ff-4d77-91cd-a958591ebdef)
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x10729bf20>智能体: 王医生 (ID: 620137d7-0f05-4d28-a5dc-73bd0e17d839)
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 711077fa-d164-474e-a726-28534638c01f)
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 56a47c46-9e53-4495-8025-e6d5a883e784)
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:37:55,710 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:37:55,720 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:37:55,720 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:37:55,720 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:37:55,720 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:37:55,734 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:37:55,738 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:38:00,223 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:38:00] "GET / HTTP/1.1" 200 -
2025-03-30 03:38:00,236 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:38:00] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 03:38:00,237 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:38:00] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 03:38:12,470 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:38:12,470 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: 6e769eb2-e258-46f5-8717-6c7d63375c94
2025-03-30 03:38:12,470 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 48033423-1544-4463-91a6-add21f779a7f
2025-03-30 03:38:12,475 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:38:12,475 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0004) 的接诊请求
2025-03-30 03:38:12,476 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:38:12,476 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 03:38:12,476 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 03:38:12,496 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:38:12,714 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:38:15,808 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:38:15,814 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.10秒
2025-03-30 03:38:15,815 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "orthopedics",
  "g...
2025-03-30 03:38:15,815 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "orthopedics",
  "greeting": "您好，赵先生！我是医院前台接待员，很高兴为您服务。根据您的症状描述，我建议您前往骨科就诊，由专业医生为您检查和诊疗。请前往左侧骨科候诊区稍作等待，我们会尽快为您安排。"
}
```
2025-03-30 03:38:15,815 - Hospital-MultiAgent-System - INFO - 医生开始与患者 P0004 进行交互式问诊
2025-03-30 03:38:15,815 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:38:15,815 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行问诊。请提出专业、有针对性的问题。
2025-03-30 03:38:15,815 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下信息生成下一个问诊问题:

已知症状: 屁股疼
病史: 无
已问过的问题:...
2025-03-30 03:38:15,818 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:38:16,035 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:38:16,849 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:38:16,852 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.82秒
2025-03-30 03:38:16,852 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是持续性还是间歇性？是否有特定活动、姿势或时间会加重或缓解疼痛？
2025-03-30 03:38:16,852 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: 48033423-1544-4463-91a6-add21f779a7f
2025-03-30 03:38:16,853 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 4
2025-03-30 03:38:16,854 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:38:16] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 03:38:16,860 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:38:16] "GET /api/consultation/48033423-1544-4463-91a6-add21f779a7f/history HTTP/1.1" 200 -
2025-03-30 03:41:47,646 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:41:47] "GET / HTTP/1.1" 200 -
2025-03-30 03:41:47,653 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:41:47] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 03:41:47,655 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:41:47] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 03:41:59,898 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 03:41:59,898 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 03:41:59,899 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 03:41:59,911 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:41:59,911 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: 
2025-03-30 03:41:59,911 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:41:59,912 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:41:59,912 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:41:59,912 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 45ce7586-372d-42c5-b2e3-d18351332490)
2025-03-30 03:41:59,912 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:41:59,912 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1103b7320>智能体: 王医生 (ID: 11f55254-8087-4922-81a5-4ef27920c0db)
2025-03-30 03:41:59,912 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: a46b447b-2b8c-4dc5-8ec5-f61c4e94eb10)
2025-03-30 03:41:59,912 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:41:59,912 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: a59c5c78-c481-4ed5-b90e-48a4f86fa1f5)
2025-03-30 03:41:59,912 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:41:59,912 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 03:41:59,912 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 03:41:59,912 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 03:41:59,921 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:41:59,921 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:41:59,921 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:41:59,922 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:41:59,953 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 03:41:59,953 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 03:41:59,954 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:42:00,127 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:42:00,127 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:42:00,127 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:42:00,139 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 7e2f6546-5d82-408d-b7a5-5ac835f7e4b4)
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x10354bec0>智能体: 王医生 (ID: 3e08db5a-8f6c-4a43-bc00-7311781ce1e7)
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: a850fdbb-870f-4e0f-a5d9-2d6a385ab2b7)
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: e2ef28bb-45e6-4151-a51d-b2f92434d37d)
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:42:00,140 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:42:00,150 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:42:00,150 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:42:00,150 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:42:00,151 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:42:00,164 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:42:00,168 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:42:09,628 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:42:09] "GET / HTTP/1.1" 200 -
2025-03-30 03:42:09,649 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:42:09] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 03:42:09,649 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:42:09] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 03:42:22,346 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:42:22,346 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: 7666b16a-7e82-41ea-a0e1-12152923adb4
2025-03-30 03:42:22,347 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 0e75ccb0-8cc4-402a-9abf-9652248f30d7
2025-03-30 03:42:22,350 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:42:22,351 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0004) 的接诊请求
2025-03-30 03:42:22,351 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:42:22,351 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 03:42:22,351 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 03:42:22,370 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:42:22,587 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:42:25,060 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:42:25,068 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.48秒
2025-03-30 03:42:25,068 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "department_code": "surgery",
  "greeting": "您...
2025-03-30 03:42:25,068 - Hospital-MultiAgent-System - INFO - 医生开始与患者 P0004 进行交互式问诊
2025-03-30 03:42:25,068 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:42:25,069 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行问诊。请提出专业、有针对性的问题。
2025-03-30 03:42:25,069 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下信息生成下一个问诊问题:

已知症状: 屁股疼
病史: 无
已问过的问题:...
2025-03-30 03:42:25,072 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:42:25,293 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:42:26,569 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:42:26,573 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.28秒
2025-03-30 03:42:26,573 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是持续性的还是间歇性的？如果是间歇性的，通常在什么情况下会加重或缓解？
2025-03-30 03:42:26,573 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: 0e75ccb0-8cc4-402a-9abf-9652248f30d7
2025-03-30 03:42:26,573 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 4
2025-03-30 03:42:26,574 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:42:26] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 03:42:26,588 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:42:26] "GET /api/consultation/0e75ccb0-8cc4-402a-9abf-9652248f30d7/history HTTP/1.1" 200 -
2025-03-30 03:42:57,590 - Hospital-MultiAgent-System-Web - ERROR - 处理患者回答时发生错误: Object of type MemorySystem is not JSON serializable
2025-03-30 03:42:57,591 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:42:57] "[35m[1mPOST /api/patient_response HTTP/1.1[0m" 500 -
2025-03-30 03:44:46,558 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 03:44:46,636 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:44:46,812 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:44:46,813 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:44:46,813 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:44:46,825 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:44:46,825 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 58223711-4456-4c74-a32b-e4f8be9ae829)
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1014eadb0>智能体: 王医生 (ID: 96e389dc-da5d-4868-9f04-857dc79aa922)
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 44c09d64-e9c3-48aa-ad70-29fe9ec05e0d)
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 7fce86ec-d8ea-4416-80c8-75b5b0437560)
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:44:46,826 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:44:46,835 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:44:46,835 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:44:46,835 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:44:46,836 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:44:46,850 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:44:46,854 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:45:39,317 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 03:45:39,390 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:45:39,572 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:45:39,572 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:45:39,572 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:45:39,585 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:45:39,585 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:45:39,585 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:45:39,585 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:45:39,585 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:45:39,585 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: dc9ffc2a-401a-405a-8f1d-73c1faf7c1d9)
2025-03-30 03:45:39,585 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:45:39,585 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x10553e150>智能体: 王医生 (ID: 2477c987-2a1d-461b-a8bc-8eaa2e1b3375)
2025-03-30 03:45:39,585 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 00fbc2a0-bc29-412b-905f-9ae58207156d)
2025-03-30 03:45:39,585 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:45:39,585 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: f0640a67-fd64-4344-891e-312c6d413dcc)
2025-03-30 03:45:39,586 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:45:39,586 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:45:39,586 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:45:39,586 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:45:39,595 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:45:39,595 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:45:39,595 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:45:39,596 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:45:39,610 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:45:39,614 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:45:46,023 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 03:45:46,023 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 03:45:46,023 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: 
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: af9c7a2a-00f8-4744-a7ad-cbb03217d9b8)
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x104ec3320>智能体: 王医生 (ID: 5e7ac86d-eeb8-4d86-8b01-5d5706c2c925)
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 457eaad3-e367-43a2-8010-5fb442f0f10c)
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 2b6bad2a-1abe-42ef-af43-996ef55faaf5)
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 03:45:46,036 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 03:45:46,046 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:45:46,046 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:45:46,046 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:45:46,046 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:45:46,065 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 03:45:46,065 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 03:45:46,065 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:45:46,239 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:45:46,239 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:45:46,239 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:45:46,252 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:45:46,252 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:45:46,252 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:45:46,252 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:45:46,253 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:45:46,253 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 16fb906b-bbcd-4650-b046-51ea68c65681)
2025-03-30 03:45:46,253 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:45:46,253 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x105a19550>智能体: 王医生 (ID: 21113796-146a-4429-8892-2b3f426a1fb2)
2025-03-30 03:45:46,253 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: f0f31790-2dc2-40ff-a03f-a23b5495ce1a)
2025-03-30 03:45:46,253 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:45:46,253 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 8abade3a-fac8-4906-b3c0-2b55abb05be9)
2025-03-30 03:45:46,253 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:45:46,253 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:45:46,253 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:45:46,253 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:45:46,262 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:45:46,262 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:45:46,262 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:45:46,263 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:45:46,276 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:45:46,280 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:45:50,063 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:45:50] "GET / HTTP/1.1" 200 -
2025-03-30 03:45:50,079 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:45:50] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 03:45:50,079 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:45:50] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 03:46:07,896 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:46:07,896 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: f1b006ba-6043-4272-92e9-b3bf84e8bc3e
2025-03-30 03:46:07,897 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: 11c5613e-0405-46c4-8808-04fe4c119cbc
2025-03-30 03:46:07,901 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:46:07,902 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0004) 的接诊请求
2025-03-30 03:46:07,902 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:46:07,902 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 03:46:07,902 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 03:46:07,913 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:46:08,171 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:46:10,770 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:46:10,772 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.60秒
2025-03-30 03:46:10,772 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "surgery",
  "greet...
2025-03-30 03:46:10,772 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "surgery",
  "greeting": "您好，赵先生！我是前台接待员，很高兴为您服务。根据您描述的症状，我建议您先到外科就诊。请到前方的等候区稍作休息，我们会尽快安排医生为您诊疗。"
}
```
2025-03-30 03:46:10,772 - Hospital-MultiAgent-System - INFO - 医生开始与患者 P0004 进行交互式问诊
2025-03-30 03:46:10,772 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:46:10,772 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行问诊。请提出专业、有针对性的问题。
2025-03-30 03:46:10,772 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下信息生成下一个问诊问题:

已知症状: 屁股疼
病史: 无
已问过的问题:...
2025-03-30 03:46:10,773 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:46:11,038 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:46:11,847 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:46:11,851 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.81秒
2025-03-30 03:46:11,851 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是持续性的还是间歇性的，是否在某些动作或姿势时会加重？
2025-03-30 03:46:11,851 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: 11c5613e-0405-46c4-8808-04fe4c119cbc
2025-03-30 03:46:11,852 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 4
2025-03-30 03:46:11,852 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:46:11] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 03:46:11,862 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:46:11] "GET /api/consultation/11c5613e-0405-46c4-8808-04fe4c119cbc/history HTTP/1.1" 200 -
2025-03-30 03:46:23,905 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:46:23] "POST /api/patient_response HTTP/1.1" 200 -
2025-03-30 03:46:40,350 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:46:40] "POST /api/patient_response HTTP/1.1" 200 -
2025-03-30 03:46:58,113 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:46:58] "POST /api/patient_response HTTP/1.1" 200 -
2025-03-30 03:55:59,557 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 03:55:59,625 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:55:59,806 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:55:59,807 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:55:59,807 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:55:59,819 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:55:59,819 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: aa7210cb-9b8e-4987-9991-411539037e5d)
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1057e64b0>智能体: 王医生 (ID: 9fbf3aea-28fe-43ae-8449-d7c4a0f6a574)
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 2d64a9ec-b9ef-4769-adbf-efbd59c1f8e1)
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: abec68f9-290f-40ca-9471-9641a7c45e74)
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:55:59,820 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:55:59,829 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:55:59,829 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:55:59,829 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:55:59,830 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:55:59,843 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:55:59,847 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:56:43,230 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/doctor.py', reloading
2025-03-30 03:56:43,298 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:56:43,491 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:56:43,491 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:56:43,491 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:56:43,505 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:56:43,505 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 338c8e9e-64b3-468c-a718-a65b67c834b8)
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1032fb320>智能体: 王医生 (ID: c505f091-9d02-4923-b4b6-78ca1f598c7c)
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 70b68cc5-0dfe-449d-9537-6bc42529ea46)
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 3c68f4dc-60e3-413b-8de0-7d28f1e66eb8)
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:56:43,506 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:56:43,516 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:56:43,516 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:56:43,516 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:56:43,516 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:56:43,530 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:56:43,534 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:57:12,788 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/doctor.py', reloading
2025-03-30 03:57:12,847 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:57:13,035 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:57:13,035 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:57:13,035 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:57:13,048 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:57:13,048 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:57:13,048 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:57:13,048 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:57:13,048 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:57:13,048 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 60d3a928-8b7b-465d-8fb2-89b38dfc8450)
2025-03-30 03:57:13,048 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:57:13,048 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1059d2480>智能体: 王医生 (ID: 8446b881-5a6f-4b22-bd79-ad025e7f196c)
2025-03-30 03:57:13,048 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 746bb0b0-8179-4c4c-b9dd-844f52e4b977)
2025-03-30 03:57:13,048 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:57:13,048 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: d32b535f-39f0-462e-ade5-beb69f41b16e)
2025-03-30 03:57:13,049 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:57:13,049 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:57:13,049 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:57:13,049 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:57:13,058 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:57:13,058 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:57:13,058 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:57:13,059 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:57:13,073 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:57:13,077 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:57:48,392 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/doctor.py', reloading
2025-03-30 03:57:48,462 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:57:48,646 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:57:48,647 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:57:48,647 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:57:48,659 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:57:48,659 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 8310b943-956e-4214-9967-ebacaf176177)
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x10331a090>智能体: 王医生 (ID: 4e61887c-49f5-43a2-8e6d-6f4b3911cb88)
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: b3a89ae2-b7c5-4255-b41e-4a82125bdaab)
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: c1399f25-1a49-4306-908e-6ef3d39f2408)
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:57:48,660 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:57:48,669 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:57:48,669 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:57:48,669 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:57:48,670 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:57:48,683 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:57:48,687 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:58:03,869 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 03:58:03,869 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 03:58:03,869 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 03:58:03,882 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:58:03,882 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: 
2025-03-30 03:58:03,882 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:58:03,882 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:58:03,882 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:58:03,882 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: d7307420-2cbb-44fd-9a30-d43a99e8157e)
2025-03-30 03:58:03,882 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:58:03,882 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x1055b6f30>智能体: 王医生 (ID: cd844d01-54ce-476f-a2a9-81202ba40e76)
2025-03-30 03:58:03,882 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: 2a1bca5b-d6bd-4992-b7b7-0bf9e31842a2)
2025-03-30 03:58:03,882 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:58:03,882 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 6efdc873-db17-4e0d-8579-011501b57598)
2025-03-30 03:58:03,882 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:58:03,883 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 03:58:03,883 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 03:58:03,883 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 03:58:03,892 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:58:03,892 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:58:03,892 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:58:03,893 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:58:03,914 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.37:5000
2025-03-30 03:58:03,914 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 03:58:03,914 - werkzeug - INFO -  * Restarting with stat
2025-03-30 03:58:04,088 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:58:04,088 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:58:04,088 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:58:04,101 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:58:04,101 - Hospital-MultiAgent-System-Web - INFO - 已初始化LLM服务，模型: gpt-4o
2025-03-30 03:58:04,101 - Hospital-MultiAgent-System - INFO - 从data/web_memories.json加载记忆成功
2025-03-30 03:58:04,102 - Hospital-MultiAgent-System - INFO - 记忆整合线程已启动
2025-03-30 03:58:04,102 - Hospital-MultiAgent-System-Web - INFO - 记忆系统已初始化，使用持久化存储
2025-03-30 03:58:04,102 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 李接待 (ID: 3ea5c919-c08e-4206-b34f-ec62fe47a757)
2025-03-30 03:58:04,102 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 李接待 初始化LLM服务成功
2025-03-30 03:58:04,102 - Hospital-MultiAgent-System - INFO - 初始化<utils.memory_system.MemorySystem object at 0x100db6db0>智能体: 王医生 (ID: aa7407bd-65e4-4501-af35-45199c2c2c68)
2025-03-30 03:58:04,102 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 张药师 (ID: c37216d1-1c52-4186-8433-e0bacfcc0230)
2025-03-30 03:58:04,102 - Hospital-MultiAgent-System - INFO - 药剂师智能体 张药师 初始化LLM服务成功
2025-03-30 03:58:04,102 - Hospital-MultiAgent-System - INFO - 初始化scheduler智能体: 调度器 (ID: 5fa11257-94fa-4dc0-9fc8-65612b62e96c)
2025-03-30 03:58:04,102 - Hospital-MultiAgent-System-Web - INFO - 所有智能体已初始化
2025-03-30 03:58:04,102 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 03:58:04,102 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 03:58:04,102 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 03:58:04,111 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 03:58:04,111 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 03:58:04,111 - Hospital-MultiAgent-System-Web - INFO - 编排器已初始化
2025-03-30 03:58:04,112 - Hospital-MultiAgent-System-Web - INFO - 医院系统Web应用已启动
2025-03-30 03:58:04,124 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 03:58:04,129 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 03:58:07,364 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:58:07] "GET / HTTP/1.1" 200 -
2025-03-30 03:58:07,378 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:58:07] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 03:58:07,381 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:58:07] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 03:58:22,558 - Hospital-MultiAgent-System-Web - INFO - 开始处理 赵四 的问诊请求...
2025-03-30 03:58:22,559 - Hospital-MultiAgent-System-Web - INFO - 初始生成的咨询ID: e4f78311-f1eb-4b3d-bc19-c36f3b693b98
2025-03-30 03:58:22,559 - Hospital-MultiAgent-System - INFO - 开始处理问诊流程，患者: 赵四, 问诊ID: f4d1e6d1-6abc-4a61-bf44-a8b83d85f482
2025-03-30 03:58:22,565 - Hospital-MultiAgent-System - INFO - 记忆已保存到data/web_memories.json
2025-03-30 03:58:22,565 - Hospital-MultiAgent-System - INFO - 接待员正在处理患者 赵四 (ID: P0004) 的接诊请求
2025-03-30 03:58:22,565 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:58:22,566 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业、友善的医院前台接待员，擅长根据患者症状推荐合适的就诊科室，并以温暖、专业的态度与患者沟...
2025-03-30 03:58:22,566 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为医院前台接待员，请根据以下患者信息推荐合适的科室:

患者姓名: 赵四
患者年龄: 60
主诉症...
2025-03-30 03:58:23,008 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:58:23,010 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:58:26,385 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:58:26,391 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.38秒
2025-03-30 03:58:26,392 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department_code": "dental",
  "greeti...
2025-03-30 03:58:26,392 - Hospital-MultiAgent-System - WARNING - 无法将LLM响应解析为有效的JSON: ```json
{
  "department_code": "dental",
  "greeting": "您好，赵先生！我是医院前台接待员，很高兴为您服务。根据您描述的牙疼症状，我建议您前往牙科就诊。牙科位于一楼左侧，请您前往挂号窗口办理相关手续，祝您早日恢复健康！"
}
```
2025-03-30 03:58:26,392 - Hospital-MultiAgent-System - INFO - 医生开始与患者 P0004 进行交互式问诊
2025-03-30 03:58:26,392 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.7
2025-03-30 03:58:26,392 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行问诊。请提出专业、有针对性的问题。
2025-03-30 03:58:26,392 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下信息生成下一个问诊问题:

已知症状: 牙疼
病史: 无
已问过的问题: ...
2025-03-30 03:58:26,394 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 03:58:26,397 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 03:58:28,138 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 03:58:28,138 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.74秒
2025-03-30 03:58:28,139 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：牙疼的部位具体是上下颌哪一侧？疼痛是持续的还是间歇性的？
2025-03-30 03:58:28,139 - Hospital-MultiAgent-System-Web - INFO - 找到实际的咨询ID: f4d1e6d1-6abc-4a61-bf44-a8b83d85f482
2025-03-30 03:58:28,139 - Hospital-MultiAgent-System-Web - INFO - 从编排器获取到的工作流程项数: 4
2025-03-30 03:58:28,139 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:58:28] "POST /api/consult HTTP/1.1" 200 -
2025-03-30 03:58:28,144 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:58:28] "GET /api/consultation/f4d1e6d1-6abc-4a61-bf44-a8b83d85f482/history HTTP/1.1" 200 -
2025-03-30 03:58:53,991 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:58:53] "POST /api/patient_response HTTP/1.1" 200 -
2025-03-30 03:59:19,686 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 03:59:19] "POST /api/patient_response HTTP/1.1" 200 -
2025-03-30 10:07:59,086 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: <utils.memory_system.MemorySystem object at 0x105b13fe0> (ID: a1cfb7a4-bd47-4d4a-a328-c1f15f0122ce)
2025-03-30 10:07:59,086 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 10:07:59,086 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 10:07:59,086 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 10:07:59,099 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:07:59,099 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 <utils.memory_system.MemorySystem object at 0x105b13fe0> 初始化LLM服务成功
2025-03-30 10:07:59,099 - Hospital-MultiAgent-System - INFO - 初始化None智能体: <utils.memory_system.MemorySystem object at 0x105b13fe0> (ID: 96ee9302-8ab7-4061-bfbe-1b6d15326bb4)
2025-03-30 10:07:59,099 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: <utils.memory_system.MemorySystem object at 0x105b13fe0> (ID: 6019dc5f-1b9e-4754-a23e-7dad6b6c57f8)
2025-03-30 10:07:59,099 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 10:07:59,099 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 10:07:59,099 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 10:07:59,109 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:07:59,109 - Hospital-MultiAgent-System - INFO - 药剂师智能体 <utils.memory_system.MemorySystem object at 0x105b13fe0> 初始化LLM服务成功
2025-03-30 10:07:59,109 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 10:07:59,109 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 10:07:59,109 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 10:07:59,118 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:07:59,118 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:07:59,142 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 10:07:59,142 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 10:07:59,142 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:07:59,314 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: <utils.memory_system.MemorySystem object at 0x10562a4e0> (ID: 6141cf8d-74dd-4563-aeb6-e29c43a81c77)
2025-03-30 10:07:59,314 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:07:59,314 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:07:59,314 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:07:59,327 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:07:59,327 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 <utils.memory_system.MemorySystem object at 0x10562a4e0> 初始化LLM服务成功
2025-03-30 10:07:59,327 - Hospital-MultiAgent-System - INFO - 初始化None智能体: <utils.memory_system.MemorySystem object at 0x10562a4e0> (ID: b45d2982-6e1a-4700-9ecf-9a7b7163bd3c)
2025-03-30 10:07:59,327 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: <utils.memory_system.MemorySystem object at 0x10562a4e0> (ID: f79cc9e4-9802-49d5-8ad3-912cd1179242)
2025-03-30 10:07:59,327 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:07:59,327 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:07:59,327 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:07:59,337 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:07:59,337 - Hospital-MultiAgent-System - INFO - 药剂师智能体 <utils.memory_system.MemorySystem object at 0x10562a4e0> 初始化LLM服务成功
2025-03-30 10:07:59,337 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:07:59,337 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:07:59,337 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:07:59,346 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:07:59,346 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:07:59,359 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:07:59,364 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 10:08:29,200 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:08:29] "GET / HTTP/1.1" 200 -
2025-03-30 10:08:29,216 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:08:29] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 10:08:29,216 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:08:29] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 10:08:29,221 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:08:29] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 10:08:48,696 - Hospital-MultiAgent-System-Web - ERROR - 处理对话失败: 'ReceptionistAgent' object has no attribute 'process_message'
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 122, in handle_conversation
    response = hospital_system["receptionist"].process_message(message, session)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ReceptionistAgent' object has no attribute 'process_message'. Did you mean: '_process_message'?
2025-03-30 10:08:48,698 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:08:48] "[35m[1mPOST /api/conversation HTTP/1.1[0m" 500 -
2025-03-30 10:10:48,693 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/receptionist.py', reloading
2025-03-30 10:10:48,763 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:10:48,946 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: <utils.memory_system.MemorySystem object at 0x10292b560> (ID: d0661092-6e66-404c-9b8a-7671060f51bf)
2025-03-30 10:10:48,946 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:10:48,946 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:10:48,946 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:10:48,958 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:10:48,958 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 <utils.memory_system.MemorySystem object at 0x10292b560> 初始化LLM服务成功
2025-03-30 10:10:48,958 - Hospital-MultiAgent-System - INFO - 初始化None智能体: <utils.memory_system.MemorySystem object at 0x10292b560> (ID: 2de84f06-6685-4af7-8075-50ddf6d0a6f4)
2025-03-30 10:10:48,958 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: <utils.memory_system.MemorySystem object at 0x10292b560> (ID: facf4cce-e12c-4d85-926b-0bb341b54d0a)
2025-03-30 10:10:48,959 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:10:48,959 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:10:48,959 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:10:48,968 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:10:48,968 - Hospital-MultiAgent-System - INFO - 药剂师智能体 <utils.memory_system.MemorySystem object at 0x10292b560> 初始化LLM服务成功
2025-03-30 10:10:48,968 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:10:48,968 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:10:48,968 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:10:48,977 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:10:48,977 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:10:48,992 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:10:48,996 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 10:11:34,349 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/doctor.py', reloading
2025-03-30 10:11:34,419 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:11:34,596 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: <utils.memory_system.MemorySystem object at 0x10353fe00> (ID: 1d048cd5-3507-4ab5-9277-4ba62bf3fa27)
2025-03-30 10:11:34,596 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:11:34,596 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:11:34,596 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:11:34,609 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:11:34,609 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 <utils.memory_system.MemorySystem object at 0x10353fe00> 初始化LLM服务成功
2025-03-30 10:11:34,609 - Hospital-MultiAgent-System - INFO - 初始化None智能体: <utils.memory_system.MemorySystem object at 0x10353fe00> (ID: 7425a4a6-2b8b-415c-80ac-829e52209439)
2025-03-30 10:11:34,609 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: <utils.memory_system.MemorySystem object at 0x10353fe00> (ID: 427bb347-33d4-4529-b81c-3a24f56dc0fa)
2025-03-30 10:11:34,609 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:11:34,609 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:11:34,609 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:11:34,618 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:11:34,618 - Hospital-MultiAgent-System - INFO - 药剂师智能体 <utils.memory_system.MemorySystem object at 0x10353fe00> 初始化LLM服务成功
2025-03-30 10:11:34,618 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:11:34,618 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:11:34,618 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:11:34,627 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:11:34,627 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:11:34,641 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:11:34,645 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 10:12:40,147 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/pharmacist.py', reloading
2025-03-30 10:12:40,222 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:12:40,402 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: <utils.memory_system.MemorySystem object at 0x105a8be90> (ID: 15a02659-7f32-4406-af40-4169a7f6285b)
2025-03-30 10:12:40,402 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:12:40,402 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:12:40,402 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:12:40,415 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:12:40,415 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 <utils.memory_system.MemorySystem object at 0x105a8be90> 初始化LLM服务成功
2025-03-30 10:12:40,415 - Hospital-MultiAgent-System - INFO - 初始化None智能体: <utils.memory_system.MemorySystem object at 0x105a8be90> (ID: 76d9db7d-ba9c-4564-a35e-9415e895f652)
2025-03-30 10:12:40,415 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: <utils.memory_system.MemorySystem object at 0x105a8be90> (ID: 103ace6b-5ef6-4bc0-946e-f95f98b84c0d)
2025-03-30 10:12:40,415 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:12:40,415 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:12:40,415 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:12:40,425 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:12:40,425 - Hospital-MultiAgent-System - INFO - 药剂师智能体 <utils.memory_system.MemorySystem object at 0x105a8be90> 初始化LLM服务成功
2025-03-30 10:12:40,425 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:12:40,425 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:12:40,425 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:12:40,434 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:12:40,434 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:12:40,448 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:12:40,452 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 10:13:10,705 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/pharmacist.py', reloading
2025-03-30 10:13:10,768 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:13:10,957 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: <utils.memory_system.MemorySystem object at 0x10566bef0> (ID: 8091d0cb-8cf0-449d-bf98-26bb92ccaa06)
2025-03-30 10:13:10,957 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:13:10,957 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:13:10,957 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:13:10,970 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:13:10,970 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 <utils.memory_system.MemorySystem object at 0x10566bef0> 初始化LLM服务成功
2025-03-30 10:13:10,970 - Hospital-MultiAgent-System - INFO - 初始化None智能体: <utils.memory_system.MemorySystem object at 0x10566bef0> (ID: db5059c8-ec09-4fcc-a8d3-6b5a0062d004)
2025-03-30 10:13:10,970 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: <utils.memory_system.MemorySystem object at 0x10566bef0> (ID: 0827133d-2319-4ee2-b5f6-84bffd4b601b)
2025-03-30 10:13:10,971 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:13:10,971 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:13:10,971 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:13:10,980 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:13:10,980 - Hospital-MultiAgent-System - INFO - 药剂师智能体 <utils.memory_system.MemorySystem object at 0x10566bef0> 初始化LLM服务成功
2025-03-30 10:13:10,980 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:13:10,980 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:13:10,980 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:13:10,989 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:13:10,989 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:13:11,003 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:13:11,007 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 10:13:20,257 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: <utils.memory_system.MemorySystem object at 0x10388fec0> (ID: 3c0e3f8e-8839-4311-a3b9-d3b16703000c)
2025-03-30 10:13:20,257 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 10:13:20,257 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 10:13:20,257 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 10:13:20,269 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:13:20,269 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 <utils.memory_system.MemorySystem object at 0x10388fec0> 初始化LLM服务成功
2025-03-30 10:13:20,270 - Hospital-MultiAgent-System - INFO - 初始化None智能体: <utils.memory_system.MemorySystem object at 0x10388fec0> (ID: da62bef5-49ee-49f2-be20-bbf7dab1d7a1)
2025-03-30 10:13:20,270 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: <utils.memory_system.MemorySystem object at 0x10388fec0> (ID: f1d06ebe-7865-40e3-acaf-a63d5997fd8c)
2025-03-30 10:13:20,270 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 10:13:20,270 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 10:13:20,270 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 10:13:20,279 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:13:20,279 - Hospital-MultiAgent-System - INFO - 药剂师智能体 <utils.memory_system.MemorySystem object at 0x10388fec0> 初始化LLM服务成功
2025-03-30 10:13:20,279 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 10:13:20,279 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 10:13:20,279 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 10:13:20,288 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:13:20,288 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:13:20,306 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 10:13:20,306 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 10:13:20,307 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:13:20,486 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: <utils.memory_system.MemorySystem object at 0x105b200e0> (ID: f507203e-d63e-499d-9181-15eb83aef5f5)
2025-03-30 10:13:20,487 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:13:20,487 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:13:20,487 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:13:20,499 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:13:20,499 - Hospital-MultiAgent-System - INFO - 前台接待员智能体 <utils.memory_system.MemorySystem object at 0x105b200e0> 初始化LLM服务成功
2025-03-30 10:13:20,499 - Hospital-MultiAgent-System - INFO - 初始化None智能体: <utils.memory_system.MemorySystem object at 0x105b200e0> (ID: 37d8436d-fa31-4477-9279-977de81ee037)
2025-03-30 10:13:20,499 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: <utils.memory_system.MemorySystem object at 0x105b200e0> (ID: 8659dfa4-bdc9-4103-ae51-7317ec20c483)
2025-03-30 10:13:20,499 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:13:20,499 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:13:20,499 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:13:20,508 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:13:20,508 - Hospital-MultiAgent-System - INFO - 药剂师智能体 <utils.memory_system.MemorySystem object at 0x105b200e0> 初始化LLM服务成功
2025-03-30 10:13:20,509 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:13:20,509 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:13:20,509 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:13:20,518 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:13:20,518 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:13:20,531 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:13:20,535 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 10:13:24,076 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:13:24] "GET / HTTP/1.1" 200 -
2025-03-30 10:13:24,087 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:13:24] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 10:13:24,088 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:13:24] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 10:13:24,091 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:13:24] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 10:13:31,141 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.3
2025-03-30 10:13:31,141 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个善于从对话中提取关键信息的助手。
2025-03-30 10:13:31,141 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：分析以下患者消息，提取姓名和年龄信息:

消息: 你好，赵医生是谁？

请以JSON格式返回，包含以...
2025-03-30 10:13:31,816 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 10:13:31,822 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 10:13:34,111 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 10:13:34,119 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.30秒
2025-03-30 10:13:34,119 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
    "has_patient_info": false,
    "name...
2025-03-30 10:13:34,119 - Hospital-MultiAgent-System - ERROR - 分析患者信息时出错: Expecting value: line 1 column 1 (char 0)
2025-03-30 10:13:34,122 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:13:34] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 10:13:49,848 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.3
2025-03-30 10:13:49,848 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个善于从对话中提取关键信息的助手。
2025-03-30 10:13:49,848 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：分析以下患者消息，提取姓名和年龄信息:

消息: 赵四 60岁

请以JSON格式返回，包含以下字段...
2025-03-30 10:13:50,037 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 10:13:50,041 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 10:13:51,959 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 10:13:51,963 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.92秒
2025-03-30 10:13:51,964 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
    "has_patient_info": true,
    "name"...
2025-03-30 10:13:51,965 - Hospital-MultiAgent-System - ERROR - 分析患者信息时出错: Expecting value: line 1 column 1 (char 0)
2025-03-30 10:13:51,965 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:13:51] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 10:14:03,296 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.3
2025-03-30 10:14:03,296 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个善于从对话中提取关键信息的助手。
2025-03-30 10:14:03,296 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：分析以下患者消息，提取姓名和年龄信息:

消息: 赵四，60

请以JSON格式返回，包含以下字段:...
2025-03-30 10:14:03,297 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 10:14:03,299 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 10:14:05,548 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 10:14:05,552 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.25秒
2025-03-30 10:14:05,552 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
    "has_patient_info": true,
    "name"...
2025-03-30 10:14:05,552 - Hospital-MultiAgent-System - ERROR - 分析患者信息时出错: Expecting value: line 1 column 1 (char 0)
2025-03-30 10:14:05,553 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:14:05] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 10:14:29,778 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.3
2025-03-30 10:14:29,779 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个善于从对话中提取关键信息的助手。
2025-03-30 10:14:29,779 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：分析以下患者消息，提取姓名和年龄信息:

消息: 赵四 60

请以JSON格式返回，包含以下字段:...
2025-03-30 10:14:30,303 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 10:14:30,308 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 10:14:32,275 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 10:14:32,280 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.97秒
2025-03-30 10:14:32,280 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
    "has_patient_info": true,
    "name"...
2025-03-30 10:14:32,281 - Hospital-MultiAgent-System - ERROR - 分析患者信息时出错: Expecting value: line 1 column 1 (char 0)
2025-03-30 10:14:32,281 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:14:32] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 10:34:31,343 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/receptionist.py', reloading
2025-03-30 10:34:31,425 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:34:31,611 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: <utils.memory_system.MemorySystem object at 0x105a46ea0> (ID: fed0736a-4cf7-4e46-be2e-bc60fb8725e5)
2025-03-30 10:34:31,611 - Hospital-MultiAgent-System - WARNING - 接待员 <utils.memory_system.MemorySystem object at 0x105a46ea0>: LLM 服务未提供，将无法执行智能分诊。
2025-03-30 10:34:31,611 - Hospital-MultiAgent-System - INFO - 前台接待智能体 <utils.memory_system.MemorySystem object at 0x105a46ea0> 初始化完成
2025-03-30 10:34:31,611 - Hospital-MultiAgent-System - INFO - 初始化None智能体: <utils.memory_system.MemorySystem object at 0x105a46ea0> (ID: fb772986-4b27-4bb3-b3a7-4cee7f6da7a8)
2025-03-30 10:34:31,611 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: <utils.memory_system.MemorySystem object at 0x105a46ea0> (ID: ae6267b5-2394-4eb6-9e87-fa359b19e26d)
2025-03-30 10:34:31,611 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:34:31,611 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:34:31,611 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:34:31,624 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:34:31,624 - Hospital-MultiAgent-System - INFO - 药剂师智能体 <utils.memory_system.MemorySystem object at 0x105a46ea0> 初始化LLM服务成功
2025-03-30 10:34:31,624 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:34:31,624 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:34:31,624 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:34:31,633 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:34:31,633 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:34:31,646 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:34:31,651 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 10:41:26,644 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/pharmacist.py', reloading
2025-03-30 10:41:26,708 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: data/hospital_memory.json
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - WARNING - LLM 服务未提供给 MemorySystem，记忆归纳功能将不可用。
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: <utils.memory_system.MemorySystem object at 0x103b72420> (ID: f0637e64-9b7f-48a6-8e01-29f057631f6a)
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - WARNING - 接待员 <utils.memory_system.MemorySystem object at 0x103b72420>: LLM 服务未提供，将无法执行智能分诊。
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - INFO - 前台接待智能体 <utils.memory_system.MemorySystem object at 0x103b72420> 初始化完成
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: <utils.memory_system.MemorySystem object at 0x103b72420> (ID: f8b9e676-dfcf-4d48-a7b3-a4a85b47534d)
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - ERROR - 医生 <utils.memory_system.MemorySystem object at 0x103b72420>: LLM 服务未提供，诊断功能将受限。
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - ERROR - 医生 <utils.memory_system.MemorySystem object at 0x103b72420>: MemorySystem 未提供，无法管理问诊状态或查询历史。
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - INFO - 医生智能体 <utils.memory_system.MemorySystem object at 0x103b72420> (general) 初始化完成
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: <utils.memory_system.MemorySystem object at 0x103b72420> (ID: ebb10907-22c2-4df3-b3fa-14a13892a520)
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - ERROR - 药剂师 <utils.memory_system.MemorySystem object at 0x103b72420>: LLM 服务未提供，核心功能将受限。
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - INFO - 药剂师智能体 <utils.memory_system.MemorySystem object at 0x103b72420> 初始化完成
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:41:26,924 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:41:26,937 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:41:26,937 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:41:26,952 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:41:26,957 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: data/hospital_memory.json
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - WARNING - LLM 服务未提供给 MemorySystem，记忆归纳功能将不可用。
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: <utils.memory_system.MemorySystem object at 0x102d8bef0> (ID: 3f6a9667-71b0-4b67-b171-0140445ba0f9)
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - WARNING - 接待员 <utils.memory_system.MemorySystem object at 0x102d8bef0>: LLM 服务未提供，将无法执行智能分诊。
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - INFO - 前台接待智能体 <utils.memory_system.MemorySystem object at 0x102d8bef0> 初始化完成
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: <utils.memory_system.MemorySystem object at 0x102d8bef0> (ID: a06e75db-3e13-48d1-8ff0-73dcd08f5896)
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - ERROR - 医生 <utils.memory_system.MemorySystem object at 0x102d8bef0>: LLM 服务未提供，诊断功能将受限。
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - ERROR - 医生 <utils.memory_system.MemorySystem object at 0x102d8bef0>: MemorySystem 未提供，无法管理问诊状态或查询历史。
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - INFO - 医生智能体 <utils.memory_system.MemorySystem object at 0x102d8bef0> (general) 初始化完成
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: <utils.memory_system.MemorySystem object at 0x102d8bef0> (ID: 09fe8380-6ba5-4b50-b419-ec101b851a0d)
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - ERROR - 药剂师 <utils.memory_system.MemorySystem object at 0x102d8bef0>: LLM 服务未提供，核心功能将受限。
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - INFO - 药剂师智能体 <utils.memory_system.MemorySystem object at 0x102d8bef0> 初始化完成
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 10:41:41,809 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 10:41:41,822 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:41:41,822 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:41:41,839 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 10:41:41,839 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 10:41:41,840 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:41:42,012 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: data/hospital_memory.json
2025-03-30 10:41:42,012 - Hospital-MultiAgent-System - WARNING - LLM 服务未提供给 MemorySystem，记忆归纳功能将不可用。
2025-03-30 10:41:42,012 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: <utils.memory_system.MemorySystem object at 0x10573e360> (ID: 4faafc1e-dadf-4b2f-8ced-478eb207225b)
2025-03-30 10:41:42,012 - Hospital-MultiAgent-System - WARNING - 接待员 <utils.memory_system.MemorySystem object at 0x10573e360>: LLM 服务未提供，将无法执行智能分诊。
2025-03-30 10:41:42,012 - Hospital-MultiAgent-System - INFO - 前台接待智能体 <utils.memory_system.MemorySystem object at 0x10573e360> 初始化完成
2025-03-30 10:41:42,012 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: <utils.memory_system.MemorySystem object at 0x10573e360> (ID: c2f00042-c4f7-4428-8c03-2a63a3bd1d23)
2025-03-30 10:41:42,012 - Hospital-MultiAgent-System - ERROR - 医生 <utils.memory_system.MemorySystem object at 0x10573e360>: LLM 服务未提供，诊断功能将受限。
2025-03-30 10:41:42,012 - Hospital-MultiAgent-System - ERROR - 医生 <utils.memory_system.MemorySystem object at 0x10573e360>: MemorySystem 未提供，无法管理问诊状态或查询历史。
2025-03-30 10:41:42,012 - Hospital-MultiAgent-System - INFO - 医生智能体 <utils.memory_system.MemorySystem object at 0x10573e360> (general) 初始化完成
2025-03-30 10:41:42,012 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: <utils.memory_system.MemorySystem object at 0x10573e360> (ID: 3f5bc8b7-c27f-43da-9c93-000e9e3ee37d)
2025-03-30 10:41:42,012 - Hospital-MultiAgent-System - ERROR - 药剂师 <utils.memory_system.MemorySystem object at 0x10573e360>: LLM 服务未提供，核心功能将受限。
2025-03-30 10:41:42,012 - Hospital-MultiAgent-System - INFO - 药剂师智能体 <utils.memory_system.MemorySystem object at 0x10573e360> 初始化完成
2025-03-30 10:41:42,013 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:41:42,013 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:41:42,013 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:41:42,025 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:41:42,025 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:41:42,037 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:41:42,041 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 10:41:48,656 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:41:48] "GET / HTTP/1.1" 200 -
2025-03-30 10:41:48,671 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:41:48] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 10:41:48,671 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:41:48] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 10:41:48,675 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:41:48] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 10:41:56,802 - Hospital-MultiAgent-System-Web - ERROR - 处理对话失败: 'ReceptionistAgent' object has no attribute 'process_message'
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 122, in handle_conversation
    response = hospital_system["receptionist"].process_message(message, session)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ReceptionistAgent' object has no attribute 'process_message'. Did you mean: '_process_message'?
2025-03-30 10:41:56,806 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:41:56] "[35m[1mPOST /api/conversation HTTP/1.1[0m" 500 -
2025-03-30 10:45:16,521 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 10:45:16,585 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:50:38,069 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 10:50:38,069 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 10:50:38,069 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:50:38,069 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 10:50:38,069 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 10:50:38,083 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:50:38,083 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 10:50:38,083 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: b6e0865c-2dec-489a-ace8-d14e2c9364a1)
2025-03-30 10:50:38,083 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 10:50:38,083 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: c640a837-cf23-4eee-83f6-bf9297d0f6cb)
2025-03-30 10:50:38,083 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 10:50:38,083 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 2c079c19-4d32-4173-bba4-614e3c6f2830)
2025-03-30 10:50:38,083 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 10:50:38,083 - Hospital-MultiAgent-System-Web - CRITICAL - 初始化医院核心系统失败: name 'logger' is not defined
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 70, in init_hospital_system
    orchestrator_instance = Orchestrator(
                            ^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 50, in __init__
    logger.info("编排器初始化完成")
    ^^^^^^
NameError: name 'logger' is not defined
2025-03-30 10:50:38,084 - Hospital-MultiAgent-System-Web - CRITICAL - 无法初始化核心系统，Web 应用可能无法正常工作。
2025-03-30 10:50:38,084 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 10:50:38,102 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 10:50:38,102 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 10:50:38,102 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:50:38,277 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 10:50:38,277 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:50:38,277 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:50:38,277 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:50:38,290 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:50:38,290 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 10:50:38,290 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: 529a8704-91b8-4714-925d-9803a443de89)
2025-03-30 10:50:38,290 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 10:50:38,290 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 6696ffe2-f152-4c27-8afd-79a5165182c9)
2025-03-30 10:50:38,290 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 10:50:38,290 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 480e49e1-ac62-4158-b24d-029a6329d04c)
2025-03-30 10:50:38,290 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 10:50:38,290 - Hospital-MultiAgent-System-Web - CRITICAL - 初始化医院核心系统失败: name 'logger' is not defined
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 70, in init_hospital_system
    orchestrator_instance = Orchestrator(
                            ^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 50, in __init__
    logger.info("编排器初始化完成")
    ^^^^^^
NameError: name 'logger' is not defined
2025-03-30 10:50:38,290 - Hospital-MultiAgent-System-Web - CRITICAL - 无法初始化核心系统，Web 应用可能无法正常工作。
2025-03-30 10:50:38,291 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 10:50:38,305 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:50:38,309 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 10:50:48,361 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:50:48] "GET / HTTP/1.1" 200 -
2025-03-30 10:50:48,379 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:50:48] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 10:50:48,379 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:50:48] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 10:55:32,446 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 10:55:32,517 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:55:32,725 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 10:55:32,725 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:55:32,725 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:55:32,725 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:55:32,738 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:55:32,739 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 10:55:32,739 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: 8b9d1864-b0f6-4fec-87c6-4d918451a5d8)
2025-03-30 10:55:32,739 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 10:55:32,739 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 6e606bd0-01c1-46e4-af58-2bb9abb43943)
2025-03-30 10:55:32,739 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 10:55:32,739 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: f1baf859-635f-470e-94d8-bdaaa4094b9b)
2025-03-30 10:55:32,739 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 10:55:32,739 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:55:32,739 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 10:55:32,739 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 10:55:32,752 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:55:32,757 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 10:55:42,364 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 10:55:42,364 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 10:55:42,364 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:55:42,364 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 10:55:42,364 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 10:55:42,377 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:55:42,377 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 10:55:42,377 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: d9ce9c54-9a71-4128-beb2-54faa784c1bb)
2025-03-30 10:55:42,377 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 10:55:42,377 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: d6b062e0-a00b-46ab-8b67-a007779d022a)
2025-03-30 10:55:42,377 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 10:55:42,377 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 7979c738-e2c3-45b2-adb0-44d2c1a36c03)
2025-03-30 10:55:42,377 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 10:55:42,377 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:55:42,377 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 10:55:42,377 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 10:55:42,395 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 10:55:42,396 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 10:55:42,396 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:55:42,573 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 10:55:42,573 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:55:42,573 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:55:42,573 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:55:42,586 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:55:42,586 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 10:55:42,586 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: ab51e5a2-eda0-4823-8ba5-20d168e43c03)
2025-03-30 10:55:42,586 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 10:55:42,586 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 0b1e9dd9-356c-49a6-b67a-2366495d9c20)
2025-03-30 10:55:42,586 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 10:55:42,586 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: e5bb2011-39f2-4d99-9571-b190ef82abd9)
2025-03-30 10:55:42,586 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 10:55:42,586 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:55:42,586 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 10:55:42,586 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 10:55:42,599 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:55:42,603 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 10:55:48,882 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:55:48] "GET / HTTP/1.1" 200 -
2025-03-30 10:55:48,896 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:55:48] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 10:55:48,896 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:55:48] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 10:57:13,006 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:57:13] "GET / HTTP/1.1" 200 -
2025-03-30 10:57:13,014 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:57:13] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 10:57:13,016 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 10:57:13] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 10:59:57,553 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 10:59:57,554 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 10:59:57,554 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:59:57,554 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 10:59:57,554 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 10:59:57,567 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:59:57,567 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 10:59:57,567 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: bc15a8f8-22a2-4fbf-ac78-4b36933a5520)
2025-03-30 10:59:57,567 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 10:59:57,567 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 4c03f6a6-d56a-4c5a-b376-5afb2662e9af)
2025-03-30 10:59:57,567 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 10:59:57,567 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: c278b18c-f365-442b-821b-5aea5f6acc3a)
2025-03-30 10:59:57,567 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 10:59:57,567 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:59:57,567 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 10:59:57,568 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 10:59:57,585 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 10:59:57,586 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 10:59:57,586 - werkzeug - INFO -  * Restarting with stat
2025-03-30 10:59:57,764 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 10:59:57,765 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 10:59:57,765 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 10:59:57,765 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 10:59:57,777 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 10:59:57,777 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 10:59:57,777 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: dbb32a31-c176-4c0e-b123-ae5effbecf49)
2025-03-30 10:59:57,777 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 10:59:57,777 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: a4bd9da1-f065-41bd-967b-dac9dcf60293)
2025-03-30 10:59:57,777 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 10:59:57,777 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 960ce444-5fc7-4a5a-8157-963ec0457be5)
2025-03-30 10:59:57,777 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 10:59:57,777 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 10:59:57,777 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 10:59:57,778 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 10:59:57,792 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 10:59:57,796 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:00:03,200 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:00:03] "GET / HTTP/1.1" 200 -
2025-03-30 11:00:03,212 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:00:03] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 11:00:03,213 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:00:03] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 11:00:33,680 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:00:33] "GET / HTTP/1.1" 200 -
2025-03-30 11:00:33,686 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:00:33] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 11:00:33,689 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:00:33] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 11:00:34,432 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:00:34] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-03-30 11:03:49,067 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:03:49,067 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 11:03:49,067 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:03:49,067 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 11:03:49,067 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 11:03:49,081 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:03:49,081 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:03:49,081 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: bdf97886-782b-4bc1-8ab1-648f8a8ad47b)
2025-03-30 11:03:49,081 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:03:49,081 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 4ab89548-bc5f-4621-9e7b-5292c6294732)
2025-03-30 11:03:49,081 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:03:49,081 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: f0b912c2-81f2-4869-ab59-b038005e6585)
2025-03-30 11:03:49,081 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:03:49,081 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:03:49,081 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:03:49,081 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:03:49,099 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 11:03:49,099 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 11:03:49,099 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:03:49,275 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:03:49,275 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:03:49,275 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:03:49,275 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:03:49,288 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:03:49,288 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:03:49,288 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: 8ad45dad-2467-4e91-bf3c-1000efe17a4b)
2025-03-30 11:03:49,288 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:03:49,288 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: d516c1ef-a12e-4823-ad72-ba4c9cdc7004)
2025-03-30 11:03:49,288 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:03:49,288 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 1d727c16-2da8-4c4b-b882-7abbdeb81781)
2025-03-30 11:03:49,288 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:03:49,288 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:03:49,288 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:03:49,288 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:03:49,302 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:03:49,306 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:03:55,370 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:03:55] "GET / HTTP/1.1" 200 -
2025-03-30 11:03:55,385 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:03:55] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 11:03:55,385 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:03:55] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 11:03:55,390 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_79c3fd1a-1489-42d3-a65b-1a950d11fb42
2025-03-30 11:03:55,391 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_79c3fd1a-1489-42d3-a65b-1a950d11fb42
2025-03-30 11:03:55,391 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:03:55] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 11:04:03,220 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_79c3fd1a-1489-42d3-a65b-1a950d11fb42): '你好，我要找一下赵医生...'
2025-03-30 11:04:03,220 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_79c3fd1a-1489-42d3-a65b-1a950d11fb42，视为新对话，转给接待员。
2025-03-30 11:04:03,221 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_871defbe 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:04:03,222 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_871defbe 不存在，创建新的记忆记录。
2025-03-30 11:04:03,223 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_871defbe (Name: 网页用户, Age: None)
2025-03-30 11:04:03,223 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_79c3fd1a-1489-42d3-a65b-1a950d11fb42
2025-03-30 11:04:03,224 - Hospital-MultiAgent-System - INFO - 接待员 前台接待员 收到对患者 WebPatient_871defbe 的接诊请求，症状: 你好, 我要找一下赵医生
2025-03-30 11:04:03,224 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.2
2025-03-30 11:04:03,224 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，负责根据患者信息推荐科室和评估优先级。请严格按要求的JSON格式输出。
2025-03-30 11:04:03,224 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 11:04:03,387 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:04:03,394 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:04:05,920 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:04:05,928 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.53秒
2025-03-30 11:04:05,929 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "内科",
  "priority": "nor...
2025-03-30 11:04:05,929 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_871defbe 的LLM分诊原始响应: ```json
{
  "department": "内科",
  "priority": "normal",
  "reason": "患者未提供具体症状，仅提到寻找医生，信息不足以明确判断，因此推荐内科作为初步就诊科室，优先级为普通。"
}
```
2025-03-30 11:04:05,929 - Hospital-MultiAgent-System - INFO - LLM 推荐科室: 内科
2025-03-30 11:04:05,929 - Hospital-MultiAgent-System - INFO - LLM 推荐优先级: normal
2025-03-30 11:04:05,931 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_79c3fd1a-1489-42d3-a65b-1a950d11fb42): Status=in_progress, Agent=receptionist, Msg='您好，根据您的描述和初步分析，建议您挂 [内科] 科。系统评估的就诊优先级为：[普通]。正在为您安排...'
2025-03-30 11:04:05,934 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:04:05] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:14:42,239 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/memory_system.py', reloading
2025-03-30 11:14:42,305 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:14:42,515 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:14:42,515 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:14:42,515 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:14:42,515 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:14:42,528 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:14:42,528 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:14:42,528 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:14:42,528 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: ccaf47e0-4144-426f-9f27-372891c73a13)
2025-03-30 11:14:42,528 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:14:42,528 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 0ce2ea76-c899-4ad0-a115-6832c8748512)
2025-03-30 11:14:42,528 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:14:42,528 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 00553245-caa1-4bc2-bbe3-a10f4a588469)
2025-03-30 11:14:42,528 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:14:42,528 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:14:42,528 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:14:42,529 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:14:42,543 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:14:42,548 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:15:28,919 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/receptionist.py', reloading
2025-03-30 11:15:28,992 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:15:29,174 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:15:29,175 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:15:29,175 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:15:29,175 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:15:29,187 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:15:29,187 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:15:29,187 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:15:29,187 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: dd7537e2-84ad-48ae-bce2-e95748bc9efd)
2025-03-30 11:15:29,187 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:15:29,187 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 879d0b69-0349-4ad4-878b-37d2907174d6)
2025-03-30 11:15:29,187 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:15:29,187 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 0e11ef1f-76b8-49d2-abbd-fe5cdbf4efc6)
2025-03-30 11:15:29,187 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:15:29,187 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:15:29,187 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:15:29,188 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:15:29,200 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:15:29,204 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:17:53,198 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 11:17:53,274 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:17:53,463 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:17:53,463 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:17:53,463 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:17:53,463 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:17:53,476 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:17:53,476 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:17:53,476 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:17:53,476 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: a213fa8a-4810-4036-95cf-7e80b44cd324)
2025-03-30 11:17:53,476 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:17:53,476 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: b6d22106-78ff-4265-8fe6-4d5b743bcc2a)
2025-03-30 11:17:53,476 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:17:53,476 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: ce23009d-faf9-4d4d-bf1a-0790b7a14e2b)
2025-03-30 11:17:53,476 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:17:53,476 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:17:53,476 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:17:53,476 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:17:53,490 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:17:53,494 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:18:04,416 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:18:04,416 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 11:18:04,416 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:18:04,416 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 11:18:04,416 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 11:18:04,429 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:18:04,429 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:18:04,429 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:18:04,429 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: cc429496-1ac3-4569-b642-55b336972c9d)
2025-03-30 11:18:04,429 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:18:04,429 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 8c772eab-97ec-4bb0-ae52-6d034ad4068b)
2025-03-30 11:18:04,429 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:18:04,429 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 19bc5bd8-4bf4-4724-87cf-f5959fd8952f)
2025-03-30 11:18:04,429 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:18:04,429 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:18:04,429 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:18:04,429 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:18:04,447 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 11:18:04,447 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 11:18:04,447 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:18:04,626 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:18:04,626 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:18:04,626 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:18:04,626 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:18:04,639 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:18:04,639 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:18:04,639 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:18:04,639 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: ba93d933-5df1-4db9-bdc6-4bc04f0f2c64)
2025-03-30 11:18:04,639 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:18:04,639 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 89c26341-e354-48e7-9e2b-c679d7999c98)
2025-03-30 11:18:04,639 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:18:04,639 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: fa359961-9d7a-4291-b79e-0794804dd970)
2025-03-30 11:18:04,639 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:18:04,639 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:18:04,639 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:18:04,639 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:18:04,653 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:18:04,657 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:18:09,418 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:18:09] "GET / HTTP/1.1" 200 -
2025-03-30 11:18:09,432 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:18:09] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 11:18:09,432 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:18:09] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 11:18:09,438 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_02ebf615-c1de-46c2-a17e-1d18eef1c764
2025-03-30 11:18:09,438 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_02ebf615-c1de-46c2-a17e-1d18eef1c764
2025-03-30 11:18:09,439 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:18:09] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 11:18:16,022 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_02ebf615-c1de-46c2-a17e-1d18eef1c764): '我想找一下赵医生...'
2025-03-30 11:18:16,023 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_02ebf615-c1de-46c2-a17e-1d18eef1c764，视为新对话，转给接待员。
2025-03-30 11:18:16,024 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_aa70d112 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:18:16,025 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_aa70d112 不存在，创建新的记忆记录。
2025-03-30 11:18:16,026 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_aa70d112 (Name: 网页用户, Age: None)
2025-03-30 11:18:16,026 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_02ebf615-c1de-46c2-a17e-1d18eef1c764
2025-03-30 11:18:16,026 - Hospital-MultiAgent-System - INFO - 为咨询 web_02ebf615-c1de-46c2-a17e-1d18eef1c764 (Patient: WebPatient_aa70d112) 创建新上下文
2025-03-30 11:18:16,026 - Hospital-MultiAgent-System - INFO - 为患者 web_02ebf615-c1de-46c2-a17e-1d18eef1c764 保存问诊上下文: ctx_web_02ebf615-c1de-46c2-a17e-1d18eef1c764_88fe25ab
2025-03-30 11:18:16,027 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.1
2025-03-30 11:18:16,027 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:18:16,027 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。

当前对话历史摘要:

对话历史摘要:
User: 我想...
2025-03-30 11:18:16,669 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:18:16,674 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:18:19,345 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:18:19,353 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.68秒
2025-03-30 11:18:19,354 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "seeking_specific_doctor",
  "has_su...
2025-03-30 11:18:19,354 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_aa70d112): Intent=seeking_specific_doctor, SufficientInfo=False
2025-03-30 11:18:19,354 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：80，温度：0.5
2025-03-30 11:18:19,354 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 11:18:19,354 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："我想找一下赵医生"。请给出一个简洁、专业、乐于助人但...
2025-03-30 11:18:19,360 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:18:19,363 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:18:21,081 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:18:21,087 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.72秒
2025-03-30 11:18:21,087 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好！感谢您的咨询。为了更好地为您安排合适的医生，您可以先简单描述一下您的症状，我们会为您进行分诊。...
2025-03-30 11:18:21,087 - Hospital-MultiAgent-System - WARNING - 尝试更新不存在的问诊上下文: web_02ebf615-c1de-46c2-a17e-1d18eef1c764
2025-03-30 11:18:21,093 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_02ebf615-c1de-46c2-a17e-1d18eef1c764): Status=in_progress, Agent=receptionist, Msg='您好！感谢您的咨询。为了更好地为您安排合适的医生，您可以先简单描述一下您的症状，我们会为您进行分诊。...'
2025-03-30 11:18:21,095 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:18:21] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:18:36,176 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_02ebf615-c1de-46c2-a17e-1d18eef1c764): '地球为什么是圆的？...'
2025-03-30 11:18:36,176 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_02ebf615-c1de-46c2-a17e-1d18eef1c764，视为新对话，转给接待员。
2025-03-30 11:18:36,176 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_96f672eb 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:18:36,176 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_96f672eb 不存在，创建新的记忆记录。
2025-03-30 11:18:36,177 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_96f672eb (Name: 网页用户, Age: None)
2025-03-30 11:18:36,179 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_02ebf615-c1de-46c2-a17e-1d18eef1c764
2025-03-30 11:18:36,179 - Hospital-MultiAgent-System - INFO - 为咨询 web_02ebf615-c1de-46c2-a17e-1d18eef1c764 (Patient: WebPatient_96f672eb) 创建新上下文
2025-03-30 11:18:36,179 - Hospital-MultiAgent-System - INFO - 为患者 web_02ebf615-c1de-46c2-a17e-1d18eef1c764 保存问诊上下文: ctx_web_02ebf615-c1de-46c2-a17e-1d18eef1c764_aa4190ce
2025-03-30 11:18:36,181 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.1
2025-03-30 11:18:36,181 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:18:36,181 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。

当前对话历史摘要:

对话历史摘要:
User: 地球...
2025-03-30 11:18:36,333 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:18:36,336 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:18:38,396 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:18:38,402 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.07秒
2025-03-30 11:18:38,402 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 11:18:38,402 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_96f672eb): Intent=general_chat, SufficientInfo=False
2025-03-30 11:18:38,403 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：80，温度：0.5
2025-03-30 11:18:38,403 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 11:18:38,403 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："地球为什么是圆的？"。请给出一个简洁、专业、乐于助人...
2025-03-30 11:18:38,410 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:18:38,415 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:18:40,020 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:18:40,025 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.61秒
2025-03-30 11:18:40,026 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好！地球是圆的，因为它的形状是接近球体，这主要是由于引力的作用，使其在形成过程中趋于均匀分布。如果...
2025-03-30 11:18:40,026 - Hospital-MultiAgent-System - WARNING - 尝试更新不存在的问诊上下文: web_02ebf615-c1de-46c2-a17e-1d18eef1c764
2025-03-30 11:18:40,030 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_02ebf615-c1de-46c2-a17e-1d18eef1c764): Status=in_progress, Agent=receptionist, Msg='您好！地球是圆的，因为它的形状是接近球体，这主要是由于引力的作用，使其在形成过程中趋于均匀分布。如果...'
2025-03-30 11:18:40,032 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:18:40] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:18:49,387 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_02ebf615-c1de-46c2-a17e-1d18eef1c764): '我想去那美克星...'
2025-03-30 11:18:49,387 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_02ebf615-c1de-46c2-a17e-1d18eef1c764，视为新对话，转给接待员。
2025-03-30 11:18:49,387 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_ba555b20 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:18:49,387 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_ba555b20 不存在，创建新的记忆记录。
2025-03-30 11:18:49,388 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_ba555b20 (Name: 网页用户, Age: None)
2025-03-30 11:18:49,389 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_02ebf615-c1de-46c2-a17e-1d18eef1c764
2025-03-30 11:18:49,389 - Hospital-MultiAgent-System - INFO - 为咨询 web_02ebf615-c1de-46c2-a17e-1d18eef1c764 (Patient: WebPatient_ba555b20) 创建新上下文
2025-03-30 11:18:49,389 - Hospital-MultiAgent-System - INFO - 为患者 web_02ebf615-c1de-46c2-a17e-1d18eef1c764 保存问诊上下文: ctx_web_02ebf615-c1de-46c2-a17e-1d18eef1c764_af45f6bb
2025-03-30 11:18:49,390 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.1
2025-03-30 11:18:49,390 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:18:49,390 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。

当前对话历史摘要:

对话历史摘要:
User: 我想...
2025-03-30 11:18:49,392 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:18:49,393 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:18:51,617 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:18:51,621 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.23秒
2025-03-30 11:18:51,622 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 11:18:51,622 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_ba555b20): Intent=general_chat, SufficientInfo=False
2025-03-30 11:18:51,622 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：80，温度：0.5
2025-03-30 11:18:51,622 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 11:18:51,623 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："我想去那美克星"。请给出一个简洁、专业、乐于助人但避...
2025-03-30 11:18:52,001 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:18:52,006 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:18:53,376 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:18:53,380 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.37秒
2025-03-30 11:18:53,380 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好！我们是一家医疗机构，目前无法提供关于“那美克星”的相关信息。如果您需要就医或咨询特定医生，建议...
2025-03-30 11:18:53,380 - Hospital-MultiAgent-System - WARNING - 尝试更新不存在的问诊上下文: web_02ebf615-c1de-46c2-a17e-1d18eef1c764
2025-03-30 11:18:53,385 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_02ebf615-c1de-46c2-a17e-1d18eef1c764): Status=in_progress, Agent=receptionist, Msg='您好！我们是一家医疗机构，目前无法提供关于“那美克星”的相关信息。如果您需要就医或咨询特定医生，建议...'
2025-03-30 11:18:53,387 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:18:53] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:21:17,850 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:21:17,850 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 11:21:17,850 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:21:17,850 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 11:21:17,850 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 11:21:17,864 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:21:17,864 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:21:17,864 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:21:17,864 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: 887ac6d8-64b2-4710-bdc3-e030a5a9d988)
2025-03-30 11:21:17,864 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:21:17,864 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 758f9b2f-efe7-42e0-9ef0-6675184b688d)
2025-03-30 11:21:17,864 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:21:17,864 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 4a125b6a-7871-4cc2-b6e0-a04835d7ede8)
2025-03-30 11:21:17,864 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:21:17,864 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:21:17,864 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:21:17,864 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:21:17,882 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 11:21:17,882 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 11:21:17,882 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:21:18,059 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:21:18,059 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:21:18,059 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:21:18,059 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:21:18,072 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:21:18,072 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:21:18,072 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:21:18,072 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: 0919a751-5203-4eed-a20b-26ba7558ded0)
2025-03-30 11:21:18,072 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:21:18,072 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 05ddf922-fc75-4746-9024-0518d33050a3)
2025-03-30 11:21:18,072 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:21:18,072 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 856d3625-a441-400f-b4c9-a8295870f72d)
2025-03-30 11:21:18,072 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:21:18,072 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:21:18,072 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:21:18,073 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:21:18,086 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:21:18,090 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:21:18,911 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:21:18] "GET / HTTP/1.1" 200 -
2025-03-30 11:21:18,920 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:21:18] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 11:21:18,921 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:21:18] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 11:21:18,957 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:21:18,957 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:21:18,957 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:21:18] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 11:21:29,731 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): '你好我想打游戏...'
2025-03-30 11:21:29,731 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee，视为新对话，转给接待员。
2025-03-30 11:21:29,733 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_542f072e 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:21:29,733 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_542f072e 不存在，创建新的记忆记录。
2025-03-30 11:21:29,735 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_542f072e (Name: 网页用户, Age: None)
2025-03-30 11:21:29,736 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:21:29,737 - Hospital-MultiAgent-System - INFO - 为咨询 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee (Patient: WebPatient_542f072e) 创建新上下文
2025-03-30 11:21:29,737 - Hospital-MultiAgent-System - INFO - 为患者 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee 保存问诊上下文: ctx_web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee_001a91fe
2025-03-30 11:21:29,738 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:21:29,739 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:21:29,739 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好我想打游戏

用户...
2025-03-30 11:21:29,902 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:21:29,904 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:21:32,875 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:21:32,885 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.98秒
2025-03-30 11:21:32,885 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 11:21:32,885 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_542f072e): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 11:21:32,886 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 11:21:32,886 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 11:21:32,886 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 11:21:32,886 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好我想打游戏"。请给出一个简洁、专业、乐于助人但【...
2025-03-30 11:21:32,890 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:21:32,896 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:21:33,898 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:21:33,903 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.01秒
2025-03-30 11:21:33,904 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，这里是医院接待处。如需就医，请简单描述您的症状，我们会为您安排合适的医生。谢谢！
2025-03-30 11:21:33,904 - Hospital-MultiAgent-System - WARNING - 尝试更新不存在的问诊上下文: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:21:33,910 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): Status=in_progress, Agent=receptionist, Msg='您好，这里是医院接待处。如需就医，请简单描述您的症状，我们会为您安排合适的医生。谢谢！...'
2025-03-30 11:21:33,912 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:21:33] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:21:44,174 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): '为什么地球是圆的？...'
2025-03-30 11:21:44,175 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee，视为新对话，转给接待员。
2025-03-30 11:21:44,176 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_ba8a2cbb 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:21:44,176 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_ba8a2cbb 不存在，创建新的记忆记录。
2025-03-30 11:21:44,178 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_ba8a2cbb (Name: 网页用户, Age: None)
2025-03-30 11:21:44,180 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:21:44,180 - Hospital-MultiAgent-System - INFO - 为咨询 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee (Patient: WebPatient_ba8a2cbb) 创建新上下文
2025-03-30 11:21:44,180 - Hospital-MultiAgent-System - INFO - 为患者 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee 保存问诊上下文: ctx_web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee_0a26430c
2025-03-30 11:21:44,183 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:21:44,184 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:21:44,185 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 为什么地球是圆的？

...
2025-03-30 11:21:44,186 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:21:44,188 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:21:46,943 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:21:46,946 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.76秒
2025-03-30 11:21:46,947 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 11:21:46,947 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_ba8a2cbb): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 11:21:46,947 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 11:21:46,948 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 11:21:46,948 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 11:21:46,949 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："为什么地球是圆的？"。请给出一个简洁、专业、乐于助人...
2025-03-30 11:21:47,544 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:21:47,549 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:21:49,471 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:21:49,474 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.92秒
2025-03-30 11:21:49,474 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，关于地球是圆的问题，这是科学领域的问题。如果有健康相关咨询，请简述症状，以便我们为您安排合适的...
2025-03-30 11:21:49,474 - Hospital-MultiAgent-System - WARNING - 尝试更新不存在的问诊上下文: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:21:49,479 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): Status=in_progress, Agent=receptionist, Msg='您好，关于地球是圆的问题，这是科学领域的问题。如果有健康相关咨询，请简述症状，以便我们为您安排合适的...'
2025-03-30 11:21:49,480 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:21:49] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:22:08,590 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): '我想去那美克星...'
2025-03-30 11:22:08,590 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee，视为新对话，转给接待员。
2025-03-30 11:22:08,590 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_e3b9201d 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:22:08,590 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_e3b9201d 不存在，创建新的记忆记录。
2025-03-30 11:22:08,593 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_e3b9201d (Name: 网页用户, Age: None)
2025-03-30 11:22:08,594 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:22:08,594 - Hospital-MultiAgent-System - INFO - 为咨询 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee (Patient: WebPatient_e3b9201d) 创建新上下文
2025-03-30 11:22:08,594 - Hospital-MultiAgent-System - INFO - 为患者 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee 保存问诊上下文: ctx_web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee_abd6d770
2025-03-30 11:22:08,597 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:22:08,597 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:22:08,597 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 我想去那美克星

用户...
2025-03-30 11:22:09,155 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:22:09,160 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:22:11,075 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:22:11,079 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.92秒
2025-03-30 11:22:11,079 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "unclear",
  "has_sufficient_medical...
2025-03-30 11:22:11,079 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_e3b9201d): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 11:22:11,081 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_e3b9201d)
2025-03-30 11:22:11,081 - Hospital-MultiAgent-System - WARNING - 尝试更新不存在的问诊上下文: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:22:11,086 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 11:22:11,087 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:22:11] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:22:22,182 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): '你这卖汽车吗？...'
2025-03-30 11:22:22,183 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee，视为新对话，转给接待员。
2025-03-30 11:22:22,183 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_4c4bdbfe 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:22:22,184 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_4c4bdbfe 不存在，创建新的记忆记录。
2025-03-30 11:22:22,186 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_4c4bdbfe (Name: 网页用户, Age: None)
2025-03-30 11:22:22,188 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:22:22,188 - Hospital-MultiAgent-System - INFO - 为咨询 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee (Patient: WebPatient_4c4bdbfe) 创建新上下文
2025-03-30 11:22:22,188 - Hospital-MultiAgent-System - INFO - 为患者 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee 保存问诊上下文: ctx_web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee_2d363fc6
2025-03-30 11:22:22,191 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:22:22,192 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:22:22,192 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你这卖汽车吗？

用户...
2025-03-30 11:22:22,193 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:22:22,195 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:22:24,485 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:22:24,487 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.29秒
2025-03-30 11:22:24,488 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 11:22:24,488 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_4c4bdbfe): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 11:22:24,488 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 11:22:24,488 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 11:22:24,488 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 11:22:24,488 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你这卖汽车吗？"。请给出一个简洁、专业、乐于助人但【...
2025-03-30 11:22:24,973 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:22:24,976 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:22:26,737 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:22:26,741 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.77秒
2025-03-30 11:22:26,742 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，这里是医院哦，若需就诊请您简单描述症状，我们会为您安排合适的科室或医生，谢谢！
2025-03-30 11:22:26,742 - Hospital-MultiAgent-System - WARNING - 尝试更新不存在的问诊上下文: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:22:26,748 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): Status=in_progress, Agent=receptionist, Msg='您好，这里是医院哦，若需就诊请您简单描述症状，我们会为您安排合适的科室或医生，谢谢！...'
2025-03-30 11:22:26,749 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:22:26] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:22:40,111 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): '我问你卖不卖汽车...'
2025-03-30 11:22:40,111 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee，视为新对话，转给接待员。
2025-03-30 11:22:40,111 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_49e175d4 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:22:40,111 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_49e175d4 不存在，创建新的记忆记录。
2025-03-30 11:22:40,113 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_49e175d4 (Name: 网页用户, Age: None)
2025-03-30 11:22:40,115 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:22:40,115 - Hospital-MultiAgent-System - INFO - 为咨询 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee (Patient: WebPatient_49e175d4) 创建新上下文
2025-03-30 11:22:40,115 - Hospital-MultiAgent-System - INFO - 为患者 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee 保存问诊上下文: ctx_web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee_e1fe46d9
2025-03-30 11:22:40,120 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:22:40,120 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:22:40,120 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 我问你卖不卖汽车

用...
2025-03-30 11:22:40,611 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:22:40,615 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:22:42,924 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:22:42,928 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.31秒
2025-03-30 11:22:42,929 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 11:22:42,929 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_49e175d4): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 11:22:42,929 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 11:22:42,929 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 11:22:42,929 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 11:22:42,930 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："我问你卖不卖汽车"。请给出一个简洁、专业、乐于助人但...
2025-03-30 11:22:42,934 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:22:42,937 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:22:44,353 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:22:44,355 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.42秒
2025-03-30 11:22:44,355 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：抱歉，我们是医院，不卖汽车。如需就诊，请描述症状以便安排合适医生。谢谢理解！
2025-03-30 11:22:44,356 - Hospital-MultiAgent-System - WARNING - 尝试更新不存在的问诊上下文: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:22:44,360 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): Status=in_progress, Agent=receptionist, Msg='抱歉，我们是医院，不卖汽车。如需就诊，请描述症状以便安排合适医生。谢谢理解！...'
2025-03-30 11:22:44,361 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:22:44] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:23:00,349 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): '那好吧，我是一下病症...'
2025-03-30 11:23:00,349 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee，视为新对话，转给接待员。
2025-03-30 11:23:00,349 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_6d89a1c1 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:23:00,349 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_6d89a1c1 不存在，创建新的记忆记录。
2025-03-30 11:23:00,351 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_6d89a1c1 (Name: 网页用户, Age: None)
2025-03-30 11:23:00,353 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:23:00,353 - Hospital-MultiAgent-System - INFO - 为咨询 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee (Patient: WebPatient_6d89a1c1) 创建新上下文
2025-03-30 11:23:00,353 - Hospital-MultiAgent-System - INFO - 为患者 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee 保存问诊上下文: ctx_web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee_7497f0d0
2025-03-30 11:23:00,359 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:23:00,359 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:23:00,359 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 那好吧，我是一下病症
...
2025-03-30 11:23:01,018 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:23:01,023 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:23:02,917 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:23:02,921 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.90秒
2025-03-30 11:23:02,922 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "unclear",
  "has_sufficient_medical...
2025-03-30 11:23:02,923 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_6d89a1c1): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 11:23:02,923 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_6d89a1c1)
2025-03-30 11:23:02,923 - Hospital-MultiAgent-System - WARNING - 尝试更新不存在的问诊上下文: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:23:02,931 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 11:23:02,932 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:23:02] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:23:14,238 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): '肚子疼...'
2025-03-30 11:23:14,238 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee，视为新对话，转给接待员。
2025-03-30 11:23:14,238 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_4c025906 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:23:14,238 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_4c025906 不存在，创建新的记忆记录。
2025-03-30 11:23:14,241 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_4c025906 (Name: 网页用户, Age: None)
2025-03-30 11:23:14,244 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:23:14,244 - Hospital-MultiAgent-System - INFO - 为咨询 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee (Patient: WebPatient_4c025906) 创建新上下文
2025-03-30 11:23:14,244 - Hospital-MultiAgent-System - INFO - 为患者 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee 保存问诊上下文: ctx_web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee_77dd3bf0
2025-03-30 11:23:14,248 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:23:14,248 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:23:14,248 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 肚子疼

用户最新消息...
2025-03-30 11:23:14,249 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:23:14,250 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:23:16,504 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:23:16,507 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.26秒
2025-03-30 11:23:16,507 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "medical_inquiry",
  "has_sufficient...
2025-03-30 11:23:16,508 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_4c025906): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['abdominal pain']
2025-03-30 11:23:16,508 - Hospital-MultiAgent-System - INFO - 意图为医疗咨询且信息充分或已引导，尝试分诊 (Patient: WebPatient_4c025906)
2025-03-30 11:23:16,509 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.2
2025-03-30 11:23:16,510 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 11:23:16,510 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 11:23:17,043 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:23:17,048 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:23:18,836 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:23:18,840 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.79秒
2025-03-30 11:23:18,841 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "急诊科",
  "priority": "ur...
2025-03-30 11:23:18,841 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=急诊科, 优先级=urgent
2025-03-30 11:23:18,841 - Hospital-MultiAgent-System - WARNING - 尝试更新不存在的问诊上下文: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:23:18,846 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee)，准备触发医生诊断。
2025-03-30 11:23:18,846 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee, Patient: WebPatient_4c025906)...
2025-03-30 11:23:18,846 - Hospital-MultiAgent-System - ERROR - 无法触发诊断：找不到咨询上下文 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:23:18,849 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): Status=handoff_to_doctor, Agent=receptionist, Msg='好的，感谢您的信息。根据您的描述 (abdominal pain, 用户描述不清晰) 和初步分析，建...'
2025-03-30 11:23:18,850 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:23:18] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:24:55,990 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): '医生呢？...'
2025-03-30 11:24:55,990 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee，视为新对话，转给接待员。
2025-03-30 11:24:55,991 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_397821c7 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:24:55,991 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_397821c7 不存在，创建新的记忆记录。
2025-03-30 11:24:55,994 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_397821c7 (Name: 网页用户, Age: None)
2025-03-30 11:24:55,997 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:24:55,997 - Hospital-MultiAgent-System - INFO - 为咨询 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee (Patient: WebPatient_397821c7) 创建新上下文
2025-03-30 11:24:55,997 - Hospital-MultiAgent-System - INFO - 为患者 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee 保存问诊上下文: ctx_web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee_01b7a018
2025-03-30 11:24:56,000 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:24:56,000 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:24:56,000 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 医生呢？

用户最新消...
2025-03-30 11:24:56,479 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:24:56,483 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:24:58,465 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:24:58,468 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.98秒
2025-03-30 11:24:58,469 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "unclear",
  "has_sufficient_medical...
2025-03-30 11:24:58,469 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_397821c7): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 11:24:58,469 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_397821c7)
2025-03-30 11:24:58,469 - Hospital-MultiAgent-System - WARNING - 尝试更新不存在的问诊上下文: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:24:58,472 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 11:24:58,472 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:24:58] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:25:15,611 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): '你是医生吗？...'
2025-03-30 11:25:15,611 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee，视为新对话，转给接待员。
2025-03-30 11:25:15,611 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_7cb8f00c 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:25:15,611 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_7cb8f00c 不存在，创建新的记忆记录。
2025-03-30 11:25:15,615 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_7cb8f00c (Name: 网页用户, Age: None)
2025-03-30 11:25:15,617 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:25:15,617 - Hospital-MultiAgent-System - INFO - 为咨询 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee (Patient: WebPatient_7cb8f00c) 创建新上下文
2025-03-30 11:25:15,617 - Hospital-MultiAgent-System - INFO - 为患者 web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee 保存问诊上下文: ctx_web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee_3653bcbf
2025-03-30 11:25:15,623 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:25:15,623 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:25:15,623 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你是医生吗？

用户最...
2025-03-30 11:25:16,078 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:25:16,087 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:25:19,293 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:25:19,297 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.21秒
2025-03-30 11:25:19,297 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 11:25:19,298 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_7cb8f00c): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 11:25:19,298 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 11:25:19,298 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 11:25:19,299 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 11:25:19,299 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你是医生吗？"。请给出一个简洁、专业、乐于助人但【绝...
2025-03-30 11:25:19,303 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:25:19,307 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:25:20,722 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:25:20,725 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.42秒
2025-03-30 11:25:20,726 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，我不是医生，但我可以帮助您安排相关医生。请简单描述您的症状，我们会为您分诊至合适的科室。
2025-03-30 11:25:20,726 - Hospital-MultiAgent-System - WARNING - 尝试更新不存在的问诊上下文: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee
2025-03-30 11:25:20,735 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_fdc8fe8f-1254-44de-b62e-c7b0f7b2cbee): Status=in_progress, Agent=receptionist, Msg='您好，我不是医生，但我可以帮助您安排相关医生。请简单描述您的症状，我们会为您分诊至合适的科室。...'
2025-03-30 11:25:20,736 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:25:20] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:29:36,120 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/memory_system.py', reloading
2025-03-30 11:29:36,201 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:29:36,414 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:29:36,414 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:29:36,414 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:29:36,414 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:29:36,427 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:29:36,427 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:29:36,427 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:29:36,427 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: 3262026d-094a-452a-b4b8-edba6e067fcb)
2025-03-30 11:29:36,427 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:29:36,427 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 28705637-0649-4cf9-bd0a-4af63613ce38)
2025-03-30 11:29:36,428 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:29:36,428 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 95931d7a-abd8-442e-80d7-0b32ee3dd80a)
2025-03-30 11:29:36,428 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:29:36,428 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:29:36,428 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:29:36,428 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:29:36,443 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:29:36,448 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:29:44,041 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:29:44,041 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 11:29:44,041 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:29:44,041 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 11:29:44,041 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 11:29:44,054 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:29:44,054 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:29:44,054 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:29:44,054 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: b8cd0810-9e58-486e-a6ef-6986409b8887)
2025-03-30 11:29:44,054 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:29:44,054 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 8b4b3b94-37b9-4bd1-a29e-fa4410604cf1)
2025-03-30 11:29:44,054 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:29:44,054 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 772f1e4c-9772-436f-a6a7-595becf7dfd2)
2025-03-30 11:29:44,054 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:29:44,054 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:29:44,054 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:29:44,054 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:29:44,070 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 11:29:44,070 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 11:29:44,071 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:29:44,244 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:29:44,244 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:29:44,244 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:29:44,244 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:29:44,257 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:29:44,257 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:29:44,257 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:29:44,257 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: b615ced5-99b9-469a-9335-3892cd9954ff)
2025-03-30 11:29:44,257 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:29:44,257 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 3312bbbe-780e-47f1-9814-2ac88162ee4c)
2025-03-30 11:29:44,257 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:29:44,257 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 2351b0b9-ff6c-47ec-8017-c193a66d7d8b)
2025-03-30 11:29:44,257 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:29:44,257 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:29:44,257 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:29:44,258 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:29:44,269 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:29:44,273 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:29:50,490 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:29:50] "GET / HTTP/1.1" 200 -
2025-03-30 11:29:50,501 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:29:50] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 11:29:50,501 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:29:50] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 11:29:50,506 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_cdca74e1-99ac-474d-8ff8-1ac386732205
2025-03-30 11:29:50,506 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_cdca74e1-99ac-474d-8ff8-1ac386732205
2025-03-30 11:29:50,506 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:29:50] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 11:29:54,159 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_cdca74e1-99ac-474d-8ff8-1ac386732205): '肚子疼...'
2025-03-30 11:29:54,160 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_cdca74e1-99ac-474d-8ff8-1ac386732205
2025-03-30 11:29:54,160 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_cdca74e1-99ac-474d-8ff8-1ac386732205，视为新对话，转给接待员。
2025-03-30 11:29:54,161 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_9846f3e5 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:29:54,161 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_9846f3e5 不存在，创建新的记忆记录。
2025-03-30 11:29:54,164 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_9846f3e5 (Name: 网页用户, Age: None)
2025-03-30 11:29:54,166 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_cdca74e1-99ac-474d-8ff8-1ac386732205
2025-03-30 11:29:54,166 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_cdca74e1-99ac-474d-8ff8-1ac386732205
2025-03-30 11:29:54,166 - Hospital-MultiAgent-System - INFO - 为咨询 web_cdca74e1-99ac-474d-8ff8-1ac386732205 (Patient: WebPatient_9846f3e5) 创建新上下文
2025-03-30 11:29:54,166 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_cdca74e1-99ac-474d-8ff8-1ac386732205 (Patient: WebPatient_9846f3e5)
2025-03-30 11:29:54,171 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:29:54,171 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:29:54,171 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 肚子疼

用户最新消息...
2025-03-30 11:29:54,338 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:29:54,342 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:29:56,550 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:29:56,558 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.22秒
2025-03-30 11:29:56,559 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "medical_inquiry",
  "has_sufficient...
2025-03-30 11:29:56,559 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_9846f3e5): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['abdominal pain']
2025-03-30 11:29:56,561 - Hospital-MultiAgent-System - INFO - 意图为医疗咨询且信息充分或已引导，尝试分诊 (Patient: WebPatient_9846f3e5)
2025-03-30 11:29:56,561 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.2
2025-03-30 11:29:56,561 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 11:29:56,562 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 11:29:56,565 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:29:56,570 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:29:58,026 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:29:58,032 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.46秒
2025-03-30 11:29:58,033 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "急诊科",
  "priority": "ur...
2025-03-30 11:29:58,033 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=急诊科, 优先级=urgent
2025-03-30 11:29:58,040 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_cdca74e1-99ac-474d-8ff8-1ac386732205)，准备触发医生诊断。
2025-03-30 11:29:58,040 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_cdca74e1-99ac-474d-8ff8-1ac386732205, Patient: WebPatient_9846f3e5)...
2025-03-30 11:29:58,040 - Hospital-MultiAgent-System - ERROR - 触发医生诊断时失败 (Consultation: web_cdca74e1-99ac-474d-8ff8-1ac386732205): name 'DEFAULT_DEPARTMENT' is not defined
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 359, in _trigger_doctor_diagnosis
    "department": reception_result.get("department", DEFAULT_DEPARTMENT),
                                                     ^^^^^^^^^^^^^^^^^^
NameError: name 'DEFAULT_DEPARTMENT' is not defined
2025-03-30 11:29:58,050 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_cdca74e1-99ac-474d-8ff8-1ac386732205): Status=handoff_to_doctor, Agent=receptionist, Msg='好的，感谢您的信息。根据您的描述 (abdominal pain, 用户描述不清晰) 和初步分析，建...'
2025-03-30 11:29:58,054 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:29:58] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:32:01,270 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 11:32:01,335 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:32:01,530 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:32:01,530 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:32:01,530 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:32:01,530 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:32:01,543 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:32:01,543 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:32:01,543 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:32:01,543 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: 659995a8-7338-4dba-8fec-99789f5da817)
2025-03-30 11:32:01,543 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:32:01,543 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 551a11c7-8310-4135-a9c8-52fab66e4d5d)
2025-03-30 11:32:01,543 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:32:01,543 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 00f90fee-e352-4210-97ed-3e2a11d0c668)
2025-03-30 11:32:01,543 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:32:01,543 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:32:01,543 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:32:01,544 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:32:01,557 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:32:01,561 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:32:15,387 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:32:15,388 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 11:32:15,388 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:32:15,388 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 11:32:15,388 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 11:32:15,400 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:32:15,400 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:32:15,400 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:32:15,400 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: bf54ff1c-79ae-44b9-ba25-92bcb46ffd84)
2025-03-30 11:32:15,400 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:32:15,400 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: 6f330a56-a611-4f5f-abb5-5faf97355123)
2025-03-30 11:32:15,400 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:32:15,400 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: d90ea2bf-1e66-42c6-8a66-378d25d71da1)
2025-03-30 11:32:15,400 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:32:15,400 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:32:15,400 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:32:15,401 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:32:15,417 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 11:32:15,417 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 11:32:15,417 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:32:15,592 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:32:15,592 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:32:15,592 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:32:15,592 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:32:15,605 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:32:15,605 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:32:15,605 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:32:15,605 - Hospital-MultiAgent-System - INFO - 初始化receptionist智能体: 前台接待员 (ID: af066b4c-f475-4025-8036-90ce78ff4b9f)
2025-03-30 11:32:15,605 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:32:15,605 - Hospital-MultiAgent-System - INFO - 初始化doctor智能体: 主治医生 (ID: b12edde6-d91b-4fd3-b790-6ed370edb698)
2025-03-30 11:32:15,605 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:32:15,605 - Hospital-MultiAgent-System - INFO - 初始化pharmacist智能体: 药剂师 (ID: 0e04fe4b-6777-4f12-ab00-d07727a5048e)
2025-03-30 11:32:15,605 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:32:15,605 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:32:15,605 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:32:15,606 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:32:15,617 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:32:15,621 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:32:23,076 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:32:23] "GET / HTTP/1.1" 200 -
2025-03-30 11:32:23,091 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:32:23] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 11:32:23,092 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:32:23] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 11:32:23,097 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_d490a050-af73-48bc-ae44-71b97a6ee6cc
2025-03-30 11:32:23,098 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_d490a050-af73-48bc-ae44-71b97a6ee6cc
2025-03-30 11:32:23,098 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:32:23] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 11:32:35,348 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_d490a050-af73-48bc-ae44-71b97a6ee6cc): '肚子疼 60 男...'
2025-03-30 11:32:35,349 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_d490a050-af73-48bc-ae44-71b97a6ee6cc
2025-03-30 11:32:35,349 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_d490a050-af73-48bc-ae44-71b97a6ee6cc，视为新对话，转给接待员。
2025-03-30 11:32:35,350 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_caae3f97 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:32:35,350 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_caae3f97 不存在，创建新的记忆记录。
2025-03-30 11:32:35,354 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_caae3f97 (Name: 网页用户, Age: None)
2025-03-30 11:32:35,356 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_d490a050-af73-48bc-ae44-71b97a6ee6cc
2025-03-30 11:32:35,356 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_d490a050-af73-48bc-ae44-71b97a6ee6cc
2025-03-30 11:32:35,356 - Hospital-MultiAgent-System - INFO - 为咨询 web_d490a050-af73-48bc-ae44-71b97a6ee6cc (Patient: WebPatient_caae3f97) 创建新上下文
2025-03-30 11:32:35,356 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_d490a050-af73-48bc-ae44-71b97a6ee6cc (Patient: WebPatient_caae3f97)
2025-03-30 11:32:35,362 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:32:35,362 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:32:35,362 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 肚子疼 60 男

用...
2025-03-30 11:32:35,532 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:32:35,539 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:32:38,899 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:32:38,907 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.37秒
2025-03-30 11:32:38,909 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "medical_inquiry",
  "has_su...
2025-03-30 11:32:38,909 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_caae3f97): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚子疼']
2025-03-30 11:32:38,909 - Hospital-MultiAgent-System - INFO - 意图为医疗咨询且信息充分或已引导，尝试分诊 (Patient: WebPatient_caae3f97)
2025-03-30 11:32:38,911 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.2
2025-03-30 11:32:38,912 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 11:32:38,912 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 11:32:38,915 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:32:38,920 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:32:40,950 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:32:40,956 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.03秒
2025-03-30 11:32:40,956 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "p...
2025-03-30 11:32:40,956 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=priority
2025-03-30 11:32:40,967 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_d490a050-af73-48bc-ae44-71b97a6ee6cc)，准备触发医生诊断。
2025-03-30 11:32:40,967 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_d490a050-af73-48bc-ae44-71b97a6ee6cc, Patient: WebPatient_caae3f97)...
2025-03-30 11:32:40,968 - Hospital-MultiAgent-System - ERROR - 触发医生诊断时失败 (Consultation: web_d490a050-af73-48bc-ae44-71b97a6ee6cc): MemorySystem.add_conversation_entry() got an unexpected keyword argument 'agent_id'
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 329, in _trigger_doctor_diagnosis
    doctor_initial_response = self.doctor.receive_message({
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/agents/base_agent.py", line 49, in receive_message
    self._record_conversation(direction="received", message=message)
  File "/Users/chilikevin/hospital_multiagent_system/agents/base_agent.py", line 133, in _record_conversation
    self.memory_system.add_conversation_entry(
TypeError: MemorySystem.add_conversation_entry() got an unexpected keyword argument 'agent_id'
2025-03-30 11:32:40,976 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_d490a050-af73-48bc-ae44-71b97a6ee6cc): Status=handoff_to_doctor, Agent=receptionist, Msg='好的，感谢您的信息。根据您的描述 (60, 肚子疼) 和初步分析，建议您挂 [消化内科] 科。系统评...'
2025-03-30 11:32:40,978 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:32:40] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:36:14,474 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/base_agent.py', reloading
2025-03-30 11:36:14,529 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:36:14,721 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:36:14,721 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:36:14,721 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:36:14,721 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:36:14,733 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:36:14,733 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:36:14,734 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:36:14,734 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 5f3ae543-97e9-4d4f-8979-e165981b3179)
2025-03-30 11:36:14,734 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:36:14,734 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 08948329-3701-47ca-a48d-055983e049cd)
2025-03-30 11:36:14,734 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:36:14,734 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 120dc95c-82e3-4b9f-aebc-82b101942668)
2025-03-30 11:36:14,734 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:36:14,734 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:36:14,734 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:36:14,734 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:36:14,748 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:36:14,752 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:36:30,483 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:36:30] "GET / HTTP/1.1" 200 -
2025-03-30 11:36:30,497 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:36:30] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 11:36:30,497 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:36:30] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 11:36:30,503 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_173a2449-ca56-45bb-8ef1-c989ed970606
2025-03-30 11:36:30,503 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_173a2449-ca56-45bb-8ef1-c989ed970606
2025-03-30 11:36:30,504 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:36:30] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 11:36:38,819 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_173a2449-ca56-45bb-8ef1-c989ed970606): '肚疼疼 60 男...'
2025-03-30 11:36:38,820 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_173a2449-ca56-45bb-8ef1-c989ed970606
2025-03-30 11:36:38,820 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_173a2449-ca56-45bb-8ef1-c989ed970606，视为新对话，转给接待员。
2025-03-30 11:36:38,820 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_468593a5 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:36:38,820 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_468593a5 不存在，创建新的记忆记录。
2025-03-30 11:36:38,824 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_468593a5 (Name: 网页用户, Age: None)
2025-03-30 11:36:38,827 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_173a2449-ca56-45bb-8ef1-c989ed970606
2025-03-30 11:36:38,827 - Hospital-MultiAgent-System - ERROR - 与 Agent (receptionist) 交互时出错 (Consultation: web_173a2449-ca56-45bb-8ef1-c989ed970606): name 'json' is not defined
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 130, in handle_web_message
    agent_response_msg = target_agent.receive_message({
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/agents/base_agent.py", line 49, in receive_message
    self._record_conversation(direction="received", message=message)
  File "/Users/chilikevin/hospital_multiagent_system/agents/base_agent.py", line 149, in _record_conversation
    log_content_str = json.dumps(message_content, ensure_ascii=False, default=str)
                      ^^^^
NameError: name 'json' is not defined. Did you forget to import 'json'
2025-03-30 11:36:38,829 - Hospital-MultiAgent-System - WARNING - 尝试删除不存在的问诊上下文: web_173a2449-ca56-45bb-8ef1-c989ed970606
2025-03-30 11:36:38,829 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:36:38] "[35m[1mPOST /api/conversation HTTP/1.1[0m" 500 -
2025-03-30 11:38:30,701 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/base_agent.py', reloading
2025-03-30 11:38:30,775 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:38:30,966 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:38:30,966 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:38:30,966 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:38:30,966 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:38:30,979 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:38:30,979 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:38:30,979 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:38:30,979 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: d1e86921-60a2-480f-bdd5-3a6e069ee935)
2025-03-30 11:38:30,979 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:38:30,979 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 05e9942b-8632-4410-babd-38d2d109064c)
2025-03-30 11:38:30,979 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:38:30,979 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 791a8fa6-36db-49a6-b4d3-7308d88c3f6d)
2025-03-30 11:38:30,979 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:38:30,979 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:38:30,979 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:38:30,980 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:38:30,991 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:38:30,996 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:38:40,227 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:38:40,227 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 11:38:40,227 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:38:40,227 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 11:38:40,227 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 11:38:40,239 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:38:40,239 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:38:40,239 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:38:40,239 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 3fa7c661-6a17-4f3d-ad18-c65fecff292c)
2025-03-30 11:38:40,239 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:38:40,240 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: ff064205-254c-42b4-afe7-c61d1e0297bb)
2025-03-30 11:38:40,240 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:38:40,240 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 7d0e274e-510c-4657-8c31-aeeb3bed303f)
2025-03-30 11:38:40,240 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:38:40,240 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:38:40,240 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:38:40,240 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:38:40,257 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 11:38:40,257 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 11:38:40,257 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:38:40,438 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:38:40,438 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:38:40,438 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:38:40,438 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:38:40,450 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:38:40,450 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:38:40,451 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:38:40,451 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 8172b46a-6a41-4c84-b65c-bce189fe9e55)
2025-03-30 11:38:40,451 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:38:40,451 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 14d655e6-bfe1-4ff9-82fe-491a3b0b5bc2)
2025-03-30 11:38:40,451 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:38:40,451 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 46465c70-9958-463d-976f-2cdc1f487686)
2025-03-30 11:38:40,451 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:38:40,451 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:38:40,451 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:38:40,451 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:38:40,464 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:38:40,468 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:38:48,055 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:38:48] "GET / HTTP/1.1" 200 -
2025-03-30 11:38:48,068 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:38:48] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 11:38:48,068 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:38:48] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 11:38:48,074 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_3e8ad534-3970-4850-b3ee-4b821b1219fe
2025-03-30 11:38:48,075 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_3e8ad534-3970-4850-b3ee-4b821b1219fe
2025-03-30 11:38:48,076 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:38:48] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 11:39:02,143 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_3e8ad534-3970-4850-b3ee-4b821b1219fe): '肚子疼 60 男...'
2025-03-30 11:39:02,143 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_3e8ad534-3970-4850-b3ee-4b821b1219fe
2025-03-30 11:39:02,143 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_3e8ad534-3970-4850-b3ee-4b821b1219fe，视为新对话，转给接待员。
2025-03-30 11:39:02,145 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_c47d0825 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:39:02,145 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_c47d0825 不存在，创建新的记忆记录。
2025-03-30 11:39:02,149 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_c47d0825 (Name: 网页用户, Age: None)
2025-03-30 11:39:02,152 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_3e8ad534-3970-4850-b3ee-4b821b1219fe
2025-03-30 11:39:02,155 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_3e8ad534-3970-4850-b3ee-4b821b1219fe
2025-03-30 11:39:02,155 - Hospital-MultiAgent-System - INFO - 为咨询 web_3e8ad534-3970-4850-b3ee-4b821b1219fe (Patient: WebPatient_c47d0825) 创建新上下文
2025-03-30 11:39:02,155 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_3e8ad534-3970-4850-b3ee-4b821b1219fe (Patient: WebPatient_c47d0825)
2025-03-30 11:39:02,159 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:39:02,160 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:39:02,160 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 肚子疼 60 男

用...
2025-03-30 11:39:02,599 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:39:02,605 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:39:05,326 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:39:05,330 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.72秒
2025-03-30 11:39:05,330 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "medical_inquiry",
  "has_sufficient...
2025-03-30 11:39:05,330 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_c47d0825): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚子疼']
2025-03-30 11:39:05,330 - Hospital-MultiAgent-System - INFO - 意图为医疗咨询且信息充分或已引导，尝试分诊 (Patient: WebPatient_c47d0825)
2025-03-30 11:39:05,330 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.2
2025-03-30 11:39:05,330 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 11:39:05,330 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 11:39:05,332 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:39:05,334 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:39:08,044 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:39:08,045 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.71秒
2025-03-30 11:39:08,045 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "p...
2025-03-30 11:39:08,045 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=priority
2025-03-30 11:39:08,048 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_3e8ad534-3970-4850-b3ee-4b821b1219fe)，准备触发医生诊断。
2025-03-30 11:39:08,048 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_3e8ad534-3970-4850-b3ee-4b821b1219fe, Patient: WebPatient_c47d0825)...
2025-03-30 11:39:08,048 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_c47d0825 的诊断请求。复诊: False
2025-03-30 11:39:08,049 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 11:39:08,049 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 11:39:08,049 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:

患者ID: WebPatien...
2025-03-30 11:39:08,050 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:39:08,052 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:39:09,153 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:39:09,157 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.10秒
2025-03-30 11:39:09,157 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：肚子疼具体是哪个部位？是上腹部、中腹部还是下腹部？
2025-03-30 11:39:09,157 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: WebPatient_c47d0825 (Patient: WebPatient_c47d0825)
2025-03-30 11:39:09,165 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_3e8ad534-3970-4850-b3ee-4b821b1219fe)
2025-03-30 11:39:09,166 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_3e8ad534-3970-4850-b3ee-4b821b1219fe): Status=handoff_to_doctor, Agent=receptionist, Msg='好的，感谢您的信息。根据您的描述 (肚子疼, 60) 和初步分析，建议您挂 [消化内科] 科。系统评...'
2025-03-30 11:39:09,167 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:39:09] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:42:05,880 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 11:42:05,948 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:42:06,139 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:42:06,139 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:42:06,139 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:42:06,139 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:42:06,152 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:42:06,152 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:42:06,152 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:42:06,152 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: ce476004-8f2d-4dd2-bc2e-47bcbfe45b26)
2025-03-30 11:42:06,152 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:42:06,152 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: c0c2d9e9-1a88-4c03-b2de-03bada89f94f)
2025-03-30 11:42:06,152 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:42:06,152 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 8aa0c45a-83b7-42de-bc2e-5a5677c7ac17)
2025-03-30 11:42:06,152 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:42:06,152 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:42:06,153 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:42:06,153 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:42:06,165 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:42:06,170 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:43:37,414 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:43:37,414 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 11:43:37,414 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:43:37,414 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 11:43:37,414 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 11:43:37,427 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:43:37,427 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:43:37,427 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:43:37,427 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 2adb889f-f681-4b05-a5ed-de9178307121)
2025-03-30 11:43:37,427 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:43:37,427 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: ab5edc6b-c4d8-4cf3-a440-873a322b608b)
2025-03-30 11:43:37,427 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:43:37,427 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 8d4104b6-0db1-4adb-a1c1-2bd8cff1588b)
2025-03-30 11:43:37,427 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:43:37,427 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:43:37,427 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:43:37,428 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:43:37,445 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 11:43:37,445 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 11:43:37,446 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:43:37,627 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:43:37,627 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:43:37,627 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:43:37,627 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:43:37,639 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:43:37,639 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:43:37,639 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:43:37,639 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 6a7b3d27-7f5f-40cf-a88d-ac1bf33e0454)
2025-03-30 11:43:37,639 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:43:37,639 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: bed6becf-4b69-456a-bec7-326c682089ff)
2025-03-30 11:43:37,639 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:43:37,639 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 062046fd-c222-4ee8-bcf1-1700e536be55)
2025-03-30 11:43:37,639 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:43:37,640 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:43:37,640 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:43:37,640 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:43:37,653 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:43:37,657 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:43:43,214 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:43:43] "GET / HTTP/1.1" 200 -
2025-03-30 11:43:43,227 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:43:43] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 11:43:43,228 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:43:43] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 11:43:43,233 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_b04a4309-d224-4a08-be2f-e092a50d52cc
2025-03-30 11:43:43,233 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_b04a4309-d224-4a08-be2f-e092a50d52cc
2025-03-30 11:43:43,234 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:43:43] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 11:43:49,382 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc): '你好...'
2025-03-30 11:43:49,383 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_b04a4309-d224-4a08-be2f-e092a50d52cc
2025-03-30 11:43:49,383 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_b04a4309-d224-4a08-be2f-e092a50d52cc，视为新对话，转给接待员。
2025-03-30 11:43:49,384 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_0affb019 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:43:49,384 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_0affb019 不存在，创建新的记忆记录。
2025-03-30 11:43:49,387 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_0affb019 (Name: 网页用户, Age: None)
2025-03-30 11:43:49,392 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc
2025-03-30 11:43:49,394 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_b04a4309-d224-4a08-be2f-e092a50d52cc
2025-03-30 11:43:49,394 - Hospital-MultiAgent-System - INFO - 为咨询 web_b04a4309-d224-4a08-be2f-e092a50d52cc (Patient: WebPatient_0affb019) 创建新上下文
2025-03-30 11:43:49,394 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_b04a4309-d224-4a08-be2f-e092a50d52cc (Patient: WebPatient_0affb019)
2025-03-30 11:43:49,400 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:43:49,400 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:43:49,400 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 11:43:49,530 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:43:49,534 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:43:52,033 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:43:52,040 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.51秒
2025-03-30 11:43:52,040 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 11:43:52,042 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0affb019): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 11:43:52,043 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 11:43:52,043 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 11:43:52,043 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 11:43:52,043 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 11:43:52,047 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:43:52,052 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:43:53,927 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:43:53,932 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.88秒
2025-03-30 11:43:53,934 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，欢迎来到医院！请您简单描述一下情况，我们会为您安排合适的医生或科室，谢谢配合。
2025-03-30 11:43:53,951 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc): Status=in_progress, Agent=receptionist, Msg='您好，欢迎来到医院！请您简单描述一下情况，我们会为您安排合适的医生或科室，谢谢配合。...'
2025-03-30 11:43:53,953 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:43:53] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:44:05,979 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc): '肚子疼 60 男...'
2025-03-30 11:44:05,980 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b04a4309-d224-4a08-be2f-e092a50d52cc (Patient: WebPatient_0affb019), 当前阶段: reception_chatting
2025-03-30 11:44:05,980 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc
2025-03-30 11:44:05,986 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_b04a4309-d224-4a08-be2f-e092a50d52cc, 当前阶段: reception_chatting
2025-03-30 11:44:05,989 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:44:05,989 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:44:05,989 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好
Receptio...
2025-03-30 11:44:06,569 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:44:06,576 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:44:09,080 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:44:09,085 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.51秒
2025-03-30 11:44:09,085 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "medical_inquiry",
  "has_su...
2025-03-30 11:44:09,085 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0affb019): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚子疼']
2025-03-30 11:44:09,086 - Hospital-MultiAgent-System - INFO - 意图为医疗咨询且信息充分或已引导，尝试分诊 (Patient: WebPatient_0affb019)
2025-03-30 11:44:09,086 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.2
2025-03-30 11:44:09,086 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 11:44:09,086 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 11:44:09,091 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:44:09,095 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:44:10,786 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:44:10,793 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.70秒
2025-03-30 11:44:10,794 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "内科",
  "priority": "nor...
2025-03-30 11:44:10,796 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=内科, 优先级=normal
2025-03-30 11:44:10,809 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc)，准备触发医生诊断。
2025-03-30 11:44:10,809 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc, Patient: WebPatient_0affb019)...
2025-03-30 11:44:10,812 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_0affb019 的诊断请求。复诊: False
2025-03-30 11:44:10,812 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 11:44:10,812 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 11:44:10,812 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:

患者ID: WebPatien...
2025-03-30 11:44:10,814 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:44:10,815 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:44:11,635 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:44:11,643 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.83秒
2025-03-30 11:44:11,643 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：肚子疼的具体部位是哪里？比如上腹部、下腹部、左侧还是右侧？
2025-03-30 11:44:11,644 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: WebPatient_0affb019 (Patient: WebPatient_0affb019)
2025-03-30 11:44:11,662 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc)
2025-03-30 11:44:11,662 - Hospital-MultiAgent-System - INFO - 成功转接给医生并获取第一个问题 (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc)
2025-03-30 11:44:11,663 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc): Status=in_progress, Agent=doctor, Msg='肚子疼的具体部位是哪里？比如上腹部、下腹部、左侧还是右侧？...'
2025-03-30 11:44:11,664 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:44:11] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:44:24,560 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc): '右侧上腹...'
2025-03-30 11:44:24,561 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b04a4309-d224-4a08-be2f-e092a50d52cc (Patient: WebPatient_0affb019), 当前阶段: reception_completed
2025-03-30 11:44:24,561 - Hospital-MultiAgent-System - WARNING - 上下文 web_b04a4309-d224-4a08-be2f-e092a50d52cc 处于未处理阶段: reception_completed，将按新对话处理。
2025-03-30 11:44:24,565 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc
2025-03-30 11:44:24,568 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_b04a4309-d224-4a08-be2f-e092a50d52cc, 当前阶段: reception_completed
2025-03-30 11:44:24,568 - Hospital-MultiAgent-System - WARNING - 收到初始请求，但上下文 web_b04a4309-d224-4a08-be2f-e092a50d52cc 已存在，将继续使用现有上下文。
2025-03-30 11:44:24,572 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:44:24,572 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:44:24,572 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 您好，...
2025-03-30 11:44:25,173 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:44:25,177 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:44:27,000 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:44:27,004 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.83秒
2025-03-30 11:44:27,004 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "medical_inquiry",
  "has_su...
2025-03-30 11:44:27,004 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0affb019): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['右侧上腹疼痛']
2025-03-30 11:44:27,004 - Hospital-MultiAgent-System - INFO - 意图为医疗咨询且信息充分或已引导，尝试分诊 (Patient: WebPatient_0affb019)
2025-03-30 11:44:27,004 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.2
2025-03-30 11:44:27,005 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 11:44:27,005 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 11:44:27,009 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:44:27,013 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:44:28,420 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:44:28,424 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.41秒
2025-03-30 11:44:28,424 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "p...
2025-03-30 11:44:28,425 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=priority
2025-03-30 11:44:28,436 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc)，准备触发医生诊断。
2025-03-30 11:44:28,437 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc, Patient: WebPatient_0affb019)...
2025-03-30 11:44:28,443 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_0affb019 的诊断请求。复诊: False
2025-03-30 11:44:28,443 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 11:44:28,443 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 11:44:28,443 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:

患者ID: WebPatien...
2025-03-30 11:44:28,448 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:44:28,452 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:44:29,459 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:44:29,464 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.01秒
2025-03-30 11:44:29,464 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛开始于何时？是突然发生还是逐渐加重的？
2025-03-30 11:44:29,465 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: WebPatient_0affb019 (Patient: WebPatient_0affb019)
2025-03-30 11:44:29,486 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc)
2025-03-30 11:44:29,486 - Hospital-MultiAgent-System - INFO - 成功转接给医生并获取第一个问题 (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc)
2025-03-30 11:44:29,488 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc): Status=in_progress, Agent=doctor, Msg='疼痛开始于何时？是突然发生还是逐渐加重的？...'
2025-03-30 11:44:29,489 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:44:29] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:44:35,352 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc): '昨天下午...'
2025-03-30 11:44:35,352 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b04a4309-d224-4a08-be2f-e092a50d52cc (Patient: WebPatient_0affb019), 当前阶段: reception_completed
2025-03-30 11:44:35,352 - Hospital-MultiAgent-System - WARNING - 上下文 web_b04a4309-d224-4a08-be2f-e092a50d52cc 处于未处理阶段: reception_completed，将按新对话处理。
2025-03-30 11:44:35,359 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc
2025-03-30 11:44:35,364 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_b04a4309-d224-4a08-be2f-e092a50d52cc, 当前阶段: reception_completed
2025-03-30 11:44:35,364 - Hospital-MultiAgent-System - WARNING - 收到初始请求，但上下文 web_b04a4309-d224-4a08-be2f-e092a50d52cc 已存在，将继续使用现有上下文。
2025-03-30 11:44:35,367 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:44:35,367 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:44:35,367 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 好的，...
2025-03-30 11:44:36,017 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:44:36,019 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:44:38,058 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:44:38,058 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.04秒
2025-03-30 11:44:38,058 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "unclear",
  "has_sufficient...
2025-03-30 11:44:38,058 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0affb019): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 11:44:38,059 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_0affb019)
2025-03-30 11:44:38,064 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b04a4309-d224-4a08-be2f-e092a50d52cc): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 11:44:38,064 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:44:38] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:48:34,870 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/doctor.py', reloading
2025-03-30 11:48:34,946 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:48:35,142 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:48:35,142 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:48:35,142 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:48:35,143 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:48:35,156 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:48:35,156 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:48:35,156 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:48:35,156 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 702af782-ce29-435b-b8f6-dda60210fef9)
2025-03-30 11:48:35,156 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:48:35,156 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: bee42d75-114b-4843-b32e-80fc78cf4c6c)
2025-03-30 11:48:35,156 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:48:35,156 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 97949f11-2c36-4956-9371-76b85ca82b8f)
2025-03-30 11:48:35,156 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:48:35,156 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:48:35,156 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:48:35,157 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:48:35,170 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:48:35,175 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:49:11,474 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/doctor.py', reloading
2025-03-30 11:49:11,555 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:49:11,741 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:49:11,741 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:49:11,741 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:49:11,741 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:49:11,754 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:49:11,754 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:49:11,754 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:49:11,754 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 82cc1558-3591-4082-8a52-dad5026de5fd)
2025-03-30 11:49:11,754 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:49:11,754 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 4f4b828b-0d1b-45bc-84d5-a94424581e35)
2025-03-30 11:49:11,754 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:49:11,754 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 012998da-e6ca-49c9-b9b6-106669a327a9)
2025-03-30 11:49:11,754 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:49:11,754 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:49:11,754 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:49:11,755 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:49:11,768 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:49:11,772 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:49:20,662 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:49:20,662 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 11:49:20,662 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:49:20,662 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 11:49:20,662 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 11:49:20,675 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:49:20,675 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:49:20,675 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:49:20,675 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: f9b7f3e9-e110-401e-8df8-eccd57f3d6f6)
2025-03-30 11:49:20,675 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:49:20,675 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: a506b50f-c848-414c-b451-ca98833bb6d5)
2025-03-30 11:49:20,675 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:49:20,675 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 29e828b4-207a-4953-8106-031ac28bf8a3)
2025-03-30 11:49:20,675 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:49:20,675 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:49:20,675 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:49:20,676 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:49:20,694 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 11:49:20,694 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 11:49:20,694 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:49:20,885 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:49:20,885 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:49:20,885 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:49:20,885 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:49:20,898 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:49:20,898 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:49:20,898 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:49:20,898 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 1b345853-06d8-4bed-927a-dd852ea3ea44)
2025-03-30 11:49:20,898 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:49:20,898 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 9c01bc8a-eb8f-4aa2-8bb2-dfa8da06e03e)
2025-03-30 11:49:20,898 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:49:20,898 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 38cccdbf-339b-4211-b180-4a56f0e9f159)
2025-03-30 11:49:20,898 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:49:20,898 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:49:20,898 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:49:20,898 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:49:20,911 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:49:20,916 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:49:26,312 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:49:26] "GET / HTTP/1.1" 200 -
2025-03-30 11:49:26,325 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:49:26] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 11:49:26,325 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:49:26] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 11:49:26,331 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336
2025-03-30 11:49:26,331 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336
2025-03-30 11:49:26,331 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:49:26] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 11:49:35,549 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336): '肚子疼 男 60...'
2025-03-30 11:49:35,550 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336
2025-03-30 11:49:35,551 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336，视为新对话，转给接待员。
2025-03-30 11:49:35,552 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_1cac882b 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 11:49:35,553 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_1cac882b 不存在，创建新的记忆记录。
2025-03-30 11:49:35,557 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_1cac882b (Name: 网页用户, Age: None)
2025-03-30 11:49:35,561 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336
2025-03-30 11:49:35,565 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336
2025-03-30 11:49:35,565 - Hospital-MultiAgent-System - INFO - 为咨询 web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336 (Patient: WebPatient_1cac882b) 创建新上下文
2025-03-30 11:49:35,565 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336 (Patient: WebPatient_1cac882b)
2025-03-30 11:49:35,571 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 11:49:35,571 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 11:49:35,571 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 肚子疼 男 60

用...
2025-03-30 11:49:36,073 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:49:36,078 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:49:38,255 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:49:38,260 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.18秒
2025-03-30 11:49:38,261 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "medical_inquiry",
  "has_sufficient...
2025-03-30 11:49:38,261 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_1cac882b): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚子疼']
2025-03-30 11:49:38,261 - Hospital-MultiAgent-System - INFO - 意图为医疗咨询且信息充分或已引导，尝试分诊 (Patient: WebPatient_1cac882b)
2025-03-30 11:49:38,261 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.2
2025-03-30 11:49:38,261 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 11:49:38,262 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 11:49:38,265 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:49:38,267 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:49:40,467 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:49:40,469 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.20秒
2025-03-30 11:49:40,469 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "p...
2025-03-30 11:49:40,469 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=priority
2025-03-30 11:49:40,475 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336)，准备触发医生诊断。
2025-03-30 11:49:40,475 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336, Patient: WebPatient_1cac882b)...
2025-03-30 11:49:40,477 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_1cac882b 的诊断请求 (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336)。复诊: False
2025-03-30 11:49:40,477 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 11:49:40,477 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 11:49:40,477 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 11:49:40,479 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:49:40,480 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:49:41,740 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:49:41,745 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.26秒
2025-03-30 11:49:41,746 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：肚子疼的具体部位在哪里？是上腹部、下腹部还是其他区域？
2025-03-30 11:49:41,746 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336 (Patient: WebPatient_1cac882b)
2025-03-30 11:49:41,755 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336)
2025-03-30 11:49:41,755 - Hospital-MultiAgent-System - INFO - 成功转接给医生并获取第一个问题 (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336)
2025-03-30 11:49:41,757 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336): Status=in_progress, Agent=doctor, Msg='肚子疼的具体部位在哪里？是上腹部、下腹部还是其他区域？...'
2025-03-30 11:49:41,758 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:49:41] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:49:48,244 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336): '上腹...'
2025-03-30 11:49:48,244 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336 (Patient: WebPatient_1cac882b), 当前阶段: information_gathering
2025-03-30 11:49:48,244 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336
2025-03-30 11:49:48,251 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_1cac882b 对问题 (Context: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336) 的回答: '上腹...'
2025-03-30 11:49:48,256 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 11:49:48,256 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 11:49:48,256 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "肚子疼的具体...
2025-03-30 11:49:48,258 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:49:48,260 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:49:50,090 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:49:50,095 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.83秒
2025-03-30 11:49:50,095 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["上腹疼痛"],
  "symptom_d...
2025-03-30 11:49:50,097 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_1cac882b 回答分析完成。当前症状: ['60', '上腹疼痛', '肚子疼']. 置信度: 0.45
2025-03-30 11:49:50,097 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_1cac882b (Context: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336) 提出下一个问题。
2025-03-30 11:49:50,097 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 11:49:50,097 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 11:49:50,098 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 11:49:50,106 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:49:50,111 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:49:51,202 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:49:51,207 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.09秒
2025-03-30 11:49:51,208 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是持续的还是间歇性的？
2025-03-30 11:49:51,230 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336): Status=in_progress, Agent=doctor, Msg='疼痛是持续的还是间歇性的？...'
2025-03-30 11:49:51,230 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:49:51] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:49:56,926 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336): '间歇性的...'
2025-03-30 11:49:56,927 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336 (Patient: WebPatient_1cac882b), 当前阶段: information_gathering
2025-03-30 11:49:56,927 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336
2025-03-30 11:49:56,934 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_1cac882b 对问题 (Context: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336) 的回答: '间歇性的...'
2025-03-30 11:49:56,939 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 11:49:56,939 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 11:49:56,940 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是持续的...
2025-03-30 11:49:57,398 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:49:57,403 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:49:59,314 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:49:59,320 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.92秒
2025-03-30 11:49:59,324 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 11:49:59,324 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_1cac882b 回答分析完成。当前症状: ['60', '上腹疼痛', '肚子疼']. 置信度: 0.55
2025-03-30 11:49:59,324 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_1cac882b (Context: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336) 提出下一个问题。
2025-03-30 11:49:59,325 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 11:49:59,325 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 11:49:59,325 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 11:49:59,328 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:49:59,336 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:50:00,423 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:50:00,427 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.09秒
2025-03-30 11:50:00,427 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛发作时是否伴有其他症状，例如恶心、呕吐、腹胀、食欲减退或排便异常？
2025-03-30 11:50:00,454 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336): Status=in_progress, Agent=doctor, Msg='疼痛发作时是否伴有其他症状，例如恶心、呕吐、腹胀、食欲减退或排便异常？...'
2025-03-30 11:50:00,455 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:50:00] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:50:05,952 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336): '恶心...'
2025-03-30 11:50:05,952 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336 (Patient: WebPatient_1cac882b), 当前阶段: information_gathering
2025-03-30 11:50:05,952 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336
2025-03-30 11:50:05,956 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_1cac882b 对问题 (Context: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336) 的回答: '恶心...'
2025-03-30 11:50:05,960 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 11:50:05,960 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 11:50:05,961 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛发作时是...
2025-03-30 11:50:05,962 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:50:05,963 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:50:08,409 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:50:08,414 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.45秒
2025-03-30 11:50:08,414 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["恶心"],
  "symptom_det...
2025-03-30 11:50:08,414 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_1cac882b 回答分析完成。当前症状: ['60', '上腹疼痛', '恶心', '肚子疼']. 置信度: 0.65
2025-03-30 11:50:08,414 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_1cac882b (Context: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336) 提出下一个问题。
2025-03-30 11:50:08,414 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 11:50:08,415 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 11:50:08,415 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 11:50:08,419 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:50:08,423 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:50:09,332 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:50:09,336 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.91秒
2025-03-30 11:50:09,336 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否与进食有关？例如，饭前、饭后或某些特定食物会加重或缓解疼痛吗？
2025-03-30 11:50:09,361 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336): Status=in_progress, Agent=doctor, Msg='疼痛是否与进食有关？例如，饭前、饭后或某些特定食物会加重或缓解疼痛吗？...'
2025-03-30 11:50:09,364 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:50:09] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:50:14,871 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336): '饭后...'
2025-03-30 11:50:14,871 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336 (Patient: WebPatient_1cac882b), 当前阶段: information_gathering
2025-03-30 11:50:14,872 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336
2025-03-30 11:50:14,877 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_1cac882b 对问题 (Context: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336) 的回答: '饭后...'
2025-03-30 11:50:14,882 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 11:50:14,882 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 11:50:14,882 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否与进...
2025-03-30 11:50:15,473 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:50:15,628 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:50:17,479 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:50:17,485 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.86秒
2025-03-30 11:50:17,485 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 11:50:17,485 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_1cac882b 回答分析完成。当前症状: ['60', '上腹疼痛', '恶心', '肚子疼']. 置信度: 0.75
2025-03-30 11:50:17,485 - Hospital-MultiAgent-System - INFO - 可以诊断：问题数 4 >= 4 且置信度 0.75 > 0.4
2025-03-30 11:50:17,486 - Hospital-MultiAgent-System - INFO - 医生 主治医生 可以为患者 WebPatient_1cac882b (Context: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336) 做出诊断。
2025-03-30 11:50:17,486 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：600，温度：0.3
2025-03-30 11:50:17,486 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位资深医生，正在进行诊断。请给出专业、详细且结构化的诊断结果（JSON格式）。
2025-03-30 11:50:17,486 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医生，请根据以下信息生成诊断结果：
症状：60, 上腹疼痛, 恶心, 肚子疼
病史：无
科室...
2025-03-30 11:50:17,490 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:50:17,495 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:50:22,848 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:50:22,855 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：5.36秒
2025-03-30 11:50:22,856 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "胃炎或消化性溃疡",
  "explanatio...
2025-03-30 11:50:22,856 - Hospital-MultiAgent-System - INFO - 为症状 '60, 上腹疼痛, 恶心, 肚子疼' 生成诊断结果：胃炎或消化性溃疡
2025-03-30 11:50:22,861 - Hospital-MultiAgent-System - INFO - 删除问诊上下文: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336 (Patient: WebPatient_1cac882b)
2025-03-30 11:50:22,872 - Hospital-MultiAgent-System - INFO - 诊断完成，自动触发处方审核 (Patient: WebPatient_1cac882b, Context: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336)
2025-03-30 11:50:22,873 - Hospital-MultiAgent-System - INFO - 向药剂师发送处方审核请求 (Patient: WebPatient_1cac882b)...
2025-03-30 11:50:22,878 - Hospital-MultiAgent-System - INFO - 药剂师 药剂师 正在审核患者 WebPatient_1cac882b 的处方...
2025-03-30 11:50:22,878 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：400，温度：0.1
2025-03-30 11:50:22,879 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富、极其严谨的临床药剂师，负责审核处方的安全性和合理性。请仔细检查每一个细节并提供结构...
2025-03-30 11:50:22,879 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位资深临床药剂师，请严格审核以下处方的合理性、安全性及潜在风险:

处方信息:
- 质子泵抑制...
2025-03-30 11:50:22,881 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 11:50:22,882 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 11:50:31,654 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 11:50:31,659 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：8.78秒
2025-03-30 11:50:31,660 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "valid": false,
  "issues": [
    "质子泵...
2025-03-30 11:50:31,660 - Hospital-MultiAgent-System - ERROR - LLM处方审核过程发生错误: Unterminated string starting at: line 17 column 5 (char 497). Raw response: ```json
{
  "valid": false,
  "issues": [
    "质子泵抑制剂（如奥美拉唑）的频率未明确，需明确每日服用次数。",
    "质子泵抑制剂的疗程未指定，需明确疗程长度以确保安全性和疗效。",
    "抗酸药（如铝碳酸镁）的疗程未指定，需明确疗程长度以避免长期使用可能导致的不良反应。",
    "幽门螺杆菌根除疗法的频率和疗程未明确，需补充具体方案（如三联疗法的药物组合、剂量、频率和疗程）。"
  ],
  "warnings": [
    "质子泵抑制剂与抗酸药可能存在药物相互作用，抗酸药可能影响质子泵抑制剂的吸收效果，需注意服药时间间隔。",
    "长期使用抗酸药可能导致电解质紊乱或便秘，需监测患者情况。",
    "幽门螺杆菌根除疗法可能涉及抗生素，需注意抗生素相关的不良反应（如胃肠道不适、抗生素耐药风险）。"
  ],
  "recommendations": [
    "明确质子泵抑制剂的具体服用频率（如每日一次或每日两次）和疗程（如4周或8周）。",
    "明确抗酸药的疗程长度（如2周或根据症状缓解情况调整）。",
    "补充幽门螺杆菌根除疗法的具体方案，包括药物组合（如奥美拉唑+克拉霉素+阿莫西林）、剂量、频率
2025-03-30 11:50:31,669 - Hospital-MultiAgent-System - WARNING - 患者 WebPatient_1cac882b 的处方未通过审核: 系统审核时发生错误，无法完成验证
2025-03-30 11:50:31,679 - Hospital-MultiAgent-System - INFO - 处方审核请求已发送给药剂师 (Patient: WebPatient_1cac882b)。
2025-03-30 11:50:31,679 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336
2025-03-30 11:50:31,679 - Hospital-MultiAgent-System - WARNING - 无法更新已结束的上下文 web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336 为 prescription_review 阶段
2025-03-30 11:50:31,686 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_ddc8b807-e207-4ab3-a2ec-c51ef54dd336): Status=prescription_pending, Agent=doctor, Msg='感谢您的配合。根据您提供的信息，我已完成初步诊断。
处方已提交药剂师审核，您可以就处方提问或结束咨询...'
2025-03-30 11:50:31,687 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:50:31] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 11:53:29,748 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 11:53:29,812 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:53:30,033 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:53:30,033 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:53:30,033 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:53:30,033 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:53:30,046 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:53:30,046 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:53:30,047 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:53:30,047 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: c5656b6f-5056-4a60-ac58-3f48c41e55c9)
2025-03-30 11:53:30,047 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:53:30,047 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 18190b05-a54e-4cdd-9184-ebddd6c1b1d9)
2025-03-30 11:53:30,047 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:53:30,047 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: d60a6e4b-2a53-43e4-8b34-e2c46c4db692)
2025-03-30 11:53:30,047 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:53:30,047 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:53:30,047 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:53:30,047 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:53:30,062 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:53:30,066 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:54:15,383 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/pharmacist.py', reloading
2025-03-30 11:54:15,446 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:55:51,655 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:55:51,656 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 11:55:51,656 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:55:51,656 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 11:55:51,656 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 11:55:51,668 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:55:51,668 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:55:51,669 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:55:51,669 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 8036f71a-9244-4c75-8797-2a22e4340b9d)
2025-03-30 11:55:51,669 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:55:51,669 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: b42ddf22-c7bf-437f-ba88-b6b62bc20fa3)
2025-03-30 11:55:51,669 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:55:51,669 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: f1cc69fe-0547-490c-b976-4c6abad9ec96)
2025-03-30 11:55:51,669 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:55:51,669 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:55:51,669 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:55:51,669 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:55:51,687 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 11:55:51,687 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 11:55:51,687 - werkzeug - INFO -  * Restarting with stat
2025-03-30 11:55:51,871 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 11:55:51,871 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 11:55:51,872 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 11:55:51,872 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 11:55:51,884 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 11:55:51,884 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 11:55:51,885 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 11:55:51,885 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: a303dd0e-87c1-477b-a85f-06a4fa3f2011)
2025-03-30 11:55:51,885 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 11:55:51,885 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 2cb5df00-3825-4884-a00b-b000ef30e763)
2025-03-30 11:55:51,885 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 11:55:51,885 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 394684e3-1439-4c48-8f12-8de2fcee241c)
2025-03-30 11:55:51,885 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 11:55:51,885 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 11:55:51,885 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 11:55:51,885 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 11:55:51,898 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 11:55:51,902 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 11:55:58,311 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:55:58] "GET / HTTP/1.1" 200 -
2025-03-30 11:55:58,326 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:55:58] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 11:55:58,326 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:55:58] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 11:56:07,210 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:56:07] "GET / HTTP/1.1" 200 -
2025-03-30 11:56:07,220 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:56:07] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 11:56:07,220 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 11:56:07] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:01:59,816 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:01:59] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:02:07,471 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:02:07] "GET / HTTP/1.1" 200 -
2025-03-30 12:02:07,481 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:02:07] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 12:02:07,483 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:02:07] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 12:02:08,289 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:02:08] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-03-30 12:02:13,915 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:02:13] "GET / HTTP/1.1" 200 -
2025-03-30 12:02:13,924 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:02:13] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:02:13,926 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:02:13] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 12:02:21,425 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 12:02:21,425 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 12:02:21,425 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 12:02:21,425 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 12:02:21,425 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 12:02:21,438 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 12:02:21,438 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 12:02:21,438 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 12:02:21,438 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: aba409cd-b109-446b-ae30-f84d302047e0)
2025-03-30 12:02:21,438 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 12:02:21,438 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: a2a0a3c1-9745-4a05-9bca-c44a5104abb4)
2025-03-30 12:02:21,438 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 12:02:21,438 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 67ce9f1e-fd17-49e6-bc8b-14304240d983)
2025-03-30 12:02:21,438 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 12:02:21,438 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 12:02:21,438 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 12:02:21,439 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 12:02:21,458 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 12:02:21,458 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 12:02:21,458 - werkzeug - INFO -  * Restarting with stat
2025-03-30 12:02:21,639 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 12:02:21,639 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 12:02:21,639 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 12:02:21,639 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 12:02:21,652 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 12:02:21,652 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 12:02:21,652 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 12:02:21,652 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 692e0e8e-3bcc-4fe8-9b3e-5bd62be8a200)
2025-03-30 12:02:21,652 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 12:02:21,652 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 43d9ba6a-f82f-48b2-82c1-662cea58d1c0)
2025-03-30 12:02:21,653 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 12:02:21,653 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: b431b917-72f4-4fd9-8c8c-598537c14f29)
2025-03-30 12:02:21,653 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 12:02:21,653 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 12:02:21,653 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 12:02:21,653 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 12:02:21,665 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 12:02:21,669 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 12:03:35,716 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:03:35] "GET / HTTP/1.1" 200 -
2025-03-30 12:03:35,730 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:03:35] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 12:03:35,731 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:03:35] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:08:25,587 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 12:08:25,587 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 12:08:25,587 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 12:08:25,587 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 12:08:25,587 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 12:08:25,600 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 12:08:25,600 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 12:08:25,600 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 12:08:25,600 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: b0fe3624-61bb-4766-a7c6-e1507d7fc577)
2025-03-30 12:08:25,600 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 12:08:25,600 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: b0978179-f7d6-4a62-951c-73aa06d82f55)
2025-03-30 12:08:25,600 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 12:08:25,600 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: cf0e61da-8317-4bc4-b060-950aeefc617c)
2025-03-30 12:08:25,600 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 12:08:25,600 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 12:08:25,600 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 12:08:25,601 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 12:08:25,617 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 12:08:25,617 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 12:08:25,617 - werkzeug - INFO -  * Restarting with stat
2025-03-30 12:08:25,800 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 12:08:25,800 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 12:08:25,800 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 12:08:25,800 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 12:08:25,813 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 12:08:25,813 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 12:08:25,813 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 12:08:25,813 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 54e3cefe-c1c7-4099-99f9-58fd5a464b25)
2025-03-30 12:08:25,813 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 12:08:25,813 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: d4e4d8c9-c6c6-4846-98d9-74f93696babe)
2025-03-30 12:08:25,813 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 12:08:25,814 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 8c7a2fd4-96d9-442b-b5bb-3f2e9d5a4b04)
2025-03-30 12:08:25,814 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 12:08:25,814 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 12:08:25,814 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 12:08:25,814 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 12:08:25,827 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 12:08:25,832 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 12:08:31,603 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:08:31] "GET / HTTP/1.1" 200 -
2025-03-30 12:08:31,617 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:08:31] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:08:31,617 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:08:31] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 12:10:54,944 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 12:10:54,944 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 12:10:54,944 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 12:10:54,944 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 12:10:54,944 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 12:10:54,956 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 12:10:54,956 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 12:10:54,957 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 12:10:54,957 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: a913a206-c304-494c-bb14-2326e227ca7f)
2025-03-30 12:10:54,957 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 12:10:54,957 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 584d8681-b69f-493f-888f-2ac2e54cbc32)
2025-03-30 12:10:54,957 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 12:10:54,957 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 15718143-7319-440c-857e-1fe482c9ece6)
2025-03-30 12:10:54,957 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 12:10:54,957 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 12:10:54,957 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 12:10:54,957 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 12:10:54,977 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 12:10:54,977 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 12:10:54,977 - werkzeug - INFO -  * Restarting with stat
2025-03-30 12:10:55,162 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 12:10:55,162 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 12:10:55,162 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 12:10:55,162 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 12:10:55,175 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 12:10:55,175 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 12:10:55,175 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 12:10:55,175 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: a558ed6d-f426-46a5-883c-ce785ecdc82f)
2025-03-30 12:10:55,175 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 12:10:55,175 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 562e5ef7-73b8-4b36-ad75-f6bd1d1ae9f6)
2025-03-30 12:10:55,175 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 12:10:55,175 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 66e510a7-f868-43c4-b5b8-d6106c2bb36d)
2025-03-30 12:10:55,175 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 12:10:55,175 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 12:10:55,175 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 12:10:55,176 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 12:10:55,188 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 12:10:55,193 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 12:11:04,941 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:11:04] "GET / HTTP/1.1" 200 -
2025-03-30 12:11:04,957 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:11:04] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 12:11:04,957 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:11:04] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:13:46,940 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 12:13:46,940 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 12:13:46,940 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 12:13:46,940 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 12:13:46,940 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 12:13:46,953 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 12:13:46,953 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 12:13:46,954 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 12:13:46,954 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: d188a247-9a1c-4536-b6e2-6a6348e1b04b)
2025-03-30 12:13:46,954 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 12:13:46,954 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 1d054184-0d99-49d0-b507-86ba654c9d6d)
2025-03-30 12:13:46,954 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 12:13:46,954 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 7d4899b6-706b-494e-b667-2e10a785243d)
2025-03-30 12:13:46,954 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 12:13:46,954 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 12:13:46,954 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 12:13:46,954 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 12:13:46,970 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 12:13:46,970 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 12:13:46,970 - werkzeug - INFO -  * Restarting with stat
2025-03-30 12:13:47,154 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 12:13:47,154 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 12:13:47,154 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 12:13:47,154 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 12:13:47,166 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 12:13:47,166 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 12:13:47,167 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 12:13:47,167 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 337ccd0c-c7e8-46b2-bfb9-8051188252b0)
2025-03-30 12:13:47,167 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 12:13:47,167 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: c4764df0-3f3b-4f75-98bd-4b079f5e3fd3)
2025-03-30 12:13:47,167 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 12:13:47,167 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 7d0a317a-953a-404e-8b69-25435deb2671)
2025-03-30 12:13:47,167 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 12:13:47,167 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 12:13:47,167 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 12:13:47,167 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 12:13:47,179 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 12:13:47,184 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 12:13:54,821 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:54] "GET / HTTP/1.1" 200 -
2025-03-30 12:13:54,834 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:54] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:13:54,834 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:54] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 12:13:55,762 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:55] "GET / HTTP/1.1" 200 -
2025-03-30 12:13:55,773 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:55] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 12:13:55,776 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:55] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:13:55,945 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:55] "GET / HTTP/1.1" 200 -
2025-03-30 12:13:55,953 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:55] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:13:55,954 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:55] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 12:13:56,960 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:56] "GET / HTTP/1.1" 200 -
2025-03-30 12:13:56,971 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:56] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:13:56,971 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:56] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 12:13:57,120 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:57] "GET / HTTP/1.1" 200 -
2025-03-30 12:13:57,127 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:57] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:13:57,129 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:13:57] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 12:14:01,044 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:14:01] "GET / HTTP/1.1" 200 -
2025-03-30 12:14:01,056 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:14:01] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:14:01,057 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:14:01] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 12:26:34,210 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 12:26:34,210 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 12:26:34,210 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 12:26:34,210 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 12:26:34,210 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 12:26:34,223 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 12:26:34,223 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 12:26:34,223 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 12:26:34,223 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 4d091d10-3749-484a-9af5-bd64314f1ac3)
2025-03-30 12:26:34,223 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 12:26:34,223 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: cb29965a-6e51-422e-b9a0-d2f392faab10)
2025-03-30 12:26:34,223 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 12:26:34,223 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 0f9b487c-68d6-42b2-92bb-bac40afdc86b)
2025-03-30 12:26:34,223 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 12:26:34,223 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 12:26:34,223 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 12:26:34,224 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 12:26:34,245 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 12:26:34,245 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 12:26:34,246 - werkzeug - INFO -  * Restarting with stat
2025-03-30 12:26:34,427 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 12:26:34,427 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 12:26:34,427 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 12:26:34,427 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 12:26:34,439 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 12:26:34,440 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 12:26:34,440 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 12:26:34,440 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 8bbaa1ca-f3eb-4284-81e8-73812f0d8e36)
2025-03-30 12:26:34,440 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 12:26:34,440 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: c177531a-91e0-4725-9d0c-e2d903c8bc4f)
2025-03-30 12:26:34,440 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 12:26:34,440 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 2cfbe866-0108-4342-98e8-2a6094819d46)
2025-03-30 12:26:34,440 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 12:26:34,440 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 12:26:34,440 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 12:26:34,440 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 12:26:34,454 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 12:26:34,458 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 12:26:38,990 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:38] "GET / HTTP/1.1" 200 -
2025-03-30 12:26:39,004 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:39] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:26:39,004 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:39] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 12:26:40,237 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:40] "GET / HTTP/1.1" 200 -
2025-03-30 12:26:40,244 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:40] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:26:40,247 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:40] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 12:26:40,969 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:40] "GET / HTTP/1.1" 200 -
2025-03-30 12:26:40,977 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:40] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:26:40,978 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:40] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 12:26:41,138 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:41] "GET / HTTP/1.1" 200 -
2025-03-30 12:26:41,144 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:41] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:26:41,146 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:41] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 12:26:41,289 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:41] "GET / HTTP/1.1" 200 -
2025-03-30 12:26:41,295 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:41] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:26:41,297 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:26:41] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 12:37:05,065 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 12:37:05,065 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 12:37:05,065 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 12:37:05,065 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 12:37:05,065 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 12:37:05,078 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 12:37:05,078 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 12:37:05,079 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 12:37:05,079 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: f6b4af6f-b637-4905-bfeb-d23b4594b247)
2025-03-30 12:37:05,079 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 12:37:05,079 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: fa783393-f0b0-4562-95ee-9937b397acf1)
2025-03-30 12:37:05,079 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 12:37:05,079 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: f962a16c-b14c-4ddd-82d1-068e3421e4f8)
2025-03-30 12:37:05,079 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 12:37:05,079 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 12:37:05,079 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 12:37:05,079 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 12:37:05,098 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 12:37:05,099 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 12:37:05,099 - werkzeug - INFO -  * Restarting with stat
2025-03-30 12:37:05,285 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 12:37:05,285 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 12:37:05,285 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 12:37:05,285 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 12:37:05,300 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 12:37:05,300 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 12:37:05,300 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 12:37:05,300 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: a9a047e7-a147-4e0b-8b8e-cc7838969680)
2025-03-30 12:37:05,300 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 12:37:05,300 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: c4bd7dd2-551e-469b-b05c-9cc012a1b2e3)
2025-03-30 12:37:05,300 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 12:37:05,300 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: dd36095a-9280-4d49-8e74-82b5f259befd)
2025-03-30 12:37:05,300 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 12:37:05,300 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 12:37:05,300 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 12:37:05,301 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 12:37:05,313 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 12:37:05,318 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 12:37:09,814 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:37:09] "GET / HTTP/1.1" 200 -
2025-03-30 12:37:09,828 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:37:09] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 12:37:09,829 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:37:09] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 12:37:09,834 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7
2025-03-30 12:37:09,835 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7
2025-03-30 12:37:09,836 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:37:09] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 12:37:23,699 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7): '肚子疼 60 男...'
2025-03-30 12:37:23,699 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7
2025-03-30 12:37:23,699 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7，视为新对话，转给接待员。
2025-03-30 12:37:23,700 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_30787a5c 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 12:37:23,700 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_30787a5c 不存在，创建新的记忆记录。
2025-03-30 12:37:23,707 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_30787a5c (Name: 网页用户, Age: None)
2025-03-30 12:37:23,711 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7
2025-03-30 12:37:23,715 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7
2025-03-30 12:37:23,715 - Hospital-MultiAgent-System - INFO - 为咨询 web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7 (Patient: WebPatient_30787a5c) 创建新上下文
2025-03-30 12:37:23,715 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7 (Patient: WebPatient_30787a5c)
2025-03-30 12:37:23,723 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 12:37:23,723 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 12:37:23,723 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 肚子疼 60 男

用...
2025-03-30 12:37:24,230 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 12:37:24,233 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 12:37:25,958 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 12:37:25,963 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.73秒
2025-03-30 12:37:25,963 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "medical_inquiry",
  "has_sufficient...
2025-03-30 12:37:25,963 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_30787a5c): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚子疼']
2025-03-30 12:37:25,964 - Hospital-MultiAgent-System - INFO - 意图为医疗咨询且信息充分或已引导，尝试分诊 (Patient: WebPatient_30787a5c)
2025-03-30 12:37:25,964 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.2
2025-03-30 12:37:25,964 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 12:37:25,964 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 12:37:25,966 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 12:37:25,969 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 12:37:27,220 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 12:37:27,225 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.26秒
2025-03-30 12:37:27,225 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "p...
2025-03-30 12:37:27,226 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=priority
2025-03-30 12:37:27,232 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7)，准备触发医生诊断。
2025-03-30 12:37:27,232 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7, Patient: WebPatient_30787a5c)...
2025-03-30 12:37:27,235 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_30787a5c 的诊断请求 (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7)。复诊: False
2025-03-30 12:37:27,235 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 12:37:27,235 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 12:37:27,235 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 12:37:27,237 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 12:37:27,241 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 12:37:28,613 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 12:37:28,614 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.37秒
2025-03-30 12:37:28,615 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：肚子疼的具体部位在哪里？是上腹部、下腹部还是其他区域？
2025-03-30 12:37:28,615 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7 (Patient: WebPatient_30787a5c)
2025-03-30 12:37:28,626 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7)
2025-03-30 12:37:28,626 - Hospital-MultiAgent-System - INFO - 成功转接给医生并获取第一个问题 (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7)
2025-03-30 12:37:28,628 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7): Status=in_progress, Agent=doctor, Msg='肚子疼的具体部位在哪里？是上腹部、下腹部还是其他区域？...'
2025-03-30 12:37:28,629 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:37:28] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 12:37:33,868 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7): '上腹...'
2025-03-30 12:37:33,868 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7 (Patient: WebPatient_30787a5c), 当前阶段: information_gathering
2025-03-30 12:37:33,869 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7
2025-03-30 12:37:33,876 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_30787a5c 对问题 (Context: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7) 的回答: '上腹...'
2025-03-30 12:37:33,882 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 12:37:33,882 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 12:37:33,882 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "肚子疼的具体...
2025-03-30 12:37:33,883 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 12:37:33,884 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 12:37:36,746 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 12:37:36,753 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.87秒
2025-03-30 12:37:36,753 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 12:37:36,753 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_30787a5c 回答分析完成。当前症状: ['60', '肚子疼']. 置信度: 0.40
2025-03-30 12:37:36,754 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_30787a5c (Context: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7) 提出下一个问题。
2025-03-30 12:37:36,754 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 12:37:36,754 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 12:37:36,754 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 12:37:36,760 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 12:37:36,764 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 12:37:37,833 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 12:37:37,838 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.07秒
2025-03-30 12:37:37,838 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是突然发生的还是逐渐加重的？
2025-03-30 12:37:37,866 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7): Status=in_progress, Agent=doctor, Msg='疼痛是突然发生的还是逐渐加重的？...'
2025-03-30 12:37:37,866 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:37:37] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 12:37:43,960 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7): '突然发生的...'
2025-03-30 12:37:43,961 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7 (Patient: WebPatient_30787a5c), 当前阶段: information_gathering
2025-03-30 12:37:43,961 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7
2025-03-30 12:37:43,972 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_30787a5c 对问题 (Context: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7) 的回答: '突然发生的...'
2025-03-30 12:37:43,978 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 12:37:43,978 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 12:37:43,978 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是突然发...
2025-03-30 12:37:44,517 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 12:37:44,521 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 12:37:47,080 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 12:37:47,085 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.56秒
2025-03-30 12:37:47,085 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 12:37:47,086 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_30787a5c 回答分析完成。当前症状: ['60', '肚子疼']. 置信度: 0.50
2025-03-30 12:37:47,086 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_30787a5c (Context: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7) 提出下一个问题。
2025-03-30 12:37:47,086 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 12:37:47,086 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 12:37:47,086 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 12:37:47,092 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 12:37:47,095 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 12:37:47,967 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 12:37:47,972 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.88秒
2025-03-30 12:37:47,972 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否伴随恶心、呕吐或食欲减退的症状？
2025-03-30 12:37:47,993 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7): Status=in_progress, Agent=doctor, Msg='疼痛是否伴随恶心、呕吐或食欲减退的症状？...'
2025-03-30 12:37:47,994 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:37:47] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 12:37:52,365 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7): '恶心...'
2025-03-30 12:37:52,366 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7 (Patient: WebPatient_30787a5c), 当前阶段: information_gathering
2025-03-30 12:37:52,366 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7
2025-03-30 12:37:52,374 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_30787a5c 对问题 (Context: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7) 的回答: '恶心...'
2025-03-30 12:37:52,379 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 12:37:52,379 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 12:37:52,379 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否伴随...
2025-03-30 12:37:52,380 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 12:37:52,382 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 12:37:53,905 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 12:37:53,914 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.53秒
2025-03-30 12:37:53,916 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["恶心"],
  "symptom_det...
2025-03-30 12:37:53,916 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_30787a5c 回答分析完成。当前症状: ['60', '恶心', '肚子疼']. 置信度: 0.60
2025-03-30 12:37:53,916 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_30787a5c (Context: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7) 提出下一个问题。
2025-03-30 12:37:53,916 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 12:37:53,916 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 12:37:53,916 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 12:37:53,918 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 12:37:53,926 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 12:37:55,034 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 12:37:55,041 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.11秒
2025-03-30 12:37:55,041 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否与进食有关？比如，进食后加重还是缓解？
2025-03-30 12:37:55,064 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7): Status=in_progress, Agent=doctor, Msg='疼痛是否与进食有关？比如，进食后加重还是缓解？...'
2025-03-30 12:37:55,065 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:37:55] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 12:38:04,299 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7): '进食加重...'
2025-03-30 12:38:04,299 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7 (Patient: WebPatient_30787a5c), 当前阶段: information_gathering
2025-03-30 12:38:04,299 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7
2025-03-30 12:38:04,306 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_30787a5c 对问题 (Context: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7) 的回答: '进食加重...'
2025-03-30 12:38:04,310 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 12:38:04,310 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 12:38:04,311 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否与进...
2025-03-30 12:38:04,443 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 12:38:04,447 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 12:38:06,809 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 12:38:06,814 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.37秒
2025-03-30 12:38:06,816 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 12:38:06,817 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_30787a5c 回答分析完成。当前症状: ['60', '恶心', '肚子疼']. 置信度: 0.70
2025-03-30 12:38:06,817 - Hospital-MultiAgent-System - INFO - 可以诊断：问题数 4 >= 4 且置信度 0.70 > 0.4
2025-03-30 12:38:06,817 - Hospital-MultiAgent-System - INFO - 医生 主治医生 可以为患者 WebPatient_30787a5c (Context: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7) 做出诊断。
2025-03-30 12:38:06,817 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：600，温度：0.3
2025-03-30 12:38:06,817 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位资深医生，正在进行诊断。请给出专业、详细且结构化的诊断结果（JSON格式）。
2025-03-30 12:38:06,817 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医生，请根据以下信息生成诊断结果：
症状：60, 恶心, 肚子疼
病史：无
科室：消化内科
...
2025-03-30 12:38:06,822 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 12:38:06,827 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 12:38:12,033 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 12:38:12,037 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：5.21秒
2025-03-30 12:38:12,038 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "急性胃肠炎",
  "explanation":...
2025-03-30 12:38:12,038 - Hospital-MultiAgent-System - INFO - 为症状 '60, 恶心, 肚子疼' 生成诊断结果：急性胃肠炎
2025-03-30 12:38:12,044 - Hospital-MultiAgent-System - INFO - 删除问诊上下文: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7 (Patient: WebPatient_30787a5c)
2025-03-30 12:38:12,049 - Hospital-MultiAgent-System - INFO - 诊断完成，同步触发处方审核 (Patient: WebPatient_30787a5c, Context: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7)
2025-03-30 12:38:12,049 - Hospital-MultiAgent-System - INFO - 向药剂师发送处方审核请求 (Patient: WebPatient_30787a5c)...
2025-03-30 12:38:12,051 - Hospital-MultiAgent-System - INFO - 药剂师 药剂师 正在审核患者 WebPatient_30787a5c 的处方...
2025-03-30 12:38:12,051 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：700，温度：0.1
2025-03-30 12:38:12,051 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富、极其严谨的临床药剂师...请仔细检查每一个细节并提供结构化的JSON反馈。
2025-03-30 12:38:12,051 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位资深临床药剂师，请严格审核以下处方的合理性、安全性及潜在风险: ... (省略完整 prom...
2025-03-30 12:38:12,054 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 12:38:12,055 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 12:38:13,709 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 12:38:13,713 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.66秒
2025-03-30 12:38:13,713 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：请提供完整的处方信息，包括药物名称、剂量、给药途径、频率、患者年龄、性别、体重、病史、肾功能、肝功能...
2025-03-30 12:38:13,714 - Hospital-MultiAgent-System - ERROR - 解析处方审核LLM响应失败: Expecting value: line 1 column 1 (char 0). Raw response: 请提供完整的处方信息，包括药物名称、剂量、给药途径、频率、患者年龄、性别、体重、病史、肾功能、肝功能、过敏史以及其他相关信息。我需要这些详细数据才能进行全面审核并提供结构化的反馈。
2025-03-30 12:38:13,720 - Hospital-MultiAgent-System - WARNING - 患者 WebPatient_30787a5c 的处方未通过审核: 系统解析审核结果失败
2025-03-30 12:38:13,723 - Hospital-MultiAgent-System - INFO - 收到药剂师审核响应 (Patient: WebPatient_30787a5c)。Status: rejected
2025-03-30 12:38:13,723 - Hospital-MultiAgent-System - WARNING - 处方审核被拒绝 (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7): ['系统解析审核结果失败']
2025-03-30 12:38:13,723 - Hospital-MultiAgent-System - WARNING - 尝试删除不存在的问诊上下文: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7
2025-03-30 12:38:13,723 - Hospital-MultiAgent-System - INFO - Web 咨询 web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7 已达到结束状态: error_prescription_rejected
2025-03-30 12:38:13,726 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7): Status=error_prescription_rejected, Agent=doctor, Msg='感谢您的配合。根据您提供的信息，我已完成初步诊断。
处方审核未通过: 系统解析审核结果失败。请医生复...'
2025-03-30 12:38:13,726 - Hospital-MultiAgent-System-Web - INFO - Web 咨询 web_e174a2dc-432d-4ec0-af77-9a8beab5d8d7 已达到结束状态: error_prescription_rejected
2025-03-30 12:38:13,726 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 12:38:13] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 13:13:50,600 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 13:13:50,600 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 13:13:50,600 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 13:13:50,600 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 13:13:50,600 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 13:13:50,612 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 13:13:50,612 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 13:13:50,613 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 13:13:50,613 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: a7ca57d0-bf67-4c4d-a919-17b91faf4d2c)
2025-03-30 13:13:50,613 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 13:13:50,613 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 61c4433f-899b-443e-bb1d-b97ff934fc73)
2025-03-30 13:13:50,613 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 13:13:50,613 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: b705bceb-b8b0-41a3-8a31-e2b5da58fc41)
2025-03-30 13:13:50,613 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 13:13:50,613 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 13:13:50,613 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 13:13:50,613 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 13:13:50,630 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 13:13:50,631 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 13:13:50,631 - werkzeug - INFO -  * Restarting with stat
2025-03-30 13:13:50,816 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 13:13:50,816 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 13:13:50,816 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 13:13:50,816 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 13:13:50,828 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 13:13:50,828 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 13:13:50,829 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 13:13:50,829 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 93810699-4fb2-4e6f-b542-1a2e0bf85c39)
2025-03-30 13:13:50,829 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 13:13:50,829 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 5900ca6e-dfbb-4cd0-ab2e-eb1277064248)
2025-03-30 13:13:50,829 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 13:13:50,829 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 4c5b078d-4aef-474f-8002-2300117cb848)
2025-03-30 13:13:50,829 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 13:13:50,829 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 13:13:50,829 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 13:13:50,829 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 13:13:50,842 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 13:13:50,847 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 13:14:14,457 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:14:14] "GET / HTTP/1.1" 200 -
2025-03-30 13:14:14,474 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:14:14] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 13:14:14,474 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:14:14] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 13:14:14,484 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_c3f18f0b-17c4-47bb-88be-0322119b9778
2025-03-30 13:14:14,484 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_c3f18f0b-17c4-47bb-88be-0322119b9778
2025-03-30 13:14:14,485 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:14:14] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 13:14:24,271 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778): '肚子疼 60 男...'
2025-03-30 13:14:24,272 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_c3f18f0b-17c4-47bb-88be-0322119b9778
2025-03-30 13:14:24,272 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_c3f18f0b-17c4-47bb-88be-0322119b9778，视为新对话，转给接待员。
2025-03-30 13:14:24,273 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_9e8a426f 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 13:14:24,273 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_9e8a426f 不存在，创建新的记忆记录。
2025-03-30 13:14:24,279 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_9e8a426f (Name: 网页用户, Age: None)
2025-03-30 13:14:24,284 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778
2025-03-30 13:14:24,289 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_c3f18f0b-17c4-47bb-88be-0322119b9778
2025-03-30 13:14:24,290 - Hospital-MultiAgent-System - INFO - 为咨询 web_c3f18f0b-17c4-47bb-88be-0322119b9778 (Patient: WebPatient_9e8a426f) 创建新上下文
2025-03-30 13:14:24,290 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_c3f18f0b-17c4-47bb-88be-0322119b9778 (Patient: WebPatient_9e8a426f)
2025-03-30 13:14:24,299 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 13:14:24,300 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 13:14:24,300 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 肚子疼 60 男

用...
2025-03-30 13:14:25,641 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:14:25,646 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:14:28,070 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:14:28,079 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.43秒
2025-03-30 13:14:28,079 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "medical_inquiry",
  "has_sufficient...
2025-03-30 13:14:28,080 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_9e8a426f): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚子疼']
2025-03-30 13:14:28,080 - Hospital-MultiAgent-System - INFO - 意图为医疗咨询且信息充分或已引导，尝试分诊 (Patient: WebPatient_9e8a426f)
2025-03-30 13:14:28,080 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.2
2025-03-30 13:14:28,081 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 13:14:28,081 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 13:14:28,086 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:14:28,090 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:14:29,823 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:14:29,828 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.74秒
2025-03-30 13:14:29,828 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "p...
2025-03-30 13:14:29,829 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=priority
2025-03-30 13:14:29,849 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778)，准备触发医生诊断。
2025-03-30 13:14:29,849 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778, Patient: WebPatient_9e8a426f)...
2025-03-30 13:14:29,853 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_9e8a426f 的诊断请求 (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778)。复诊: False
2025-03-30 13:14:29,853 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 13:14:29,853 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 13:14:29,853 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 13:14:29,856 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:14:29,857 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:14:31,549 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:14:31,556 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.70秒
2025-03-30 13:14:31,556 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：肚子疼的具体部位在哪里？是上腹部、下腹部，还是整个腹部都疼？
2025-03-30 13:14:31,556 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_c3f18f0b-17c4-47bb-88be-0322119b9778 (Patient: WebPatient_9e8a426f)
2025-03-30 13:14:31,582 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778)
2025-03-30 13:14:31,582 - Hospital-MultiAgent-System - INFO - 成功转接给医生并获取第一个问题 (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778)
2025-03-30 13:14:31,585 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778): Status=in_progress, Agent=doctor, Msg='肚子疼的具体部位在哪里？是上腹部、下腹部，还是整个腹部都疼？...'
2025-03-30 13:14:31,585 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:14:31] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 13:14:35,600 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778): '上腹...'
2025-03-30 13:14:35,600 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_c3f18f0b-17c4-47bb-88be-0322119b9778 (Patient: WebPatient_9e8a426f), 当前阶段: information_gathering
2025-03-30 13:14:35,601 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778
2025-03-30 13:14:35,607 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_9e8a426f 对问题 (Context: web_c3f18f0b-17c4-47bb-88be-0322119b9778) 的回答: '上腹...'
2025-03-30 13:14:35,612 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 13:14:35,613 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 13:14:35,613 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "肚子疼的具体...
2025-03-30 13:14:35,614 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:14:35,615 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:14:37,181 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:14:37,186 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.57秒
2025-03-30 13:14:37,186 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["上腹疼痛"],
  "symptom_d...
2025-03-30 13:14:37,186 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_9e8a426f 回答分析完成。当前症状: ['上腹疼痛', '60', '肚子疼']. 置信度: 0.40
2025-03-30 13:14:37,187 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_9e8a426f (Context: web_c3f18f0b-17c4-47bb-88be-0322119b9778) 提出下一个问题。
2025-03-30 13:14:37,187 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 13:14:37,187 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 13:14:37,187 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 13:14:37,192 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:14:37,197 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:14:38,717 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:14:38,722 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.52秒
2025-03-30 13:14:38,722 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是突然发生的还是逐渐加重的？疼痛持续了多长时间？
2025-03-30 13:14:38,744 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778): Status=in_progress, Agent=doctor, Msg='疼痛是突然发生的还是逐渐加重的？疼痛持续了多长时间？...'
2025-03-30 13:14:38,745 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:14:38] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 13:14:51,581 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778): '逐渐加重 24小时...'
2025-03-30 13:14:51,582 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_c3f18f0b-17c4-47bb-88be-0322119b9778 (Patient: WebPatient_9e8a426f), 当前阶段: information_gathering
2025-03-30 13:14:51,582 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778
2025-03-30 13:14:51,588 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_9e8a426f 对问题 (Context: web_c3f18f0b-17c4-47bb-88be-0322119b9778) 的回答: '逐渐加重 24小时...'
2025-03-30 13:14:51,593 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 13:14:51,593 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 13:14:51,593 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是突然发...
2025-03-30 13:14:52,056 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:14:52,062 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:14:54,690 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:14:54,695 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.63秒
2025-03-30 13:14:54,695 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 13:14:54,695 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_9e8a426f 回答分析完成。当前症状: ['上腹疼痛', '60', '肚子疼']. 置信度: 0.55
2025-03-30 13:14:54,695 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_9e8a426f (Context: web_c3f18f0b-17c4-47bb-88be-0322119b9778) 提出下一个问题。
2025-03-30 13:14:54,695 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 13:14:54,695 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 13:14:54,695 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 13:14:54,697 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:14:54,699 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:14:56,126 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:14:56,129 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.43秒
2025-03-30 13:14:56,130 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否伴有恶心、呕吐、腹胀或食欲减退等其他症状？
2025-03-30 13:14:56,160 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778): Status=in_progress, Agent=doctor, Msg='疼痛是否伴有恶心、呕吐、腹胀或食欲减退等其他症状？...'
2025-03-30 13:14:56,161 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:14:56] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 13:15:04,369 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778): '腹胀...'
2025-03-30 13:15:04,369 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_c3f18f0b-17c4-47bb-88be-0322119b9778 (Patient: WebPatient_9e8a426f), 当前阶段: information_gathering
2025-03-30 13:15:04,370 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778
2025-03-30 13:15:04,376 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_9e8a426f 对问题 (Context: web_c3f18f0b-17c4-47bb-88be-0322119b9778) 的回答: '腹胀...'
2025-03-30 13:15:04,382 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 13:15:04,382 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 13:15:04,382 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否伴有...
2025-03-30 13:15:04,384 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:15:04,385 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:15:06,265 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:15:06,268 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.88秒
2025-03-30 13:15:06,269 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["腹胀"],
  "symptom_det...
2025-03-30 13:15:06,269 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_9e8a426f 回答分析完成。当前症状: ['上腹疼痛', '腹胀', '60', '肚子疼']. 置信度: 0.65
2025-03-30 13:15:06,269 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_9e8a426f (Context: web_c3f18f0b-17c4-47bb-88be-0322119b9778) 提出下一个问题。
2025-03-30 13:15:06,270 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 13:15:06,270 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 13:15:06,270 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 13:15:06,636 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:15:06,639 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:15:08,239 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:15:08,242 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.60秒
2025-03-30 13:15:08,243 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否会向后背或其他部位放射？
2025-03-30 13:15:08,270 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778): Status=in_progress, Agent=doctor, Msg='疼痛是否会向后背或其他部位放射？...'
2025-03-30 13:15:08,270 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:15:08] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 13:15:24,960 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778): '会...'
2025-03-30 13:15:24,960 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_c3f18f0b-17c4-47bb-88be-0322119b9778 (Patient: WebPatient_9e8a426f), 当前阶段: information_gathering
2025-03-30 13:15:24,960 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778
2025-03-30 13:15:24,967 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_9e8a426f 对问题 (Context: web_c3f18f0b-17c4-47bb-88be-0322119b9778) 的回答: '会...'
2025-03-30 13:15:24,972 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 13:15:24,972 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 13:15:24,972 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否会向...
2025-03-30 13:15:25,539 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:15:25,544 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:15:28,041 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:15:28,045 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.50秒
2025-03-30 13:15:28,045 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["疼痛向后背或其他部位放射"],
  "s...
2025-03-30 13:15:28,046 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_9e8a426f 回答分析完成。当前症状: ['疼痛向后背或其他部位放射', '腹胀', '60', '上腹疼痛', '肚子疼']. 置信度: 0.80
2025-03-30 13:15:28,046 - Hospital-MultiAgent-System - INFO - 可以诊断：置信度 0.80 >= 0.75
2025-03-30 13:15:28,047 - Hospital-MultiAgent-System - INFO - 医生 主治医生 可以为患者 WebPatient_9e8a426f (Context: web_c3f18f0b-17c4-47bb-88be-0322119b9778) 做出诊断。
2025-03-30 13:15:28,047 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：600，温度：0.3
2025-03-30 13:15:28,048 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位资深医生，正在进行诊断。请给出专业、详细且结构化的诊断结果（JSON格式）。
2025-03-30 13:15:28,048 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医生，请根据以下信息生成诊断结果：
症状：疼痛向后背或其他部位放射, 腹胀, 60, 上腹疼...
2025-03-30 13:15:28,052 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:15:28,057 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:15:32,477 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:15:32,481 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：4.42秒
2025-03-30 13:15:32,481 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "急性胰腺炎",
  "explanation":...
2025-03-30 13:15:32,481 - Hospital-MultiAgent-System - INFO - 为症状 '疼痛向后背或其他部位放射, 腹胀, 60, 上腹疼痛, 肚子疼' 生成诊断结果：急性胰腺炎
2025-03-30 13:15:32,492 - Hospital-MultiAgent-System - INFO - 删除问诊上下文: web_c3f18f0b-17c4-47bb-88be-0322119b9778 (Patient: WebPatient_9e8a426f)
2025-03-30 13:15:32,508 - Hospital-MultiAgent-System - INFO - 诊断完成，同步触发处方审核 (Patient: WebPatient_9e8a426f, Context: web_c3f18f0b-17c4-47bb-88be-0322119b9778)
2025-03-30 13:15:32,508 - Hospital-MultiAgent-System - INFO - 向药剂师发送处方审核请求 (Patient: WebPatient_9e8a426f)...
2025-03-30 13:15:32,511 - Hospital-MultiAgent-System - INFO - 药剂师 药剂师 正在审核患者 WebPatient_9e8a426f 的处方...
2025-03-30 13:15:32,512 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：700，温度：0.1
2025-03-30 13:15:32,512 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富、极其严谨的临床药剂师...请仔细检查每一个细节并提供结构化的JSON反馈。
2025-03-30 13:15:32,512 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位资深临床药剂师，请严格审核以下处方的合理性、安全性及潜在风险: ... (省略完整 prom...
2025-03-30 13:15:32,515 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:15:32,516 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:15:33,602 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:15:33,606 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.09秒
2025-03-30 13:15:33,607 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：请提供完整的处方信息，包括药物名称、剂量、给药途径、频率、患者年龄、性别、体重、病史、肾功能、肝功能...
2025-03-30 13:15:33,607 - Hospital-MultiAgent-System - ERROR - 解析处方审核LLM响应失败: Expecting value: line 1 column 1 (char 0). Raw response: 请提供完整的处方信息，包括药物名称、剂量、给药途径、频率、患者年龄、性别、体重、病史、肾功能、肝功能、过敏史以及其他相关临床信息。我需要这些详细数据才能进行全面审核并提供准确的反馈。
2025-03-30 13:15:33,617 - Hospital-MultiAgent-System - WARNING - 患者 WebPatient_9e8a426f 的处方未通过审核: 系统解析审核结果失败
2025-03-30 13:15:33,630 - Hospital-MultiAgent-System - INFO - 收到药剂师审核响应 (Patient: WebPatient_9e8a426f)。Status: rejected
2025-03-30 13:15:33,630 - Hospital-MultiAgent-System - WARNING - 处方审核被拒绝 (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778): ['系统解析审核结果失败']
2025-03-30 13:15:33,631 - Hospital-MultiAgent-System - WARNING - 尝试删除不存在的问诊上下文: web_c3f18f0b-17c4-47bb-88be-0322119b9778
2025-03-30 13:15:33,631 - Hospital-MultiAgent-System - INFO - Web 咨询 web_c3f18f0b-17c4-47bb-88be-0322119b9778 已达到结束状态: error_prescription_rejected
2025-03-30 13:15:33,638 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_c3f18f0b-17c4-47bb-88be-0322119b9778): Status=error_prescription_rejected, Agent=doctor, Msg='感谢您的配合。根据您提供的信息，我已完成初步诊断。
处方审核未通过: 系统解析审核结果失败。请医生复...'
2025-03-30 13:15:33,638 - Hospital-MultiAgent-System-Web - INFO - Web 咨询 web_c3f18f0b-17c4-47bb-88be-0322119b9778 已达到结束状态: error_prescription_rejected
2025-03-30 13:15:33,639 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:15:33] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 13:24:38,818 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/pharmacist.py', reloading
2025-03-30 13:24:38,889 - werkzeug - INFO -  * Restarting with stat
2025-03-30 13:24:39,078 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 13:24:39,078 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 13:24:39,078 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 13:24:39,078 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 13:24:39,090 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 13:24:39,090 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 13:24:39,091 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 13:24:39,091 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: e4064ce9-123a-4ba6-8c12-c2a2387626eb)
2025-03-30 13:24:39,091 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 13:24:39,091 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 4ac82940-a533-465c-8378-865097341eb9)
2025-03-30 13:24:39,091 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 13:24:39,091 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 59e07fdb-7618-4c29-ae93-4008290940de)
2025-03-30 13:24:39,091 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 13:24:39,091 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 13:24:39,091 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 13:24:39,091 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 13:24:39,104 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 13:24:39,108 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 13:25:55,785 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/pharmacist.py', reloading
2025-03-30 13:25:55,852 - werkzeug - INFO -  * Restarting with stat
2025-03-30 13:42:41,358 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 13:42:41,358 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 13:42:41,358 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 13:42:41,358 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 13:42:41,358 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 13:42:41,370 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 13:42:41,371 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 13:42:41,371 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 13:42:41,371 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: ce42ad4d-5ec6-4ae3-8444-4baf6d39b2f6)
2025-03-30 13:42:41,371 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 13:42:41,371 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 308a8d28-d4ec-4e4a-936b-34855e9edf8d)
2025-03-30 13:42:41,371 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 13:42:41,371 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 11d0a707-7bad-4e95-9f82-2227abfb1c3d)
2025-03-30 13:42:41,371 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 13:42:41,371 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 13:42:41,371 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 13:42:41,372 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 13:42:41,390 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 13:42:41,390 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 13:42:41,390 - werkzeug - INFO -  * Restarting with stat
2025-03-30 13:42:41,571 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 13:42:41,571 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 13:42:41,571 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 13:42:41,571 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 13:42:41,584 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 13:42:41,584 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 13:42:41,584 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 13:42:41,584 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 81a9c725-cd99-4832-9fb1-9434975fd610)
2025-03-30 13:42:41,585 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 13:42:41,585 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: d8130b4f-b76d-4186-8163-109b58e360b6)
2025-03-30 13:42:41,585 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 13:42:41,585 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: a9d110a8-dc35-4af3-a0b3-6f4bcf89654b)
2025-03-30 13:42:41,585 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 13:42:41,585 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 13:42:41,585 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 13:42:41,585 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 13:42:41,599 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 13:42:41,603 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 13:42:48,066 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:42:48] "GET / HTTP/1.1" 200 -
2025-03-30 13:42:48,078 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:42:48] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 13:42:48,081 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:42:48] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 13:42:48,090 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b
2025-03-30 13:42:48,090 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b
2025-03-30 13:42:48,091 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:42:48] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 13:43:07,313 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b): '肚疼 60 男...'
2025-03-30 13:43:07,313 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b
2025-03-30 13:43:07,314 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b，视为新对话，转给接待员。
2025-03-30 13:43:07,315 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_1df3c3b1 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web'}
2025-03-30 13:43:07,315 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_1df3c3b1 不存在，创建新的记忆记录。
2025-03-30 13:43:07,323 - Hospital-MultiAgent-System - INFO - 为网页交互创建/更新患者 ID: WebPatient_1df3c3b1 (Name: 网页用户, Age: None)
2025-03-30 13:43:07,328 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b
2025-03-30 13:43:07,334 - Hospital-MultiAgent-System - WARNING - 获取问诊上下文失败：找不到 ID web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b
2025-03-30 13:43:07,334 - Hospital-MultiAgent-System - INFO - 为咨询 web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b (Patient: WebPatient_1df3c3b1) 创建新上下文
2025-03-30 13:43:07,334 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b (Patient: WebPatient_1df3c3b1)
2025-03-30 13:43:07,345 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.1
2025-03-30 13:43:07,345 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 13:43:07,345 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 肚疼 60 男

用户...
2025-03-30 13:43:07,784 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:43:07,786 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:43:09,889 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:43:09,895 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.11秒
2025-03-30 13:43:09,895 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "medical_inquiry",
  "has_sufficient...
2025-03-30 13:43:09,895 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_1df3c3b1): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚疼']
2025-03-30 13:43:09,895 - Hospital-MultiAgent-System - INFO - 意图为医疗咨询且信息充分或已引导，尝试分诊 (Patient: WebPatient_1df3c3b1)
2025-03-30 13:43:09,895 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：150，温度：0.2
2025-03-30 13:43:09,895 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 13:43:09,895 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 13:43:09,900 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:43:09,902 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:43:11,904 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:43:11,909 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.01秒
2025-03-30 13:43:11,909 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "p...
2025-03-30 13:43:11,910 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=priority
2025-03-30 13:43:11,934 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b)，准备触发医生诊断。
2025-03-30 13:43:11,934 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b, Patient: WebPatient_1df3c3b1)...
2025-03-30 13:43:11,938 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_1df3c3b1 的诊断请求 (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b)。复诊: False
2025-03-30 13:43:11,938 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 13:43:11,938 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 13:43:11,938 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 13:43:11,940 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:43:11,942 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:43:13,155 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:43:13,159 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.22秒
2025-03-30 13:43:13,160 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：肚子疼的具体部位在哪里？是上腹部、下腹部、左侧还是右侧？
2025-03-30 13:43:13,160 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b (Patient: WebPatient_1df3c3b1)
2025-03-30 13:43:13,189 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b)
2025-03-30 13:43:13,189 - Hospital-MultiAgent-System - INFO - 成功转接给医生并获取第一个问题 (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b)
2025-03-30 13:43:13,192 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b): Status=in_progress, Agent=doctor, Msg='肚子疼的具体部位在哪里？是上腹部、下腹部、左侧还是右侧？...'
2025-03-30 13:43:13,192 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:43:13] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 13:43:22,831 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b): '右侧 下腹...'
2025-03-30 13:43:22,832 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b (Patient: WebPatient_1df3c3b1), 当前阶段: information_gathering
2025-03-30 13:43:22,832 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b
2025-03-30 13:43:22,841 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_1df3c3b1 对问题 (Context: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b) 的回答: '右侧 下腹...'
2025-03-30 13:43:22,848 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 13:43:22,848 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 13:43:22,848 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "肚子疼的具体...
2025-03-30 13:43:23,322 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:43:23,328 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:43:25,987 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:43:25,992 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.66秒
2025-03-30 13:43:25,993 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["右侧下腹疼痛"],
  "symptom...
2025-03-30 13:43:25,993 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_1df3c3b1 回答分析完成。当前症状: ['肚疼', '60', '右侧下腹疼痛']. 置信度: 0.45
2025-03-30 13:43:25,993 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_1df3c3b1 (Context: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b) 提出下一个问题。
2025-03-30 13:43:25,994 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 13:43:25,994 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 13:43:25,994 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 13:43:26,001 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:43:26,006 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:43:27,441 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:43:27,445 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.44秒
2025-03-30 13:43:27,445 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：右侧下腹疼痛是否伴有恶心、呕吐、发热或排便异常？
2025-03-30 13:43:27,474 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b): Status=in_progress, Agent=doctor, Msg='右侧下腹疼痛是否伴有恶心、呕吐、发热或排便异常？...'
2025-03-30 13:43:27,475 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:43:27] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 13:43:36,554 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b): '没...'
2025-03-30 13:43:36,554 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b (Patient: WebPatient_1df3c3b1), 当前阶段: information_gathering
2025-03-30 13:43:36,555 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b
2025-03-30 13:43:36,562 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_1df3c3b1 对问题 (Context: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b) 的回答: '没...'
2025-03-30 13:43:36,568 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 13:43:36,568 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 13:43:36,568 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "右侧下腹疼痛...
2025-03-30 13:43:36,570 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:43:36,571 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:43:38,839 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:43:38,842 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.27秒
2025-03-30 13:43:38,842 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 13:43:38,842 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_1df3c3b1 回答分析完成。当前症状: ['肚疼', '60', '右侧下腹疼痛']. 置信度: 0.55
2025-03-30 13:43:38,842 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_1df3c3b1 (Context: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b) 提出下一个问题。
2025-03-30 13:43:38,843 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 13:43:38,843 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 13:43:38,843 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 13:43:38,956 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:43:38,962 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:43:39,955 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:43:39,960 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.00秒
2025-03-30 13:43:39,960 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是突然开始的还是逐渐加重的？
2025-03-30 13:43:39,990 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b): Status=in_progress, Agent=doctor, Msg='疼痛是突然开始的还是逐渐加重的？...'
2025-03-30 13:43:39,991 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:43:39] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 13:43:45,203 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b): '突然...'
2025-03-30 13:43:45,204 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b (Patient: WebPatient_1df3c3b1), 当前阶段: information_gathering
2025-03-30 13:43:45,204 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b
2025-03-30 13:43:45,212 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_1df3c3b1 对问题 (Context: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b) 的回答: '突然...'
2025-03-30 13:43:45,219 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 13:43:45,219 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 13:43:45,219 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是突然开...
2025-03-30 13:43:45,220 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:43:45,221 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:43:47,123 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:43:47,128 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.91秒
2025-03-30 13:43:47,128 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 13:43:47,128 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_1df3c3b1 回答分析完成。当前症状: ['肚疼', '60', '右侧下腹疼痛']. 置信度: 0.65
2025-03-30 13:43:47,129 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_1df3c3b1 (Context: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b) 提出下一个问题。
2025-03-30 13:43:47,129 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 13:43:47,129 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 13:43:47,129 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 13:43:47,291 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:43:47,294 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:43:48,249 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:43:48,253 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.96秒
2025-03-30 13:43:48,254 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）："右侧下腹疼痛是否在活动、咳嗽或按压时加重？"
2025-03-30 13:43:48,283 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b): Status=in_progress, Agent=doctor, Msg='"右侧下腹疼痛是否在活动、咳嗽或按压时加重？"...'
2025-03-30 13:43:48,283 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:43:48] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 13:43:59,043 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b): '按压...'
2025-03-30 13:43:59,044 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b (Patient: WebPatient_1df3c3b1), 当前阶段: information_gathering
2025-03-30 13:43:59,044 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b
2025-03-30 13:43:59,051 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_1df3c3b1 对问题 (Context: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b) 的回答: '按压...'
2025-03-30 13:43:59,057 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 13:43:59,057 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 13:43:59,057 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: ""右侧下腹疼...
2025-03-30 13:43:59,059 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:43:59,060 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:44:01,972 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:44:01,975 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.91秒
2025-03-30 13:44:01,975 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 13:44:01,976 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_1df3c3b1 回答分析完成。当前症状: ['肚疼', '60', '右侧下腹疼痛']. 置信度: 0.80
2025-03-30 13:44:01,976 - Hospital-MultiAgent-System - INFO - 可以诊断：置信度 0.80 >= 0.75
2025-03-30 13:44:01,976 - Hospital-MultiAgent-System - INFO - 医生 主治医生 可以为患者 WebPatient_1df3c3b1 (Context: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b) 做出诊断。
2025-03-30 13:44:01,976 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：600，温度：0.3
2025-03-30 13:44:01,976 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位资深医生，正在进行诊断。请给出专业、详细且结构化的诊断结果（JSON格式）。
2025-03-30 13:44:01,976 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医生，请根据以下信息生成诊断结果：
症状：肚疼, 60, 右侧下腹疼痛
病史：无
科室：消化...
2025-03-30 13:44:01,981 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:44:01,985 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:44:06,273 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:44:06,276 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：4.29秒
2025-03-30 13:44:06,277 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "急性阑尾炎",
  "explanation":...
2025-03-30 13:44:06,277 - Hospital-MultiAgent-System - INFO - 为症状 '肚疼, 60, 右侧下腹疼痛' 生成诊断结果：急性阑尾炎
2025-03-30 13:44:06,292 - Hospital-MultiAgent-System - INFO - 删除问诊上下文: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b (Patient: WebPatient_1df3c3b1)
2025-03-30 13:44:06,311 - Hospital-MultiAgent-System - INFO - 诊断完成，同步触发处方审核 (Patient: WebPatient_1df3c3b1, Context: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b)
2025-03-30 13:44:06,312 - Hospital-MultiAgent-System - INFO - 向药剂师发送处方审核请求 (Patient: WebPatient_1df3c3b1)...
2025-03-30 13:44:06,317 - Hospital-MultiAgent-System - INFO - 药剂师 药剂师 正在审核患者 WebPatient_1df3c3b1 的处方...
2025-03-30 13:44:06,317 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.1
2025-03-30 13:44:06,317 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富、极其严谨的临床药剂师。请仔细检查处方，并【严格按照要求的JSON格式】输出反馈，【...
2025-03-30 13:44:06,318 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位资深临床药剂师，请基于患者的部分诊断信息和以下处方，严格审核其合理性、安全性及潜在风险。

...
2025-03-30 13:44:06,458 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 13:44:06,462 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 13:44:09,490 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 13:44:09,494 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.03秒
2025-03-30 13:44:09,494 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "valid": false,
  "issues": ["处方中未指定止痛药和抗生素的具体...
2025-03-30 13:44:09,494 - Hospital-MultiAgent-System - INFO - 处方审核LLM解析成功: Valid=False, Issues=2, Warnings=1
2025-03-30 13:44:09,504 - Hospital-MultiAgent-System - WARNING - 患者 WebPatient_1df3c3b1 的处方未通过审核: 处方中未指定止痛药和抗生素的具体名称、剂量、用法及疗程、处方缺乏明确的药物信息，无法评估适应症符合性及安全性
2025-03-30 13:44:09,512 - Hospital-MultiAgent-System - INFO - 收到药剂师审核响应 (Patient: WebPatient_1df3c3b1)。Status: rejected
2025-03-30 13:44:09,512 - Hospital-MultiAgent-System - WARNING - 处方审核被拒绝 (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b): ['处方中未指定止痛药和抗生素的具体名称、剂量、用法及疗程', '处方缺乏明确的药物信息，无法评估适应症符合性及安全性']
2025-03-30 13:44:09,512 - Hospital-MultiAgent-System - WARNING - 尝试删除不存在的问诊上下文: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b
2025-03-30 13:44:09,512 - Hospital-MultiAgent-System - INFO - Web 咨询 web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b 已达到结束状态: error_prescription_rejected
2025-03-30 13:44:09,517 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b): Status=error_prescription_rejected, Agent=doctor, Msg='感谢您的配合。根据您提供的信息，我已完成初步诊断。
处方审核未通过: 处方中未指定止痛药和抗生素的具...'
2025-03-30 13:44:09,517 - Hospital-MultiAgent-System-Web - INFO - Web 咨询 web_1a74ae8e-868c-40f6-84e7-1d3158c1f49b 已达到结束状态: error_prescription_rejected
2025-03-30 13:44:09,518 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:44:09] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 13:51:42,263 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 13:51:42,263 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 13:51:42,263 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 13:51:42,263 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 13:51:42,263 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 13:51:42,276 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 13:51:42,276 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 13:51:42,276 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 13:51:42,276 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: f6d3fc7d-072e-4c3c-b6c1-36ba10e96f51)
2025-03-30 13:51:42,277 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 13:51:42,277 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 5f340544-4eb1-44d0-829e-8302f3767a6a)
2025-03-30 13:51:42,277 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 13:51:42,277 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: e0888dc2-5907-4ec4-9450-f7ab8a0b0bd5)
2025-03-30 13:51:42,277 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 13:51:42,277 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 13:51:42,277 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 13:51:42,277 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 13:51:42,295 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 13:51:42,295 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 13:51:42,296 - werkzeug - INFO -  * Restarting with stat
2025-03-30 13:51:42,478 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 13:51:42,478 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 13:51:42,478 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 13:51:42,478 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 13:51:42,490 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 13:51:42,490 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 13:51:42,491 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 13:51:42,491 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: c43264f8-8eaa-42d4-a41b-8de6da730e2c)
2025-03-30 13:51:42,491 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 13:51:42,491 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: b9349a2a-f78b-4e93-a130-68c086d94b4e)
2025-03-30 13:51:42,491 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 13:51:42,491 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 8d27a94b-8e63-4953-8aa2-2d6a83574852)
2025-03-30 13:51:42,491 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 13:51:42,491 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 13:51:42,491 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 13:51:42,492 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 13:51:42,504 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 13:51:42,509 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 13:51:46,901 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:51:46] "GET / HTTP/1.1" 200 -
2025-03-30 13:51:46,917 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:51:46] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 13:51:46,918 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:51:46] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 13:51:46,926 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_a0afba5e-c0a6-40f3-b235-c1218da878f8
2025-03-30 13:51:46,926 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_a0afba5e-c0a6-40f3-b235-c1218da878f8
2025-03-30 13:51:46,927 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:51:46] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 13:57:28,548 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:57:28] "GET / HTTP/1.1" 200 -
2025-03-30 13:57:28,559 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:57:28] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 13:57:28,559 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:57:28] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 13:57:28,568 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_b22d8095-8826-45b9-8899-592512f3aece
2025-03-30 13:57:28,568 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_b22d8095-8826-45b9-8899-592512f3aece
2025-03-30 13:57:28,569 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:57:28] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 13:57:37,276 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 13:57:37,276 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 13:57:37,276 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 13:57:37,276 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 13:57:37,276 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 13:57:37,288 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 13:57:37,289 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 13:57:37,289 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 13:57:37,289 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: e225f1d3-dde3-495c-b3c2-fa720a198641)
2025-03-30 13:57:37,289 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 13:57:37,289 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 69b381dc-c63c-44bb-a766-e37670145e5e)
2025-03-30 13:57:37,289 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 13:57:37,289 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 379297fa-80a1-48fc-916e-6b0852ae2529)
2025-03-30 13:57:37,289 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 13:57:37,289 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 13:57:37,289 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 13:57:37,290 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 13:57:37,307 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 13:57:37,307 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 13:57:37,307 - werkzeug - INFO -  * Restarting with stat
2025-03-30 13:57:37,486 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 13:57:37,486 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 13:57:37,486 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 13:57:37,486 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 13:57:37,499 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 13:57:37,499 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 13:57:37,500 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 13:57:37,500 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 3137da39-6f8a-4dd8-a558-7c8f7f84f35d)
2025-03-30 13:57:37,500 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 13:57:37,500 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 428fcc65-341c-4ff8-9ffc-144fcaad9928)
2025-03-30 13:57:37,500 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 13:57:37,500 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: bfb450b2-11d5-4faf-9910-f8b6dea80004)
2025-03-30 13:57:37,500 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 13:57:37,500 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 13:57:37,500 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 13:57:37,500 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 13:57:37,513 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 13:57:37,517 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 13:57:41,330 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:57:41] "GET / HTTP/1.1" 200 -
2025-03-30 13:57:41,343 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:57:41] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 13:57:41,343 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:57:41] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 13:57:41,351 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_52e9034b-4ed8-4c1b-88fc-a88e108cbdbf
2025-03-30 13:57:41,352 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_52e9034b-4ed8-4c1b-88fc-a88e108cbdbf
2025-03-30 13:57:41,352 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:57:41] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 13:57:41,964 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:57:41] "GET / HTTP/1.1" 200 -
2025-03-30 13:57:41,974 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:57:41] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 13:57:41,975 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:57:41] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 13:57:41,981 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_e734c867-54f3-477c-9314-e7c76ef95ac4
2025-03-30 13:57:41,981 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_e734c867-54f3-477c-9314-e7c76ef95ac4
2025-03-30 13:57:41,982 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 13:57:41] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 14:13:35,435 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 14:13:35,435 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 14:13:35,435 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 14:13:35,435 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 14:13:35,435 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 14:13:35,447 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 14:13:35,448 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 14:13:35,448 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 14:13:35,448 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: c4c45931-240f-4e57-a5af-33c95759e0f8)
2025-03-30 14:13:35,448 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 14:13:35,448 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 2d84f00b-b837-4c64-a4b7-89dd20faffd0)
2025-03-30 14:13:35,448 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 14:13:35,448 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 2e29c221-33c8-4121-925d-19993d48dde8)
2025-03-30 14:13:35,448 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 14:13:35,448 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 14:13:35,448 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 14:13:35,449 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 14:13:35,467 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 14:13:35,467 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 14:13:35,468 - werkzeug - INFO -  * Restarting with stat
2025-03-30 14:13:35,646 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 14:13:35,646 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 14:13:35,646 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 14:13:35,646 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 14:13:35,659 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 14:13:35,659 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 14:13:35,659 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 14:13:35,659 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 937232b8-1537-4701-a359-bf063a8fe95b)
2025-03-30 14:13:35,659 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 14:13:35,659 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: d21b521a-a2b6-4b70-8220-287ca5664051)
2025-03-30 14:13:35,659 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 14:13:35,659 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 7720d551-ccae-4b89-b338-0f2c40b9a6f1)
2025-03-30 14:13:35,659 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 14:13:35,659 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 14:13:35,659 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 14:13:35,660 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 14:13:35,672 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 14:13:35,677 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 14:13:40,032 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:13:40] "GET / HTTP/1.1" 200 -
2025-03-30 14:13:40,047 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:13:40] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 14:13:40,048 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:13:40] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 14:13:40,054 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_96031c9b-5dc8-45b9-b69d-459c5f5d691b
2025-03-30 14:13:40,054 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_96031c9b-5dc8-45b9-b69d-459c5f5d691b
2025-03-30 14:13:40,055 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:13:40] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 14:36:47,015 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 14:36:47,015 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 14:36:47,015 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 14:36:47,015 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 14:36:47,015 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 14:36:47,027 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 14:36:47,027 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 14:36:47,028 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 14:36:47,028 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: b970e047-96f9-42ba-89fd-0c672cb83b90)
2025-03-30 14:36:47,028 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 14:36:47,028 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: c90702b7-e2cb-400d-916a-5a00bdbd744d)
2025-03-30 14:36:47,028 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 14:36:47,028 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 81e7fdb0-37d6-4c09-80c1-92559f243724)
2025-03-30 14:36:47,028 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 14:36:47,028 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 14:36:47,028 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 14:36:47,029 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 14:36:47,046 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 14:36:47,046 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 14:36:47,047 - werkzeug - INFO -  * Restarting with stat
2025-03-30 14:36:47,227 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 14:36:47,227 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 14:36:47,227 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 14:36:47,227 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 14:36:47,240 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 14:36:47,240 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 14:36:47,241 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 14:36:47,241 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: b1e762ff-4625-4daa-a726-15d6846a6291)
2025-03-30 14:36:47,241 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 14:36:47,241 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 4f236ae5-5ae2-4f59-a686-c877832fef46)
2025-03-30 14:36:47,241 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 14:36:47,241 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 23179752-d8d4-462c-858c-45cfd438ab15)
2025-03-30 14:36:47,241 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 14:36:47,241 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 14:36:47,241 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 14:36:47,241 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 14:36:47,255 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 14:36:47,259 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 14:36:52,348 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:36:52] "GET / HTTP/1.1" 200 -
2025-03-30 14:36:52,361 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:36:52] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 14:36:52,362 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:36:52] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 14:36:52,366 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_d7ff6ab0-e1ad-4132-9886-0b6976304238
2025-03-30 14:36:52,367 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_d7ff6ab0-e1ad-4132-9886-0b6976304238
2025-03-30 14:36:52,367 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:36:52] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 14:37:09,766 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_d7ff6ab0-e1ad-4132-9886-0b6976304238): '肚子疼 60...'
2025-03-30 14:37:09,766 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_d7ff6ab0-e1ad-4132-9886-0b6976304238，视为新对话，转给接待员。
2025-03-30 14:37:09,768 - Hospital-MultiAgent-System-Web - ERROR - 处理 Web 对话失败 (Session Consult ID: web_d7ff6ab0-e1ad-4132-9886-0b6976304238): name 'timezone' is not defined
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 168, in handle_conversation
    response_data = orchestrator.handle_web_message(consultation_id, user_message)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 138, in handle_web_message
    patient_id = self._get_or_create_patient_id(extracted_info.get("name"), extracted_info.get("age"))
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 241, in _get_or_create_patient_id
    "created_utc": datetime.now(timezone.utc).isoformat()
                                ^^^^^^^^
NameError: name 'timezone' is not defined
2025-03-30 14:37:09,775 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:37:09] "[35m[1mPOST /api/conversation HTTP/1.1[0m" 500 -
2025-03-30 14:40:47,079 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 14:40:47,144 - werkzeug - INFO -  * Restarting with stat
2025-03-30 14:40:47,336 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 14:40:47,336 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 14:40:47,336 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 14:40:47,336 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 14:40:47,349 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 14:40:47,350 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 14:40:47,350 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 14:40:47,350 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 9c5cfc13-286d-491f-86cd-828c51a2cdaf)
2025-03-30 14:40:47,350 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 14:40:47,350 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 8869d182-1df2-451a-8292-9a938f9a5853)
2025-03-30 14:40:47,350 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 14:40:47,350 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 4ae1074d-3436-4a91-8f85-e8dc3e53d45d)
2025-03-30 14:40:47,350 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 14:40:47,350 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 14:40:47,350 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 14:40:47,351 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 14:40:47,365 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 14:40:47,369 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 14:40:52,483 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:40:52] "GET / HTTP/1.1" 200 -
2025-03-30 14:40:52,495 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:40:52] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 14:40:52,497 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:40:52] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 14:40:52,501 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb
2025-03-30 14:40:52,501 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb
2025-03-30 14:40:52,501 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:40:52] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 14:40:55,008 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): '你好...'
2025-03-30 14:40:55,008 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb，视为新对话，转给接待员。
2025-03-30 14:40:55,009 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_665ed697 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T06:40:55.009408+00:00'}
2025-03-30 14:40:55,009 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 不存在，创建新的记忆记录。
2025-03-30 14:40:55,017 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_665ed697 (Name: 网页用户, Age: None)
2025-03-30 14:40:55,024 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb
2025-03-30 14:40:55,032 - Hospital-MultiAgent-System - INFO - 为咨询 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient: WebPatient_665ed697) 创建新上下文
2025-03-30 14:40:55,032 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient: WebPatient_665ed697)
2025-03-30 14:40:55,039 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 14:40:55,039 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 14:40:55,039 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 14:40:55,281 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:40:55,284 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:40:57,586 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:40:57,594 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.31秒
2025-03-30 14:40:57,594 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 14:40:57,594 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_665ed697): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 14:40:57,595 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 14:40:57,595 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 14:40:57,595 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 14:40:57,595 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 14:40:57,597 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:40:57,601 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:40:58,926 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:40:58,929 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.33秒
2025-03-30 14:40:58,929 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好！欢迎光临医院，请问有什么可以帮您？如果需要预约医生，请简单描述症状，我们会为您安排合适的分诊。
2025-03-30 14:40:58,948 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): Status=in_progress, Agent=receptionist, Msg='您好！欢迎光临医院，请问有什么可以帮您？如果需要预约医生，请简单描述症状，我们会为您安排合适的分诊。...'
2025-03-30 14:40:58,950 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:40:58] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 14:41:04,448 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): '我想去那美克星...'
2025-03-30 14:41:04,448 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient ID in context: WebPatient_665ed697), 当前阶段: reception_chatting
2025-03-30 14:41:04,448 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb
2025-03-30 14:41:04,457 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb, 当前阶段: reception_chatting
2025-03-30 14:41:04,465 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 14:41:04,465 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 14:41:04,465 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好
Receptio...
2025-03-30 14:41:04,466 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:41:04,468 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:41:06,284 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:41:06,285 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.82秒
2025-03-30 14:41:06,285 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 14:41:06,285 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_665ed697): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 14:41:06,285 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 2
2025-03-30 14:41:06,285 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 14:41:06,286 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 14:41:06,286 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："我想去那美克星"。请给出一个简洁、专业、乐于助人但【...
2025-03-30 14:41:06,287 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:41:06,289 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:41:07,520 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:41:07,523 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.23秒
2025-03-30 14:41:07,524 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，这里是医院接待中心，暂未找到相关信息。若需就诊，请简述您的情况，我们将为您安排合适的科室。
2025-03-30 14:41:07,551 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): Status=in_progress, Agent=receptionist, Msg='您好，这里是医院接待中心，暂未找到相关信息。若需就诊，请简述您的情况，我们将为您安排合适的科室。...'
2025-03-30 14:41:07,552 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:41:07] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 14:41:18,613 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): '谈恋爱吗？...'
2025-03-30 14:41:18,613 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient ID in context: WebPatient_665ed697), 当前阶段: reception_chatting
2025-03-30 14:41:18,614 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb
2025-03-30 14:41:18,622 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb, 当前阶段: reception_chatting
2025-03-30 14:41:18,629 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 14:41:18,629 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 14:41:18,629 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 您好！...
2025-03-30 14:41:19,045 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:41:19,048 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:41:21,640 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:41:21,643 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.60秒
2025-03-30 14:41:21,644 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 14:41:21,644 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_665ed697): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 14:41:21,644 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 3
2025-03-30 14:41:21,644 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 14:41:21,644 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 14:41:21,644 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："谈恋爱吗？"。请给出一个简洁、专业、乐于助人但【绝对...
2025-03-30 14:41:21,650 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:41:21,654 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:41:22,566 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:41:22,572 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.92秒
2025-03-30 14:41:22,572 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，我是医院接待员，负责协助您挂号和安排就诊。如需帮助，请描述您的需求或症状，我们将为您安排合适的...
2025-03-30 14:41:22,597 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): Status=in_progress, Agent=receptionist, Msg='您好，我是医院接待员，负责协助您挂号和安排就诊。如需帮助，请描述您的需求或症状，我们将为您安排合适的服务。...'
2025-03-30 14:41:22,597 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:41:22] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 14:41:30,117 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): '啦啦啦...'
2025-03-30 14:41:30,118 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient ID in context: WebPatient_665ed697), 当前阶段: reception_chatting
2025-03-30 14:41:30,118 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb
2025-03-30 14:41:30,128 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb, 当前阶段: reception_chatting
2025-03-30 14:41:30,135 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 14:41:30,135 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 14:41:30,135 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 您好，...
2025-03-30 14:41:30,138 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:41:30,139 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:41:32,295 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:41:32,298 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.16秒
2025-03-30 14:41:32,298 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 14:41:32,298 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_665ed697): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 14:41:32,298 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 4
2025-03-30 14:41:32,326 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): Status=in_progress, Agent=receptionist, Msg='非常抱歉，我们已经聊了几句了。如果您有身体不适需要咨询，请详细描述您的症状，否则我需要优先处理其他患者的请求。...'
2025-03-30 14:41:32,327 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:41:32] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 14:41:38,791 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): '我肚子疼...'
2025-03-30 14:41:38,791 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient ID in context: WebPatient_665ed697), 当前阶段: reception_chat_ended
2025-03-30 14:41:38,791 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb
2025-03-30 14:41:38,800 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb, 当前阶段: reception_chat_ended
2025-03-30 14:41:38,808 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 14:41:38,808 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 14:41:38,808 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 您好，...
2025-03-30 14:41:38,975 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:41:38,978 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:41:41,929 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:41:41,933 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.95秒
2025-03-30 14:41:41,933 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "medical_inquiry",
  "has_su...
2025-03-30 14:41:41,934 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_665ed697): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚子疼']
2025-03-30 14:41:41,934 - Hospital-MultiAgent-System - INFO - 识别到医疗意图或提前提供身份，准备询问/确认身份信息 (Patient: WebPatient_665ed697)
2025-03-30 14:41:41,962 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): Status=in_progress, Agent=receptionist, Msg='了解您身体不适。为了更好地帮助您（特别是如果您之前来过），请问您的手机号码是多少？这次是复诊吗？...'
2025-03-30 14:41:41,963 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:41:41] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 14:41:54,726 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): '18600001111 不是复诊...'
2025-03-30 14:41:54,726 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient ID in context: WebPatient_665ed697), 当前阶段: reception_asking_identity
2025-03-30 14:41:54,726 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb
2025-03-30 14:41:54,738 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb, 当前阶段: reception_asking_identity
2025-03-30 14:41:54,747 - Hospital-MultiAgent-System - INFO - 处理用户对身份问题的回复 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb)
2025-03-30 14:41:54,747 - Hospital-MultiAgent-System - INFO - 未找到匹配手机号的患者，或未提供手机号。将使用当前ID: WebPatient_665ed697
2025-03-30 14:41:54,747 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_665ed697 的基本信息: {'phone': '18600001111', 'source': 'web', 'first_consultation_id': 'web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb'}
2025-03-30 14:41:54,753 - Hospital-MultiAgent-System - INFO - 身份信息处理完毕，症状充分，准备分诊 (Patient: WebPatient_665ed697)
2025-03-30 14:41:54,753 - Hospital-MultiAgent-System - INFO - 执行分诊逻辑 (Patient: WebPatient_665ed697)
2025-03-30 14:41:54,753 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.2
2025-03-30 14:41:54,753 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 14:41:54,753 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 14:41:55,201 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:41:55,205 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:41:57,487 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:41:57,490 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.28秒
2025-03-30 14:41:57,491 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "n...
2025-03-30 14:41:57,491 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=normal
2025-03-30 14:41:57,514 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb)，准备触发医生诊断。
2025-03-30 14:41:57,514 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb, Patient: WebPatient_665ed697)...
2025-03-30 14:41:57,520 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_665ed697 的诊断请求 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb)。复诊: True
2025-03-30 14:41:57,521 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 14:41:57,521 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 14:41:57,521 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 14:41:57,523 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:41:57,524 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:41:59,009 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:41:59,012 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.49秒
2025-03-30 14:41:59,012 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：肚子疼具体是哪个部位？是上腹、中腹还是下腹？疼痛的性质是钝痛、绞痛还是刺痛？
2025-03-30 14:41:59,012 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient: WebPatient_665ed697)
2025-03-30 14:41:59,044 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb)
2025-03-30 14:41:59,044 - Hospital-MultiAgent-System - INFO - 成功转接给医生并获取第一个问题 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb)
2025-03-30 14:41:59,049 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): Status=in_progress, Agent=doctor, Msg='肚子疼具体是哪个部位？是上腹、中腹还是下腹？疼痛的性质是钝痛、绞痛还是刺痛？...'
2025-03-30 14:41:59,049 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:41:59] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 14:42:02,680 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): '上腹...'
2025-03-30 14:42:02,680 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient ID in context: WebPatient_665ed697), 当前阶段: information_gathering
2025-03-30 14:42:02,680 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb
2025-03-30 14:42:02,688 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_665ed697 对问题 (Context: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb) 的回答: '上腹...'
2025-03-30 14:42:02,696 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 14:42:02,696 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 14:42:02,696 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "肚子疼具体是...
2025-03-30 14:42:02,697 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:42:02,699 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:42:03,942 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:42:03,945 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.25秒
2025-03-30 14:42:03,946 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["上腹疼痛"],
  "symptom_d...
2025-03-30 14:42:03,946 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 回答分析完成。当前症状: ['用户描述不清晰', '上腹疼痛', '肚子疼']. 置信度: 0.40
2025-03-30 14:42:03,946 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_665ed697 (Context: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb) 提出下一个问题。
2025-03-30 14:42:03,946 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 14:42:03,946 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 14:42:03,947 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 14:42:03,953 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:42:03,958 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:42:05,337 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:42:05,338 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.38秒
2025-03-30 14:42:05,338 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否与进食相关？是饭前、饭后还是进食过程中加重？
2025-03-30 14:42:05,353 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): Status=in_progress, Agent=doctor, Msg='疼痛是否与进食相关？是饭前、饭后还是进食过程中加重？...'
2025-03-30 14:42:05,353 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:42:05] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 14:42:12,943 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): '饭后...'
2025-03-30 14:42:12,944 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient ID in context: WebPatient_665ed697), 当前阶段: information_gathering
2025-03-30 14:42:12,944 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb
2025-03-30 14:42:12,954 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_665ed697 对问题 (Context: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb) 的回答: '饭后...'
2025-03-30 14:42:12,962 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 14:42:12,962 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 14:42:12,962 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否与进...
2025-03-30 14:42:13,540 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:42:13,543 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:42:15,919 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:42:15,922 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.38秒
2025-03-30 14:42:15,923 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 14:42:15,923 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 回答分析完成。当前症状: ['用户描述不清晰', '上腹疼痛', '肚子疼']. 置信度: 0.50
2025-03-30 14:42:15,923 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_665ed697 (Context: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb) 提出下一个问题。
2025-03-30 14:42:15,923 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 14:42:15,923 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 14:42:15,923 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 14:42:15,925 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:42:15,929 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:42:17,455 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:42:17,458 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.53秒
2025-03-30 14:42:17,458 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否伴随其他症状，例如恶心、呕吐、腹胀、腹泻或便秘？
2025-03-30 14:42:17,489 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): Status=in_progress, Agent=doctor, Msg='疼痛是否伴随其他症状，例如恶心、呕吐、腹胀、腹泻或便秘？...'
2025-03-30 14:42:17,489 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:42:17] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 14:42:19,578 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): '恶心...'
2025-03-30 14:42:19,579 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient ID in context: WebPatient_665ed697), 当前阶段: information_gathering
2025-03-30 14:42:19,579 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb
2025-03-30 14:42:19,588 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_665ed697 对问题 (Context: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb) 的回答: '恶心...'
2025-03-30 14:42:19,595 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 14:42:19,596 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 14:42:19,596 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否伴随...
2025-03-30 14:42:19,814 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:42:19,816 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:42:21,242 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:42:21,248 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.43秒
2025-03-30 14:42:21,248 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["恶心"],
  "symptom_det...
2025-03-30 14:42:21,248 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 回答分析完成。当前症状: ['用户描述不清晰', '上腹疼痛', '恶心', '肚子疼']. 置信度: 0.60
2025-03-30 14:42:21,248 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_665ed697 (Context: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb) 提出下一个问题。
2025-03-30 14:42:21,248 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 14:42:21,248 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 14:42:21,248 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 14:42:21,250 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:42:21,252 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:42:22,983 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:42:22,986 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.73秒
2025-03-30 14:42:22,988 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否会向其他部位放射，例如后背或肩部？
2025-03-30 14:42:23,025 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): Status=in_progress, Agent=doctor, Msg='疼痛是否会向其他部位放射，例如后背或肩部？...'
2025-03-30 14:42:23,025 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:42:23] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 14:42:26,191 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): '后背...'
2025-03-30 14:42:26,191 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient ID in context: WebPatient_665ed697), 当前阶段: information_gathering
2025-03-30 14:42:26,191 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb
2025-03-30 14:42:26,199 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_665ed697 对问题 (Context: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb) 的回答: '后背...'
2025-03-30 14:42:26,208 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 14:42:26,208 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 14:42:26,208 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否会向...
2025-03-30 14:42:26,209 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:42:26,210 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:42:27,287 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:42:27,290 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.08秒
2025-03-30 14:42:27,290 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["后背疼痛"],
  "symptom_d...
2025-03-30 14:42:27,290 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 回答分析完成。当前症状: ['上腹疼痛', '用户描述不清晰', '肚子疼', '恶心', '后背疼痛']. 置信度: 0.70
2025-03-30 14:42:27,290 - Hospital-MultiAgent-System - INFO - 可以诊断：问题数 4 >= 4 且置信度 0.70 > 0.4
2025-03-30 14:42:27,291 - Hospital-MultiAgent-System - INFO - 医生 主治医生 可以为患者 WebPatient_665ed697 (Context: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb) 做出诊断。
2025-03-30 14:42:27,291 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：600，温度：0.3
2025-03-30 14:42:27,291 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位资深医生，正在进行诊断。请给出专业、详细且结构化的诊断结果（JSON格式）。
2025-03-30 14:42:27,291 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医生，请根据以下信息生成诊断结果：
症状：上腹疼痛, 用户描述不清晰, 肚子疼, 恶心, 后...
2025-03-30 14:42:27,293 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:42:27,296 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:42:31,897 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:42:31,900 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：4.60秒
2025-03-30 14:42:31,900 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "疑似胃肠疾病或胆囊疾病",
  "explana...
2025-03-30 14:42:31,901 - Hospital-MultiAgent-System - INFO - 为症状 '上腹疼痛, 用户描述不清晰, 肚子疼, 恶心, 后背疼痛' 生成诊断结果：疑似胃肠疾病或胆囊疾病
2025-03-30 14:42:31,910 - Hospital-MultiAgent-System - INFO - 删除问诊上下文: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb (Patient: WebPatient_665ed697)
2025-03-30 14:42:31,929 - Hospital-MultiAgent-System - INFO - 医生完成诊断 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb, Patient used by Doctor: WebPatient_665ed697)
2025-03-30 14:42:31,930 - Hospital-MultiAgent-System - INFO - 诊断完成，需要开药，同步触发处方审核 (Patient: WebPatient_665ed697, Context: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb)
2025-03-30 14:42:31,930 - Hospital-MultiAgent-System - INFO - 向药剂师发送处方审核请求 (Patient: WebPatient_665ed697)...
2025-03-30 14:42:31,934 - Hospital-MultiAgent-System - INFO - 药剂师 药剂师 正在审核患者 WebPatient_665ed697 的处方...
2025-03-30 14:42:31,934 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.1
2025-03-30 14:42:31,934 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富、极其严谨的临床药剂师。请仔细检查处方，并【严格按照要求的JSON格式】输出反馈，【...
2025-03-30 14:42:31,935 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位资深临床药剂师，请基于患者的部分诊断信息和以下处方，严格审核其合理性、安全性及潜在风险。

...
2025-03-30 14:42:31,936 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 14:42:31,939 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 14:42:33,840 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 14:42:33,842 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.90秒
2025-03-30 14:42:33,842 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "valid": false,
  "issues": ["解痉药未明确具体药物名称，可能导...
2025-03-30 14:42:33,842 - Hospital-MultiAgent-System - INFO - 处方审核LLM解析成功: Valid=False, Issues=2, Warnings=1
2025-03-30 14:42:33,852 - Hospital-MultiAgent-System - WARNING - 患者 WebPatient_665ed697 的处方未通过审核: 解痉药未明确具体药物名称，可能导致用药不当、疗程未指定，可能影响治疗效果
2025-03-30 14:42:33,864 - Hospital-MultiAgent-System - INFO - 收到药剂师审核响应 (Patient: WebPatient_665ed697)。Status: rejected
2025-03-30 14:42:33,864 - Hospital-MultiAgent-System - WARNING - 处方审核被拒绝 (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): ['解痉药未明确具体药物名称，可能导致用药不当', '疗程未指定，可能影响治疗效果']
2025-03-30 14:42:33,864 - Hospital-MultiAgent-System - INFO - Web 咨询 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb 已达到结束状态: error_prescription_rejected
2025-03-30 14:42:33,873 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb): Status=error_prescription_rejected, Agent=doctor, Msg='感谢您的配合。根据您提供的信息，我已完成初步诊断。
处方审核未通过: 解痉药未明确具体药物名称，可能导致用药不当、疗程未指定，可能影响治疗效...'
2025-03-30 14:42:33,873 - Hospital-MultiAgent-System-Web - INFO - Web 咨询 web_cd392019-8c5e-4be3-a0be-b00ae7b1e7cb 已达到结束状态: error_prescription_rejected
2025-03-30 14:42:33,874 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:42:33] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 14:50:15,823 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:50:15] "GET / HTTP/1.1" 200 -
2025-03-30 14:50:15,836 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:50:15] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 14:50:15,837 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:50:15] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 14:50:46,731 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 14:50:46,731 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 14:50:46,731 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 14:50:46,731 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 14:50:46,731 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 14:50:46,744 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 14:50:46,744 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 14:50:46,745 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 14:50:46,745 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 6503d90a-f875-4e8c-ba7c-04a3c6e25476)
2025-03-30 14:50:46,745 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 14:50:46,745 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 906780a8-08f9-4ce3-a263-50bbaf0ab923)
2025-03-30 14:50:46,745 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 14:50:46,745 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: f02ade55-98a3-4260-bf49-bb5f0601c6a6)
2025-03-30 14:50:46,745 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 14:50:46,745 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 14:50:46,745 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 14:50:46,745 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 14:50:46,763 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 14:50:46,763 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 14:50:46,763 - werkzeug - INFO -  * Restarting with stat
2025-03-30 14:50:46,944 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 14:50:46,944 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 14:50:46,944 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 14:50:46,944 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 14:50:46,957 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 14:50:46,957 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 14:50:46,958 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 14:50:46,958 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 544234a2-9ed9-4dd7-8969-5627f4afac1b)
2025-03-30 14:50:46,958 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 14:50:46,958 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 6da20e33-efbd-4eac-8ace-83f46bba924d)
2025-03-30 14:50:46,958 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 14:50:46,958 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: db4e6f30-70bc-467a-9b3d-5808fa817a2d)
2025-03-30 14:50:46,958 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 14:50:46,958 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 14:50:46,958 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 14:50:46,958 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 14:50:46,970 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 14:50:46,974 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 14:50:52,127 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:50:52] "GET / HTTP/1.1" 200 -
2025-03-30 14:50:52,141 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:50:52] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 14:50:52,141 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:50:52] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 14:51:55,206 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:51:55] "GET / HTTP/1.1" 200 -
2025-03-30 14:51:55,217 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:51:55] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 14:51:55,218 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:51:55] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 14:52:05,082 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 14:52:05,082 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 14:52:05,082 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 14:52:05,082 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 14:52:05,082 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 14:52:05,095 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 14:52:05,095 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 14:52:05,096 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 14:52:05,096 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 2c17c6b0-7023-4471-9be3-ac6b8bc6cd1a)
2025-03-30 14:52:05,096 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 14:52:05,096 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: d06f796d-59df-4fce-bf54-740eb396d6c6)
2025-03-30 14:52:05,096 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 14:52:05,096 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: b55c23ab-ab75-4b21-9202-b72339aacb50)
2025-03-30 14:52:05,096 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 14:52:05,096 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 14:52:05,096 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 14:52:05,096 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 14:52:05,115 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 14:52:05,115 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 14:52:05,116 - werkzeug - INFO -  * Restarting with stat
2025-03-30 14:52:05,308 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 14:52:05,308 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 14:52:05,308 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 14:52:05,308 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 14:52:05,321 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 14:52:05,321 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 14:52:05,322 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 14:52:05,322 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 73f83f22-e3c5-4aeb-9034-45dcf35ec8b8)
2025-03-30 14:52:05,322 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 14:52:05,322 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: d07a57a8-1db3-4b3e-a4cf-846e9dc63734)
2025-03-30 14:52:05,322 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 14:52:05,322 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: e887753e-0ead-4ab3-93dd-0e945cd3bcd8)
2025-03-30 14:52:05,322 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 14:52:05,322 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 14:52:05,322 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 14:52:05,322 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 14:52:05,336 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 14:52:05,340 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 14:52:08,074 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:52:08] "GET / HTTP/1.1" 200 -
2025-03-30 14:52:08,089 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:52:08] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 14:52:08,089 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:52:08] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 14:52:08,960 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:52:08] "GET / HTTP/1.1" 200 -
2025-03-30 14:52:08,969 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:52:08] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 14:52:08,971 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:52:08] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 14:52:09,121 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:52:09] "GET / HTTP/1.1" 200 -
2025-03-30 14:52:09,128 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:52:09] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 14:52:09,130 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 14:52:09] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 15:02:54,990 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/memory_system.py', reloading
2025-03-30 15:02:55,060 - werkzeug - INFO -  * Restarting with stat
2025-03-30 15:02:55,340 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:02:55,340 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:02:55,340 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 15:02:55,340 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 15:02:55,353 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:02:55,353 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:02:55,354 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:02:55,354 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: ff4b9755-165f-4bc5-b161-cba659c7db3d)
2025-03-30 15:02:55,354 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:02:55,354 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 47601b98-7d56-4f26-9dbe-56a6e5594ba2)
2025-03-30 15:02:55,354 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:02:55,354 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 8e8120e6-09f4-4962-844d-2befdbcd30c4)
2025-03-30 15:02:55,354 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:02:55,354 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:02:55,354 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:02:55,354 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:02:55,371 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 15:02:55,375 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 15:03:25,634 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 15:03:25,703 - werkzeug - INFO -  * Restarting with stat
2025-03-30 15:03:25,893 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:03:25,893 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:03:25,893 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 15:03:25,893 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 15:03:25,905 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:03:25,905 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:03:25,906 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:03:25,906 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: aadff15a-2636-4b3b-98a1-59d97fcf7d2f)
2025-03-30 15:03:25,906 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:03:25,906 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: d89221c3-afe2-4036-9867-af6f755dd426)
2025-03-30 15:03:25,906 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:03:25,906 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 8b5c68c3-a27e-461d-bc8b-c6070e2cba07)
2025-03-30 15:03:25,906 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:03:25,906 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:03:25,906 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:03:25,906 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:03:25,919 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 15:03:25,923 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 15:03:34,539 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:03:34,539 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 15:03:34,539 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:03:34,539 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 15:03:34,539 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 15:03:34,551 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:03:34,551 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:03:34,552 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:03:34,552 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: afb56938-fe00-4407-971c-3d308410ac25)
2025-03-30 15:03:34,552 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:03:34,552 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: c60dfd64-757f-4a51-81ed-529e3aae7e0c)
2025-03-30 15:03:34,552 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:03:34,552 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 45aea416-3731-43c3-ac4f-b4c565988be7)
2025-03-30 15:03:34,552 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:03:34,552 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:03:34,552 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:03:34,553 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:03:34,570 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 15:03:34,571 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 15:03:34,571 - werkzeug - INFO -  * Restarting with stat
2025-03-30 15:03:34,753 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:03:34,753 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:03:34,753 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 15:03:34,753 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 15:03:34,765 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:03:34,766 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:03:34,766 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:03:34,766 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 11f6f991-5281-4027-8bb3-86715cc723b0)
2025-03-30 15:03:34,766 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:03:34,766 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: fa7cc698-a66d-470e-929f-2606303494cd)
2025-03-30 15:03:34,766 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:03:34,766 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 254e6af3-ff8d-4df4-834a-654d7cd9b01e)
2025-03-30 15:03:34,766 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:03:34,767 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:03:34,767 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:03:34,767 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:03:34,780 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 15:03:34,784 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 15:03:38,130 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:03:38] "GET / HTTP/1.1" 200 -
2025-03-30 15:03:38,143 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:03:38] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 15:03:38,144 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:03:38] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 15:03:38,151 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:03:38,151 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:03:38,152 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:03:38] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 15:03:42,798 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): '你好...'
2025-03-30 15:03:42,799 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062，视为新对话，转给接待员。
2025-03-30 15:03:42,800 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_67ab916b 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T07:03:42.799748+00:00'}
2025-03-30 15:03:42,800 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_67ab916b 不存在，创建新的记忆记录。
2025-03-30 15:03:42,809 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_67ab916b (Name: 网页用户, Age: None)
2025-03-30 15:03:42,817 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:03:42,825 - Hospital-MultiAgent-System - INFO - 为咨询 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient: WebPatient_67ab916b) 创建新上下文
2025-03-30 15:03:42,825 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient: WebPatient_67ab916b)
2025-03-30 15:03:42,834 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 15:03:42,834 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 15:03:42,834 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 15:03:43,423 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:03:43,426 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:03:45,156 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:03:45,162 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.74秒
2025-03-30 15:03:45,163 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 15:03:45,163 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_67ab916b): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 15:03:45,163 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 15:03:45,163 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 15:03:45,163 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 15:03:45,163 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 15:03:45,165 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:03:45,168 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:03:46,405 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:03:46,411 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.24秒
2025-03-30 15:03:46,412 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好！欢迎光临，请问您需要什么帮助？如果是预约医生，请简单描述症状，我们会协助安排合适的分诊。
2025-03-30 15:03:46,437 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): Status=in_progress, Agent=receptionist, Msg='您好！欢迎光临，请问您需要什么帮助？如果是预约医生，请简单描述症状，我们会协助安排合适的分诊。...'
2025-03-30 15:03:46,438 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:03:46] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:03:51,952 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): '我要打篮球...'
2025-03-30 15:03:51,952 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient ID in context: WebPatient_67ab916b), 当前阶段: reception_chatting
2025-03-30 15:03:51,952 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:03:51,962 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062, 当前阶段: reception_chatting
2025-03-30 15:03:51,970 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 15:03:51,970 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 15:03:51,970 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好
Receptio...
2025-03-30 15:03:51,972 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:03:51,973 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:03:54,032 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:03:54,038 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.06秒
2025-03-30 15:03:54,039 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "unclear",
  "has_sufficient...
2025-03-30 15:03:54,039 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_67ab916b): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 15:03:54,040 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_67ab916b)
2025-03-30 15:03:54,066 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 15:03:54,067 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:03:54] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:03:59,626 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): '附近有合适的篮球场吗？...'
2025-03-30 15:03:59,626 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient ID in context: WebPatient_67ab916b), 当前阶段: reception_clarification
2025-03-30 15:03:59,627 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:03:59,636 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062, 当前阶段: reception_clarification
2025-03-30 15:03:59,645 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 15:03:59,645 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 15:03:59,645 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 您好！...
2025-03-30 15:03:59,792 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:03:59,796 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:04:02,154 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:04:02,162 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.36秒
2025-03-30 15:04:02,162 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 15:04:02,162 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_67ab916b): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 15:04:02,163 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 2
2025-03-30 15:04:02,163 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 15:04:02,163 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 15:04:02,163 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："附近有合适的篮球场吗？"。请给出一个简洁、专业、乐于...
2025-03-30 15:04:02,167 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:04:02,169 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:04:03,079 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:04:03,084 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.91秒
2025-03-30 15:04:03,084 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：抱歉，我们主要提供医疗相关服务。建议您查询当地社区或体育中心的信息，可能会更方便找到合适的篮球场。
2025-03-30 15:04:03,113 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): Status=in_progress, Agent=receptionist, Msg='抱歉，我们主要提供医疗相关服务。建议您查询当地社区或体育中心的信息，可能会更方便找到合适的篮球场。...'
2025-03-30 15:04:03,113 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:04:03] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:04:15,594 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): '那你打厂上哪个位置？...'
2025-03-30 15:04:15,595 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient ID in context: WebPatient_67ab916b), 当前阶段: reception_chatting
2025-03-30 15:04:15,595 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:04:15,606 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062, 当前阶段: reception_chatting
2025-03-30 15:04:15,614 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 15:04:15,614 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 15:04:15,614 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 嗯，请...
2025-03-30 15:04:16,087 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:04:16,096 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:04:18,186 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:04:18,189 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.09秒
2025-03-30 15:04:18,189 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 15:04:18,189 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_67ab916b): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 15:04:18,189 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 3
2025-03-30 15:04:18,189 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 15:04:18,189 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 15:04:18,189 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："那你打厂上哪个位置？"。请给出一个简洁、专业、乐于助...
2025-03-30 15:04:18,191 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:04:18,196 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:04:19,054 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:04:19,057 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.86秒
2025-03-30 15:04:19,057 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，为了更好地为您安排，请您简单描述一下症状或需求，我们会根据情况进行分诊，感谢您的配合！
2025-03-30 15:04:19,085 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): Status=in_progress, Agent=receptionist, Msg='您好，为了更好地为您安排，请您简单描述一下症状或需求，我们会根据情况进行分诊，感谢您的配合！...'
2025-03-30 15:04:19,086 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:04:19] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:04:32,458 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): '我打组织后卫...'
2025-03-30 15:04:32,459 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient ID in context: WebPatient_67ab916b), 当前阶段: reception_chatting
2025-03-30 15:04:32,459 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:04:32,470 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062, 当前阶段: reception_chatting
2025-03-30 15:04:32,478 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 15:04:32,478 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 15:04:32,478 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 抱歉，...
2025-03-30 15:04:32,936 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:04:32,938 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:04:35,004 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:04:35,007 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.07秒
2025-03-30 15:04:35,007 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 15:04:35,007 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_67ab916b): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 15:04:35,007 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 4
2025-03-30 15:04:35,036 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): Status=in_progress, Agent=receptionist, Msg='非常抱歉，我们已经聊了几句了。如果您有身体不适需要咨询，请详细描述您的症状，否则我需要优先处理其他患者的请求。...'
2025-03-30 15:04:35,037 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:04:35] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:04:48,382 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): '我打得分后卫可以吗？...'
2025-03-30 15:04:48,382 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient ID in context: WebPatient_67ab916b), 当前阶段: reception_chat_ended
2025-03-30 15:04:48,383 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:04:48,395 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062, 当前阶段: reception_chat_ended
2025-03-30 15:04:48,404 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 15:04:48,404 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 15:04:48,404 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 您好，...
2025-03-30 15:04:48,953 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:04:48,960 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:04:50,692 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:04:50,695 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.73秒
2025-03-30 15:04:50,695 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "unclear",
  "has_sufficient...
2025-03-30 15:04:50,695 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_67ab916b): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 15:04:50,695 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_67ab916b)
2025-03-30 15:04:50,726 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 15:04:50,727 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:04:50] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:05:14,432 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): '我肚子疼...'
2025-03-30 15:05:14,432 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient ID in context: WebPatient_67ab916b), 当前阶段: reception_clarification
2025-03-30 15:05:14,432 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:05:14,444 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062, 当前阶段: reception_clarification
2025-03-30 15:05:14,452 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 15:05:14,452 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 15:05:14,452 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 非常抱...
2025-03-30 15:05:15,096 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:05:15,100 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:05:16,817 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:05:16,819 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.72秒
2025-03-30 15:05:16,820 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "medical_inquiry",
  "has_su...
2025-03-30 15:05:16,820 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_67ab916b): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['腹痛']
2025-03-30 15:05:16,820 - Hospital-MultiAgent-System - INFO - 识别到医疗意图或提前提供身份，准备询问/确认身份信息 (Patient: WebPatient_67ab916b)
2025-03-30 15:05:16,850 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): Status=in_progress, Agent=receptionist, Msg='了解您身体不适。为了更好地帮助您（特别是如果您之前来过），请问您的手机号码是多少？这次是复诊吗？...'
2025-03-30 15:05:16,850 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:05:16] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:05:30,294 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): '18611110000 不是复诊...'
2025-03-30 15:05:30,294 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient ID in context: WebPatient_67ab916b), 当前阶段: reception_asking_identity
2025-03-30 15:05:30,294 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:05:30,306 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062, 当前阶段: reception_asking_identity
2025-03-30 15:05:30,314 - Hospital-MultiAgent-System - INFO - 处理用户对身份问题的回复 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062)
2025-03-30 15:05:30,314 - Hospital-MultiAgent-System - INFO - 未找到匹配手机号的患者，或未提供手机号。将使用当前ID: WebPatient_67ab916b
2025-03-30 15:05:30,314 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_67ab916b 的基本信息: {'phone': '18611110000', 'source': 'web', 'first_consultation_id': 'web_b7898669-79f9-47f5-914d-e5cd8dd6f062'}
2025-03-30 15:05:30,322 - Hospital-MultiAgent-System - INFO - 身份信息处理完毕，症状充分，准备分诊 (Patient: WebPatient_67ab916b)
2025-03-30 15:05:30,323 - Hospital-MultiAgent-System - INFO - 执行分诊逻辑 (Patient: WebPatient_67ab916b)
2025-03-30 15:05:30,323 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.2
2025-03-30 15:05:30,323 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 15:05:30,323 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 15:05:30,946 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:05:30,949 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:05:33,858 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:05:33,863 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.91秒
2025-03-30 15:05:33,864 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "n...
2025-03-30 15:05:33,864 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=normal
2025-03-30 15:05:33,885 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062)，准备触发医生诊断。
2025-03-30 15:05:33,885 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062, Patient: WebPatient_67ab916b)...
2025-03-30 15:05:33,892 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_67ab916b 的诊断请求 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062)。复诊: True
2025-03-30 15:05:33,892 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 15:05:33,892 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 15:05:33,892 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 15:05:33,895 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:05:33,897 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:05:35,444 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:05:35,447 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.55秒
2025-03-30 15:05:35,447 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：腹痛具体是位于腹部的哪个位置？例如上腹、中腹或下腹？
2025-03-30 15:05:35,447 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient: WebPatient_67ab916b)
2025-03-30 15:05:35,483 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062)
2025-03-30 15:05:35,483 - Hospital-MultiAgent-System - INFO - 成功转接给医生并获取第一个问题 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062)
2025-03-30 15:05:35,488 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): Status=in_progress, Agent=doctor, Msg='腹痛具体是位于腹部的哪个位置？例如上腹、中腹或下腹？...'
2025-03-30 15:05:35,488 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:05:35] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:05:39,244 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): '下腹...'
2025-03-30 15:05:39,244 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient ID in context: WebPatient_67ab916b), 当前阶段: information_gathering
2025-03-30 15:05:39,244 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:05:39,248 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_67ab916b 对问题 (Context: web_b7898669-79f9-47f5-914d-e5cd8dd6f062) 的回答: '下腹...'
2025-03-30 15:05:39,253 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 15:05:39,253 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 15:05:39,253 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "腹痛具体是位...
2025-03-30 15:05:39,254 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:05:39,255 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:05:40,357 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:05:40,360 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.10秒
2025-03-30 15:05:40,361 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["下腹痛"],
  "symptom_de...
2025-03-30 15:05:40,361 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_67ab916b 回答分析完成。当前症状: ['用户描述不清晰', '下腹痛', '腹痛']. 置信度: 0.45
2025-03-30 15:05:40,361 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_67ab916b (Context: web_b7898669-79f9-47f5-914d-e5cd8dd6f062) 提出下一个问题。
2025-03-30 15:05:40,361 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 15:05:40,361 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 15:05:40,361 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 15:05:40,364 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:05:40,365 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:05:41,116 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:05:41,120 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.75秒
2025-03-30 15:05:41,121 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：腹痛是否伴随其他症状，例如恶心、呕吐、腹泻或便秘？
2025-03-30 15:05:41,156 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): Status=in_progress, Agent=doctor, Msg='腹痛是否伴随其他症状，例如恶心、呕吐、腹泻或便秘？...'
2025-03-30 15:05:41,157 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:05:41] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:05:44,975 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): '呕吐...'
2025-03-30 15:05:44,975 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient ID in context: WebPatient_67ab916b), 当前阶段: information_gathering
2025-03-30 15:05:44,975 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:05:44,987 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_67ab916b 对问题 (Context: web_b7898669-79f9-47f5-914d-e5cd8dd6f062) 的回答: '呕吐...'
2025-03-30 15:05:44,996 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 15:05:44,996 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 15:05:44,996 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "腹痛是否伴随...
2025-03-30 15:05:44,997 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:05:44,998 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:05:46,175 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:05:46,179 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.18秒
2025-03-30 15:05:46,179 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["呕吐"],
  "symptom_det...
2025-03-30 15:05:46,180 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_67ab916b 回答分析完成。当前症状: ['用户描述不清晰', '腹痛', '下腹痛', '呕吐']. 置信度: 0.55
2025-03-30 15:05:46,180 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_67ab916b (Context: web_b7898669-79f9-47f5-914d-e5cd8dd6f062) 提出下一个问题。
2025-03-30 15:05:46,180 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 15:05:46,180 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 15:05:46,180 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 15:05:46,737 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:05:46,740 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:05:47,835 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:05:47,838 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.10秒
2025-03-30 15:05:47,838 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：腹痛的性质是怎样的？例如是持续性钝痛、间歇性绞痛还是剧烈刺痛？
2025-03-30 15:05:47,871 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): Status=in_progress, Agent=doctor, Msg='腹痛的性质是怎样的？例如是持续性钝痛、间歇性绞痛还是剧烈刺痛？...'
2025-03-30 15:05:47,871 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:05:47] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:05:58,979 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): '间歇性...'
2025-03-30 15:05:58,979 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient ID in context: WebPatient_67ab916b), 当前阶段: information_gathering
2025-03-30 15:05:58,979 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:05:58,991 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_67ab916b 对问题 (Context: web_b7898669-79f9-47f5-914d-e5cd8dd6f062) 的回答: '间歇性...'
2025-03-30 15:05:58,999 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 15:05:58,999 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 15:05:58,999 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "腹痛的性质是...
2025-03-30 15:05:59,594 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:05:59,597 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:06:01,760 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:06:01,763 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.17秒
2025-03-30 15:06:01,763 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["间歇性腹痛"],
  "symptom_...
2025-03-30 15:06:01,764 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_67ab916b 回答分析完成。当前症状: ['用户描述不清晰', '下腹痛', '腹痛', '呕吐', '间歇性腹痛']. 置信度: 0.65
2025-03-30 15:06:01,764 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_67ab916b (Context: web_b7898669-79f9-47f5-914d-e5cd8dd6f062) 提出下一个问题。
2025-03-30 15:06:01,764 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 15:06:01,764 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 15:06:01,764 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 15:06:01,767 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:06:01,769 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:06:02,919 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:06:02,922 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.15秒
2025-03-30 15:06:02,923 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：腹痛是否与进食有关？例如，进食后是否加重或缓解？
2025-03-30 15:06:02,958 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): Status=in_progress, Agent=doctor, Msg='腹痛是否与进食有关？例如，进食后是否加重或缓解？...'
2025-03-30 15:06:02,958 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:06:02] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:06:09,647 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): '进食后...'
2025-03-30 15:06:09,647 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient ID in context: WebPatient_67ab916b), 当前阶段: information_gathering
2025-03-30 15:06:09,647 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062
2025-03-30 15:06:09,658 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_67ab916b 对问题 (Context: web_b7898669-79f9-47f5-914d-e5cd8dd6f062) 的回答: '进食后...'
2025-03-30 15:06:09,666 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 15:06:09,666 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 15:06:09,666 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "腹痛是否与进...
2025-03-30 15:06:09,668 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:06:09,669 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:06:11,696 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:06:11,699 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.03秒
2025-03-30 15:06:11,700 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 15:06:11,700 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_67ab916b 回答分析完成。当前症状: ['用户描述不清晰', '下腹痛', '腹痛', '呕吐', '间歇性腹痛']. 置信度: 0.75
2025-03-30 15:06:11,700 - Hospital-MultiAgent-System - INFO - 可以诊断：问题数 4 >= 4 且置信度 0.75 > 0.4
2025-03-30 15:06:11,700 - Hospital-MultiAgent-System - INFO - 医生 主治医生 可以为患者 WebPatient_67ab916b (Context: web_b7898669-79f9-47f5-914d-e5cd8dd6f062) 做出诊断。
2025-03-30 15:06:11,700 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：600，温度：0.3
2025-03-30 15:06:11,700 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位资深医生，正在进行诊断。请给出专业、详细且结构化的诊断结果（JSON格式）。
2025-03-30 15:06:11,700 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医生，请根据以下信息生成诊断结果：
症状：用户描述不清晰, 下腹痛, 腹痛, 呕吐, 间歇性...
2025-03-30 15:06:11,702 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:06:11,705 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:06:15,993 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:06:15,997 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：4.29秒
2025-03-30 15:06:15,997 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "急性胃肠炎",
  "explanation":...
2025-03-30 15:06:15,997 - Hospital-MultiAgent-System - INFO - 为症状 '用户描述不清晰, 下腹痛, 腹痛, 呕吐, 间歇性腹痛' 生成诊断结果：急性胃肠炎
2025-03-30 15:06:16,012 - Hospital-MultiAgent-System - INFO - 删除问诊上下文: web_b7898669-79f9-47f5-914d-e5cd8dd6f062 (Patient: WebPatient_67ab916b)
2025-03-30 15:06:16,026 - Hospital-MultiAgent-System - INFO - 医生完成诊断 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062, Patient used by Doctor: WebPatient_67ab916b)
2025-03-30 15:06:16,027 - Hospital-MultiAgent-System - INFO - 诊断完成，需要开药，同步触发处方审核 (Patient: WebPatient_67ab916b, Context: web_b7898669-79f9-47f5-914d-e5cd8dd6f062)
2025-03-30 15:06:16,027 - Hospital-MultiAgent-System - INFO - 向药剂师发送处方审核请求 (Patient: WebPatient_67ab916b)...
2025-03-30 15:06:16,032 - Hospital-MultiAgent-System - INFO - 药剂师 药剂师 正在审核患者 WebPatient_67ab916b 的处方...
2025-03-30 15:06:16,032 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.1
2025-03-30 15:06:16,032 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富、极其严谨的临床药剂师。请仔细检查处方，并【严格按照要求的JSON格式】输出反馈，【...
2025-03-30 15:06:16,032 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位资深临床药剂师，请基于患者的部分诊断信息和以下处方，严格审核其合理性、安全性及潜在风险。

...
2025-03-30 15:06:16,217 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:06:16,219 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:06:18,553 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:06:18,556 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.34秒
2025-03-30 15:06:18,556 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "valid": false,
  "issues": ["疗程未指定", "蒙脱石散剂量可...
2025-03-30 15:06:18,556 - Hospital-MultiAgent-System - INFO - 处方审核LLM解析成功: Valid=False, Issues=2, Warnings=1
2025-03-30 15:06:18,568 - Hospital-MultiAgent-System - WARNING - 患者 WebPatient_67ab916b 的处方未通过审核: 疗程未指定、蒙脱石散剂量可能偏高，建议复核
2025-03-30 15:06:18,579 - Hospital-MultiAgent-System - INFO - 收到药剂师审核响应 (Patient: WebPatient_67ab916b)。Status: rejected
2025-03-30 15:06:18,579 - Hospital-MultiAgent-System - WARNING - 处方审核被拒绝 (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): ['疗程未指定', '蒙脱石散剂量可能偏高，建议复核']
2025-03-30 15:06:18,580 - Hospital-MultiAgent-System - INFO - Web 咨询 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 已达到结束状态: error_prescription_rejected
2025-03-30 15:06:18,586 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_b7898669-79f9-47f5-914d-e5cd8dd6f062): Status=error_prescription_rejected, Agent=doctor, Msg='感谢您的配合。根据您提供的信息，我已完成初步诊断。
处方审核未通过: 疗程未指定、蒙脱石散剂量可能偏高，建议复核。处方存在剂量和疗程信息不足...'
2025-03-30 15:06:18,586 - Hospital-MultiAgent-System-Web - INFO - Web 咨询 web_b7898669-79f9-47f5-914d-e5cd8dd6f062 已达到结束状态: error_prescription_rejected
2025-03-30 15:06:18,587 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:06:18] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:19:22,011 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:19:22,011 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 15:19:22,011 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:19:22,011 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 15:19:22,011 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 15:19:22,024 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:19:22,024 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:19:22,025 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:19:22,025 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 5d826c9c-e396-4929-af8f-d06ba4262167)
2025-03-30 15:19:22,025 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:19:22,025 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 28243ad1-6043-430c-a6bd-2dd0f365ac48)
2025-03-30 15:19:22,025 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:19:22,025 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 8d1a271b-5fee-4c5b-8ad9-9488408b4cf7)
2025-03-30 15:19:22,025 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:19:22,025 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:19:22,025 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:19:22,025 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:19:22,044 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 15:19:22,045 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 15:19:22,045 - werkzeug - INFO -  * Restarting with stat
2025-03-30 15:19:22,225 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:19:22,225 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:19:22,225 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 15:19:22,225 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 15:19:22,238 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:19:22,238 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:19:22,239 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:19:22,239 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 43e424c6-383d-4e92-8f30-12fdc4ecd780)
2025-03-30 15:19:22,239 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:19:22,239 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: caa66fa9-783c-4f4c-a806-5af447127729)
2025-03-30 15:19:22,239 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:19:22,239 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: abbc64c1-d895-4f48-b63a-c309c00f5fbc)
2025-03-30 15:19:22,239 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:19:22,239 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:19:22,239 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:19:22,239 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:19:22,253 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 15:19:22,257 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 15:19:28,053 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:19:28] "GET / HTTP/1.1" 200 -
2025-03-30 15:19:28,066 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:19:28] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 15:19:28,068 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:19:28] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 15:19:28,074 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_e0d75f66-44d6-4db7-a497-c84782f72f5e
2025-03-30 15:19:28,075 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_e0d75f66-44d6-4db7-a497-c84782f72f5e
2025-03-30 15:19:28,075 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:19:28] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 15:19:35,089 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_e0d75f66-44d6-4db7-a497-c84782f72f5e): '你好...'
2025-03-30 15:19:35,089 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_e0d75f66-44d6-4db7-a497-c84782f72f5e，视为新对话，转给接待员。
2025-03-30 15:19:35,090 - Hospital-MultiAgent-System-Web - ERROR - 处理 Web 对话失败 (Session Consult ID: web_e0d75f66-44d6-4db7-a497-c84782f72f5e): 'Orchestrator' object has no attribute '_extract_info_from_initial_message'
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/web_app.py", line 168, in handle_conversation
    response_data = orchestrator.handle_web_message(consultation_id, user_message)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py", line 156, in handle_web_message
    extracted_info = self._extract_info_from_initial_message(user_message)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Orchestrator' object has no attribute '_extract_info_from_initial_message'
2025-03-30 15:19:35,094 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:19:35] "[35m[1mPOST /api/conversation HTTP/1.1[0m" 500 -
2025-03-30 15:29:02,979 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 15:29:03,055 - werkzeug - INFO -  * Restarting with stat
2025-03-30 15:29:03,249 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:29:03,249 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:29:03,249 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 15:29:03,249 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 15:29:03,261 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:29:03,262 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:29:03,263 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:29:03,263 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: e9286071-6310-404c-90bd-daf96ca8d481)
2025-03-30 15:29:03,263 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:29:03,263 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 62a8cbc9-dd29-4aa7-b4fe-703a6d9f3db2)
2025-03-30 15:29:03,263 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:29:03,263 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: c710242c-28e5-43bd-ba15-073857b77332)
2025-03-30 15:29:03,263 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:29:03,263 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:29:03,264 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:29:03,265 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:29:03,278 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 15:29:03,283 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 15:29:10,072 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:29:10,072 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 15:29:10,072 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:29:10,072 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 15:29:10,072 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 15:29:10,084 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:29:10,084 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:29:10,085 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:29:10,085 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 462909a9-fd45-408e-a566-02a212dfc408)
2025-03-30 15:29:10,085 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:29:10,085 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 9924ee3d-ad3d-4477-82d6-02e3b5269433)
2025-03-30 15:29:10,085 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:29:10,085 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 12e34e6d-005d-44b5-94d3-13ecf11b30fb)
2025-03-30 15:29:10,085 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:29:10,085 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:29:10,085 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:29:10,085 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:29:10,103 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 15:29:10,103 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 15:29:10,103 - werkzeug - INFO -  * Restarting with stat
2025-03-30 15:29:10,286 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:29:10,286 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:29:10,286 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 15:29:10,286 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 15:29:10,298 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:29:10,298 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:29:10,299 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:29:10,299 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: cbff4a2e-4a5c-403e-a096-e471a5527bc2)
2025-03-30 15:29:10,299 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:29:10,299 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 35dcde95-9c3c-4453-833e-7a5772a95525)
2025-03-30 15:29:10,299 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:29:10,299 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 1b857264-1224-40a1-9e45-dfab628a38fe)
2025-03-30 15:29:10,299 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:29:10,299 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:29:10,299 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:29:10,300 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:29:10,312 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 15:29:10,316 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 15:29:19,361 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:29:19] "GET / HTTP/1.1" 200 -
2025-03-30 15:29:19,373 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:29:19] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 15:29:19,375 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:29:19] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 15:29:19,381 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_eb347460-27dd-4414-bb85-934bf1c81a27
2025-03-30 15:29:19,382 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_eb347460-27dd-4414-bb85-934bf1c81a27
2025-03-30 15:29:19,382 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:29:19] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 15:29:22,872 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_eb347460-27dd-4414-bb85-934bf1c81a27): '你好...'
2025-03-30 15:29:22,875 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_eb347460-27dd-4414-bb85-934bf1c81a27，视为新对话，转给接待员。
2025-03-30 15:29:22,876 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_0ae424cd 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T07:29:22.876118+00:00'}
2025-03-30 15:29:22,876 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_0ae424cd 不存在，创建新的记忆记录。
2025-03-30 15:29:22,886 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_0ae424cd (Name: 网页用户, Age: None)
2025-03-30 15:29:22,887 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_eb347460-27dd-4414-bb85-934bf1c81a27
2025-03-30 15:29:22,895 - Hospital-MultiAgent-System - INFO - 为咨询 web_eb347460-27dd-4414-bb85-934bf1c81a27 (Patient: WebPatient_0ae424cd) 创建新上下文
2025-03-30 15:29:22,895 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_eb347460-27dd-4414-bb85-934bf1c81a27 (Patient: WebPatient_0ae424cd)
2025-03-30 15:29:22,906 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 15:29:22,906 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 15:29:22,906 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 15:29:23,039 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:29:23,041 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:29:24,774 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:29:24,786 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.74秒
2025-03-30 15:29:24,790 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 15:29:24,791 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0ae424cd): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 15:29:24,791 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 15:29:24,791 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 15:29:24,791 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 15:29:24,791 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 15:29:24,793 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:29:24,795 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:29:25,906 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:29:25,909 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.11秒
2025-03-30 15:29:25,909 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，欢迎光临医院！请您简单描述需要帮助的内容，我们将为您安排合适的医生或服务。
2025-03-30 15:29:25,943 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_eb347460-27dd-4414-bb85-934bf1c81a27): Status=in_progress, Agent=receptionist, Msg='您好，欢迎光临医院！请您简单描述需要帮助的内容，我们将为您安排合适的医生或服务。...'
2025-03-30 15:29:25,944 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:29:25] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:29:43,072 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_eb347460-27dd-4414-bb85-934bf1c81a27): '什么意思？...'
2025-03-30 15:29:43,081 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_eb347460-27dd-4414-bb85-934bf1c81a27 (Patient ID in context: WebPatient_0ae424cd), 当前阶段: reception_chatting
2025-03-30 15:29:43,081 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_eb347460-27dd-4414-bb85-934bf1c81a27
2025-03-30 15:29:43,097 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_eb347460-27dd-4414-bb85-934bf1c81a27, 当前阶段: reception_chatting
2025-03-30 15:29:43,102 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 15:29:43,102 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 15:29:43,103 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好
Receptio...
2025-03-30 15:29:43,406 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:29:43,408 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:29:45,162 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:29:45,166 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.76秒
2025-03-30 15:29:45,167 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "asking_guidance",
  "has_sufficient...
2025-03-30 15:29:45,167 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0ae424cd): Intent=asking_guidance, SufficientInfo=False, Symptoms=[]
2025-03-30 15:29:45,167 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_0ae424cd)
2025-03-30 15:29:45,202 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_eb347460-27dd-4414-bb85-934bf1c81a27): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 15:29:45,203 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:29:45] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 15:38:10,748 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:38:10,748 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 15:38:10,748 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:38:10,748 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 15:38:10,748 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 15:38:10,761 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:38:10,761 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:38:10,762 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:38:10,762 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 8449c555-81e1-4f97-a1eb-b3d4cda86c6f)
2025-03-30 15:38:10,762 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:38:10,762 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 282548ab-d863-4d8a-89c5-cae1a5313a12)
2025-03-30 15:38:10,762 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:38:10,762 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 00abe9f9-5fbd-4aff-8291-eaee206b3cfe)
2025-03-30 15:38:10,762 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:38:10,762 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:38:10,762 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:38:10,762 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:38:10,780 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 15:38:10,780 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 15:38:10,781 - werkzeug - INFO -  * Restarting with stat
2025-03-30 15:38:10,961 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:38:10,961 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:38:10,961 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 15:38:10,961 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 15:38:10,974 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:38:10,974 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:38:10,975 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:38:10,975 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: ccb15ecc-47f6-4f9f-bf72-1880269f8d81)
2025-03-30 15:38:10,975 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:38:10,975 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: db6d6653-82e7-4dfa-a381-d93ec89d6aac)
2025-03-30 15:38:10,975 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:38:10,975 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 93d7abbe-59a0-4e92-b98d-86c8c17c6f0e)
2025-03-30 15:38:10,975 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:38:10,975 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:38:10,975 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:38:10,975 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:38:10,989 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 15:38:10,993 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 15:38:15,098 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:38:15] "GET / HTTP/1.1" 200 -
2025-03-30 15:38:15,111 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:38:15] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 15:38:15,111 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:38:15] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 15:38:15,118 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_72d53ab9-1fbd-41da-8e7f-8725ed17f3cf
2025-03-30 15:38:15,118 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_72d53ab9-1fbd-41da-8e7f-8725ed17f3cf
2025-03-30 15:38:15,118 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:38:15] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 15:38:19,356 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:38:19] "[31m[1mGET /api/conversation HTTP/1.1[0m" 405 -
2025-03-30 15:51:03,348 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:51:03,348 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 15:51:03,348 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:51:03,348 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 15:51:03,348 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 15:51:03,361 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:51:03,361 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:51:03,362 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:51:03,362 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 03b31c73-1486-425b-9083-415b327ac941)
2025-03-30 15:51:03,362 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:51:03,362 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 2d4fa527-9270-49c9-9eb6-29c148f739e5)
2025-03-30 15:51:03,362 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:51:03,362 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: dfcd2c05-f178-498f-a10f-c4ecac9192ba)
2025-03-30 15:51:03,362 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:51:03,362 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:51:03,362 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:51:03,363 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:51:03,383 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 15:51:03,383 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 15:51:03,383 - werkzeug - INFO -  * Restarting with stat
2025-03-30 15:51:03,564 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 15:51:03,564 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 15:51:03,564 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 15:51:03,564 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 15:51:03,576 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 15:51:03,576 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 15:51:03,577 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 15:51:03,577 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 6e10d5a8-7a3e-472d-9c7a-3be964dd38b7)
2025-03-30 15:51:03,577 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 15:51:03,577 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: eacdd26a-518f-41ec-bcab-76b96e760e7a)
2025-03-30 15:51:03,577 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 15:51:03,577 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 39a89780-5692-4e8a-923f-1aa81ab6f884)
2025-03-30 15:51:03,577 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 15:51:03,577 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 15:51:03,577 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 15:51:03,578 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 15:51:03,590 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 15:51:03,594 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 15:51:07,685 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:51:07] "GET / HTTP/1.1" 200 -
2025-03-30 15:51:07,697 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:51:07] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 15:51:07,697 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:51:07] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 15:51:07,704 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_abca6e75-4f89-4813-a924-d5650a8d158a
2025-03-30 15:51:07,704 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_abca6e75-4f89-4813-a924-d5650a8d158a
2025-03-30 15:51:07,704 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:51:07] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 15:51:10,287 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_abca6e75-4f89-4813-a924-d5650a8d158a): '你好...'
2025-03-30 15:51:10,287 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_abca6e75-4f89-4813-a924-d5650a8d158a，视为新对话，转给接待员。
2025-03-30 15:51:10,288 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_f3e529b6 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T07:51:10.288277+00:00'}
2025-03-30 15:51:10,288 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_f3e529b6 不存在，创建新的记忆记录。
2025-03-30 15:51:10,298 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_f3e529b6 (Name: 网页用户, Age: None)
2025-03-30 15:51:10,298 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_abca6e75-4f89-4813-a924-d5650a8d158a
2025-03-30 15:51:10,306 - Hospital-MultiAgent-System - INFO - 为咨询 web_abca6e75-4f89-4813-a924-d5650a8d158a (Patient: WebPatient_f3e529b6) 创建新上下文
2025-03-30 15:51:10,307 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_abca6e75-4f89-4813-a924-d5650a8d158a (Patient: WebPatient_f3e529b6)
2025-03-30 15:51:10,318 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 15:51:10,318 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 15:51:10,318 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 15:51:11,065 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:51:11,068 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:51:12,948 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:51:12,953 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.88秒
2025-03-30 15:51:12,953 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 15:51:12,953 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_f3e529b6): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 15:51:12,953 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 15:51:12,954 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 15:51:12,954 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 15:51:12,954 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 15:51:12,957 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 15:51:12,958 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 15:51:14,109 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 15:51:14,113 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.15秒
2025-03-30 15:51:14,113 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，欢迎光临！请您简单描述需要咨询的内容，我们会为您安排合适的医生或科室，谢谢！
2025-03-30 15:51:14,151 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_abca6e75-4f89-4813-a924-d5650a8d158a): Status=in_progress, Agent=receptionist, Msg='您好，欢迎光临！请您简单描述需要咨询的内容，我们会为您安排合适的医生或科室，谢谢！...'
2025-03-30 15:51:14,151 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 15:51:14] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:00:07,736 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:00:07,736 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 16:00:07,736 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:00:07,736 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 16:00:07,736 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 16:00:07,749 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:00:07,749 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:00:07,750 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:00:07,750 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 3ffab1c2-8caa-4f02-8b61-2606398c1ce8)
2025-03-30 16:00:07,750 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:00:07,750 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: c642bb93-4c6e-421d-9599-288aedcd92a3)
2025-03-30 16:00:07,750 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:00:07,750 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 441574c1-039b-4dd0-8692-4d19b969382c)
2025-03-30 16:00:07,750 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:00:07,750 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:00:07,750 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:00:07,750 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:00:07,769 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 16:00:07,769 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 16:00:07,770 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:00:07,950 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:00:07,950 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:00:07,950 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:00:07,950 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:00:07,962 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:00:07,962 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:00:07,963 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:00:07,963 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 0da3a1f6-6cf3-4cb0-ba26-82f1cb1edc71)
2025-03-30 16:00:07,963 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:00:07,963 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 6be807c2-4fff-42f6-afda-015a0d24cb74)
2025-03-30 16:00:07,963 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:00:07,963 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 9d495413-8c37-434c-a235-d5eba5d69109)
2025-03-30 16:00:07,963 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:00:07,963 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:00:07,963 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:00:07,964 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:00:07,976 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:00:07,980 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:00:14,913 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:00:14] "GET / HTTP/1.1" 200 -
2025-03-30 16:00:14,926 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:00:14] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 16:00:14,926 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:00:14] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 16:00:14,934 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_fe0292e9-2370-4ffb-80b3-df75a37ce9df
2025-03-30 16:00:14,934 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_fe0292e9-2370-4ffb-80b3-df75a37ce9df
2025-03-30 16:00:14,935 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:00:14] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 16:00:17,534 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_fe0292e9-2370-4ffb-80b3-df75a37ce9df): '你好...'
2025-03-30 16:00:17,534 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_fe0292e9-2370-4ffb-80b3-df75a37ce9df，视为新对话，转给接待员。
2025-03-30 16:00:17,535 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_f2c6d588 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T08:00:17.535555+00:00'}
2025-03-30 16:00:17,535 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_f2c6d588 不存在，创建新的记忆记录。
2025-03-30 16:00:17,548 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_f2c6d588 (Name: 网页用户, Age: None)
2025-03-30 16:00:17,548 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_fe0292e9-2370-4ffb-80b3-df75a37ce9df
2025-03-30 16:00:17,557 - Hospital-MultiAgent-System - INFO - 为咨询 web_fe0292e9-2370-4ffb-80b3-df75a37ce9df (Patient: WebPatient_f2c6d588) 创建新上下文
2025-03-30 16:00:17,557 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_fe0292e9-2370-4ffb-80b3-df75a37ce9df (Patient: WebPatient_f2c6d588)
2025-03-30 16:00:17,567 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:00:17,568 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:00:17,568 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 16:00:17,715 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:00:17,719 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:00:19,672 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:00:19,682 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.96秒
2025-03-30 16:00:19,682 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 16:00:19,682 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_f2c6d588): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 16:00:19,682 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 16:00:19,683 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 16:00:19,683 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 16:00:19,683 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 16:00:19,684 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:00:19,687 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:00:21,205 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:00:21,206 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.52秒
2025-03-30 16:00:21,206 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好！欢迎光临本院，请问有什么可以帮助您的？如果需要预约医生，请先简单描述您的情况，我们会为您安排合...
2025-03-30 16:00:21,226 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_fe0292e9-2370-4ffb-80b3-df75a37ce9df): Status=in_progress, Agent=receptionist, Msg='您好！欢迎光临本院，请问有什么可以帮助您的？如果需要预约医生，请先简单描述您的情况，我们会为您安排合适的分诊。...'
2025-03-30 16:00:21,226 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:00:21] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:02:11,617 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:02:11,617 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 16:02:11,617 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:02:11,617 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 16:02:11,618 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 16:02:11,630 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:02:11,630 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:02:11,631 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:02:11,631 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 83ec3939-3e5f-4f26-9093-61a6121ac01b)
2025-03-30 16:02:11,631 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:02:11,631 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 1deaed54-c44d-4cde-8626-3a86b0d1fbe0)
2025-03-30 16:02:11,631 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:02:11,631 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 86c10211-1d8c-4836-8673-e20739d43659)
2025-03-30 16:02:11,631 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:02:11,631 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:02:11,631 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:02:11,631 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:02:11,650 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 16:02:11,650 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 16:02:11,651 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:02:11,829 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:02:11,829 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:02:11,829 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:02:11,829 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:02:11,841 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:02:11,841 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:02:11,842 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:02:11,842 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 16af9ef5-8d1e-42b7-87b2-abc1f0220cca)
2025-03-30 16:02:11,842 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:02:11,842 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 85ac7e7c-50d8-4fc9-9af3-077eebb256bc)
2025-03-30 16:02:11,842 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:02:11,842 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: aae76d95-6771-45f4-808c-6e7a48e0480d)
2025-03-30 16:02:11,842 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:02:11,842 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:02:11,842 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:02:11,842 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:02:11,856 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:02:11,860 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:02:14,739 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:02:14] "GET / HTTP/1.1" 200 -
2025-03-30 16:02:14,755 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:02:14] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 16:02:14,756 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:02:14] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 16:02:14,762 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_58a69302-2a87-44cf-9a36-2b00171c4454
2025-03-30 16:02:14,763 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_58a69302-2a87-44cf-9a36-2b00171c4454
2025-03-30 16:02:14,763 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:02:14] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 16:02:17,846 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_58a69302-2a87-44cf-9a36-2b00171c4454): '你好...'
2025-03-30 16:02:17,847 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_58a69302-2a87-44cf-9a36-2b00171c4454，视为新对话，转给接待员。
2025-03-30 16:02:17,849 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_708ab6e9 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T08:02:17.849410+00:00'}
2025-03-30 16:02:17,849 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_708ab6e9 不存在，创建新的记忆记录。
2025-03-30 16:02:17,860 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_708ab6e9 (Name: 网页用户, Age: None)
2025-03-30 16:02:17,860 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_58a69302-2a87-44cf-9a36-2b00171c4454
2025-03-30 16:02:17,868 - Hospital-MultiAgent-System - INFO - 为咨询 web_58a69302-2a87-44cf-9a36-2b00171c4454 (Patient: WebPatient_708ab6e9) 创建新上下文
2025-03-30 16:02:17,868 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_58a69302-2a87-44cf-9a36-2b00171c4454 (Patient: WebPatient_708ab6e9)
2025-03-30 16:02:17,878 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:02:17,878 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:02:17,878 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 16:02:18,016 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:02:18,022 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:02:20,094 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:02:20,102 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.08秒
2025-03-30 16:02:20,102 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 16:02:20,103 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_708ab6e9): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 16:02:20,103 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 16:02:20,104 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 16:02:20,104 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 16:02:20,104 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 16:02:20,108 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:02:20,113 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:02:21,528 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:02:21,533 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.42秒
2025-03-30 16:02:21,533 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好！欢迎光临医院，请问有什么可以帮您？若需预约医生，请简单描述症状以便我们安排合适的专家。
2025-03-30 16:02:21,566 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_58a69302-2a87-44cf-9a36-2b00171c4454): Status=in_progress, Agent=receptionist, Msg='您好！欢迎光临医院，请问有什么可以帮您？若需预约医生，请简单描述症状以便我们安排合适的专家。...'
2025-03-30 16:02:21,566 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:02:21] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:05:51,609 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 16:05:51,685 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:05:51,875 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:05:51,875 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:05:51,875 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:05:51,875 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:05:51,887 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:05:51,887 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:05:51,888 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:05:51,888 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: a2b0e735-b439-4682-b251-04a36c30e57e)
2025-03-30 16:05:51,888 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:05:51,888 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 00b00cad-7247-42f1-b8fe-40b84bc60f6c)
2025-03-30 16:05:51,888 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:05:51,888 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: c2b15655-5cb7-441e-b97a-d10a3d25540b)
2025-03-30 16:05:51,888 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:05:51,888 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:05:51,888 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:05:51,889 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:05:51,902 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:05:51,906 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:05:58,963 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 16:05:59,036 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:05:59,223 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:05:59,223 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:05:59,223 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:05:59,223 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:05:59,236 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:05:59,236 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:05:59,237 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:05:59,237 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 696bf82d-ac37-49c3-97ef-c02047d09ccb)
2025-03-30 16:05:59,237 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:05:59,237 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 7056d8c1-293f-49d5-84e5-9ae925de2696)
2025-03-30 16:05:59,237 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:05:59,237 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 1bc88ad0-b30b-4587-8e02-473151034546)
2025-03-30 16:05:59,237 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:05:59,237 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:05:59,237 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:05:59,237 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:05:59,250 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:05:59,254 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:06:22,275 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:06:22,278 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 16:06:22,278 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:06:22,278 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 16:06:22,278 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 16:06:22,291 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:06:22,291 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:06:22,292 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:06:22,292 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 28837149-e253-4ce3-a015-5f4ab658152a)
2025-03-30 16:06:22,292 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:06:22,292 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 3e4b98e5-0c65-4065-bcd5-6ab27f9940f2)
2025-03-30 16:06:22,292 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:06:22,292 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 0c8315e6-c262-4834-bf7e-2a527b3a733a)
2025-03-30 16:06:22,292 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:06:22,292 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:06:22,292 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:06:22,292 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:06:22,308 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 16:06:22,308 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 16:06:22,309 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:06:22,489 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:06:22,489 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:06:22,489 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:06:22,489 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:06:22,502 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:06:22,502 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:06:22,503 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:06:22,503 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: ff8e138a-024d-4c60-a98b-b9ac13ee6b76)
2025-03-30 16:06:22,503 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:06:22,503 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 3f674d57-4ca7-47eb-a008-8fdf91db9923)
2025-03-30 16:06:22,503 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:06:22,503 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 0166981d-2980-4ec3-8017-7a37962c8ce6)
2025-03-30 16:06:22,503 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:06:22,503 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:06:22,503 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:06:22,503 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:06:22,517 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:06:22,521 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:06:25,243 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:06:25] "GET / HTTP/1.1" 200 -
2025-03-30 16:06:25,258 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:06:25] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 16:06:25,259 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:06:25] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 16:06:25,263 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_35a246ed-0566-4889-8ef6-c650200258c4
2025-03-30 16:06:25,263 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_35a246ed-0566-4889-8ef6-c650200258c4
2025-03-30 16:06:25,264 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:06:25] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 16:06:27,657 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_35a246ed-0566-4889-8ef6-c650200258c4): '你好...'
2025-03-30 16:06:27,658 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_35a246ed-0566-4889-8ef6-c650200258c4，视为新对话，转给接待员。
2025-03-30 16:06:27,659 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_01d6a492 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T08:06:27.659812+00:00'}
2025-03-30 16:06:27,659 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_01d6a492 不存在，创建新的记忆记录。
2025-03-30 16:06:27,671 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_01d6a492 (Name: 网页用户, Age: None)
2025-03-30 16:06:27,671 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_35a246ed-0566-4889-8ef6-c650200258c4
2025-03-30 16:06:27,682 - Hospital-MultiAgent-System - INFO - 为咨询 web_35a246ed-0566-4889-8ef6-c650200258c4 (Patient: WebPatient_01d6a492) 创建新上下文
2025-03-30 16:06:27,682 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_35a246ed-0566-4889-8ef6-c650200258c4 (Patient: WebPatient_01d6a492)
2025-03-30 16:06:27,693 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:06:27,693 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:06:27,693 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 16:06:27,863 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:06:27,871 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:06:29,752 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:06:29,759 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.89秒
2025-03-30 16:06:29,759 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 16:06:29,759 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_01d6a492): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 16:06:29,759 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 16:06:29,759 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 16:06:29,759 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 16:06:29,760 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 16:06:29,762 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:06:29,764 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:06:30,776 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:06:30,780 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.01秒
2025-03-30 16:06:30,781 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，欢迎光临！请问有什么可以帮您？如需预约医生，请简单描述您的症状，以便我们为您安排合适的专家。
2025-03-30 16:06:30,818 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_35a246ed-0566-4889-8ef6-c650200258c4): Status=in_progress, Agent=receptionist, Msg='您好，欢迎光临！请问有什么可以帮您？如需预约医生，请简单描述您的症状，以便我们为您安排合适的专家。...'
2025-03-30 16:06:30,818 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:06:30] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:15:42,938 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:15:42,938 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 16:15:42,938 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:15:42,939 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 16:15:42,939 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 16:15:42,951 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:15:42,951 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:15:42,952 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:15:42,952 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 934aaf6f-935a-4c77-a560-c2370858c3bf)
2025-03-30 16:15:42,952 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:15:42,952 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: f6c89907-17f2-407d-95fd-04c1ea23bfb0)
2025-03-30 16:15:42,952 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:15:42,952 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 210d94c9-3fe9-4853-8dab-a8892dc18328)
2025-03-30 16:15:42,952 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:15:42,952 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:15:42,952 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:15:42,953 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:15:42,970 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 16:15:42,970 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 16:15:42,970 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:15:43,152 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:15:43,152 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:15:43,152 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:15:43,152 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:15:43,164 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:15:43,164 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:15:43,165 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:15:43,165 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 23cba004-4aa1-424f-a2bc-168dd0fd277e)
2025-03-30 16:15:43,165 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:15:43,165 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 7420e20a-8ee8-4e53-bea0-2b483f6681cc)
2025-03-30 16:15:43,165 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:15:43,165 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: f5178d5e-e607-4c3a-9cb5-5716b0ecb41e)
2025-03-30 16:15:43,165 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:15:43,165 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:15:43,165 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:15:43,166 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:15:43,181 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:15:43,185 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:15:48,586 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:15:48] "GET / HTTP/1.1" 200 -
2025-03-30 16:15:48,603 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:15:48] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 16:15:48,603 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:15:48] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 16:15:48,610 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:15:48,611 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:15:48,612 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:15:48] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 16:15:51,575 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): '你好...'
2025-03-30 16:15:51,576 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611，视为新对话，转给接待员。
2025-03-30 16:15:51,577 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_18033824 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T08:15:51.577709+00:00'}
2025-03-30 16:15:51,577 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_18033824 不存在，创建新的记忆记录。
2025-03-30 16:15:51,588 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_18033824 (Name: 网页用户, Age: None)
2025-03-30 16:15:51,588 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:15:51,599 - Hospital-MultiAgent-System - INFO - 为咨询 web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient: WebPatient_18033824) 创建新上下文
2025-03-30 16:15:51,599 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient: WebPatient_18033824)
2025-03-30 16:15:51,610 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:15:51,610 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:15:51,610 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 16:15:51,843 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:15:51,845 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:15:53,479 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:15:53,487 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.64秒
2025-03-30 16:15:53,487 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 16:15:53,487 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_18033824): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 16:15:53,488 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 16:15:53,488 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 16:15:53,488 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 16:15:53,488 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 16:15:53,492 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:15:53,494 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:15:54,920 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:15:54,923 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.43秒
2025-03-30 16:15:54,923 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好！欢迎光临医院。有任何需求请告诉我，若需预约医生，您可简单描述症状，我们将协助安排合适的专家。
2025-03-30 16:15:54,959 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): Status=in_progress, Agent=receptionist, Msg='您好！欢迎光临医院。有任何需求请告诉我，若需预约医生，您可简单描述症状，我们将协助安排合适的专家。...'
2025-03-30 16:15:54,960 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:15:54] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:16:05,215 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): '我要打篮球...'
2025-03-30 16:16:05,230 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient ID in context: WebPatient_18033824), 当前阶段: reception_chatting
2025-03-30 16:16:05,230 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:16:05,247 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611, 当前阶段: reception_chatting
2025-03-30 16:16:05,253 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:16:05,253 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:16:05,253 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好
Receptio...
2025-03-30 16:16:05,255 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:16:05,256 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:16:06,992 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:16:06,998 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.74秒
2025-03-30 16:16:06,998 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "unclear",
  "has_sufficient...
2025-03-30 16:16:06,998 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_18033824): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 16:16:06,998 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_18033824)
2025-03-30 16:16:07,035 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 16:16:07,036 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:16:07] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:16:26,063 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): '我说想找赵大夫一起打篮球...'
2025-03-30 16:16:26,079 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient ID in context: WebPatient_18033824), 当前阶段: reception_clarification
2025-03-30 16:16:26,079 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:16:26,093 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611, 当前阶段: reception_clarification
2025-03-30 16:16:26,099 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:16:26,099 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:16:26,100 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 您好！...
2025-03-30 16:16:26,668 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:16:26,672 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:16:28,493 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:16:28,496 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.82秒
2025-03-30 16:16:28,496 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "seeking_specific_doctor",
 ...
2025-03-30 16:16:28,497 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_18033824): Intent=seeking_specific_doctor, SufficientInfo=False, Symptoms=[]
2025-03-30 16:16:28,497 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 2
2025-03-30 16:16:28,497 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 16:16:28,497 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 16:16:28,497 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："我说想找赵大夫一起打篮球"。请给出一个简洁、专业、乐...
2025-03-30 16:16:28,501 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:16:28,504 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:16:29,518 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:16:29,522 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.02秒
2025-03-30 16:16:29,522 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，感谢您的咨询！如需预约医生，请先简要描述您的需求或症状，我们将为您安排合适的分诊，谢谢理解！
2025-03-30 16:16:29,559 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): Status=in_progress, Agent=receptionist, Msg='您好，感谢您的咨询！如需预约医生，请先简要描述您的需求或症状，我们将为您安排合适的分诊，谢谢理解！...'
2025-03-30 16:16:29,560 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:16:29] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:16:43,259 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): '我要去那美克星...'
2025-03-30 16:16:43,273 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient ID in context: WebPatient_18033824), 当前阶段: reception_chatting
2025-03-30 16:16:43,273 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:16:43,287 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611, 当前阶段: reception_chatting
2025-03-30 16:16:43,292 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:16:43,293 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:16:43,293 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 嗯，请...
2025-03-30 16:16:43,465 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:16:43,468 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:16:45,183 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:16:45,190 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.72秒
2025-03-30 16:16:45,190 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "unclear",
  "has_sufficient...
2025-03-30 16:16:45,191 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_18033824): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 16:16:45,191 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_18033824)
2025-03-30 16:16:45,232 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 16:16:45,232 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:16:45] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:17:14,583 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): '去那美克星打篮球...'
2025-03-30 16:17:14,597 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient ID in context: WebPatient_18033824), 当前阶段: reception_clarification
2025-03-30 16:17:14,597 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:17:14,613 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611, 当前阶段: reception_clarification
2025-03-30 16:17:14,619 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:17:14,619 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:17:14,619 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 您好，...
2025-03-30 16:17:14,777 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:17:14,780 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:17:16,729 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:17:16,735 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.95秒
2025-03-30 16:17:16,735 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "unclear",
  "has_sufficient...
2025-03-30 16:17:16,736 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_18033824): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 16:17:16,736 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_18033824)
2025-03-30 16:17:16,772 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 16:17:16,772 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:17:16] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:17:27,785 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): '肚子疼...'
2025-03-30 16:17:27,800 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient ID in context: WebPatient_18033824), 当前阶段: reception_clarification
2025-03-30 16:17:27,801 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:17:27,816 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611, 当前阶段: reception_clarification
2025-03-30 16:17:27,822 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:17:27,822 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:17:27,822 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 嗯，请...
2025-03-30 16:17:28,454 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:17:28,457 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:17:30,343 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:17:30,348 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.89秒
2025-03-30 16:17:30,348 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "medical_inquiry",
  "has_sufficient...
2025-03-30 16:17:30,349 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_18033824): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚子疼']
2025-03-30 16:17:30,349 - Hospital-MultiAgent-System - INFO - 识别到医疗意图或提前提供身份，准备询问/确认身份信息 (Patient: WebPatient_18033824)
2025-03-30 16:17:30,388 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): Status=in_progress, Agent=receptionist, Msg='了解您身体不适。为了更好地帮助您（特别是如果您之前来过），请问您的手机号码是多少？这次是复诊吗？...'
2025-03-30 16:17:30,389 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:17:30] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:17:41,322 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): '18600001111 是复诊...'
2025-03-30 16:17:41,334 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient ID in context: WebPatient_18033824), 当前阶段: reception_asking_identity
2025-03-30 16:17:41,335 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:17:41,352 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611, 当前阶段: reception_asking_identity
2025-03-30 16:17:41,357 - Hospital-MultiAgent-System - INFO - 处理用户对身份问题的回复 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611)
2025-03-30 16:17:41,357 - Hospital-MultiAgent-System - INFO - Found patient WebPatient_665ed697 matching phone number.
2025-03-30 16:17:41,358 - Hospital-MultiAgent-System - INFO - 找到匹配手机号的患者: WebPatient_665ed697。更新上下文。
2025-03-30 16:17:41,358 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_665ed697 的基本信息: {'phone': '18600001111', 'last_web_consultation_id': 'web_1f1eccbc-68b7-4682-96c0-32376b0d7611'}
2025-03-30 16:17:41,362 - Hospital-MultiAgent-System - INFO - 身份信息处理完毕，症状充分，准备分诊 (Patient: WebPatient_665ed697)
2025-03-30 16:17:41,363 - Hospital-MultiAgent-System - INFO - 执行分诊逻辑 (Patient: WebPatient_665ed697)
2025-03-30 16:17:41,363 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.2
2025-03-30 16:17:41,363 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 16:17:41,363 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 16:17:41,364 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:17:41,365 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:17:43,450 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:17:43,452 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.09秒
2025-03-30 16:17:43,452 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "n...
2025-03-30 16:17:43,452 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=normal
2025-03-30 16:17:43,488 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611)，准备触发医生诊断。
2025-03-30 16:17:43,494 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611, Patient: WebPatient_665ed697)...
2025-03-30 16:17:43,499 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_665ed697 的诊断请求 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611)。复诊: True
2025-03-30 16:17:43,499 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:17:43,499 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:17:43,499 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:17:43,990 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:17:43,993 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:17:45,759 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:17:45,762 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.77秒
2025-03-30 16:17:45,764 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：肚子疼的具体位置在哪里？是上腹部、中腹部还是下腹部？
2025-03-30 16:17:45,764 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient: WebPatient_665ed697)
2025-03-30 16:17:45,807 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611)
2025-03-30 16:17:45,812 - Hospital-MultiAgent-System - INFO - 成功转接给医生 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611)
2025-03-30 16:17:45,818 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): Status=in_progress, Agent=doctor, Msg='肚子疼的具体位置在哪里？是上腹部、中腹部还是下腹部？...'
2025-03-30 16:17:45,818 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:17:45] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:17:49,225 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): '上腹...'
2025-03-30 16:17:49,241 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient ID in context: WebPatient_665ed697), 当前阶段: information_gathering
2025-03-30 16:17:49,241 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:17:49,258 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_665ed697 对问题 (Context: web_1f1eccbc-68b7-4682-96c0-32376b0d7611) 的回答: '上腹...'
2025-03-30 16:17:49,265 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:17:49,265 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:17:49,265 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "肚子疼的具体...
2025-03-30 16:17:49,266 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:17:49,267 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:17:50,439 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:17:50,443 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.18秒
2025-03-30 16:17:50,443 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["上腹部疼痛"],
  "symptom_...
2025-03-30 16:17:50,443 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 回答分析完成。当前症状: ['肚子疼', '用户描述不清晰', '上腹部疼痛']. 置信度: 0.45
2025-03-30 16:17:50,443 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_665ed697 (Context: web_1f1eccbc-68b7-4682-96c0-32376b0d7611) 提出下一个问题。
2025-03-30 16:17:50,443 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:17:50,443 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:17:50,444 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:17:50,447 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:17:50,449 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:17:51,848 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:17:51,854 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.40秒
2025-03-30 16:17:51,854 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：这种上腹部疼痛是持续性的还是间歇性的？疼痛的性质是胀痛、刺痛还是灼烧感？
2025-03-30 16:17:51,899 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): Status=in_progress, Agent=doctor, Msg='这种上腹部疼痛是持续性的还是间歇性的？疼痛的性质是胀痛、刺痛还是灼烧感？...'
2025-03-30 16:17:51,899 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:17:51] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:17:55,524 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): '刺痛...'
2025-03-30 16:17:55,541 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient ID in context: WebPatient_665ed697), 当前阶段: information_gathering
2025-03-30 16:17:55,541 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:17:55,557 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_665ed697 对问题 (Context: web_1f1eccbc-68b7-4682-96c0-32376b0d7611) 的回答: '刺痛...'
2025-03-30 16:17:55,563 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:17:55,563 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:17:55,563 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "这种上腹部疼...
2025-03-30 16:17:55,564 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:17:55,565 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:17:56,967 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:17:56,973 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.41秒
2025-03-30 16:17:56,973 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["刺痛"],
  "symptom_det...
2025-03-30 16:17:56,974 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 回答分析完成。当前症状: ['刺痛', '肚子疼', '用户描述不清晰', '上腹部疼痛']. 置信度: 0.55
2025-03-30 16:17:56,974 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_665ed697 (Context: web_1f1eccbc-68b7-4682-96c0-32376b0d7611) 提出下一个问题。
2025-03-30 16:17:56,974 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:17:56,974 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:17:56,974 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:17:56,976 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:17:56,978 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:17:57,723 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:17:57,727 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.75秒
2025-03-30 16:17:57,728 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否与进食有关？是在饭后加重还是空腹时更明显？
2025-03-30 16:17:57,775 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): Status=in_progress, Agent=doctor, Msg='疼痛是否与进食有关？是在饭后加重还是空腹时更明显？...'
2025-03-30 16:17:57,776 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:17:57] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:18:01,099 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): '空腹...'
2025-03-30 16:18:01,116 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient ID in context: WebPatient_665ed697), 当前阶段: information_gathering
2025-03-30 16:18:01,116 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:18:01,132 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_665ed697 对问题 (Context: web_1f1eccbc-68b7-4682-96c0-32376b0d7611) 的回答: '空腹...'
2025-03-30 16:18:01,138 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:18:01,138 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:18:01,138 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否与进...
2025-03-30 16:18:01,608 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:18:01,612 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:18:02,702 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:18:02,707 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.09秒
2025-03-30 16:18:02,708 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 16:18:02,708 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 回答分析完成。当前症状: ['刺痛', '肚子疼', '用户描述不清晰', '上腹部疼痛']. 置信度: 0.70
2025-03-30 16:18:02,708 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_665ed697 (Context: web_1f1eccbc-68b7-4682-96c0-32376b0d7611) 提出下一个问题。
2025-03-30 16:18:02,708 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:18:02,708 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:18:02,708 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:18:02,710 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:18:02,718 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:18:04,546 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:18:04,549 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.83秒
2025-03-30 16:18:04,549 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否会在夜间加重或影响您的睡眠？
2025-03-30 16:18:04,595 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): Status=in_progress, Agent=doctor, Msg='疼痛是否会在夜间加重或影响您的睡眠？...'
2025-03-30 16:18:04,596 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:18:04] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:18:07,486 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): '会...'
2025-03-30 16:18:07,501 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient ID in context: WebPatient_665ed697), 当前阶段: information_gathering
2025-03-30 16:18:07,501 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611
2025-03-30 16:18:07,518 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_665ed697 对问题 (Context: web_1f1eccbc-68b7-4682-96c0-32376b0d7611) 的回答: '会...'
2025-03-30 16:18:07,523 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:18:07,523 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:18:07,523 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否会在...
2025-03-30 16:18:07,685 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:18:07,690 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:18:09,052 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:18:09,058 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.37秒
2025-03-30 16:18:09,058 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["夜间疼痛加重", "睡眠受影响"],
 ...
2025-03-30 16:18:09,058 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 回答分析完成。当前症状: ['上腹部疼痛', '夜间疼痛加重', '睡眠受影响', '用户描述不清晰', '肚子疼', '刺痛']. 置信度: 0.85
2025-03-30 16:18:09,058 - Hospital-MultiAgent-System - INFO - 可以诊断：置信度 0.85 >= 0.75
2025-03-30 16:18:09,058 - Hospital-MultiAgent-System - INFO - 医生 主治医生 可以为患者 WebPatient_665ed697 (Context: web_1f1eccbc-68b7-4682-96c0-32376b0d7611) 做出诊断。
2025-03-30 16:18:09,058 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：600，温度：0.3
2025-03-30 16:18:09,058 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位资深医生，正在进行诊断。请给出专业、详细且结构化的诊断结果（JSON格式）。
2025-03-30 16:18:09,058 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医生，请根据以下信息生成诊断结果：
症状：上腹部疼痛, 夜间疼痛加重, 睡眠受影响, 用户描...
2025-03-30 16:18:09,060 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:18:09,067 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:18:15,607 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:18:15,610 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：6.54秒
2025-03-30 16:18:15,610 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "可能的胃溃疡或十二指肠溃疡",
  "expla...
2025-03-30 16:18:15,611 - Hospital-MultiAgent-System - ERROR - 生成诊断结果时出错: Unterminated string starting at: line 42 column 18 (char 972). Raw Response: ```json
{
  "condition": "可能的胃溃疡或十二指肠溃疡",
  "explanation": "患者描述的上腹部疼痛，尤其是夜间加重，伴随刺痛感，提示可能存在胃或十二指肠溃疡。溃疡通常与胃酸分泌过多或幽门螺杆菌感染相关，且夜间疼痛可能与胃酸分泌的昼夜节律有关。",
  "differential_diagnosis": [
    "功能性消化不良",
    "胃食管反流病（GERD）",
    "胰腺疾病（如胰腺炎）",
    "胆囊疾病（如胆结石）",
    "胃癌或其他消化道肿瘤"
  ],
  "severity": "中度",
  "recommendations": [
    "避免刺激性食物（如辛辣、油腻食物）和饮酒。",
    "规律进食，避免空腹时间过长。",
    "避免服用可能加重溃疡的药物（如非甾体抗炎药）。",
    "保持良好的睡眠习惯，避免压力过大。"
  ],
  "medications": [
    {
      "name": "质子泵抑制剂（如奥美拉唑或埃索美拉唑）",
      "dosage": "每日一次，早餐前服用",
      "purpose": "减少胃酸分泌，促进溃疡愈合"
    },
    {
      "name": "抗幽门螺杆菌治疗（如三联或四联疗法）",
      "dosage": "根据幽门螺杆菌检测结果决定",
      "purpose": "根除幽门螺杆菌感染（如存在）"
    }
  ],
  "follow_up": "建议患者在治疗开始后2周内复诊以评估症状改善情况，并在治疗结束后进行幽门螺杆菌复查（如适用）。",
  "diagnostic_tests": [
    {
      "name": "胃镜检查",
      "purpose": "直接观察胃和十二指肠黏膜，明确是否存在溃疡或其他病变"
    },
    {
      "name": "幽门螺杆菌检测（如13C尿素呼气试验或粪便抗原检测）",
      "purpose": "评估是否存在幽门螺杆菌感染"
    },
    {
      "name": "腹部超声",
      "purpose": "排除胆囊疾病或胰腺
2025-03-30 16:18:15,633 - Hospital-MultiAgent-System - INFO - 删除问诊上下文: web_1f1eccbc-68b7-4682-96c0-32376b0d7611 (Patient: WebPatient_665ed697)
2025-03-30 16:18:15,649 - Hospital-MultiAgent-System - INFO - 医生完成诊断 (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611, Patient: WebPatient_665ed697)
2025-03-30 16:18:15,649 - Hospital-MultiAgent-System - INFO - 诊断完成，无需开药。 (Patient: WebPatient_665ed697, Context: web_1f1eccbc-68b7-4682-96c0-32376b0d7611)
2025-03-30 16:18:15,649 - Hospital-MultiAgent-System - INFO - Web 咨询 web_1f1eccbc-68b7-4682-96c0-32376b0d7611 结束: completed_no_prescription
2025-03-30 16:18:15,655 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1f1eccbc-68b7-4682-96c0-32376b0d7611): Status=completed_no_prescription, Agent=doctor, Msg='感谢您的配合。根据您提供的信息，我已完成初步诊断。...'
2025-03-30 16:18:15,656 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:18:15] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:22:17,452 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/doctor.py', reloading
2025-03-30 16:22:17,526 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:22:17,724 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:22:17,724 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:22:17,724 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:22:17,724 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:22:17,737 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:22:17,737 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:22:17,738 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:22:17,738 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: e6efb4a2-126f-4654-87fd-71b5c3701822)
2025-03-30 16:22:17,738 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:22:17,738 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: bcb49587-524b-49c3-aa07-eb614bf4602e)
2025-03-30 16:22:17,738 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:22:17,738 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 10cf1d67-1faf-4743-91bc-b3ce6aa7f218)
2025-03-30 16:22:17,738 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:22:17,738 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:22:17,738 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:22:17,738 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:22:17,752 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:22:17,756 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:22:56,098 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/doctor.py', reloading
2025-03-30 16:22:56,166 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:22:56,351 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:22:56,351 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:22:56,351 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:22:56,351 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:22:56,364 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:22:56,364 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:22:56,365 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:22:56,365 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 3245dd05-3bd3-4486-a4b5-703633cf4d26)
2025-03-30 16:22:56,365 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:22:56,365 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: e80d26b7-f50f-4bcc-b0af-174b163874f5)
2025-03-30 16:22:56,365 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:22:56,365 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 52e26c62-5aaa-4f0f-b2c4-2b63e08cf35c)
2025-03-30 16:22:56,365 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:22:56,365 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:22:56,365 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:22:56,366 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:22:56,378 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:22:56,382 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:23:12,555 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:23:12,555 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 16:23:12,555 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:23:12,555 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 16:23:12,555 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 16:23:12,568 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:23:12,568 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:23:12,569 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:23:12,569 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 26e07a7c-fd12-4e51-b794-2d25b17e29ed)
2025-03-30 16:23:12,569 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:23:12,570 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 2fe62d73-f6eb-4fa7-97ef-475a2171178e)
2025-03-30 16:23:12,570 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:23:12,570 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: ec66e29b-f4f8-4ed0-b5ca-8af3f3fd74d5)
2025-03-30 16:23:12,570 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:23:12,570 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:23:12,570 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:23:12,570 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:23:12,588 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 16:23:12,588 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 16:23:12,588 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:23:12,767 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:23:12,767 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:23:12,767 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:23:12,767 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:23:12,779 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:23:12,779 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:23:12,780 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:23:12,780 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: cde1913f-3808-46da-8f13-776b77ad89c4)
2025-03-30 16:23:12,781 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:23:12,781 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: bc4c7626-7a21-4ff3-8590-32202a03c56d)
2025-03-30 16:23:12,781 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:23:12,781 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 624a9855-d333-4925-b631-13128a35cb35)
2025-03-30 16:23:12,781 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:23:12,781 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:23:12,781 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:23:12,781 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:23:12,794 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:23:12,798 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:23:17,674 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:23:17] "GET / HTTP/1.1" 200 -
2025-03-30 16:23:17,689 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:23:17] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 16:23:17,690 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:23:17] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 16:23:17,697 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7
2025-03-30 16:23:17,697 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7
2025-03-30 16:23:17,698 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:23:17] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 16:23:28,756 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): '肚疼 60...'
2025-03-30 16:23:28,756 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7，视为新对话，转给接待员。
2025-03-30 16:23:28,758 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_7d28b51e 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T08:23:28.758327+00:00'}
2025-03-30 16:23:28,758 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_7d28b51e 不存在，创建新的记忆记录。
2025-03-30 16:23:28,771 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_7d28b51e (Name: 网页用户, Age: None)
2025-03-30 16:23:28,771 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7
2025-03-30 16:23:28,782 - Hospital-MultiAgent-System - INFO - 为咨询 web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7 (Patient: WebPatient_7d28b51e) 创建新上下文
2025-03-30 16:23:28,782 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7 (Patient: WebPatient_7d28b51e)
2025-03-30 16:23:28,793 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:23:28,793 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:23:28,794 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 肚疼 60

用户最新...
2025-03-30 16:23:29,214 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:23:29,218 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:23:34,029 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:23:34,038 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：4.82秒
2025-03-30 16:23:34,038 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "medical_inquiry",
  "has_su...
2025-03-30 16:23:34,039 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_7d28b51e): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚疼']
2025-03-30 16:23:34,039 - Hospital-MultiAgent-System - INFO - 识别到医疗意图或提前提供身份，准备询问/确认身份信息 (Patient: WebPatient_7d28b51e)
2025-03-30 16:23:34,075 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): Status=in_progress, Agent=receptionist, Msg='了解您身体不适。为了更好地帮助您（特别是如果您之前来过），请问您的手机号码是多少？这次是复诊吗？...'
2025-03-30 16:23:34,076 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:23:34] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:23:47,524 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): '18600001111 是复诊...'
2025-03-30 16:23:47,540 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7 (Patient ID in context: WebPatient_7d28b51e), 当前阶段: reception_asking_identity
2025-03-30 16:23:47,540 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7
2025-03-30 16:23:47,556 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7, 当前阶段: reception_asking_identity
2025-03-30 16:23:47,561 - Hospital-MultiAgent-System - INFO - 处理用户对身份问题的回复 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7)
2025-03-30 16:23:47,561 - Hospital-MultiAgent-System - INFO - Found patient WebPatient_665ed697 matching phone number.
2025-03-30 16:23:47,561 - Hospital-MultiAgent-System - INFO - 找到匹配手机号的患者: WebPatient_665ed697。更新上下文。
2025-03-30 16:23:47,561 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_665ed697 的基本信息: {'phone': '18600001111', 'last_web_consultation_id': 'web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7'}
2025-03-30 16:23:47,568 - Hospital-MultiAgent-System - INFO - 身份信息处理完毕，症状充分，准备分诊 (Patient: WebPatient_665ed697)
2025-03-30 16:23:47,568 - Hospital-MultiAgent-System - INFO - 执行分诊逻辑 (Patient: WebPatient_665ed697)
2025-03-30 16:23:47,568 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.2
2025-03-30 16:23:47,568 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 16:23:47,568 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 16:23:48,076 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:23:48,086 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:23:50,153 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:23:50,156 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.07秒
2025-03-30 16:23:50,156 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "n...
2025-03-30 16:23:50,156 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=normal
2025-03-30 16:23:50,190 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7)，准备触发医生诊断。
2025-03-30 16:23:50,196 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7, Patient: WebPatient_665ed697)...
2025-03-30 16:23:50,201 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_665ed697 的诊断请求 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7)。复诊: True
2025-03-30 16:23:50,201 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:23:50,201 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:23:50,201 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:23:50,202 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:23:50,204 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:23:51,790 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:23:51,795 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.59秒
2025-03-30 16:23:51,796 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：肚疼的具体部位在哪里？疼痛是持续性还是间歇性？是否伴有其他症状，如恶心、呕吐、腹泻或便秘？
2025-03-30 16:23:51,796 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7 (Patient: WebPatient_665ed697)
2025-03-30 16:23:51,844 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7)
2025-03-30 16:23:51,849 - Hospital-MultiAgent-System - INFO - 成功转接给医生 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7)
2025-03-30 16:23:51,854 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): Status=in_progress, Agent=doctor, Msg='肚疼的具体部位在哪里？疼痛是持续性还是间歇性？是否伴有其他症状，如恶心、呕吐、腹泻或便秘？...'
2025-03-30 16:23:51,854 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:23:51] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:24:01,149 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): '上腹，间歇性，恶心...'
2025-03-30 16:24:01,164 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7 (Patient ID in context: WebPatient_665ed697), 当前阶段: information_gathering
2025-03-30 16:24:01,164 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7
2025-03-30 16:24:01,181 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_665ed697 对问题 (Context: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7) 的回答: '上腹，间歇性，恶心...'
2025-03-30 16:24:01,187 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:24:01,187 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:24:01,187 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "肚疼的具体部...
2025-03-30 16:24:01,189 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:24:01,190 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:24:03,262 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:24:03,265 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.08秒
2025-03-30 16:24:03,265 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["恶心"],
  "symptom_det...
2025-03-30 16:24:03,265 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 回答分析完成。当前症状: ['恶心', '肚疼']. 置信度: 0.45
2025-03-30 16:24:03,265 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_665ed697 (Context: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7) 提出下一个问题。
2025-03-30 16:24:03,265 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:24:03,266 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:24:03,266 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:24:03,410 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:24:03,414 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:24:04,319 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:24:04,322 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.91秒
2025-03-30 16:24:04,322 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：除了恶心之外，是否有出现呕吐、腹胀、食欲不振或体重变化的情况？
2025-03-30 16:24:04,368 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): Status=in_progress, Agent=doctor, Msg='除了恶心之外，是否有出现呕吐、腹胀、食欲不振或体重变化的情况？...'
2025-03-30 16:24:04,369 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:24:04] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:24:10,115 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): '腹胀...'
2025-03-30 16:24:10,130 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7 (Patient ID in context: WebPatient_665ed697), 当前阶段: information_gathering
2025-03-30 16:24:10,130 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7
2025-03-30 16:24:10,148 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_665ed697 对问题 (Context: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7) 的回答: '腹胀...'
2025-03-30 16:24:10,155 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:24:10,155 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:24:10,155 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "除了恶心之外...
2025-03-30 16:24:10,321 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:24:10,323 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:24:14,013 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:24:14,015 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.69秒
2025-03-30 16:24:14,015 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["腹胀"],
  "symptom_det...
2025-03-30 16:24:14,015 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 回答分析完成。当前症状: ['肚疼', '腹胀', '恶心']. 置信度: 0.55
2025-03-30 16:24:14,015 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_665ed697 (Context: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7) 提出下一个问题。
2025-03-30 16:24:14,016 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:24:14,016 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:24:14,016 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:24:14,020 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:24:14,024 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:24:15,651 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:24:15,654 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.63秒
2025-03-30 16:24:15,655 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：最近是否有进食不洁食物、油腻食物或饮酒史？
2025-03-30 16:24:15,701 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): Status=in_progress, Agent=doctor, Msg='最近是否有进食不洁食物、油腻食物或饮酒史？...'
2025-03-30 16:24:15,702 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:24:15] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:24:19,670 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): '无...'
2025-03-30 16:24:19,686 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7 (Patient ID in context: WebPatient_665ed697), 当前阶段: information_gathering
2025-03-30 16:24:19,687 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7
2025-03-30 16:24:19,704 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_665ed697 对问题 (Context: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7) 的回答: '无...'
2025-03-30 16:24:19,710 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:24:19,710 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:24:19,710 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "最近是否有进...
2025-03-30 16:24:19,712 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:24:19,713 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:24:21,078 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:24:21,081 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.37秒
2025-03-30 16:24:21,081 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 16:24:21,081 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 回答分析完成。当前症状: ['肚疼', '腹胀', '恶心']. 置信度: 0.65
2025-03-30 16:24:21,082 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_665ed697 (Context: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7) 提出下一个问题。
2025-03-30 16:24:21,082 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:24:21,082 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:24:21,082 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:24:21,089 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:24:21,093 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:24:22,104 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:24:22,108 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.01秒
2025-03-30 16:24:22,108 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：最近是否有出现排便异常，例如便秘、腹泻或粪便颜色改变（如黑便或血便）？
2025-03-30 16:24:22,155 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): Status=in_progress, Agent=doctor, Msg='最近是否有出现排便异常，例如便秘、腹泻或粪便颜色改变（如黑便或血便）？...'
2025-03-30 16:24:22,155 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:24:22] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:24:26,697 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): '腹泻...'
2025-03-30 16:24:26,712 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7 (Patient ID in context: WebPatient_665ed697), 当前阶段: information_gathering
2025-03-30 16:24:26,712 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7
2025-03-30 16:24:26,730 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_665ed697 对问题 (Context: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7) 的回答: '腹泻...'
2025-03-30 16:24:26,735 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:24:26,735 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:24:26,735 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "最近是否有出...
2025-03-30 16:24:26,860 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:24:26,864 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:24:28,040 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:24:28,045 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.18秒
2025-03-30 16:24:28,045 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["腹泻"],
  "symptom_det...
2025-03-30 16:24:28,045 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_665ed697 回答分析完成。当前症状: ['恶心', '腹泻', '腹胀', '肚疼']. 置信度: 0.75
2025-03-30 16:24:28,045 - Hospital-MultiAgent-System - INFO - 可以诊断：问题数 4 >= 4 且置信度 0.75 > 0.4
2025-03-30 16:24:28,045 - Hospital-MultiAgent-System - INFO - 医生 主治医生 可以为患者 WebPatient_665ed697 (Context: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7) 做出诊断。
2025-03-30 16:24:28,046 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：1000，温度：0.3
2025-03-30 16:24:28,046 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位资深医生，正在进行诊断。请给出专业、简洁且结构化的诊断结果（JSON格式）。
2025-03-30 16:24:28,046 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医生，请根据以下信息生成诊断结果：
症状：恶心, 腹泻, 腹胀, 肚疼
病史：有就诊记录但无...
2025-03-30 16:24:28,047 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:24:28,050 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:24:31,915 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:24:31,917 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.86秒
2025-03-30 16:24:31,917 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "急性胃肠炎",
  "explanation":...
2025-03-30 16:24:31,918 - Hospital-MultiAgent-System - INFO - 为症状 '恶心, 腹泻, 腹胀, 肚疼' 生成诊断结果：急性胃肠炎
2025-03-30 16:24:31,934 - Hospital-MultiAgent-System - INFO - 删除问诊上下文: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7 (Patient: WebPatient_665ed697)
2025-03-30 16:24:31,950 - Hospital-MultiAgent-System - INFO - 医生完成诊断 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7, Patient: WebPatient_665ed697)
2025-03-30 16:24:31,950 - Hospital-MultiAgent-System - INFO - 诊断完成，需开药，触发审核 (Patient: WebPatient_665ed697, Context: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7)
2025-03-30 16:24:31,950 - Hospital-MultiAgent-System - INFO - 向药剂师发送处方审核请求 (Patient: WebPatient_665ed697)...
2025-03-30 16:24:31,957 - Hospital-MultiAgent-System - INFO - 药剂师 药剂师 正在审核患者 WebPatient_665ed697 的处方...
2025-03-30 16:24:31,957 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.1
2025-03-30 16:24:31,957 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富、极其严谨的临床药剂师。请仔细检查处方，并【严格按照要求的JSON格式】输出反馈，【...
2025-03-30 16:24:31,957 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位资深临床药剂师，请基于患者的部分诊断信息和以下处方，严格审核其合理性、安全性及潜在风险。

...
2025-03-30 16:24:31,959 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:24:31,960 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:24:35,876 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:24:35,879 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.92秒
2025-03-30 16:24:35,879 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "valid": false,
  "issues": ["蒙脱石散的疗程未指定", "奥美...
2025-03-30 16:24:35,880 - Hospital-MultiAgent-System - INFO - 处方审核LLM解析成功: Valid=False, Issues=3, Warnings=1
2025-03-30 16:24:35,898 - Hospital-MultiAgent-System - WARNING - 患者 WebPatient_665ed697 的处方未通过审核: 蒙脱石散的疗程未指定、奥美拉唑的疗程未指定、口服补液盐的用量和疗程未明确
2025-03-30 16:24:35,909 - Hospital-MultiAgent-System - INFO - 收到药剂师审核响应 (Patient: WebPatient_665ed697)。Status: rejected
2025-03-30 16:24:35,909 - Hospital-MultiAgent-System - WARNING - 处方审核被拒绝 (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): ['蒙脱石散的疗程未指定', '奥美拉唑的疗程未指定', '口服补液盐的用量和疗程未明确']
2025-03-30 16:24:35,909 - Hospital-MultiAgent-System - INFO - Web 咨询 web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7 结束: error_prescription_rejected
2025-03-30 16:24:35,916 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7): Status=error_prescription_rejected, Agent=doctor, Msg='感谢您的配合。根据您提供的信息，我已完成初步诊断。
处方审核未通过: 蒙脱石散的疗程未指定、奥美拉唑的疗程未指定、口服补液盐的用量和疗程未明...'
2025-03-30 16:24:35,916 - Hospital-MultiAgent-System-Web - INFO - Web 咨询 web_6e9dd8e0-b6e0-46b2-b861-c0276cb43bf7 已达到结束状态: error_prescription_rejected
2025-03-30 16:24:35,917 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:24:35] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:28:18,320 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 16:28:18,393 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:28:18,581 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:28:18,581 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:28:18,581 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:28:18,581 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:28:18,594 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:28:18,594 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:28:18,595 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:28:18,595 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: eeae0937-c1fe-44d8-a1df-cd8d70117633)
2025-03-30 16:28:18,595 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:28:18,595 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: bc117e56-319d-4ae1-940c-f8ec687cd443)
2025-03-30 16:28:18,595 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:28:18,595 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 77af518a-b8b8-4140-a442-9994bcc043e8)
2025-03-30 16:28:18,595 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:28:18,595 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:28:18,595 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:28:18,595 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:28:18,609 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:28:18,613 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:28:43,837 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 16:28:43,923 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:28:44,109 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:28:44,109 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:28:44,109 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:28:44,109 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:28:44,122 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:28:44,122 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:28:44,123 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:28:44,123 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 27c5b648-eae6-4e78-a3d9-c6e20296ddee)
2025-03-30 16:28:44,123 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:28:44,123 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: d8534e70-d299-4730-aa3f-8efbd37468e4)
2025-03-30 16:28:44,123 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:28:44,123 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 09d1032d-1ba1-47be-963e-98fc5973a82a)
2025-03-30 16:28:44,123 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:28:44,123 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:28:44,123 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:28:44,123 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:28:44,136 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:28:44,140 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:31:41,871 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:31:41,871 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 16:31:41,871 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:31:41,871 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 16:31:41,871 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 16:31:41,883 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:31:41,884 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:31:41,885 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:31:41,885 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: fc479398-3b4f-48d9-9bac-89b5c4cdb54b)
2025-03-30 16:31:41,885 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:31:41,885 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 8fd836dd-4cda-4b1b-9319-71d2b94fb5d3)
2025-03-30 16:31:41,885 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:31:41,885 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 86b75ecf-af12-4206-82f7-506ac0e4176e)
2025-03-30 16:31:41,885 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:31:41,885 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:31:41,885 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:31:41,885 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:31:41,907 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 16:31:41,907 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 16:31:41,907 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:31:42,090 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:31:42,090 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:31:42,090 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:31:42,090 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:31:42,102 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:31:42,102 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:31:42,104 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:31:42,104 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: b1b63c96-abb2-4257-9718-10f08e85706d)
2025-03-30 16:31:42,104 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:31:42,104 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 9fbd2ec2-3506-4f32-bd4d-7241f62b56de)
2025-03-30 16:31:42,104 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:31:42,104 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 001b1c0a-f4f0-4537-b2f3-7ff551f34af2)
2025-03-30 16:31:42,104 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:31:42,104 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:31:42,104 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:31:42,104 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:31:42,118 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:31:42,122 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:31:45,112 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:31:45] "GET / HTTP/1.1" 200 -
2025-03-30 16:31:45,125 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:31:45] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 16:31:45,127 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:31:45] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 16:31:45,136 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:31:45,136 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:31:45,137 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:31:45] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 16:31:54,213 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): '肚子疼 60...'
2025-03-30 16:31:54,215 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4，视为新对话，转给接待员。
2025-03-30 16:31:54,217 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_81bb008e 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T08:31:54.217798+00:00'}
2025-03-30 16:31:54,218 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_81bb008e 不存在，创建新的记忆记录。
2025-03-30 16:31:54,233 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_81bb008e (Name: 网页用户, Age: None)
2025-03-30 16:31:54,234 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:31:54,234 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:31:54,234 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:31:54,243 - Hospital-MultiAgent-System - INFO - 为咨询 web_910536f0-ae91-4d5c-9946-cb656907eca4 (Patient: WebPatient_81bb008e) 创建新上下文
2025-03-30 16:31:54,243 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_910536f0-ae91-4d5c-9946-cb656907eca4 (Patient: WebPatient_81bb008e)
2025-03-30 16:31:54,255 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:31:54,255 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:31:54,255 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 肚子疼 60

用户最...
2025-03-30 16:31:54,733 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:31:54,737 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:31:56,550 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:31:56,559 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.82秒
2025-03-30 16:31:56,561 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "medical_inquiry",
  "has_su...
2025-03-30 16:31:56,562 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_81bb008e): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚子疼']
2025-03-30 16:31:56,562 - Hospital-MultiAgent-System - INFO - 识别到医疗意图或提前提供身份，准备询问/确认身份信息 (Patient: WebPatient_81bb008e)
2025-03-30 16:31:56,600 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): Status=in_progress, Agent=receptionist, Msg='了解您身体不适。为了更好地帮助您（特别是如果您之前来过），请问您的手机号码是多少？这次是复诊吗？...'
2025-03-30 16:31:56,600 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:31:56] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:32:13,572 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): '18611000020  不是复诊...'
2025-03-30 16:32:13,590 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4 (Patient ID in context: WebPatient_81bb008e), 当前阶段: reception_asking_identity
2025-03-30 16:32:13,590 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:32:13,607 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4, 当前阶段: reception_asking_identity
2025-03-30 16:32:13,614 - Hospital-MultiAgent-System - INFO - 处理用户对身份问题的回复 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4)
2025-03-30 16:32:13,614 - Hospital-MultiAgent-System - INFO - 未找到匹配手机号的患者，或未提供手机号。将使用当前ID: WebPatient_81bb008e
2025-03-30 16:32:13,614 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_81bb008e 的基本信息: {'phone': '18611000020', 'source': 'web', 'first_consultation_id': 'web_910536f0-ae91-4d5c-9946-cb656907eca4'}
2025-03-30 16:32:13,621 - Hospital-MultiAgent-System - INFO - 身份信息处理完毕，症状充分，准备分诊 (Patient: WebPatient_81bb008e)
2025-03-30 16:32:13,621 - Hospital-MultiAgent-System - INFO - 执行分诊逻辑 (Patient: WebPatient_81bb008e)
2025-03-30 16:32:13,621 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.2
2025-03-30 16:32:13,621 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 16:32:13,621 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 16:32:13,734 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:32:13,740 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:32:15,787 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:32:15,792 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.05秒
2025-03-30 16:32:15,792 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "n...
2025-03-30 16:32:15,793 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=normal
2025-03-30 16:32:15,825 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4)，准备触发医生诊断。
2025-03-30 16:32:15,831 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4, Patient: WebPatient_81bb008e)...
2025-03-30 16:32:15,837 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_81bb008e 的诊断请求 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4)。复诊: True
2025-03-30 16:32:15,837 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:32:15,838 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:32:15,838 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:32:15,839 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:32:15,840 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:32:16,636 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:32:16,642 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.80秒
2025-03-30 16:32:16,643 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您这次肚子疼的具体部位是哪里？疼痛是持续的还是间歇性的？
2025-03-30 16:32:16,643 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_910536f0-ae91-4d5c-9946-cb656907eca4 (Patient: WebPatient_81bb008e)
2025-03-30 16:32:16,682 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4)
2025-03-30 16:32:16,687 - Hospital-MultiAgent-System - INFO - 成功转接给医生 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4)
2025-03-30 16:32:16,692 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): Status=in_progress, Agent=doctor, Msg='您这次肚子疼的具体部位是哪里？疼痛是持续的还是间歇性的？...'
2025-03-30 16:32:16,693 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:32:16] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:32:26,399 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): '持续...'
2025-03-30 16:32:26,413 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4 (Patient ID in context: WebPatient_81bb008e), 当前阶段: information_gathering
2025-03-30 16:32:26,413 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:32:26,432 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_81bb008e 对问题 (Context: web_910536f0-ae91-4d5c-9946-cb656907eca4) 的回答: '持续...'
2025-03-30 16:32:26,439 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:32:26,439 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:32:26,439 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "您这次肚子疼...
2025-03-30 16:32:26,441 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:32:26,442 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:32:28,213 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:32:28,216 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.77秒
2025-03-30 16:32:28,216 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 16:32:28,216 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_81bb008e 回答分析完成。当前症状: ['肚子疼']. 置信度: 0.40
2025-03-30 16:32:28,216 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_81bb008e (Context: web_910536f0-ae91-4d5c-9946-cb656907eca4) 提出下一个问题。
2025-03-30 16:32:28,216 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:32:28,216 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:32:28,217 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:32:28,218 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:32:28,220 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:32:29,310 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:32:29,312 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.09秒
2025-03-30 16:32:29,313 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否伴随其他症状，例如恶心、呕吐、腹胀或腹泻？
2025-03-30 16:32:29,362 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): Status=in_progress, Agent=doctor, Msg='疼痛是否伴随其他症状，例如恶心、呕吐、腹胀或腹泻？...'
2025-03-30 16:32:29,362 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:32:29] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:32:34,333 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): '恶心...'
2025-03-30 16:32:34,346 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4 (Patient ID in context: WebPatient_81bb008e), 当前阶段: information_gathering
2025-03-30 16:32:34,346 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:32:34,363 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_81bb008e 对问题 (Context: web_910536f0-ae91-4d5c-9946-cb656907eca4) 的回答: '恶心...'
2025-03-30 16:32:34,369 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:32:34,369 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:32:34,369 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否伴随...
2025-03-30 16:32:34,575 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:32:34,578 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:32:36,704 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:32:36,707 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.13秒
2025-03-30 16:32:36,707 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["恶心"],
  "symptom_det...
2025-03-30 16:32:36,707 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_81bb008e 回答分析完成。当前症状: ['肚子疼', '恶心']. 置信度: 0.50
2025-03-30 16:32:36,708 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_81bb008e (Context: web_910536f0-ae91-4d5c-9946-cb656907eca4) 提出下一个问题。
2025-03-30 16:32:36,708 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:32:36,708 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:32:36,708 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:32:36,712 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:32:36,718 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:32:37,625 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:32:37,627 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.91秒
2025-03-30 16:32:37,627 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您最近是否有进食不洁或不常吃的食物，或者是否有饮食习惯的改变？
2025-03-30 16:32:37,671 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): Status=in_progress, Agent=doctor, Msg='您最近是否有进食不洁或不常吃的食物，或者是否有饮食习惯的改变？...'
2025-03-30 16:32:37,672 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:32:37] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:32:41,223 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): '无...'
2025-03-30 16:32:41,238 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4 (Patient ID in context: WebPatient_81bb008e), 当前阶段: information_gathering
2025-03-30 16:32:41,238 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:32:41,257 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_81bb008e 对问题 (Context: web_910536f0-ae91-4d5c-9946-cb656907eca4) 的回答: '无...'
2025-03-30 16:32:41,263 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:32:41,263 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:32:41,263 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "您最近是否有...
2025-03-30 16:32:41,265 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:32:41,267 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:32:42,902 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:32:42,906 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.64秒
2025-03-30 16:32:42,906 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 16:32:42,906 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_81bb008e 回答分析完成。当前症状: ['肚子疼', '恶心']. 置信度: 0.60
2025-03-30 16:32:42,906 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_81bb008e (Context: web_910536f0-ae91-4d5c-9946-cb656907eca4) 提出下一个问题。
2025-03-30 16:32:42,907 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:32:42,907 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:32:42,907 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:32:42,909 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:32:42,911 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:32:43,640 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:32:43,642 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.73秒
2025-03-30 16:32:43,642 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您最近是否有出现发热、畏寒或其他全身不适的症状？
2025-03-30 16:32:43,692 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): Status=in_progress, Agent=doctor, Msg='您最近是否有出现发热、畏寒或其他全身不适的症状？...'
2025-03-30 16:32:43,692 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:32:43] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:32:51,404 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): '发热...'
2025-03-30 16:32:51,419 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4 (Patient ID in context: WebPatient_81bb008e), 当前阶段: information_gathering
2025-03-30 16:32:51,420 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:32:51,435 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_81bb008e 对问题 (Context: web_910536f0-ae91-4d5c-9946-cb656907eca4) 的回答: '发热...'
2025-03-30 16:32:51,442 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:32:51,442 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:32:51,442 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "您最近是否有...
2025-03-30 16:32:52,014 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:32:52,016 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:32:54,111 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:32:54,114 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.10秒
2025-03-30 16:32:54,114 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["发热"],
  "symptom_det...
2025-03-30 16:32:54,114 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_81bb008e 回答分析完成。当前症状: ['肚子疼', '恶心', '发热']. 置信度: 0.70
2025-03-30 16:32:54,114 - Hospital-MultiAgent-System - INFO - 可以诊断：问题数 4 >= 4 且置信度 0.70 > 0.4
2025-03-30 16:32:54,114 - Hospital-MultiAgent-System - INFO - 医生 主治医生 可以为患者 WebPatient_81bb008e (Context: web_910536f0-ae91-4d5c-9946-cb656907eca4) 做出诊断。
2025-03-30 16:32:54,114 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：1000，温度：0.3
2025-03-30 16:32:54,114 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位资深医生，正在进行诊断。请给出专业、简洁且结构化的诊断结果（JSON格式）。
2025-03-30 16:32:54,114 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医生，请根据以下信息生成诊断结果：
症状：肚子疼, 恶心, 发热
病史：无
科室：消化内科
...
2025-03-30 16:32:54,116 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:32:54,120 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:32:56,671 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:32:56,674 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.55秒
2025-03-30 16:32:56,675 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "急性胃肠炎",
  "explanation":...
2025-03-30 16:32:56,675 - Hospital-MultiAgent-System - INFO - 为症状 '肚子疼, 恶心, 发热' 生成诊断结果：急性胃肠炎
2025-03-30 16:32:56,691 - Hospital-MultiAgent-System - INFO - 删除问诊上下文: web_910536f0-ae91-4d5c-9946-cb656907eca4 (Patient: WebPatient_81bb008e)
2025-03-30 16:32:56,714 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:32:56,714 - Hospital-MultiAgent-System - INFO - 医生完成诊断 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4, Patient: WebPatient_81bb008e)
2025-03-30 16:32:56,714 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:32:56,714 - Hospital-MultiAgent-System - INFO - 诊断完成，需开药，触发审核 (Patient: WebPatient_81bb008e, Context: web_910536f0-ae91-4d5c-9946-cb656907eca4)
2025-03-30 16:32:56,714 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:32:56,714 - Hospital-MultiAgent-System - INFO - 向药剂师发送处方审核请求 (Patient: WebPatient_81bb008e)...
2025-03-30 16:32:56,722 - Hospital-MultiAgent-System - INFO - 药剂师 药剂师 正在审核患者 WebPatient_81bb008e 的处方...
2025-03-30 16:32:56,722 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.1
2025-03-30 16:32:56,722 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富、极其严谨的临床药剂师。请仔细检查处方，并【严格按照要求的JSON格式】输出反馈，【...
2025-03-30 16:32:56,722 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位资深临床药剂师，请基于患者的部分诊断信息和以下处方，严格审核其合理性、安全性及潜在风险。

...
2025-03-30 16:32:56,723 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:32:56,725 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:32:59,130 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:32:59,133 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.41秒
2025-03-30 16:32:59,134 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "valid": false,
  "issues": ["蒙脱石散疗程未指定", "对乙酰...
2025-03-30 16:32:59,134 - Hospital-MultiAgent-System - INFO - 处方审核LLM解析成功: Valid=False, Issues=2, Warnings=1
2025-03-30 16:32:59,156 - Hospital-MultiAgent-System - WARNING - 患者 WebPatient_81bb008e 的处方未通过审核: 蒙脱石散疗程未指定、对乙酰氨基酚疗程未指定
2025-03-30 16:32:59,165 - Hospital-MultiAgent-System - INFO - 收到药剂师审核响应 (Patient: WebPatient_81bb008e)。Status: rejected
2025-03-30 16:32:59,165 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:32:59,165 - Hospital-MultiAgent-System - WARNING - 处方审核被拒绝 (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): ['蒙脱石散疗程未指定', '对乙酰氨基酚疗程未指定']
2025-03-30 16:32:59,165 - Hospital-MultiAgent-System - INFO - Web 咨询 web_910536f0-ae91-4d5c-9946-cb656907eca4 结束: error_prescription_rejected
2025-03-30 16:32:59,165 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_910536f0-ae91-4d5c-9946-cb656907eca4
2025-03-30 16:32:59,172 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_910536f0-ae91-4d5c-9946-cb656907eca4): Status=error_prescription_rejected, Agent=doctor, Msg='感谢您的配合。根据您提供的信息，我已完成初步诊断。
处方审核未通过: 蒙脱石散疗程未指定、对乙酰氨基酚疗程未指定。处方存在疗程未明确的问题，...'
2025-03-30 16:32:59,172 - Hospital-MultiAgent-System-Web - INFO - Web 咨询 web_910536f0-ae91-4d5c-9946-cb656907eca4 已达到结束状态: error_prescription_rejected
2025-03-30 16:32:59,172 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:32:59] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:35:45,077 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 16:35:45,141 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:35:45,342 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:35:45,342 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:35:45,342 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:35:45,342 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:35:45,355 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:35:45,355 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:35:45,357 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:35:45,357 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 06876002-f485-4d1f-b15e-45f046b08e30)
2025-03-30 16:35:45,357 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:35:45,357 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: e10ee70c-a1b0-46ec-a58b-7c42d69d85ac)
2025-03-30 16:35:45,357 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:35:45,357 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 0598ffb0-dbcc-47af-897e-69696e594428)
2025-03-30 16:35:45,357 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:35:45,357 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:35:45,357 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:35:45,357 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:35:45,370 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:35:45,374 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:35:54,468 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/utils/orchestrator.py', reloading
2025-03-30 16:35:54,540 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:35:54,732 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:35:54,732 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:35:54,732 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:35:54,732 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:35:54,744 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:35:54,744 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:35:54,745 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:35:54,745 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 9fe3bb54-04d5-4aa4-9f51-420439f89997)
2025-03-30 16:35:54,745 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:35:54,745 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 3267eba0-0463-41fb-a3bc-1f853dc1ae04)
2025-03-30 16:35:54,745 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:35:54,745 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 9ec0d02a-061f-446b-baad-7a1354a6d700)
2025-03-30 16:35:54,745 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:35:54,745 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:35:54,745 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:35:54,746 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:35:54,759 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:35:54,763 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:36:20,939 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 16:36:21,004 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:36:21,194 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:36:21,195 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:36:21,195 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:36:21,195 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:36:21,207 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:36:21,207 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:36:21,208 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:36:21,208 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: e08015c1-a4ee-499d-913d-02c42b00cf7f)
2025-03-30 16:36:21,208 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:36:21,208 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: fdb0df43-4f54-4012-91bf-0ce59d297272)
2025-03-30 16:36:21,208 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:36:21,208 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 788fcb7c-8425-4b19-a2cb-55277cd35a80)
2025-03-30 16:36:21,209 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:36:21,209 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:36:21,209 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:36:21,209 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:36:21,223 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:36:21,227 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:37:38,917 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 16:37:38,986 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:37:39,170 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:37:39,170 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:37:39,170 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:37:39,170 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:37:39,182 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:37:39,182 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:37:39,183 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:37:39,183 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 67b21af4-1149-4736-b70f-18936087807d)
2025-03-30 16:37:39,183 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:37:39,183 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 579ab493-ac59-451a-8c33-0855c8a4f6ed)
2025-03-30 16:37:39,183 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:37:39,183 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 4cfab635-9208-43e5-98b1-9183075a1201)
2025-03-30 16:37:39,183 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:37:39,183 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:37:39,184 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:37:39,184 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:37:39,197 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:37:39,200 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:38:21,566 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/web_app.py', reloading
2025-03-30 16:38:21,630 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:38:21,826 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:38:21,826 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:38:21,826 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:38:21,826 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:38:21,842 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:38:21,842 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:38:21,844 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:38:21,844 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: c299c7df-8300-4098-8191-903987b6e2d4)
2025-03-30 16:38:21,844 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:38:21,844 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: fbdc8ad3-9633-421e-ba18-ccb26e6b788a)
2025-03-30 16:38:21,844 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:38:21,844 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: ed03fc7b-7527-4d05-8702-49711eb18d71)
2025-03-30 16:38:21,844 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:38:21,844 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:38:21,844 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:38:21,844 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:38:21,856 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:38:21,861 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:38:29,612 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:38:29,612 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 16:38:29,612 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:38:29,612 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 16:38:29,612 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 16:38:29,625 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:38:29,625 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:38:29,627 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:38:29,627 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 3db5918e-236e-476b-bfe1-60d38e82fefe)
2025-03-30 16:38:29,627 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:38:29,627 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 926d900e-7b9b-4b88-a5f8-7adb4e2066a8)
2025-03-30 16:38:29,627 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:38:29,627 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 935b3c0c-e398-4341-a8ac-97833cf11085)
2025-03-30 16:38:29,627 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:38:29,627 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:38:29,627 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:38:29,627 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:38:29,645 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 16:38:29,645 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 16:38:29,645 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:38:29,826 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:38:29,826 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:38:29,826 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:38:29,826 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:38:29,839 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:38:29,839 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:38:29,840 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:38:29,840 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: ae5be537-92c2-4175-aaac-175a24981637)
2025-03-30 16:38:29,840 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:38:29,840 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: a0d0bfa4-1bd1-4ad1-a21b-b0ad2b9fbb66)
2025-03-30 16:38:29,840 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:38:29,840 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: b770fe80-480e-4436-a13a-62b2abd5ba6c)
2025-03-30 16:38:29,840 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:38:29,840 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:38:29,840 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:38:29,841 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:38:29,853 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:38:29,857 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:38:35,817 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:38:35] "GET / HTTP/1.1" 200 -
2025-03-30 16:38:35,831 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:38:35] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 16:38:35,831 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:38:35] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 16:38:35,838 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:38:35,838 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:38:35,839 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:38:35] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 16:38:42,782 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): '肚子疼 60...'
2025-03-30 16:38:42,782 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_97510c21-51a3-49be-9775-a3edf7f40132，视为新对话，转给接待员。
2025-03-30 16:38:42,783 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_91dda781 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T08:38:42.783559+00:00'}
2025-03-30 16:38:42,784 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_91dda781 不存在，创建新的记忆记录。
2025-03-30 16:38:42,800 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_91dda781 (Name: 网页用户, Age: None)
2025-03-30 16:38:42,800 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:38:42,800 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:38:42,800 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:38:42,810 - Hospital-MultiAgent-System - INFO - 为咨询 web_97510c21-51a3-49be-9775-a3edf7f40132 (Patient: WebPatient_91dda781) 创建新上下文
2025-03-30 16:38:42,810 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_97510c21-51a3-49be-9775-a3edf7f40132 (Patient: WebPatient_91dda781)
2025-03-30 16:38:42,823 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:38:42,823 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:38:42,823 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 肚子疼 60

用户最...
2025-03-30 16:38:42,957 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:38:42,964 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:38:45,116 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:38:45,123 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.16秒
2025-03-30 16:38:45,123 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "medical_inquiry",
  "has_su...
2025-03-30 16:38:45,124 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_91dda781): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚子疼']
2025-03-30 16:38:45,124 - Hospital-MultiAgent-System - INFO - 识别到医疗意图或提前提供身份，准备询问/确认身份信息 (Patient: WebPatient_91dda781)
2025-03-30 16:38:45,165 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): Status=in_progress, Agent=receptionist, Msg='了解您身体不适。为了更好地帮助您（特别是如果您之前来过），请问您的手机号码是多少？这次是复诊吗？...'
2025-03-30 16:38:45,165 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:38:45] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:38:57,038 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): '18610119801 不是复诊...'
2025-03-30 16:38:57,056 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_97510c21-51a3-49be-9775-a3edf7f40132 (Patient ID in context: WebPatient_91dda781), 当前阶段: reception_asking_identity
2025-03-30 16:38:57,056 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:38:57,074 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_97510c21-51a3-49be-9775-a3edf7f40132, 当前阶段: reception_asking_identity
2025-03-30 16:38:57,081 - Hospital-MultiAgent-System - INFO - 处理用户对身份问题的回复 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132)
2025-03-30 16:38:57,081 - Hospital-MultiAgent-System - INFO - 未找到匹配手机号的患者，或未提供手机号。将使用当前ID: WebPatient_91dda781
2025-03-30 16:38:57,081 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_91dda781 的基本信息: {'phone': '18610119801', 'source': 'web', 'first_consultation_id': 'web_97510c21-51a3-49be-9775-a3edf7f40132'}
2025-03-30 16:38:57,088 - Hospital-MultiAgent-System - INFO - 身份信息处理完毕，症状充分，准备分诊 (Patient: WebPatient_91dda781)
2025-03-30 16:38:57,088 - Hospital-MultiAgent-System - INFO - 执行分诊逻辑 (Patient: WebPatient_91dda781)
2025-03-30 16:38:57,088 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.2
2025-03-30 16:38:57,088 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 16:38:57,088 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 16:38:57,089 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:38:57,091 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:38:59,279 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:38:59,282 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.19秒
2025-03-30 16:38:59,283 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "消化内科",
  "priority": "n...
2025-03-30 16:38:59,283 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=消化内科, 优先级=normal
2025-03-30 16:38:59,322 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132)，准备触发医生诊断。
2025-03-30 16:38:59,328 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132, Patient: WebPatient_91dda781)...
2025-03-30 16:38:59,334 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_91dda781 的诊断请求 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132)。复诊: True
2025-03-30 16:38:59,334 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:38:59,334 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:38:59,334 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:38:59,770 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:38:59,775 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:39:00,709 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:39:00,712 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.94秒
2025-03-30 16:39:00,712 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您这次肚子疼的具体位置是哪里？是整个腹部还是集中在某个区域，比如上腹部、下腹部、左侧或右侧？
2025-03-30 16:39:00,712 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_97510c21-51a3-49be-9775-a3edf7f40132 (Patient: WebPatient_91dda781)
2025-03-30 16:39:00,756 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132)
2025-03-30 16:39:00,762 - Hospital-MultiAgent-System - INFO - 成功转接给医生 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132)
2025-03-30 16:39:00,767 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): Status=in_progress, Agent=doctor, Msg='您这次肚子疼的具体位置是哪里？是整个腹部还是集中在某个区域，比如上腹部、下腹部、左侧或右侧？...'
2025-03-30 16:39:00,768 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:39:00] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:39:06,747 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): '上...'
2025-03-30 16:39:06,766 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_97510c21-51a3-49be-9775-a3edf7f40132 (Patient ID in context: WebPatient_91dda781), 当前阶段: information_gathering
2025-03-30 16:39:06,767 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:39:06,782 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_91dda781 对问题 (Context: web_97510c21-51a3-49be-9775-a3edf7f40132) 的回答: '上...'
2025-03-30 16:39:06,788 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:39:06,788 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:39:06,788 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "您这次肚子疼...
2025-03-30 16:39:06,790 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:39:06,792 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:39:08,748 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:39:08,751 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.96秒
2025-03-30 16:39:08,751 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["上腹部疼痛"],
  "symptom_...
2025-03-30 16:39:08,751 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_91dda781 回答分析完成。当前症状: ['肚子疼', '上腹部疼痛']. 置信度: 0.45
2025-03-30 16:39:08,751 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_91dda781 (Context: web_97510c21-51a3-49be-9775-a3edf7f40132) 提出下一个问题。
2025-03-30 16:39:08,752 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:39:08,752 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:39:08,752 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:39:08,754 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:39:08,756 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:39:10,642 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:39:10,645 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.89秒
2025-03-30 16:39:10,645 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是持续性的还是间歇性的？疼痛的强度如何（轻微、适中、剧烈）？
2025-03-30 16:39:10,696 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): Status=in_progress, Agent=doctor, Msg='疼痛是持续性的还是间歇性的？疼痛的强度如何（轻微、适中、剧烈）？...'
2025-03-30 16:39:10,696 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:39:10] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:39:14,967 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): '轻微...'
2025-03-30 16:39:14,984 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_97510c21-51a3-49be-9775-a3edf7f40132 (Patient ID in context: WebPatient_91dda781), 当前阶段: information_gathering
2025-03-30 16:39:14,984 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:39:15,002 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_91dda781 对问题 (Context: web_97510c21-51a3-49be-9775-a3edf7f40132) 的回答: '轻微...'
2025-03-30 16:39:15,009 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:39:15,009 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:39:15,009 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是持续性...
2025-03-30 16:39:15,123 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:39:15,126 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:39:16,200 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:39:16,211 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.08秒
2025-03-30 16:39:16,212 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 16:39:16,212 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_91dda781 回答分析完成。当前症状: ['肚子疼', '上腹部疼痛']. 置信度: 0.55
2025-03-30 16:39:16,212 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_91dda781 (Context: web_97510c21-51a3-49be-9775-a3edf7f40132) 提出下一个问题。
2025-03-30 16:39:16,212 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:39:16,212 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:39:16,212 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:39:16,214 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:39:16,216 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:39:17,399 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:39:17,401 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.18秒
2025-03-30 16:39:17,401 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：这种上腹部的轻微疼痛是否与进食有关？比如，疼痛是在饭前、饭后还是空腹时更明显？
2025-03-30 16:39:17,453 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): Status=in_progress, Agent=doctor, Msg='这种上腹部的轻微疼痛是否与进食有关？比如，疼痛是在饭前、饭后还是空腹时更明显？...'
2025-03-30 16:39:17,453 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:39:17] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:39:24,755 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): '饭后...'
2025-03-30 16:39:24,773 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_97510c21-51a3-49be-9775-a3edf7f40132 (Patient ID in context: WebPatient_91dda781), 当前阶段: information_gathering
2025-03-30 16:39:24,773 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:39:24,792 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_91dda781 对问题 (Context: web_97510c21-51a3-49be-9775-a3edf7f40132) 的回答: '饭后...'
2025-03-30 16:39:24,799 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:39:24,799 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:39:24,799 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "这种上腹部的...
2025-03-30 16:39:24,975 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:39:24,978 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:39:27,332 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:39:27,335 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.36秒
2025-03-30 16:39:27,335 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 16:39:27,336 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_91dda781 回答分析完成。当前症状: ['肚子疼', '上腹部疼痛']. 置信度: 0.65
2025-03-30 16:39:27,338 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_91dda781 (Context: web_97510c21-51a3-49be-9775-a3edf7f40132) 提出下一个问题。
2025-03-30 16:39:27,338 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:39:27,338 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:39:27,338 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:39:27,340 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:39:27,342 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:39:28,358 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:39:28,364 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.02秒
2025-03-30 16:39:28,364 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您的上腹部疼痛是否伴随其他症状，比如恶心、呕吐、腹胀、烧心或食欲减退？
2025-03-30 16:39:28,412 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): Status=in_progress, Agent=doctor, Msg='您的上腹部疼痛是否伴随其他症状，比如恶心、呕吐、腹胀、烧心或食欲减退？...'
2025-03-30 16:39:28,412 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:39:28] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:39:31,391 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): '无...'
2025-03-30 16:39:31,409 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_97510c21-51a3-49be-9775-a3edf7f40132 (Patient ID in context: WebPatient_91dda781), 当前阶段: information_gathering
2025-03-30 16:39:31,409 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:39:31,423 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_91dda781 对问题 (Context: web_97510c21-51a3-49be-9775-a3edf7f40132) 的回答: '无...'
2025-03-30 16:39:31,430 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:39:31,430 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:39:31,430 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "您的上腹部疼...
2025-03-30 16:39:31,431 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:39:31,432 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:39:33,272 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:39:33,275 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.84秒
2025-03-30 16:39:33,275 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 16:39:33,275 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_91dda781 回答分析完成。当前症状: ['肚子疼', '上腹部疼痛']. 置信度: 0.75
2025-03-30 16:39:33,275 - Hospital-MultiAgent-System - INFO - 可以诊断：问题数 4 >= 4 且置信度 0.75 > 0.4
2025-03-30 16:39:33,275 - Hospital-MultiAgent-System - INFO - 医生 主治医生 可以为患者 WebPatient_91dda781 (Context: web_97510c21-51a3-49be-9775-a3edf7f40132) 做出诊断。
2025-03-30 16:39:33,275 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：1000，温度：0.3
2025-03-30 16:39:33,275 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位资深医生，正在进行诊断。请给出专业、简洁且结构化的诊断结果（JSON格式）。
2025-03-30 16:39:33,275 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医生，请根据以下信息生成诊断结果：
症状：肚子疼, 上腹部疼痛
病史：无
科室：消化内科

...
2025-03-30 16:39:33,280 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:39:33,282 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:39:36,147 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:39:36,150 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.87秒
2025-03-30 16:39:36,151 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "功能性消化不良",
  "explanation...
2025-03-30 16:39:36,151 - Hospital-MultiAgent-System - INFO - 为症状 '肚子疼, 上腹部疼痛' 生成诊断结果：功能性消化不良
2025-03-30 16:39:36,169 - Hospital-MultiAgent-System - INFO - 删除问诊上下文: web_97510c21-51a3-49be-9775-a3edf7f40132 (Patient: WebPatient_91dda781)
2025-03-30 16:39:36,191 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:39:36,191 - Hospital-MultiAgent-System - INFO - 医生完成诊断 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132, Patient: WebPatient_91dda781)
2025-03-30 16:39:36,191 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:39:36,191 - Hospital-MultiAgent-System - INFO - 诊断完成，需开药，触发审核 (Patient: WebPatient_91dda781, Context: web_97510c21-51a3-49be-9775-a3edf7f40132)
2025-03-30 16:39:36,191 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:39:36,191 - Hospital-MultiAgent-System - INFO - 向药剂师发送处方审核请求 (Patient: WebPatient_91dda781)...
2025-03-30 16:39:36,197 - Hospital-MultiAgent-System - INFO - 药剂师 药剂师 正在审核患者 WebPatient_91dda781 的处方...
2025-03-30 16:39:36,197 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.1
2025-03-30 16:39:36,197 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富、极其严谨的临床药剂师。请仔细检查处方，并【严格按照要求的JSON格式】输出反馈，【...
2025-03-30 16:39:36,197 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位资深临床药剂师，请基于患者的部分诊断信息和以下处方，严格审核其合理性、安全性及潜在风险。

...
2025-03-30 16:39:36,199 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:39:36,200 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:39:36,463 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 429 Too Many Requests"
2025-03-30 16:39:36,463 - openai._base_client - INFO - Retrying request to /deployments/gpt-4o/chat/completions in 8.000000 seconds
2025-03-30 16:39:47,712 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:39:47,715 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：11.51秒
2025-03-30 16:39:47,715 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "valid": false,
  "issues": ["奥美拉唑和莫沙必利的疗程未指定"...
2025-03-30 16:39:47,715 - Hospital-MultiAgent-System - INFO - 处方审核LLM解析成功: Valid=False, Issues=2, Warnings=2
2025-03-30 16:39:47,733 - Hospital-MultiAgent-System - WARNING - 患者 WebPatient_91dda781 的处方未通过审核: 奥美拉唑和莫沙必利的疗程未指定、奥美拉唑的适应症未明确是否需要长期使用
2025-03-30 16:39:47,748 - Hospital-MultiAgent-System - INFO - 收到药剂师审核响应 (Patient: WebPatient_91dda781)。Status: rejected
2025-03-30 16:39:47,748 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:39:47,748 - Hospital-MultiAgent-System - WARNING - 处方审核被拒绝 (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): ['奥美拉唑和莫沙必利的疗程未指定', '奥美拉唑的适应症未明确是否需要长期使用']
2025-03-30 16:39:47,748 - Hospital-MultiAgent-System - INFO - Web 咨询 web_97510c21-51a3-49be-9775-a3edf7f40132 结束: error_prescription_rejected
2025-03-30 16:39:47,748 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_97510c21-51a3-49be-9775-a3edf7f40132
2025-03-30 16:39:47,757 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_97510c21-51a3-49be-9775-a3edf7f40132): Status=error_prescription_rejected, Agent=doctor, Msg='感谢您的配合。根据您提供的信息，我已完成初步诊断。
处方审核未通过: 奥美拉唑和莫沙必利的疗程未指定、奥美拉唑的适应症未明确是否需要长期使用...'
2025-03-30 16:39:47,757 - Hospital-MultiAgent-System-Web - INFO - Web 咨询 web_97510c21-51a3-49be-9775-a3edf7f40132 已达到结束状态: error_prescription_rejected
2025-03-30 16:39:47,757 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:39:47] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:39:51,919 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:39:51] "GET /logs HTTP/1.1" 200 -
2025-03-30 16:39:51,927 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:39:51] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 16:39:51,966 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:39:51] "GET /api/interaction_logs HTTP/1.1" 200 -
2025-03-30 16:39:54,816 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:39:54] "GET /api/interaction_logs/web_97510c21-51a3-49be-9775-a3edf7f40132 HTTP/1.1" 200 -
2025-03-30 16:43:12,030 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:43:12,030 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 16:43:12,030 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:43:12,030 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 16:43:12,030 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 16:43:12,043 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:43:12,043 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:43:12,044 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:43:12,044 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 3e440b53-5f0d-42c2-bfe6-e1863fe074e8)
2025-03-30 16:43:12,044 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:43:12,044 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: c1f78f8b-d9fe-45e4-919b-015f67420537)
2025-03-30 16:43:12,044 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:43:12,044 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 09e9e385-7ba3-4612-bb58-cf1f5256c01e)
2025-03-30 16:43:12,044 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:43:12,044 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:43:12,045 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:43:12,045 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:43:12,062 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 16:43:12,062 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 16:43:12,062 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:43:12,241 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:43:12,241 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:43:12,241 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:43:12,241 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:43:12,253 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:43:12,253 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:43:12,255 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:43:12,255 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 1dfb5508-9d2b-48d3-9bd5-1168ce6f7cd0)
2025-03-30 16:43:12,255 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:43:12,255 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 8833ee9a-1d9a-417b-ba7d-a033f2561f5c)
2025-03-30 16:43:12,255 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:43:12,255 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 6b190f17-f254-41bf-949e-36bdacbeb3dd)
2025-03-30 16:43:12,255 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:43:12,255 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:43:12,255 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:43:12,256 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:43:12,269 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:43:12,273 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:43:30,486 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:43:30] "GET / HTTP/1.1" 200 -
2025-03-30 16:43:30,502 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:43:30] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 16:43:30,502 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:43:30] "GET /static/js/app.js HTTP/1.1" 200 -
2025-03-30 16:43:30,510 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:43:30,510 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:43:30,511 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:43:30] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 16:43:34,209 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): '你好...'
2025-03-30 16:43:34,210 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d，视为新对话，转给接待员。
2025-03-30 16:43:34,211 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_c72bfbc8 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T08:43:34.211497+00:00'}
2025-03-30 16:43:34,212 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_c72bfbc8 不存在，创建新的记忆记录。
2025-03-30 16:43:34,227 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_c72bfbc8 (Name: 网页用户, Age: None)
2025-03-30 16:43:34,227 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:43:34,227 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:43:34,227 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:43:34,239 - Hospital-MultiAgent-System - INFO - 为咨询 web_c51ee967-0f51-4fd6-bd14-82bf309e175d (Patient: WebPatient_c72bfbc8) 创建新上下文
2025-03-30 16:43:34,239 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_c51ee967-0f51-4fd6-bd14-82bf309e175d (Patient: WebPatient_c72bfbc8)
2025-03-30 16:43:34,252 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:43:34,252 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:43:34,252 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 16:43:34,416 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:43:34,419 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:43:36,375 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:43:36,382 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.96秒
2025-03-30 16:43:36,383 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 16:43:36,383 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_c72bfbc8): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 16:43:36,383 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1
2025-03-30 16:43:36,383 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 16:43:36,383 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 16:43:36,383 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 16:43:36,386 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:43:36,390 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:43:37,604 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:43:37,608 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.22秒
2025-03-30 16:43:37,608 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，欢迎光临！请简要描述您的需求或症状，我们将为您安排合适的医生或服务。
2025-03-30 16:43:37,655 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): Status=in_progress, Agent=receptionist, Msg='您好，欢迎光临！请简要描述您的需求或症状，我们将为您安排合适的医生或服务。...'
2025-03-30 16:43:37,655 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:43:37] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:43:45,618 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): '肚疼 60...'
2025-03-30 16:43:45,636 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d (Patient ID in context: WebPatient_c72bfbc8), 当前阶段: reception_chatting
2025-03-30 16:43:45,636 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:43:45,655 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d, 当前阶段: reception_chatting
2025-03-30 16:43:45,662 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:43:45,662 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:43:45,663 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好
Receptio...
2025-03-30 16:43:45,664 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:43:45,665 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:43:47,842 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:43:47,846 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.18秒
2025-03-30 16:43:47,846 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "medical_inquiry",
  "has_su...
2025-03-30 16:43:47,846 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_c72bfbc8): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚疼']
2025-03-30 16:43:47,846 - Hospital-MultiAgent-System - INFO - 识别到医疗意图或提前提供身份，准备询问/确认身份信息 (Patient: WebPatient_c72bfbc8)
2025-03-30 16:43:47,887 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): Status=in_progress, Agent=receptionist, Msg='了解您身体不适。为了更好地帮助您（特别是如果您之前来过），请问您的手机号码是多少？这次是复诊吗？...'
2025-03-30 16:43:47,888 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:43:47] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:44:00,402 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): '19791101020 不是复诊...'
2025-03-30 16:44:00,422 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d (Patient ID in context: WebPatient_c72bfbc8), 当前阶段: reception_asking_identity
2025-03-30 16:44:00,422 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:44:00,442 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d, 当前阶段: reception_asking_identity
2025-03-30 16:44:00,449 - Hospital-MultiAgent-System - INFO - 处理用户对身份问题的回复 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d)
2025-03-30 16:44:00,449 - Hospital-MultiAgent-System - INFO - 未找到匹配手机号的患者，或未提供手机号。将使用当前ID: WebPatient_c72bfbc8
2025-03-30 16:44:00,449 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_c72bfbc8 的基本信息: {'phone': '19791101020', 'source': 'web', 'first_consultation_id': 'web_c51ee967-0f51-4fd6-bd14-82bf309e175d'}
2025-03-30 16:44:00,456 - Hospital-MultiAgent-System - INFO - 身份信息处理完毕，症状充分，准备分诊 (Patient: WebPatient_c72bfbc8)
2025-03-30 16:44:00,456 - Hospital-MultiAgent-System - INFO - 执行分诊逻辑 (Patient: WebPatient_c72bfbc8)
2025-03-30 16:44:00,456 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.2
2025-03-30 16:44:00,456 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 16:44:00,456 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 16:44:00,934 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:44:00,938 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:44:03,206 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:44:03,210 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.27秒
2025-03-30 16:44:03,210 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "内科",
  "priority": "nor...
2025-03-30 16:44:03,211 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=内科, 优先级=normal
2025-03-30 16:44:03,246 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d)，准备触发医生诊断。
2025-03-30 16:44:03,253 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d, Patient: WebPatient_c72bfbc8)...
2025-03-30 16:44:03,258 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_c72bfbc8 的诊断请求 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d)。复诊: True
2025-03-30 16:44:03,259 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:44:03,259 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:44:03,259 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:44:03,260 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:44:03,261 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:44:04,089 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:44:04,092 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.83秒
2025-03-30 16:44:04,092 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：肚子疼是持续性还是间歇性？具体疼痛部位在哪里，例如上腹部、下腹部或左侧、右侧？
2025-03-30 16:44:04,092 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_c51ee967-0f51-4fd6-bd14-82bf309e175d (Patient: WebPatient_c72bfbc8)
2025-03-30 16:44:04,140 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d)
2025-03-30 16:44:04,147 - Hospital-MultiAgent-System - INFO - 成功转接给医生 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d)
2025-03-30 16:44:04,152 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): Status=in_progress, Agent=doctor, Msg='肚子疼是持续性还是间歇性？具体疼痛部位在哪里，例如上腹部、下腹部或左侧、右侧？...'
2025-03-30 16:44:04,153 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:44:04] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:44:12,947 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): '上，左...'
2025-03-30 16:44:12,965 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d (Patient ID in context: WebPatient_c72bfbc8), 当前阶段: information_gathering
2025-03-30 16:44:12,965 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:44:12,983 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_c72bfbc8 对问题 (Context: web_c51ee967-0f51-4fd6-bd14-82bf309e175d) 的回答: '上，左...'
2025-03-30 16:44:12,991 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:44:12,991 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:44:12,991 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "肚子疼是持续...
2025-03-30 16:44:12,992 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:44:12,993 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:44:14,980 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:44:14,983 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.99秒
2025-03-30 16:44:14,983 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 16:44:14,983 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_c72bfbc8 回答分析完成。当前症状: ['肚疼', '用户描述不清晰']. 置信度: 0.40
2025-03-30 16:44:14,983 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_c72bfbc8 (Context: web_c51ee967-0f51-4fd6-bd14-82bf309e175d) 提出下一个问题。
2025-03-30 16:44:14,983 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:44:14,983 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:44:14,984 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:44:15,506 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:44:15,508 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:44:16,413 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:44:16,416 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.91秒
2025-03-30 16:44:16,416 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否与进食相关？例如，进食后疼痛是否加重或缓解？
2025-03-30 16:44:16,468 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): Status=in_progress, Agent=doctor, Msg='疼痛是否与进食相关？例如，进食后疼痛是否加重或缓解？...'
2025-03-30 16:44:16,469 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:44:16] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:44:25,061 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): '否...'
2025-03-30 16:44:25,076 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d (Patient ID in context: WebPatient_c72bfbc8), 当前阶段: information_gathering
2025-03-30 16:44:25,076 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:44:25,098 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_c72bfbc8 对问题 (Context: web_c51ee967-0f51-4fd6-bd14-82bf309e175d) 的回答: '否...'
2025-03-30 16:44:25,105 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:44:25,105 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:44:25,105 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否与进...
2025-03-30 16:44:25,107 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:44:25,108 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:44:27,472 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:44:27,477 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.37秒
2025-03-30 16:44:27,477 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 16:44:27,477 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_c72bfbc8 回答分析完成。当前症状: ['肚疼', '用户描述不清晰']. 置信度: 0.50
2025-03-30 16:44:27,477 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_c72bfbc8 (Context: web_c51ee967-0f51-4fd6-bd14-82bf309e175d) 提出下一个问题。
2025-03-30 16:44:27,477 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:44:27,477 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:44:27,477 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:44:27,482 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:44:27,485 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:44:28,908 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:44:28,914 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.43秒
2025-03-30 16:44:28,915 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否伴随其他症状，例如恶心、呕吐、腹胀、发热或排便异常？
2025-03-30 16:44:28,965 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): Status=in_progress, Agent=doctor, Msg='疼痛是否伴随其他症状，例如恶心、呕吐、腹胀、发热或排便异常？...'
2025-03-30 16:44:28,966 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:44:28] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:44:31,593 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): '无...'
2025-03-30 16:44:31,611 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d (Patient ID in context: WebPatient_c72bfbc8), 当前阶段: information_gathering
2025-03-30 16:44:31,611 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:44:31,631 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_c72bfbc8 对问题 (Context: web_c51ee967-0f51-4fd6-bd14-82bf309e175d) 的回答: '无...'
2025-03-30 16:44:31,639 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:44:31,639 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:44:31,639 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否伴随...
2025-03-30 16:44:31,764 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:44:31,768 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:44:32,914 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:44:32,918 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.15秒
2025-03-30 16:44:32,918 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 16:44:32,918 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_c72bfbc8 回答分析完成。当前症状: ['肚疼', '用户描述不清晰']. 置信度: 0.60
2025-03-30 16:44:32,918 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_c72bfbc8 (Context: web_c51ee967-0f51-4fd6-bd14-82bf309e175d) 提出下一个问题。
2025-03-30 16:44:32,918 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 16:44:32,918 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 16:44:32,918 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 16:44:32,920 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:44:32,922 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:44:34,085 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:44:34,087 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.17秒
2025-03-30 16:44:34,088 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否会向其他部位放射，例如后背、肩膀或胸口？
2025-03-30 16:44:34,141 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): Status=in_progress, Agent=doctor, Msg='疼痛是否会向其他部位放射，例如后背、肩膀或胸口？...'
2025-03-30 16:44:34,141 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:44:34] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:44:39,535 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): '后背...'
2025-03-30 16:44:39,553 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d (Patient ID in context: WebPatient_c72bfbc8), 当前阶段: information_gathering
2025-03-30 16:44:39,553 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:44:39,573 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_c72bfbc8 对问题 (Context: web_c51ee967-0f51-4fd6-bd14-82bf309e175d) 的回答: '后背...'
2025-03-30 16:44:39,581 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 16:44:39,581 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 16:44:39,581 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否会向...
2025-03-30 16:44:39,582 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:44:39,584 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:44:41,842 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:44:41,845 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.26秒
2025-03-30 16:44:41,845 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["后背疼痛放射"],
  "symptom...
2025-03-30 16:44:41,846 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_c72bfbc8 回答分析完成。当前症状: ['后背疼痛放射', '肚疼', '用户描述不清晰']. 置信度: 0.70
2025-03-30 16:44:41,846 - Hospital-MultiAgent-System - INFO - 可以诊断：问题数 4 >= 4 且置信度 0.70 > 0.4
2025-03-30 16:44:41,846 - Hospital-MultiAgent-System - INFO - 医生 主治医生 可以为患者 WebPatient_c72bfbc8 (Context: web_c51ee967-0f51-4fd6-bd14-82bf309e175d) 做出诊断。
2025-03-30 16:44:41,846 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：1000，温度：0.3
2025-03-30 16:44:41,846 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位资深医生，正在进行诊断。请给出专业、简洁且结构化的诊断结果（JSON格式）。
2025-03-30 16:44:41,846 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医生，请根据以下信息生成诊断结果：
症状：后背疼痛放射, 肚疼, 用户描述不清晰
病史：无
...
2025-03-30 16:44:41,850 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:44:41,853 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:44:44,573 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:44:44,576 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.72秒
2025-03-30 16:44:44,576 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "可能为肾结石或胃肠道问题",
  "explan...
2025-03-30 16:44:44,576 - Hospital-MultiAgent-System - INFO - 为症状 '后背疼痛放射, 肚疼, 用户描述不清晰' 生成诊断结果：可能为肾结石或胃肠道问题
2025-03-30 16:44:44,591 - Hospital-MultiAgent-System - INFO - 删除问诊上下文: web_c51ee967-0f51-4fd6-bd14-82bf309e175d (Patient: WebPatient_c72bfbc8)
2025-03-30 16:44:44,608 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:44:44,608 - Hospital-MultiAgent-System - INFO - 医生完成诊断 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d, Patient: WebPatient_c72bfbc8)
2025-03-30 16:44:44,608 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:44:44,608 - Hospital-MultiAgent-System - INFO - 诊断完成，需开药，触发审核 (Patient: WebPatient_c72bfbc8, Context: web_c51ee967-0f51-4fd6-bd14-82bf309e175d)
2025-03-30 16:44:44,608 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:44:44,608 - Hospital-MultiAgent-System - INFO - 向药剂师发送处方审核请求 (Patient: WebPatient_c72bfbc8)...
2025-03-30 16:44:44,612 - Hospital-MultiAgent-System - INFO - 药剂师 药剂师 正在审核患者 WebPatient_c72bfbc8 的处方...
2025-03-30 16:44:44,612 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.1
2025-03-30 16:44:44,612 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富、极其严谨的临床药剂师。请仔细检查处方，并【严格按照要求的JSON格式】输出反馈，【...
2025-03-30 16:44:44,612 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位资深临床药剂师，请基于患者的部分诊断信息和以下处方，严格审核其合理性、安全性及潜在风险。

...
2025-03-30 16:44:44,614 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:44:44,615 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:44:44,983 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 429 Too Many Requests"
2025-03-30 16:44:44,985 - openai._base_client - INFO - Retrying request to /deployments/gpt-4o/chat/completions in 2.000000 seconds
2025-03-30 16:44:49,057 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:44:49,060 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：4.45秒
2025-03-30 16:44:49,060 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "valid": false,
  "issues": ["疗程未指定", "布洛芬可能对肾...
2025-03-30 16:44:49,060 - Hospital-MultiAgent-System - INFO - 处方审核LLM解析成功: Valid=False, Issues=2, Warnings=1
2025-03-30 16:44:49,080 - Hospital-MultiAgent-System - WARNING - 患者 WebPatient_c72bfbc8 的处方未通过审核: 疗程未指定、布洛芬可能对肾功能有潜在影响，需谨慎使用
2025-03-30 16:44:49,093 - Hospital-MultiAgent-System - INFO - 收到药剂师审核响应 (Patient: WebPatient_c72bfbc8)。Status: rejected
2025-03-30 16:44:49,093 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:44:49,093 - Hospital-MultiAgent-System - WARNING - 处方审核被拒绝 (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): ['疗程未指定', '布洛芬可能对肾功能有潜在影响，需谨慎使用']
2025-03-30 16:44:49,093 - Hospital-MultiAgent-System - INFO - Web 咨询 web_c51ee967-0f51-4fd6-bd14-82bf309e175d 结束: error_prescription_rejected
2025-03-30 16:44:49,093 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_c51ee967-0f51-4fd6-bd14-82bf309e175d
2025-03-30 16:44:49,102 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_c51ee967-0f51-4fd6-bd14-82bf309e175d): Status=error_prescription_rejected, Agent=doctor, Msg='感谢您的配合。根据您提供的信息，我已完成初步诊断。
处方审核未通过: 疗程未指定、布洛芬可能对肾功能有潜在影响，需谨慎使用。处方存在疗程不明...'
2025-03-30 16:44:49,102 - Hospital-MultiAgent-System-Web - INFO - Web 咨询 web_c51ee967-0f51-4fd6-bd14-82bf309e175d 已达到结束状态: error_prescription_rejected
2025-03-30 16:44:49,102 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:44:49] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:44:55,295 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:44:55] "GET /logs HTTP/1.1" 200 -
2025-03-30 16:44:55,304 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:44:55] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 16:44:55,307 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:44:55] "GET /api/interaction_logs HTTP/1.1" 200 -
2025-03-30 16:45:00,436 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:45:00] "GET /api/interaction_logs/web_c51ee967-0f51-4fd6-bd14-82bf309e175d HTTP/1.1" 200 -
2025-03-30 16:52:59,377 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/receptionist.py', reloading
2025-03-30 16:52:59,443 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:52:59,638 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:52:59,638 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:52:59,638 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:52:59,638 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:52:59,651 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:52:59,651 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:52:59,653 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:52:59,653 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 0088b8cf-cc59-4d89-b4ed-61a5492ce7ca)
2025-03-30 16:52:59,653 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:52:59,653 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: d6e637ea-9949-4b1f-9e1d-6bba357f4804)
2025-03-30 16:52:59,653 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:52:59,653 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 250adc1d-b393-487e-8fe0-2ccceba457e9)
2025-03-30 16:52:59,653 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:52:59,653 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:52:59,653 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:52:59,653 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:52:59,667 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:52:59,672 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:53:34,945 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/receptionist.py', reloading
2025-03-30 16:53:35,004 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:53:35,205 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:53:35,205 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:53:35,205 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:53:35,205 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:53:35,218 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:53:35,218 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:53:35,219 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:53:35,219 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 2d8d2b13-51aa-4221-947e-d082507d81ed)
2025-03-30 16:53:35,219 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:53:35,219 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 81bce4af-d066-45d2-abcf-f7e90b9936d6)
2025-03-30 16:53:35,219 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:53:35,219 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 6c79f493-18ee-40f3-a0fd-b1de14bbddf8)
2025-03-30 16:53:35,219 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:53:35,219 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:53:35,219 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:53:35,220 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:53:35,233 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:53:35,238 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:53:47,357 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/receptionist.py', reloading
2025-03-30 16:53:47,445 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:53:47,659 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:53:47,659 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:53:47,659 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:53:47,659 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:53:47,672 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:53:47,673 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:53:47,674 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:53:47,674 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: fdd2d495-ff09-4ebf-a64b-2c73f98cf9b7)
2025-03-30 16:53:47,674 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:53:47,674 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 10a7333b-d5e9-41ce-9968-69bfa486f190)
2025-03-30 16:53:47,674 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:53:47,674 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 8ae80313-87a8-4f1f-b0a7-296ecb1bdf72)
2025-03-30 16:53:47,674 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:53:47,674 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:53:47,674 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:53:47,675 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:53:47,690 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:53:47,695 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:54:10,769 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:54:10,769 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 16:54:10,769 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:54:10,769 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 16:54:10,769 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 16:54:10,782 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:54:10,782 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:54:10,783 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:54:10,783 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 9ccf61dc-a455-4d19-827f-4d70a8a0bc6e)
2025-03-30 16:54:10,783 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:54:10,783 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 537fa682-6a34-4b6b-a319-ecf5e0d2a473)
2025-03-30 16:54:10,783 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:54:10,783 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: fb755080-7fff-4c03-92df-480da31bf4bb)
2025-03-30 16:54:10,783 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:54:10,783 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:54:10,783 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:54:10,784 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:54:10,802 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 16:54:10,802 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 16:54:10,802 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:54:10,990 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:54:10,990 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:54:10,990 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:54:10,990 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:54:11,003 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:54:11,003 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:54:11,005 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:54:11,005 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: bb14683e-1c7d-41cf-8741-a7a1d53e822c)
2025-03-30 16:54:11,005 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:54:11,005 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: b8f568f8-9f9f-4f82-a6b9-7dfa8d340e4b)
2025-03-30 16:54:11,005 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:54:11,005 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: a789545a-db55-4a37-8256-257e510e0ae3)
2025-03-30 16:54:11,005 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:54:11,005 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:54:11,005 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:54:11,005 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:54:11,020 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:54:11,024 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:54:13,695 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:54:13] "GET / HTTP/1.1" 200 -
2025-03-30 16:54:13,707 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:54:13] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 16:54:13,707 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:54:13] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 16:54:13,713 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b
2025-03-30 16:54:13,713 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b
2025-03-30 16:54:13,714 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:54:13] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 16:54:17,090 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b): '你好...'
2025-03-30 16:54:17,090 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b，视为新对话，转给接待员。
2025-03-30 16:54:17,092 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_0e791be7 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T08:54:17.091966+00:00'}
2025-03-30 16:54:17,092 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_0e791be7 不存在，创建新的记忆记录。
2025-03-30 16:54:17,109 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_0e791be7 (Name: 网页用户, Age: None)
2025-03-30 16:54:17,109 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b
2025-03-30 16:54:17,110 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b
2025-03-30 16:54:17,110 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b
2025-03-30 16:54:17,119 - Hospital-MultiAgent-System - INFO - 为咨询 web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b (Patient: WebPatient_0e791be7) 创建新上下文
2025-03-30 16:54:17,119 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b (Patient: WebPatient_0e791be7)
2025-03-30 16:54:17,134 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:54:17,134 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:54:17,134 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 16:54:17,306 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:54:17,308 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:54:19,871 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:54:19,882 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.57秒
2025-03-30 16:54:19,882 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 16:54:19,883 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0e791be7): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 16:54:19,883 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1，与诊断无关对话轮次: 1
2025-03-30 16:54:19,883 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 16:54:19,883 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 16:54:19,883 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 16:54:19,887 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:54:19,889 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:54:20,788 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:54:20,794 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.90秒
2025-03-30 16:54:20,794 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好，欢迎来到医院！请您简单描述症状，我们将为您安排合适的医生或科室。感谢您的配合！
2025-03-30 16:54:20,838 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b): Status=in_progress, Agent=receptionist, Msg='您好，欢迎来到医院！请您简单描述症状，我们将为您安排合适的医生或科室。感谢您的配合！...'
2025-03-30 16:54:20,839 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:54:20] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:54:25,274 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b): '我想打篮球...'
2025-03-30 16:54:25,292 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b (Patient ID in context: WebPatient_0e791be7), 当前阶段: reception_chatting
2025-03-30 16:54:25,292 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b
2025-03-30 16:54:25,311 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b, 当前阶段: reception_chatting
2025-03-30 16:54:25,318 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:54:25,318 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:54:25,318 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好
Receptio...
2025-03-30 16:54:25,320 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:54:25,321 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:54:26,420 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:54:26,424 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.10秒
2025-03-30 16:54:26,424 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "unclear",
  "has_sufficient_medical...
2025-03-30 16:54:26,424 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0e791be7): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 16:54:26,425 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_0e791be7)
2025-03-30 16:54:26,471 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 16:54:26,471 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:54:26] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:54:31,513 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b): '我想去那美克星...'
2025-03-30 16:54:31,528 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b (Patient ID in context: WebPatient_0e791be7), 当前阶段: reception_clarification
2025-03-30 16:54:31,528 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b
2025-03-30 16:54:31,550 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b, 当前阶段: reception_clarification
2025-03-30 16:54:31,557 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:54:31,558 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:54:31,558 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 您好，...
2025-03-30 16:54:31,559 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:54:31,560 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:54:33,589 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:54:33,591 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.03秒
2025-03-30 16:54:33,591 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "unclear",
  "has_sufficient...
2025-03-30 16:54:33,592 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0e791be7): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 16:54:33,592 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_0e791be7)
2025-03-30 16:54:33,643 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 16:54:33,643 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:54:33] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:54:39,186 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b): '去那美克星打篮球...'
2025-03-30 16:54:39,204 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b (Patient ID in context: WebPatient_0e791be7), 当前阶段: reception_clarification
2025-03-30 16:54:39,205 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b
2025-03-30 16:54:39,225 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b, 当前阶段: reception_clarification
2025-03-30 16:54:39,232 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:54:39,233 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:54:39,233 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 嗯，请...
2025-03-30 16:54:39,347 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:54:39,350 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:54:41,176 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:54:41,178 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.83秒
2025-03-30 16:54:41,179 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 16:54:41,181 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0e791be7): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 16:54:41,182 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 2，与诊断无关对话轮次: 2
2025-03-30 16:54:41,182 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 16:54:41,182 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 16:54:41,182 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："去那美克星打篮球"。请给出一个简洁、专业、乐于助人但...
2025-03-30 16:54:41,185 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:54:41,187 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:54:42,498 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:54:42,501 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.31秒
2025-03-30 16:54:42,501 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好！您可以简单描述需求或症状，我们将为您安排合适的科室和医生，非常感谢您的配合！
2025-03-30 16:54:42,551 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_0c79e93f-1b8b-4f9b-a740-a7c8eff5dc4b): Status=in_progress, Agent=receptionist, Msg='您好！您可以简单描述需求或症状，我们将为您安排合适的科室和医生，非常感谢您的配合！...'
2025-03-30 16:54:42,551 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:54:42] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:56:45,271 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/receptionist.py', reloading
2025-03-30 16:56:45,339 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:56:45,532 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:56:45,532 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:56:45,532 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:56:45,532 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:56:45,545 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:56:45,545 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:56:45,547 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:56:45,547 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 350af146-2e17-42be-a022-c63ae9487ee8)
2025-03-30 16:56:45,547 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:56:45,547 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 74ef6a3d-eb3d-4684-89f2-58c826754118)
2025-03-30 16:56:45,547 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:56:45,547 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 4fc429e1-f40f-4893-9683-503057eb65b7)
2025-03-30 16:56:45,547 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:56:45,547 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:56:45,547 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:56:45,547 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:56:45,561 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:56:45,565 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:56:48,586 - werkzeug - INFO -  * Detected change in '/Users/chilikevin/hospital_multiagent_system/agents/receptionist.py', reloading
2025-03-30 16:56:48,647 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:56:48,864 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:56:48,864 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:56:48,864 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:56:48,864 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:56:48,877 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:56:48,877 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:56:48,879 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:56:48,879 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 72cc1f8d-c102-459c-b99d-7ce89c48ea83)
2025-03-30 16:56:48,879 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:56:48,879 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 042fb78f-aeb2-4f23-a073-62ff3d82608c)
2025-03-30 16:56:48,879 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:56:48,879 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 96df2067-1237-40a0-b9a9-9e195c35143e)
2025-03-30 16:56:48,879 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:56:48,879 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:56:48,879 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:56:48,880 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:56:48,893 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:56:48,897 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:57:18,430 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:57:18,430 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 16:57:18,430 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:57:18,430 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 16:57:18,430 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 16:57:18,443 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:57:18,443 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:57:18,444 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:57:18,444 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: b2a8ed75-1aaa-4968-8fba-73220d910fb4)
2025-03-30 16:57:18,444 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:57:18,444 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 525f5867-4e55-4f55-89b8-1fceb00ab99c)
2025-03-30 16:57:18,444 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:57:18,444 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 7f7968d1-585e-439f-8361-da73fb1316fa)
2025-03-30 16:57:18,444 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:57:18,444 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:57:18,444 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:57:18,445 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:57:18,465 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 16:57:18,466 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 16:57:18,466 - werkzeug - INFO -  * Restarting with stat
2025-03-30 16:57:18,645 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 16:57:18,645 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 16:57:18,645 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 16:57:18,645 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 16:57:18,658 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 16:57:18,658 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 16:57:18,660 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 16:57:18,660 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: c91c4202-23e9-4765-983d-b0206976ff6e)
2025-03-30 16:57:18,660 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 16:57:18,660 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: edba9d28-5009-4038-95e4-c08da5f23da1)
2025-03-30 16:57:18,660 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 16:57:18,660 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: de616952-17ff-4b96-80da-3a327eddf052)
2025-03-30 16:57:18,660 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 16:57:18,660 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 16:57:18,660 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 16:57:18,661 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 16:57:18,674 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 16:57:18,678 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 16:57:21,200 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:57:21] "GET / HTTP/1.1" 200 -
2025-03-30 16:57:21,214 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:57:21] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 16:57:21,214 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:57:21] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 16:57:21,219 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_2016dbdb-a132-409d-bd46-960cd475f407
2025-03-30 16:57:21,219 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_2016dbdb-a132-409d-bd46-960cd475f407
2025-03-30 16:57:21,220 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:57:21] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 16:57:25,245 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407): '你好...'
2025-03-30 16:57:25,245 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_2016dbdb-a132-409d-bd46-960cd475f407，视为新对话，转给接待员。
2025-03-30 16:57:25,247 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_2ff85e17 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T08:57:25.247130+00:00'}
2025-03-30 16:57:25,247 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_2ff85e17 不存在，创建新的记忆记录。
2025-03-30 16:57:25,264 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_2ff85e17 (Name: 网页用户, Age: None)
2025-03-30 16:57:25,265 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_2016dbdb-a132-409d-bd46-960cd475f407
2025-03-30 16:57:25,265 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407
2025-03-30 16:57:25,265 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_2016dbdb-a132-409d-bd46-960cd475f407
2025-03-30 16:57:25,275 - Hospital-MultiAgent-System - INFO - 为咨询 web_2016dbdb-a132-409d-bd46-960cd475f407 (Patient: WebPatient_2ff85e17) 创建新上下文
2025-03-30 16:57:25,275 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_2016dbdb-a132-409d-bd46-960cd475f407 (Patient: WebPatient_2ff85e17)
2025-03-30 16:57:25,290 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:57:25,290 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:57:25,290 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 16:57:25,453 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:57:25,456 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:57:30,558 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:57:30,567 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：5.11秒
2025-03-30 16:57:30,568 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 16:57:30,569 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_2ff85e17): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 16:57:30,569 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1，与诊断无关对话轮次: 1
2025-03-30 16:57:30,569 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 16:57:30,569 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 16:57:30,569 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 16:57:30,571 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:57:30,573 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:57:31,479 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:57:31,482 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.91秒
2025-03-30 16:57:31,483 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好！欢迎来到医院，请问有什么可以帮您？如需预约医生，请先简要描述您的症状，我们将为您安排合适的分诊...
2025-03-30 16:57:31,533 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407): Status=in_progress, Agent=receptionist, Msg='您好！欢迎来到医院，请问有什么可以帮您？如需预约医生，请先简要描述您的症状，我们将为您安排合适的分诊。...'
2025-03-30 16:57:31,534 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:57:31] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:57:34,619 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407): '我想打篮球...'
2025-03-30 16:57:34,642 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_2016dbdb-a132-409d-bd46-960cd475f407 (Patient ID in context: WebPatient_2ff85e17), 当前阶段: reception_chatting
2025-03-30 16:57:34,642 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407
2025-03-30 16:57:34,658 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_2016dbdb-a132-409d-bd46-960cd475f407, 当前阶段: reception_chatting
2025-03-30 16:57:34,665 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:57:34,665 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:57:34,665 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好
Receptio...
2025-03-30 16:57:34,666 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:57:34,667 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:57:35,465 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:57:35,468 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.80秒
2025-03-30 16:57:35,469 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "unclear",
  "has_sufficient...
2025-03-30 16:57:35,469 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_2ff85e17): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 16:57:35,469 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_2ff85e17)
2025-03-30 16:57:35,517 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 16:57:35,518 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:57:35] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:57:42,158 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407): '我要去那美克星...'
2025-03-30 16:57:42,175 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_2016dbdb-a132-409d-bd46-960cd475f407 (Patient ID in context: WebPatient_2ff85e17), 当前阶段: reception_clarification
2025-03-30 16:57:42,175 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407
2025-03-30 16:57:42,192 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_2016dbdb-a132-409d-bd46-960cd475f407, 当前阶段: reception_clarification
2025-03-30 16:57:42,199 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:57:42,199 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:57:42,199 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 您好！...
2025-03-30 16:57:42,365 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:57:42,368 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:57:44,483 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:57:44,487 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.12秒
2025-03-30 16:57:44,487 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 16:57:44,487 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_2ff85e17): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 16:57:44,487 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 2，与诊断无关对话轮次: 2
2025-03-30 16:57:44,488 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 16:57:44,488 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 16:57:44,488 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："我要去那美克星"。请给出一个简洁、专业、乐于助人但【...
2025-03-30 16:57:44,492 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:57:44,494 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:57:45,321 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:57:45,326 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.83秒
2025-03-30 16:57:45,326 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：欢迎光临！若需协助，请简要说明您的需求或症状，我们将为您安排适合的服务或分诊。谢谢！
2025-03-30 16:57:45,373 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407): Status=in_progress, Agent=receptionist, Msg='欢迎光临！若需协助，请简要说明您的需求或症状，我们将为您安排适合的服务或分诊。谢谢！...'
2025-03-30 16:57:45,374 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:57:45] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:58:08,628 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407): '去那美克星打篮球...'
2025-03-30 16:58:08,651 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_2016dbdb-a132-409d-bd46-960cd475f407 (Patient ID in context: WebPatient_2ff85e17), 当前阶段: reception_chatting
2025-03-30 16:58:08,651 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407
2025-03-30 16:58:08,670 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_2016dbdb-a132-409d-bd46-960cd475f407, 当前阶段: reception_chatting
2025-03-30 16:58:08,677 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:58:08,677 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:58:08,677 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 嗯，请...
2025-03-30 16:58:08,838 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:58:08,840 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:58:10,562 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:58:10,564 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.72秒
2025-03-30 16:58:10,564 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 16:58:10,565 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_2ff85e17): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 16:58:10,565 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 3，与诊断无关对话轮次: 3
2025-03-30 16:58:10,565 - Hospital-MultiAgent-System - INFO - 用户闲聊已达3轮，返回标准回复 (Patient: WebPatient_2ff85e17)
2025-03-30 16:58:10,616 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407): Status=in_progress, Agent=receptionist, Msg='您交流过多和看诊无关的话题，请描述您的具体症状，或明天再来沟通。我们需要给其他病人留出更多时间，谢谢理解。...'
2025-03-30 16:58:10,617 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:58:10] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 16:58:20,142 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407): '赵大夫打篮球吗？...'
2025-03-30 16:58:20,161 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_2016dbdb-a132-409d-bd46-960cd475f407 (Patient ID in context: WebPatient_2ff85e17), 当前阶段: reception_chat_ended
2025-03-30 16:58:20,161 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407
2025-03-30 16:58:20,182 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_2016dbdb-a132-409d-bd46-960cd475f407, 当前阶段: reception_chat_ended
2025-03-30 16:58:20,189 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 16:58:20,190 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 16:58:20,190 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 欢迎光...
2025-03-30 16:58:20,191 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 16:58:20,192 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 16:58:21,986 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 16:58:21,990 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.80秒
2025-03-30 16:58:21,990 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 16:58:21,990 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_2ff85e17): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 16:58:21,991 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 4，与诊断无关对话轮次: 4
2025-03-30 16:58:21,991 - Hospital-MultiAgent-System - INFO - 用户闲聊已达3轮，返回标准回复 (Patient: WebPatient_2ff85e17)
2025-03-30 16:58:22,036 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_2016dbdb-a132-409d-bd46-960cd475f407): Status=in_progress, Agent=receptionist, Msg='您交流过多和看诊无关的话题，请描述您的具体症状，或明天再来沟通。我们需要给其他病人留出更多时间，谢谢理解。...'
2025-03-30 16:58:22,037 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 16:58:22] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:20:59,489 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 17:20:59,489 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 17:20:59,489 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 17:20:59,489 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 17:20:59,489 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 17:20:59,501 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 17:20:59,501 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 17:20:59,503 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 17:20:59,503 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 2a4d2835-c999-4898-be42-58b7c5c42ed1)
2025-03-30 17:20:59,503 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 17:20:59,503 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: a585746c-8b70-4e99-90ed-235afa8ad41c)
2025-03-30 17:20:59,503 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 17:20:59,503 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: f02d5716-df50-4436-aaaf-d0de9516402e)
2025-03-30 17:20:59,503 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 17:20:59,503 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 17:20:59,503 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 17:20:59,504 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 17:20:59,522 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 17:20:59,522 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 17:20:59,522 - werkzeug - INFO -  * Restarting with stat
2025-03-30 17:20:59,702 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 17:20:59,702 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 17:20:59,702 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 17:20:59,702 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 17:20:59,702 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 17:20:59,715 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 17:20:59,715 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 17:20:59,716 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 17:20:59,716 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 0596e716-49f3-4cb4-ab34-b2bb125c2320)
2025-03-30 17:20:59,716 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 17:20:59,716 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 70280971-7059-48c4-999a-8c02ea28b034)
2025-03-30 17:20:59,716 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 17:20:59,716 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 700ec407-4dda-45e2-8178-b6db38075a4e)
2025-03-30 17:20:59,716 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 17:20:59,716 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 17:20:59,716 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 17:20:59,717 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 17:20:59,731 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 17:20:59,735 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 17:21:10,020 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:21:10] "GET / HTTP/1.1" 200 -
2025-03-30 17:21:10,036 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:21:10] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 17:21:10,037 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:21:10] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 17:21:10,040 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:21:10] "[33mGET /static/images/hospital_background.jpg HTTP/1.1[0m" 404 -
2025-03-30 17:21:10,045 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_d5e278a7-c919-475e-a6db-92a776c1a610
2025-03-30 17:21:10,045 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_d5e278a7-c919-475e-a6db-92a776c1a610
2025-03-30 17:21:10,046 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:21:10] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 17:21:18,078 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:21:18] "GET /logs HTTP/1.1" 200 -
2025-03-30 17:21:18,086 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:21:18] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 17:21:18,091 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:21:18] "[33mGET /static/images/hospital_background.jpg HTTP/1.1[0m" 404 -
2025-03-30 17:21:18,091 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:21:18] "GET /api/interaction_logs HTTP/1.1" 200 -
2025-03-30 17:21:28,481 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_d5e278a7-c919-475e-a6db-92a776c1a610): '你好...'
2025-03-30 17:21:28,481 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_d5e278a7-c919-475e-a6db-92a776c1a610，视为新对话，转给接待员。
2025-03-30 17:21:28,482 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_899f14a6 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T09:21:28.482704+00:00'}
2025-03-30 17:21:28,482 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_899f14a6 不存在，创建新的记忆记录。
2025-03-30 17:21:28,504 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_899f14a6 (Name: 网页用户, Age: None)
2025-03-30 17:21:28,504 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_d5e278a7-c919-475e-a6db-92a776c1a610
2025-03-30 17:21:28,504 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_d5e278a7-c919-475e-a6db-92a776c1a610
2025-03-30 17:21:28,504 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_d5e278a7-c919-475e-a6db-92a776c1a610
2025-03-30 17:21:28,514 - Hospital-MultiAgent-System - INFO - 为咨询 web_d5e278a7-c919-475e-a6db-92a776c1a610 (Patient: WebPatient_899f14a6) 创建新上下文
2025-03-30 17:21:28,514 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_d5e278a7-c919-475e-a6db-92a776c1a610 (Patient: WebPatient_899f14a6)
2025-03-30 17:21:28,530 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：，最大令牌：200，温度：0.1
2025-03-30 17:21:28,530 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 17:21:28,530 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 17:21:28,550 - openai._base_client - INFO - Retrying request to /deployments//chat/completions in 0.821327 seconds
2025-03-30 17:21:29,378 - openai._base_client - INFO - Retrying request to /deployments//chat/completions in 1.961350 seconds
2025-03-30 17:21:31,343 - Hospital-MultiAgent-System - ERROR - LLM响应生成失败: Connection error.，耗时：2.81秒
2025-03-30 17:21:31,343 - Hospital-MultiAgent-System - ERROR - 错误类型: APIConnectionError
2025-03-30 17:21:31,354 - Hospital-MultiAgent-System - ERROR - 错误详情: Traceback (most recent call last):
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 60, in map_httpcore_exceptions
    yield
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 218, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 214, in handle_request
    raise UnsupportedProtocol(
httpcore.UnsupportedProtocol: Request URL is missing an 'http://' or 'https://' protocol.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 918, in _request
    response = self._client.send(
               ^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 901, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 929, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 966, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 1002, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 217, in handle_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 77, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.UnsupportedProtocol: Request URL is missing an 'http://' or 'https://' protocol.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 60, in map_httpcore_exceptions
    yield
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 218, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 214, in handle_request
    raise UnsupportedProtocol(
httpcore.UnsupportedProtocol: Request URL is missing an 'http://' or 'https://' protocol.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 918, in _request
    response = self._client.send(
               ^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 901, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 929, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 966, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 1002, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 217, in handle_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 77, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.UnsupportedProtocol: Request URL is missing an 'http://' or 'https://' protocol.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 60, in map_httpcore_exceptions
    yield
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 218, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 214, in handle_request
    raise UnsupportedProtocol(
httpcore.UnsupportedProtocol: Request URL is missing an 'http://' or 'https://' protocol.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 918, in _request
    response = self._client.send(
               ^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 901, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 929, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 966, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 1002, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 217, in handle_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 77, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.UnsupportedProtocol: Request URL is missing an 'http://' or 'https://' protocol.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/utils/llm_service.py", line 129, in generate_response
    response = self.client.chat.completions.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 663, in create
    return self._post(
           ^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 1200, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 889, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 942, in _request
    return self._retry_request(
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 1013, in _retry_request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 942, in _request
    return self._retry_request(
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 1013, in _retry_request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 952, in _request
    raise APIConnectionError(request=request) from err
openai.APIConnectionError: Connection error.

2025-03-30 17:21:31,356 - Hospital-MultiAgent-System - ERROR - 检测到网络连接问题，请检查您的网络连接和防火墙设置
2025-03-30 17:21:31,356 - Hospital-MultiAgent-System - ERROR - 意图识别LLM调用或解析失败 (Patient WebPatient_899f14a6): Expecting value: line 1 column 1 (char 0)
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/agents/receptionist.py", line 86, in _determine_intent_and_extract
    result = json.loads(json_part)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/__init__.py", line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/decoder.py", line 338, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/decoder.py", line 356, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
2025-03-30 17:21:31,399 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_d5e278a7-c919-475e-a6db-92a776c1a610): Status=in_progress, Agent=receptionist, Msg='抱歉，系统在理解您意图的时候好像出了点问题 (意图识别失败: Expecting value: line 1 column 1 (char ...'
2025-03-30 17:21:31,399 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:21:31] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:21:44,129 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_d5e278a7-c919-475e-a6db-92a776c1a610): '？...'
2025-03-30 17:21:44,152 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_d5e278a7-c919-475e-a6db-92a776c1a610 (Patient ID in context: WebPatient_899f14a6), 当前阶段: reception_error_handling
2025-03-30 17:21:44,153 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_d5e278a7-c919-475e-a6db-92a776c1a610
2025-03-30 17:21:44,172 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_d5e278a7-c919-475e-a6db-92a776c1a610, 当前阶段: reception_error_handling
2025-03-30 17:21:44,181 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：，最大令牌：200，温度：0.1
2025-03-30 17:21:44,181 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 17:21:44,181 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好
Receptio...
2025-03-30 17:21:44,183 - openai._base_client - INFO - Retrying request to /deployments//chat/completions in 0.787689 seconds
2025-03-30 17:21:44,977 - openai._base_client - INFO - Retrying request to /deployments//chat/completions in 1.984948 seconds
2025-03-30 17:21:46,968 - Hospital-MultiAgent-System - ERROR - LLM响应生成失败: Connection error.，耗时：2.79秒
2025-03-30 17:21:46,969 - Hospital-MultiAgent-System - ERROR - 错误类型: APIConnectionError
2025-03-30 17:21:46,971 - Hospital-MultiAgent-System - ERROR - 错误详情: Traceback (most recent call last):
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 60, in map_httpcore_exceptions
    yield
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 218, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 214, in handle_request
    raise UnsupportedProtocol(
httpcore.UnsupportedProtocol: Request URL is missing an 'http://' or 'https://' protocol.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 918, in _request
    response = self._client.send(
               ^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 901, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 929, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 966, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 1002, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 217, in handle_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 77, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.UnsupportedProtocol: Request URL is missing an 'http://' or 'https://' protocol.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 60, in map_httpcore_exceptions
    yield
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 218, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 214, in handle_request
    raise UnsupportedProtocol(
httpcore.UnsupportedProtocol: Request URL is missing an 'http://' or 'https://' protocol.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 918, in _request
    response = self._client.send(
               ^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 901, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 929, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 966, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 1002, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 217, in handle_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 77, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.UnsupportedProtocol: Request URL is missing an 'http://' or 'https://' protocol.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 60, in map_httpcore_exceptions
    yield
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 218, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py", line 214, in handle_request
    raise UnsupportedProtocol(
httpcore.UnsupportedProtocol: Request URL is missing an 'http://' or 'https://' protocol.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 918, in _request
    response = self._client.send(
               ^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 901, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 929, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 966, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_client.py", line 1002, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 217, in handle_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/httpx/_transports/default.py", line 77, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.UnsupportedProtocol: Request URL is missing an 'http://' or 'https://' protocol.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/utils/llm_service.py", line 129, in generate_response
    response = self.client.chat.completions.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 663, in create
    return self._post(
           ^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 1200, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 889, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 942, in _request
    return self._retry_request(
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 1013, in _retry_request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 942, in _request
    return self._retry_request(
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 1013, in _retry_request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/site-packages/openai/_base_client.py", line 952, in _request
    raise APIConnectionError(request=request) from err
openai.APIConnectionError: Connection error.

2025-03-30 17:21:46,973 - Hospital-MultiAgent-System - ERROR - 检测到网络连接问题，请检查您的网络连接和防火墙设置
2025-03-30 17:21:46,973 - Hospital-MultiAgent-System - ERROR - 意图识别LLM调用或解析失败 (Patient WebPatient_899f14a6): Expecting value: line 1 column 1 (char 0)
Traceback (most recent call last):
  File "/Users/chilikevin/hospital_multiagent_system/agents/receptionist.py", line 86, in _determine_intent_and_extract
    result = json.loads(json_part)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/__init__.py", line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/decoder.py", line 338, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chilikevin/miniconda3/envs/ma/lib/python3.12/json/decoder.py", line 356, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
2025-03-30 17:21:47,022 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_d5e278a7-c919-475e-a6db-92a776c1a610): Status=in_progress, Agent=receptionist, Msg='抱歉，系统在理解您意图的时候好像出了点问题 (意图识别失败: Expecting value: line 1 column 1 (char ...'
2025-03-30 17:21:47,023 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:21:47] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:25:44,867 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 17:25:44,867 - Hospital-MultiAgent-System-Web - WARNING - LLM 配置不完整，功能可能受限。
2025-03-30 17:25:44,867 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 17:25:44,867 - Hospital-MultiAgent-System - INFO - 端点URL：
2025-03-30 17:25:44,867 - Hospital-MultiAgent-System - WARNING - 未提供API密钥
2025-03-30 17:25:44,880 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 17:25:44,880 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 17:25:44,881 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 17:25:44,881 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: a725ed19-ab75-46d4-b89b-760f53b09b9f)
2025-03-30 17:25:44,881 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 17:25:44,882 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: cf690025-0f4a-4161-b732-aa7ab0d20440)
2025-03-30 17:25:44,882 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 17:25:44,882 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: b2616f19-6eb2-4cbf-aecd-d95588011ad2)
2025-03-30 17:25:44,882 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 17:25:44,882 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 17:25:44,882 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 17:25:44,882 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 17:25:44,898 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
2025-03-30 17:25:44,898 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-03-30 17:25:44,898 - werkzeug - INFO -  * Restarting with stat
2025-03-30 17:25:45,079 - Hospital-MultiAgent-System-Web - INFO - 开始初始化医院核心系统...
2025-03-30 17:25:45,079 - Hospital-MultiAgent-System - INFO - 正在初始化Azure OpenAI客户端，API版本：2024-05-01-preview
2025-03-30 17:25:45,079 - Hospital-MultiAgent-System - INFO - 端点URL：https://bysnd.openai.azure.com/
2025-03-30 17:25:45,079 - Hospital-MultiAgent-System - INFO - API密钥（部分掩码）：AHVg***gHzd
2025-03-30 17:25:45,092 - Hospital-MultiAgent-System - INFO - Azure OpenAI客户端初始化成功
2025-03-30 17:25:45,092 - Hospital-MultiAgent-System - INFO - 从 /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json 加载记忆...
2025-03-30 17:25:45,093 - Hospital-MultiAgent-System - INFO - 记忆系统初始化完成。持久化路径: /Users/chilikevin/hospital_multiagent_system/data/hospital_memory_web.json
2025-03-30 17:25:45,093 - Hospital-MultiAgent-System - INFO - 初始化 receptionist 智能体: 前台接待员 (ID: 5f0bb837-d713-4439-8cc1-c118dedbe346)
2025-03-30 17:25:45,093 - Hospital-MultiAgent-System - INFO - 前台接待智能体 前台接待员 初始化完成
2025-03-30 17:25:45,093 - Hospital-MultiAgent-System - INFO - 初始化 doctor 智能体: 主治医生 (ID: 5decd8d9-249b-44b6-8dae-7dd71fa87912)
2025-03-30 17:25:45,093 - Hospital-MultiAgent-System - INFO - 医生智能体 主治医生 (general) 初始化完成
2025-03-30 17:25:45,093 - Hospital-MultiAgent-System - INFO - 初始化 pharmacist 智能体: 药剂师 (ID: 654cf5e6-9cbb-4396-87e9-69afc1d9c1dc)
2025-03-30 17:25:45,093 - Hospital-MultiAgent-System - INFO - 药剂师智能体 药剂师 初始化完成
2025-03-30 17:25:45,093 - Hospital-MultiAgent-System - INFO - 编排器初始化完成
2025-03-30 17:25:45,093 - Hospital-MultiAgent-System-Web - INFO - 医院核心系统初始化成功。
2025-03-30 17:25:45,094 - Hospital-MultiAgent-System-Web - INFO - 启动 Flask Web 应用，地址: http://127.0.0.1:5000，调试模式: True
2025-03-30 17:25:45,106 - werkzeug - WARNING -  * Debugger is active!
2025-03-30 17:25:45,110 - werkzeug - INFO -  * Debugger PIN: 142-702-556
2025-03-30 17:26:06,915 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:26:06] "GET / HTTP/1.1" 200 -
2025-03-30 17:26:06,928 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:26:06] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 17:26:06,931 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:26:06] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 17:26:06,933 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:26:06] "GET /static/images/hospital_background.jpeg HTTP/1.1" 200 -
2025-03-30 17:26:06,937 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_1b22e080-832b-4614-ba5b-dfb96078db32
2025-03-30 17:26:06,937 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_1b22e080-832b-4614-ba5b-dfb96078db32
2025-03-30 17:26:06,938 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:26:06] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 17:26:40,257 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_1b22e080-832b-4614-ba5b-dfb96078db32): '你好...'
2025-03-30 17:26:40,257 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_1b22e080-832b-4614-ba5b-dfb96078db32，视为新对话，转给接待员。
2025-03-30 17:26:40,258 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_99deae9f 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T09:26:40.258496+00:00'}
2025-03-30 17:26:40,258 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_99deae9f 不存在，创建新的记忆记录。
2025-03-30 17:26:40,278 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_99deae9f (Name: 网页用户, Age: None)
2025-03-30 17:26:40,278 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_1b22e080-832b-4614-ba5b-dfb96078db32
2025-03-30 17:26:40,278 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_1b22e080-832b-4614-ba5b-dfb96078db32
2025-03-30 17:26:40,278 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_1b22e080-832b-4614-ba5b-dfb96078db32
2025-03-30 17:26:40,289 - Hospital-MultiAgent-System - INFO - 为咨询 web_1b22e080-832b-4614-ba5b-dfb96078db32 (Patient: WebPatient_99deae9f) 创建新上下文
2025-03-30 17:26:40,289 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_1b22e080-832b-4614-ba5b-dfb96078db32 (Patient: WebPatient_99deae9f)
2025-03-30 17:26:40,306 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 17:26:40,306 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 17:26:40,306 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 17:26:40,593 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:26:40,596 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:26:42,240 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:26:42,249 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.65秒
2025-03-30 17:26:42,249 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 17:26:42,249 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_99deae9f): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 17:26:42,249 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1，与诊断无关对话轮次: 1
2025-03-30 17:26:42,249 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 17:26:42,249 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 17:26:42,249 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 17:26:42,251 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:26:42,252 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:26:43,145 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:26:43,148 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.90秒
2025-03-30 17:26:43,148 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：你好！欢迎光临医院，请问有什么可以帮助您？如果需要预约医生，请简单描述症状，我们将为您安排合适的专家...
2025-03-30 17:26:43,193 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_1b22e080-832b-4614-ba5b-dfb96078db32): Status=in_progress, Agent=receptionist, Msg='你好！欢迎光临医院，请问有什么可以帮助您？如果需要预约医生，请简单描述症状，我们将为您安排合适的专家。...'
2025-03-30 17:26:43,194 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:26:43] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:30:08,148 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:30:08] "GET / HTTP/1.1" 200 -
2025-03-30 17:30:08,159 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:30:08] "GET /static/css/styles.css HTTP/1.1" 200 -
2025-03-30 17:30:08,159 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:30:08] "[36mGET /static/js/app.js HTTP/1.1[0m" 304 -
2025-03-30 17:30:08,168 - Hospital-MultiAgent-System - INFO - Orchestrator: 开始新的 Web 咨询，ID: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:30:08,168 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:30:08] "[36mGET /static/images/hospital_background.jpeg HTTP/1.1[0m" 304 -
2025-03-30 17:30:08,169 - Hospital-MultiAgent-System-Web - INFO - 为新 Web 会话 127.0.0.1 启动咨询，ID: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:30:08,169 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:30:08] "POST /api/start_consultation HTTP/1.1" 200 -
2025-03-30 17:30:14,424 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): '你好...'
2025-03-30 17:30:14,426 - Hospital-MultiAgent-System - INFO - 没有找到活跃上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d，视为新对话，转给接待员。
2025-03-30 17:30:14,426 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_0b6f2fb0 的基本信息: {'name': '网页用户', 'age': None, 'source': 'web', 'created_utc': '2025-03-30T09:30:14.426876+00:00'}
2025-03-30 17:30:14,427 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_0b6f2fb0 不存在，创建新的记忆记录。
2025-03-30 17:30:14,445 - Hospital-MultiAgent-System - INFO - 为网页交互创建初始患者 ID: WebPatient_0b6f2fb0 (Name: 网页用户, Age: None)
2025-03-30 17:30:14,445 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:30:14,445 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:30:14,445 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:30:14,457 - Hospital-MultiAgent-System - INFO - 为咨询 web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient: WebPatient_0b6f2fb0) 创建新上下文
2025-03-30 17:30:14,457 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient: WebPatient_0b6f2fb0)
2025-03-30 17:30:14,474 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 17:30:14,474 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 17:30:14,474 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好

用户最新消息:...
2025-03-30 17:30:14,640 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:30:14,642 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:30:17,471 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:30:17,473 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.83秒
2025-03-30 17:30:17,473 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 17:30:17,474 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0b6f2fb0): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 17:30:17,474 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 1，与诊断无关对话轮次: 1
2025-03-30 17:30:17,474 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 17:30:17,474 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 17:30:17,474 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："你好"。请给出一个简洁、专业、乐于助人但【绝对不涉及...
2025-03-30 17:30:17,478 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:30:17,481 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:30:18,318 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:30:18,320 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.84秒
2025-03-30 17:30:18,321 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：您好！欢迎光临医院，请问需要什么帮助？如需预约医生，请简单描述症状，我们将为您安排合适的科室和医生。
2025-03-30 17:30:18,373 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): Status=in_progress, Agent=receptionist, Msg='您好！欢迎光临医院，请问需要什么帮助？如需预约医生，请简单描述症状，我们将为您安排合适的科室和医生。...'
2025-03-30 17:30:18,373 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:30:18] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:30:30,378 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): '我想打篮球...'
2025-03-30 17:30:30,397 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient ID in context: WebPatient_0b6f2fb0), 当前阶段: reception_chatting
2025-03-30 17:30:30,398 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:30:30,418 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d, 当前阶段: reception_chatting
2025-03-30 17:30:30,427 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 17:30:30,427 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 17:30:30,427 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
User: 你好
Receptio...
2025-03-30 17:30:30,802 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:30:30,805 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:30:32,629 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:30:32,631 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.83秒
2025-03-30 17:30:32,631 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "unclear",
  "has_sufficient...
2025-03-30 17:30:32,632 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0b6f2fb0): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 17:30:32,632 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_0b6f2fb0)
2025-03-30 17:30:32,685 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 17:30:32,685 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:30:32] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:30:39,504 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): '和赵大夫打篮球...'
2025-03-30 17:30:39,523 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient ID in context: WebPatient_0b6f2fb0), 当前阶段: reception_clarification
2025-03-30 17:30:39,523 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:30:39,545 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d, 当前阶段: reception_clarification
2025-03-30 17:30:39,554 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 17:30:39,554 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 17:30:39,554 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 您好！...
2025-03-30 17:30:39,555 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:30:39,556 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:30:41,332 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:30:41,333 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.78秒
2025-03-30 17:30:41,334 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "unclear",
  "has_sufficient...
2025-03-30 17:30:41,334 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0b6f2fb0): Intent=unclear, SufficientInfo=False, Symptoms=[]
2025-03-30 17:30:41,334 - Hospital-MultiAgent-System - INFO - 用户意图不清或寻求引导 (Patient: WebPatient_0b6f2fb0)
2025-03-30 17:30:41,384 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): Status=in_progress, Agent=receptionist, Msg='嗯，请问您具体哪里不舒服呢？或者您想咨询什么问题？请尽量详细描述，以便我能更好地帮助您。...'
2025-03-30 17:30:41,385 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:30:41] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:30:47,161 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): '中午吃饭了吗？...'
2025-03-30 17:30:47,180 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient ID in context: WebPatient_0b6f2fb0), 当前阶段: reception_clarification
2025-03-30 17:30:47,180 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:30:47,200 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d, 当前阶段: reception_clarification
2025-03-30 17:30:47,208 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 17:30:47,208 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 17:30:47,208 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 嗯，请...
2025-03-30 17:30:47,620 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:30:47,622 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:30:49,428 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:30:49,430 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.81秒
2025-03-30 17:30:49,430 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "general_chat",
  "has_suffi...
2025-03-30 17:30:49,430 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0b6f2fb0): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 17:30:49,430 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 2，与诊断无关对话轮次: 2
2025-03-30 17:30:49,431 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：100，温度：0.6
2025-03-30 17:30:49,431 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗助手，提供准确、专业的医疗建议。
2025-03-30 17:30:49,431 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个专业、有礼貌的医院接待员。用户刚才说："中午吃饭了吗？"。请给出一个简洁、专业、乐于助人但【...
2025-03-30 17:30:49,433 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:30:49,436 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:30:50,487 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:30:50,490 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.05秒
2025-03-30 17:30:50,490 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：谢谢关心！我是医院接待员，随时为您提供帮助。如需挂号，请简要说明症状，我们会为您分诊安排合适的医生。
2025-03-30 17:30:50,543 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): Status=in_progress, Agent=receptionist, Msg='谢谢关心！我是医院接待员，随时为您提供帮助。如需挂号，请简要说明症状，我们会为您分诊安排合适的医生。...'
2025-03-30 17:30:50,543 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:30:50] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:30:59,963 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): '吃完饭打篮球？...'
2025-03-30 17:30:59,981 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient ID in context: WebPatient_0b6f2fb0), 当前阶段: reception_chatting
2025-03-30 17:30:59,981 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:31:00,002 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d, 当前阶段: reception_chatting
2025-03-30 17:31:00,011 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 17:31:00,011 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 17:31:00,011 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 嗯，请...
2025-03-30 17:31:00,467 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:31:00,469 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:31:02,246 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:31:02,248 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.78秒
2025-03-30 17:31:02,248 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "intent": "general_chat",
  "has_sufficient_me...
2025-03-30 17:31:02,248 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0b6f2fb0): Intent=general_chat, SufficientInfo=False, Symptoms=[]
2025-03-30 17:31:02,248 - Hospital-MultiAgent-System - INFO - 处理闲聊/找医生意图，当前轮次: 3，与诊断无关对话轮次: 3
2025-03-30 17:31:02,248 - Hospital-MultiAgent-System - INFO - 用户闲聊已达3轮，返回标准回复 (Patient: WebPatient_0b6f2fb0)
2025-03-30 17:31:02,299 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): Status=in_progress, Agent=receptionist, Msg='您交流过多和看诊无关的话题，请描述您的具体症状，或明天再来沟通。我们需要给其他病人留出更多时间，谢谢理解。...'
2025-03-30 17:31:02,300 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:31:02] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:31:37,891 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): '肚疼...'
2025-03-30 17:31:37,910 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient ID in context: WebPatient_0b6f2fb0), 当前阶段: reception_chat_ended
2025-03-30 17:31:37,910 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:31:37,931 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d, 当前阶段: reception_chat_ended
2025-03-30 17:31:37,939 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.1
2025-03-30 17:31:37,939 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个意图识别助手，请分析用户输入并以JSON格式返回结果。
2025-03-30 17:31:37,939 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一个医院接待AI，需要判断用户的意图。



最近对话片段:
Receptionist: 谢谢关...
2025-03-30 17:31:38,051 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:31:38,052 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:31:40,234 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:31:40,237 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.18秒
2025-03-30 17:31:40,238 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "intent": "medical_inquiry",
  "has_su...
2025-03-30 17:31:40,238 - Hospital-MultiAgent-System - INFO - 意图识别结果 (Patient WebPatient_0b6f2fb0): Intent=medical_inquiry, SufficientInfo=True, Symptoms=['肚疼']
2025-03-30 17:31:40,238 - Hospital-MultiAgent-System - INFO - 识别到医疗意图或提前提供身份，准备询问/确认身份信息 (Patient: WebPatient_0b6f2fb0)
2025-03-30 17:31:40,287 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): Status=in_progress, Agent=receptionist, Msg='了解您身体不适。为了更好地帮助您（特别是如果您之前来过），请问您的手机号码是多少？这次是复诊吗？...'
2025-03-30 17:31:40,287 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:31:40] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:31:58,408 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): '18610006666...'
2025-03-30 17:31:58,427 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient ID in context: WebPatient_0b6f2fb0), 当前阶段: reception_asking_identity
2025-03-30 17:31:58,427 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: receptionist (Name: 前台接待员), Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:31:58,446 - Hospital-MultiAgent-System - INFO - 找到现有上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d, 当前阶段: reception_asking_identity
2025-03-30 17:31:58,455 - Hospital-MultiAgent-System - INFO - 处理用户对身份问题的回复 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d)
2025-03-30 17:31:58,455 - Hospital-MultiAgent-System - INFO - 未找到匹配手机号的患者，或未提供手机号。将使用当前ID: WebPatient_0b6f2fb0
2025-03-30 17:31:58,455 - Hospital-MultiAgent-System - INFO - 更新患者 WebPatient_0b6f2fb0 的基本信息: {'phone': '18610006666', 'source': 'web', 'first_consultation_id': 'web_42bab133-e870-4e36-82b4-53fc9432e91d'}
2025-03-30 17:31:58,463 - Hospital-MultiAgent-System - INFO - 身份信息处理完毕，症状充分，准备分诊 (Patient: WebPatient_0b6f2fb0)
2025-03-30 17:31:58,463 - Hospital-MultiAgent-System - INFO - 执行分诊逻辑 (Patient: WebPatient_0b6f2fb0)
2025-03-30 17:31:58,463 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：200，温度：0.2
2025-03-30 17:31:58,463 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业的医院分诊助手，请仔细分析信息并给出结构化JSON输出。
2025-03-30 17:31:58,463 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：你是一位经验丰富的医院分诊接待员。请根据以下患者信息，推荐最合适的就诊科室，并评估紧急程度（普通、优...
2025-03-30 17:31:59,000 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:31:59,003 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:32:01,317 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:32:01,321 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.32秒
2025-03-30 17:32:01,321 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "department": "内科",
  "priority": "nor...
2025-03-30 17:32:01,322 - Hospital-MultiAgent-System - INFO - 分诊结果: 科室=内科, 优先级=normal
2025-03-30 17:32:01,366 - Hospital-MultiAgent-System - INFO - 接待流程完成 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d)，准备触发医生诊断。
2025-03-30 17:32:01,374 - Hospital-MultiAgent-System - INFO - 触发医生诊断流程 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d, Patient: WebPatient_0b6f2fb0)...
2025-03-30 17:32:01,381 - Hospital-MultiAgent-System - INFO - 医生 主治医生 开始处理患者 WebPatient_0b6f2fb0 的诊断请求 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d)。复诊: False
2025-03-30 17:32:01,381 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 17:32:01,381 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 17:32:01,381 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 17:32:01,383 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:32:01,384 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:32:02,098 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:32:02,100 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.72秒
2025-03-30 17:32:02,100 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：肚子疼具体是哪个部位？是上腹部、下腹部还是整个腹部？
2025-03-30 17:32:02,101 - Hospital-MultiAgent-System - INFO - 保存问诊上下文: web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient: WebPatient_0b6f2fb0)
2025-03-30 17:32:02,152 - Hospital-MultiAgent-System - INFO - 医生对初始诊断请求的响应状态: in_consultation (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d)
2025-03-30 17:32:02,159 - Hospital-MultiAgent-System - INFO - 成功转接给医生 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d)
2025-03-30 17:32:02,166 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): Status=in_progress, Agent=doctor, Msg='肚子疼具体是哪个部位？是上腹部、下腹部还是整个腹部？...'
2025-03-30 17:32:02,167 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:32:02] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:32:07,341 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): '上腹...'
2025-03-30 17:32:07,361 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient ID in context: WebPatient_0b6f2fb0), 当前阶段: information_gathering
2025-03-30 17:32:07,361 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:32:07,382 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_0b6f2fb0 对问题 (Context: web_42bab133-e870-4e36-82b4-53fc9432e91d) 的回答: '上腹...'
2025-03-30 17:32:07,390 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 17:32:07,390 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 17:32:07,390 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "肚子疼具体是...
2025-03-30 17:32:07,391 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:32:07,393 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:32:10,831 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:32:10,833 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：3.44秒
2025-03-30 17:32:10,833 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["上腹部疼痛"],
  "symptom_...
2025-03-30 17:32:10,833 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_0b6f2fb0 回答分析完成。当前症状: ['用户描述不清晰', '上腹部疼痛', '肚疼']. 置信度: 0.40
2025-03-30 17:32:10,833 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_0b6f2fb0 (Context: web_42bab133-e870-4e36-82b4-53fc9432e91d) 提出下一个问题。
2025-03-30 17:32:10,833 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 17:32:10,833 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 17:32:10,833 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 17:32:10,836 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:32:10,837 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:32:11,508 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:32:11,510 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.67秒
2025-03-30 17:32:11,510 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是什么时候开始的？持续时间有多久？
2025-03-30 17:32:11,567 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): Status=in_progress, Agent=doctor, Msg='疼痛是什么时候开始的？持续时间有多久？...'
2025-03-30 17:32:11,567 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:32:11] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:32:42,945 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): '昨天下午持续24小时...'
2025-03-30 17:32:42,966 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient ID in context: WebPatient_0b6f2fb0), 当前阶段: information_gathering
2025-03-30 17:32:42,966 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:32:42,989 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_0b6f2fb0 对问题 (Context: web_42bab133-e870-4e36-82b4-53fc9432e91d) 的回答: '昨天下午持续24小时...'
2025-03-30 17:32:42,997 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 17:32:42,998 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 17:32:42,998 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是什么时...
2025-03-30 17:32:43,458 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:32:43,460 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:32:46,429 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:32:46,432 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.97秒
2025-03-30 17:32:46,432 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": [],
  "symptom_details...
2025-03-30 17:32:46,432 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_0b6f2fb0 回答分析完成。当前症状: ['用户描述不清晰', '上腹部疼痛', '肚疼']. 置信度: 0.50
2025-03-30 17:32:46,433 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_0b6f2fb0 (Context: web_42bab133-e870-4e36-82b4-53fc9432e91d) 提出下一个问题。
2025-03-30 17:32:46,433 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 17:32:46,433 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 17:32:46,433 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 17:32:46,436 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:32:46,438 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:32:47,287 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:32:47,289 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.85秒
2025-03-30 17:32:47,290 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛的性质是怎样的？是隐隐作痛、刺痛、灼痛还是胀痛？
2025-03-30 17:32:47,351 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): Status=in_progress, Agent=doctor, Msg='疼痛的性质是怎样的？是隐隐作痛、刺痛、灼痛还是胀痛？...'
2025-03-30 17:32:47,351 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:32:47] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:32:50,822 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): '刺痛...'
2025-03-30 17:32:50,845 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient ID in context: WebPatient_0b6f2fb0), 当前阶段: information_gathering
2025-03-30 17:32:50,845 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:32:50,863 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_0b6f2fb0 对问题 (Context: web_42bab133-e870-4e36-82b4-53fc9432e91d) 的回答: '刺痛...'
2025-03-30 17:32:50,871 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 17:32:50,871 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 17:32:50,872 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛的性质是...
2025-03-30 17:32:50,873 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:32:50,874 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:32:52,302 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:32:52,305 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：1.43秒
2025-03-30 17:32:52,306 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["刺痛"],
  "symptom_det...
2025-03-30 17:32:52,306 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_0b6f2fb0 回答分析完成。当前症状: ['刺痛', '用户描述不清晰', '肚疼', '上腹部疼痛']. 置信度: 0.60
2025-03-30 17:32:52,306 - Hospital-MultiAgent-System - INFO - 医生 主治医生 需要向患者 WebPatient_0b6f2fb0 (Context: web_42bab133-e870-4e36-82b4-53fc9432e91d) 提出下一个问题。
2025-03-30 17:32:52,306 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.6
2025-03-30 17:32:52,306 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位专业医生，正在进行交互式问诊。请提出精准、简洁的下一个问题。
2025-03-30 17:32:52,306 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位专业医生，根据以下问诊上下文信息生成下一个有针对性的问题:
患者ID: WebPatient...
2025-03-30 17:32:52,307 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:32:52,308 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:32:53,233 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:32:53,237 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.93秒
2025-03-30 17:32:53,237 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：疼痛是否伴随其他症状，例如恶心、呕吐、腹泻、发热或食欲下降？
2025-03-30 17:32:53,298 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): Status=in_progress, Agent=doctor, Msg='疼痛是否伴随其他症状，例如恶心、呕吐、腹泻、发热或食欲下降？...'
2025-03-30 17:32:53,298 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:32:53] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:32:55,700 - Hospital-MultiAgent-System - INFO - Orchestrator: 处理 Web 消息 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): '恶心...'
2025-03-30 17:32:55,722 - Hospital-MultiAgent-System - INFO - 找到活跃上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient ID in context: WebPatient_0b6f2fb0), 当前阶段: information_gathering
2025-03-30 17:32:55,722 - Hospital-MultiAgent-System - INFO - 将消息转发给 Agent: doctor (Name: 主治医生), Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:32:55,742 - Hospital-MultiAgent-System - INFO - 医生 主治医生 收到患者 WebPatient_0b6f2fb0 对问题 (Context: web_42bab133-e870-4e36-82b4-53fc9432e91d) 的回答: '恶心...'
2025-03-30 17:32:55,751 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：300，温度：0.1
2025-03-30 17:32:55,751 - Hospital-MultiAgent-System - INFO - 系统消息：你是一个医疗信息提取和分析助手。请仔细分析医患对话并按要求输出JSON。
2025-03-30 17:32:55,751 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医疗信息分析员，请分析患者对以下问题的回答，并提取关键信息:

医生的问题: "疼痛是否伴随...
2025-03-30 17:32:55,753 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:32:55,754 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:32:56,675 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:32:56,679 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：0.92秒
2025-03-30 17:32:56,680 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "new_symptoms": ["恶心"],
  "symptom_det...
2025-03-30 17:32:56,680 - Hospital-MultiAgent-System - INFO - 患者 WebPatient_0b6f2fb0 回答分析完成。当前症状: ['用户描述不清晰', '上腹部疼痛', '肚疼', '恶心', '刺痛']. 置信度: 0.70
2025-03-30 17:32:56,680 - Hospital-MultiAgent-System - INFO - 可以诊断：问题数 4 >= 4 且置信度 0.70 > 0.4
2025-03-30 17:32:56,680 - Hospital-MultiAgent-System - INFO - 医生 主治医生 可以为患者 WebPatient_0b6f2fb0 (Context: web_42bab133-e870-4e36-82b4-53fc9432e91d) 做出诊断。
2025-03-30 17:32:56,680 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：1000，温度：0.3
2025-03-30 17:32:56,680 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位资深医生，正在进行诊断。请给出专业、简洁且结构化的诊断结果（JSON格式）。
2025-03-30 17:32:56,680 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为专业医生，请根据以下信息生成诊断结果：
症状：用户描述不清晰, 上腹部疼痛, 肚疼, 恶心, 刺...
2025-03-30 17:32:56,682 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:32:56,684 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:32:59,472 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:32:59,475 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.79秒
2025-03-30 17:32:59,475 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：```json
{
  "condition": "功能性消化不良",
  "explanation...
2025-03-30 17:32:59,475 - Hospital-MultiAgent-System - INFO - 为症状 '用户描述不清晰, 上腹部疼痛, 肚疼, 恶心, 刺痛' 生成诊断结果：功能性消化不良
2025-03-30 17:32:59,500 - Hospital-MultiAgent-System - INFO - 删除问诊上下文: web_42bab133-e870-4e36-82b4-53fc9432e91d (Patient: WebPatient_0b6f2fb0)
2025-03-30 17:32:59,520 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:32:59,520 - Hospital-MultiAgent-System - INFO - 医生完成诊断 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d, Patient: WebPatient_0b6f2fb0)
2025-03-30 17:32:59,520 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:32:59,520 - Hospital-MultiAgent-System - INFO - 诊断完成，需开药，触发审核 (Patient: WebPatient_0b6f2fb0, Context: web_42bab133-e870-4e36-82b4-53fc9432e91d)
2025-03-30 17:32:59,520 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:32:59,520 - Hospital-MultiAgent-System - INFO - 向药剂师发送处方审核请求 (Patient: WebPatient_0b6f2fb0)...
2025-03-30 17:32:59,528 - Hospital-MultiAgent-System - INFO - 药剂师 药剂师 正在审核患者 WebPatient_0b6f2fb0 的处方...
2025-03-30 17:32:59,528 - Hospital-MultiAgent-System - INFO - 正在调用LLM API，模型：gpt-4o，最大令牌：800，温度：0.1
2025-03-30 17:32:59,528 - Hospital-MultiAgent-System - INFO - 系统消息：你是一位经验丰富、极其严谨的临床药剂师。请仔细检查处方，并【严格按照要求的JSON格式】输出反馈，【...
2025-03-30 17:32:59,528 - Hospital-MultiAgent-System - INFO - 提示词（前50个字符）：作为一位资深临床药剂师，请基于患者的部分诊断信息和以下处方，严格审核其合理性、安全性及潜在风险。

...
2025-03-30 17:32:59,994 - Hospital-MultiAgent-System - INFO - 成功解析主机名 bysnd.openai.azure.com 到 IP：20.232.91.180
2025-03-30 17:32:59,996 - Hospital-MultiAgent-System - INFO - 成功连接到 bysnd.openai.azure.com:443
2025-03-30 17:33:02,545 - httpx - INFO - HTTP Request: POST https://bysnd.openai.azure.com//openai/deployments/gpt-4o/chat/completions?api-version=2024-05-01-preview "HTTP/1.1 200 OK"
2025-03-30 17:33:02,547 - Hospital-MultiAgent-System - INFO - LLM API调用成功，耗时：2.55秒
2025-03-30 17:33:02,548 - Hospital-MultiAgent-System - INFO - 响应内容（前50个字符）：{
  "valid": false,
  "issues": ["疗程未指定", "奥美拉唑的用法...
2025-03-30 17:33:02,548 - Hospital-MultiAgent-System - INFO - 处方审核LLM解析成功: Valid=False, Issues=2, Warnings=1
2025-03-30 17:33:02,572 - Hospital-MultiAgent-System - WARNING - 患者 WebPatient_0b6f2fb0 的处方未通过审核: 疗程未指定、奥美拉唑的用法未明确是否在餐前或餐后
2025-03-30 17:33:02,583 - Hospital-MultiAgent-System - INFO - 收到药剂师审核响应 (Patient: WebPatient_0b6f2fb0)。Status: rejected
2025-03-30 17:33:02,583 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:33:02,583 - Hospital-MultiAgent-System - WARNING - 处方审核被拒绝 (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): ['疗程未指定', '奥美拉唑的用法未明确是否在餐前或餐后']
2025-03-30 17:33:02,583 - Hospital-MultiAgent-System - INFO - Web 咨询 web_42bab133-e870-4e36-82b4-53fc9432e91d 结束: error_prescription_rejected
2025-03-30 17:33:02,583 - Hospital-MultiAgent-System - WARNING - 无法记录交互事件: 找不到上下文 web_42bab133-e870-4e36-82b4-53fc9432e91d
2025-03-30 17:33:02,592 - Hospital-MultiAgent-System - INFO - Orchestrator: 返回给 Web (Consultation: web_42bab133-e870-4e36-82b4-53fc9432e91d): Status=error_prescription_rejected, Agent=doctor, Msg='感谢您的配合。根据您提供的信息，我已完成初步诊断。
处方审核未通过: 疗程未指定、奥美拉唑的用法未明确是否在餐前或餐后。处方存在用法和疗程不...'
2025-03-30 17:33:02,593 - Hospital-MultiAgent-System-Web - INFO - Web 咨询 web_42bab133-e870-4e36-82b4-53fc9432e91d 已达到结束状态: error_prescription_rejected
2025-03-30 17:33:02,593 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:33:02] "POST /api/conversation HTTP/1.1" 200 -
2025-03-30 17:33:53,409 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:33:53] "GET /logs HTTP/1.1" 200 -
2025-03-30 17:33:53,417 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:33:53] "[36mGET /static/css/styles.css HTTP/1.1[0m" 304 -
2025-03-30 17:33:53,422 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:33:53] "GET /api/interaction_logs HTTP/1.1" 200 -
2025-03-30 17:33:53,423 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:33:53] "[36mGET /static/images/hospital_background.jpeg HTTP/1.1[0m" 304 -
2025-03-30 17:34:04,719 - werkzeug - INFO - 127.0.0.1 - - [30/Mar/2025 17:34:04] "GET /api/interaction_logs/web_42bab133-e870-4e36-82b4-53fc9432e91d HTTP/1.1" 200 -
